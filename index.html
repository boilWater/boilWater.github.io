<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <link rel="dns-prefetch" href="http://yoursite.com">
  <title>JackJin&#39;s 博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="JackJin's 博客">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="JackJin's 博客">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JackJin's 博客">
<meta name="twitter:description">
  
    <link rel="alternative" href="/atom.xml" title="JackJin&#39;s 博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" type="text/css" href="/./main.b3331d.css">
  <style type="text/css">
  
    #container.show {
      background: linear-gradient(200deg,#a0cfe4,#e8c37e);
    }
  </style>
  

  

</head>

<body>
  <div id="container" q-class="show:isCtnShow">
    <canvas id="anm-canvas" class="anm-canvas"></canvas>
    <div class="left-col" q-class="show:isShow">
      
<div class="overlay" style="background: #4d4d4d"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			<img src="null" class="js-avatar">
		</a>
		<hgroup>
		  <h1 class="header-author"><a href="/">JackJin</a></h1>
		</hgroup>
		
		<p class="header-subtitle">一位脚踏实地，拥有梦想的90后，想要一直努力追上你！</p>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
				<li><a href="/tags/随笔/">随笔</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
    		
    			
    			<a q-on="click: openSlider(e, 'innerArchive')" href="javascript:void(0)">所有文章</a>
    			
            
    			
    			<a q-on="click: openSlider(e, 'friends')" href="javascript:void(0)">友链</a>
    			
            
    			
    			<a q-on="click: openSlider(e, 'aboutme')" href="javascript:void(0)">关于我</a>
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="#" title="github"><i class="icon-github"></i></a>
		        
					<a class="weibo" target="_blank" href="#" title="weibo"><i class="icon-weibo"></i></a>
		        
					<a class="rss" target="_blank" href="#" title="rss"><i class="icon-rss"></i></a>
		        
					<a class="zhihu" target="_blank" href="#" title="zhihu"><i class="icon-zhihu"></i></a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col" q-class="show:isShow,hide:isShow|isFalse">
      
<nav id="mobile-nav">
  	<div class="overlay js-overlay" style="background: #4d4d4d"></div>
	<div class="btnctn js-mobile-btnctn">
  		<div class="slider-trigger list" q-on="click: openSlider(e)"><i class="icon icon-sort"></i></div>
	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img src="null" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author js-header-author">JackJin</h1>
			</hgroup>
			
			<p class="header-subtitle"><i class="icon icon-quo-left"></i>一位脚踏实地，拥有梦想的90后，想要一直努力追上你！<i class="icon icon-quo-right"></i></p>
			
			
			
				
			
				
			
			
			
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="#" title="github"><i class="icon-github"></i></a>
			        
						<a class="weibo" target="_blank" href="#" title="weibo"><i class="icon-weibo"></i></a>
			        
						<a class="rss" target="_blank" href="#" title="rss"><i class="icon-rss"></i></a>
			        
						<a class="zhihu" target="_blank" href="#" title="zhihu"><i class="icon-zhihu"></i></a>
			        
				</div>
			</nav>

			<nav class="header-menu js-header-menu">
				<ul style="width: 50%">
				
				
					<li style="width: 50%"><a href="/">主页</a></li>
		        
					<li style="width: 50%"><a href="/tags/随笔/">随笔</a></li>
		        
				</ul>
			</nav>
		</header>				
	</div>
	<div class="mobile-mask" style="display:none" q-show="isShow"></div>
</nav>

      <div id="wrapper" class="body-wrap">
        <div class="menu-l">
          <div class="canvas-wrap">
            <canvas data-colors="#eaeaea" data-sectionHeight="100" data-contentId="js-content" id="myCanvas1" class="anm-canvas"></canvas>
          </div>
          <div id="js-content" class="content-ll">
            
  
    <article id="post-NSError(错误信息)" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/31/NSError(错误信息)/">iOS-开发过程中的错误处理</a>
    </h1>
  

        
        <a href="/2017/05/31/NSError(错误信息)/" class="archive-article-date">
  	<time datetime="2017-05-31T06:35:13.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2017-05-31</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>开发过过程中我们经常会遇到异常问题</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1877765-ebec37c09e21ba91.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="iOS异常.png"></p>
<h1 id="iOS-开发过程中的错误处理"><a href="#iOS-开发过程中的错误处理" class="headerlink" title="iOS-开发过程中的错误处理"></a>iOS-开发过程中的错误处理</h1><p>我们在程序开发过程中经常会遇到异常，对异常的处理一般采用打印或者直接抛出。这样也可以很方便我们调试过程有所参考，而且方便我们查看异常产生的位置信息</p>
<h3 id="NSError-错误信息"><a href="#NSError-错误信息" class="headerlink" title="NSError(错误信息)"></a>NSError(错误信息)</h3><h4 id="采用NSError的情况"><a href="#采用NSError的情况" class="headerlink" title="采用NSError的情况"></a>采用NSError的情况</h4><p>  使用 <code>NSError</code> 的形式可以把程序中导致错误原因回报给调用者，而且使程序正常运行不会造成奔溃的后果</p>
<h4 id="NSError包含的内容"><a href="#NSError包含的内容" class="headerlink" title="NSError包含的内容"></a>NSError包含的内容</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NSError</span> : <span class="title">NSObject</span> &lt;<span class="title">NSCopying</span>, <span class="title">NSSecureCoding</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">@private</span></span><br><span class="line">    <span class="keyword">void</span> *_reserved;</span><br><span class="line">    <span class="built_in">NSInteger</span> _code;</span><br><span class="line">    <span class="built_in">NSString</span> *_domain;</span><br><span class="line">    <span class="built_in">NSDictionary</span> *_userInfo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>NSError _code</code>（错误码， 类型 <code>NSInteger</code>)  ： 独有的错误代码，指明在某个范围内具体发生的错误。可能是一系列的错误的集合，所以可以使用 Enum 来定义。</li>
<li><code>NSError *_domain</code> (错误范围，类型 <code>NSString</code>) ：错误发生范围，通常使用一个特有的全局变量来定义。</li>
<li><code>NSError *_userInfo</code> (用户信息，类型 <code>NSDictionary</code>) ：有关错误的额外信息，其中包含一段“本地化的描述”，还可能包含导致此错误发生的另一个错误。userInfo 可以描述为一条错误的链条</li>
</ul>
<h4 id="NSError使用的两种情况"><a href="#NSError使用的两种情况" class="headerlink" title="NSError使用的两种情况"></a>NSError使用的两种情况</h4><p>   在方法实现或者是 API 设计时，我们对 <code>NSError</code> 的使用情形有两种：在协议中传递和“输出参数”返回给调用者</p>
<ol>
<li>通过委托协议来传递错误</li>
</ol>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)connection:(<span class="built_in">NSURLConnection</span> *)connection withError:(<span class="built_in">NSError</span> *)error;</span><br></pre></td></tr></table></figure>
<p>通过代理协议的方式可以把错误报告信息传递</p>
<p>  2.“输出参数”返回给调用者</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">BOOL</span>)doSomething:(<span class="built_in">NSError</span> **)error;</span><br></pre></td></tr></table></figure>
<p>错误的信息作为一个指向指针的指针（也就是说一个指针指向错误的对象）</p>
<h3 id="throw-NSException-异常抛出"><a href="#throw-NSException-异常抛出" class="headerlink" title="@throw NSException (异常抛出)"></a>@throw NSException (异常抛出)</h3><h4 id="采用-throw-情况"><a href="#采用-throw-情况" class="headerlink" title="采用 @throw 情况"></a>采用 @throw 情况</h4><p>在 APP 运行期间遇到问题，需要对问题进行操作终止程序抛出异常，可以使用 <code>@throw</code> 来进行</p>
<h4 id="采用-throw-可能产生问题"><a href="#采用-throw-可能产生问题" class="headerlink" title="采用 @throw 可能产生问题"></a>采用 @throw 可能产生问题</h4><p>在异常抛出实例中，如果抛出异常。在实现抛出异常的代码后面的执行释放资源就不会执行，这样末尾的对象就不会被释放。如果想要生成“异常安全”的代码，可以设置编译器的标志 <code>-fobjc-arc-exceptions</code> 来进行实现。不过将要一如加一些额外的代码，在不抛出异常时也会执行代码。<br>在不使用 ARC 时也很难实现异常抛出情况下对内存进行释放。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSError</span> * error = <span class="literal">nil</span>;</span><br><span class="line"><span class="built_in">BOOL</span> success = [<span class="keyword">self</span> doSomething:&amp;error];</span><br><span class="line"><span class="keyword">if</span>(error &amp;&amp; success) &#123;</span><br><span class="line">     <span class="keyword">@throw</span>[<span class="built_in">NSException</span> …];</span><br><span class="line">&#125;</span><br><span class="line">[success release];</span><br></pre></td></tr></table></figure>
<p>按照上面👆实现当在异常抛出的过程时，success 还来不及释放。所以要解决上面的问题可以在异常抛出之前对 success 进行释放，但是当需要释放的资源有很多的情况下，这样操作起来就比较复杂。</p>
<p>在开发过程中异常抛出可以使用在 抽象的基类 实例方法中进行调用。如果基类中的方法不被 <code>override</code> 就设置抛出异常，这样可以保证实例方法被重写。</p>
<h3 id="try-catch-finally-异常捕捉"><a href="#try-catch-finally-异常捕捉" class="headerlink" title="@try @catch @finally (异常捕捉)"></a>@try @catch @finally (异常捕捉)</h3><h4 id="采用-try-catch-finally-情况"><a href="#采用-try-catch-finally-情况" class="headerlink" title="采用 @try @catch @finally 情况"></a>采用 @try @catch @finally 情况</h4><p>个人感觉 @try @catch @finally 是 @throw NSException 的加强版。前者可以实现对异常的捕捉，相关异常的输出，和异常输出后执行的 @finally 相关的具体操作。后者是对具体整理 NSExpection 抛出，并没有前者比较完善的流程化操作步骤。</p>
<p>如果在基类中实现 @throw 进行设置 必须 override 基类中的实例方法，那么捕获异常的方法中使用 @try @catch @finally。例如：NSArray，NSDictionary 初始变量使用字面量来获取值时，需要判断返回数据是否为 nil 来防止 APP Crash。 </p>
<h4 id="产生问题和解决方式"><a href="#产生问题和解决方式" class="headerlink" title="产生问题和解决方式"></a>产生问题和解决方式</h4><p>当使用 <code>@try @catch @finally</code> 时，有两种情况 <code>MRC</code> 和 <code>ARC</code>。</p>
<p><code>MRC</code>（iOS 5 之前） 的环境中，上面的代码可以展示为：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">SomeClass *someClass = <span class="literal">nil</span>;</span><br><span class="line"><span class="keyword">@try</span> &#123;</span><br><span class="line">       someClass = [[SomeClass alloc] init];</span><br><span class="line">       [someClass doSomeThingsThatMayThrow];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@catch</span>() &#123;</span><br><span class="line">     <span class="built_in">NSLog</span>(… …);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@finally</span> &#123;</span><br><span class="line">     [someClass release];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 ARC 的环境中，上面的代码展示为：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">SomeClass *someClass = <span class="literal">nil</span>;</span><br><span class="line"><span class="keyword">@try</span> &#123;</span><br><span class="line">       someClass = [[SomeClass alloc] init];</span><br><span class="line">       [someClass doSomeThingsThatMayThrow];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@catch</span>( … ) &#123;</span><br><span class="line">     <span class="built_in">NSLog</span>(… …);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@finally</span> &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>可以看出在 MRC 的情形下可以实现对于内存的释放，在 ARC 的情形下会系统会实现对内存的释放? 这样向正确吗？</p>
</blockquote>
<p>答案是：ARC 不会自动处理，因为如果要实现自动处理可能要加入大量的代码，才可以清楚对象实现抛出异常时将其清理。但是如果加入代码就会影响运行时的性能，在正常运行时也会如此。<br>如果在当前实现中开启 <code>-fobjc-arc-exception</code> 的模式可以实现在 <code>@try @catch @finally</code> 在异常情况下实现对未释放的对象进行内存的释放管理</p>
<h4 id="try-catch-finally-的-C-源码"><a href="#try-catch-finally-的-C-源码" class="headerlink" title="@try@catch@finally 的 C++ 源码"></a>@try@catch@finally 的 C++ 源码</h4><p>查看异常抛出的源码：<br>建立项目在 <code>main.m</code> 文件中实现下面代码：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">@try</span> &#123;</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="keyword">@catch</span> (<span class="built_in">NSException</span> *exception) &#123;</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="keyword">@finally</span> &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>打开终端在 <code>main.m</code> 终端的文件夹路径执行下面的语句</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clang -x objective-c -rewrite-objc -isysroot /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator.sdk main.m</span><br></pre></td></tr></table></figure>
<p>会生成文件 <code>main.cpp</code> 的文件，可以打开查看文 <code>@try @catch @fianlly</code></p>
<h5 id="NSExpection-属性内容"><a href="#NSExpection-属性内容" class="headerlink" title="NSExpection 属性内容"></a>NSExpection 属性内容</h5><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">__attribute__((__objc_exception__))</span><br><span class="line"></span><br><span class="line"><span class="meta">#ifndef _REWRITER_typedef_NSException</span></span><br><span class="line"><span class="meta">#define _REWRITER_typedef_NSException</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> objc_object <span class="built_in">NSException</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;&#125; _objc_exc_NSException;</span><br><span class="line"><span class="meta">#endif</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="built_in">NSException_IMPL</span> &#123;</span><br><span class="line">	<span class="keyword">struct</span> <span class="built_in">NSObject_IMPL</span> <span class="built_in">NSObject_IVARS</span>; <span class="comment">//实例变量</span></span><br><span class="line">	<span class="built_in">NSString</span> *name;                      <span class="comment">//exception 的名字</span></span><br><span class="line">	<span class="built_in">NSString</span> *reason;                    <span class="comment">//exception 产生的原因</span></span><br><span class="line">	<span class="built_in">NSDictionary</span> *userInfo;              <span class="comment">//exception 展示使用详细的信息</span></span><br><span class="line">	<span class="keyword">id</span> reserved;                         <span class="comment">//</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h5 id="NSError-属性内容"><a href="#NSError-属性内容" class="headerlink" title="NSError 属性内容"></a>NSError 属性内容</h5><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#ifndef _REWRITER_typedef_NSError</span></span><br><span class="line"><span class="meta">#define _REWRITER_typedef_NSError</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> objc_object <span class="built_in">NSError</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;&#125; _objc_exc_NSError;</span><br><span class="line"><span class="meta">#endif</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="built_in">NSError_IMPL</span> &#123;</span><br><span class="line">	<span class="keyword">struct</span> <span class="built_in">NSObject_IMPL</span> <span class="built_in">NSObject_IVARS</span>; <span class="comment">//实例变量</span></span><br><span class="line">	<span class="keyword">void</span> *_reserved;                     <span class="comment">//实例调用的方法</span></span><br><span class="line">	<span class="built_in">NSInteger</span> _code;                     <span class="comment">//error 错误码</span></span><br><span class="line">	<span class="built_in">NSString</span> *_domain;                   <span class="comment">//error 错误发生范围</span></span><br><span class="line">	<span class="built_in">NSDictionary</span> *_userInfo;             <span class="comment">//error 错误描述的具体信息</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>下面在 <code>main.m</code> 中使用 <code>Clang</code> 解析 <code>@try @catch @finally</code> 在 C++ 环境中解析</p>
<ul><br><li>没有参数<br></li><br><br><li>有参数<br></li><br></ul>

<h5 id="没有参数"><a href="#没有参数" class="headerlink" title="没有参数"></a>没有参数</h5><p>在没有参数的情况下</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> main() &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">@try</span> &#123;</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="keyword">@catch</span> (<span class="built_in">NSException</span> *exception) &#123;</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="keyword">@finally</span> &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>经过 Clang 解析后源码如下：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> main() &#123;</span><br><span class="line"></span><br><span class="line">&#123; <span class="keyword">id</span> <span class="keyword">volatile</span> _rethrow = <span class="number">0</span>;</span><br><span class="line">	try &#123;</span><br><span class="line">		try &#123;</span><br><span class="line">		         <span class="comment">//异常捕获</span></span><br><span class="line">		    &#125; catch (_objc_exc_NSException *_exception) &#123;</span><br><span class="line">		         <span class="built_in">NSException</span> *exception = (<span class="built_in">NSException</span>*)_exception; </span><br><span class="line">		         <span class="comment">//捕获异常，并进行抛出</span></span><br><span class="line">		    &#125; </span><br><span class="line">	    &#125;</span><br><span class="line">	catch (<span class="keyword">id</span> e) &#123;</span><br><span class="line">	     _rethrow = e;</span><br><span class="line">	    &#125;</span><br><span class="line">	&#123;  </span><br><span class="line">	  <span class="keyword">struct</span> _FIN &#123; _FIN(<span class="keyword">id</span> reth) : rethrow(reth) &#123;&#125;</span><br><span class="line">		~_FIN() &#123; <span class="keyword">if</span> (rethrow) objc_exception_throw(rethrow); &#125;</span><br><span class="line">		<span class="keyword">id</span> rethrow;</span><br><span class="line">		&#125; _fin_force_rethow(_rethrow);</span><br><span class="line">		   <span class="comment">//异常抛出后执行的 finally 的内容</span></span><br><span class="line">	    &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">struct</span> IMAGE_INFO &#123; <span class="keyword">unsigned</span> version; <span class="keyword">unsigned</span> flag; &#125; _OBJC_IMAGE_INFO = &#123; <span class="number">0</span>, <span class="number">2</span> &#125;;</span><br></pre></td></tr></table></figure>
<h5 id="有参数"><a href="#有参数" class="headerlink" title="有参数"></a>有参数</h5><p>在有参数的情况下</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> main() &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSDictionary</span> *dic = @&#123;<span class="string">@"name"</span>:<span class="string">@"liang"</span>,</span><br><span class="line">                          <span class="string">@"last name"</span>:<span class="string">@"bai"</span>,</span><br><span class="line">                          <span class="string">@"dream"</span>:<span class="string">@"to be a bussinessman"</span>,</span><br><span class="line">                          <span class="string">@"work"</span>:<span class="string">@"IT"</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSString</span> *salaryLiterals = <span class="literal">nil</span>;</span><br><span class="line">    <span class="built_in">NSString</span> *salaryAtIndex = <span class="literal">nil</span>;</span><br><span class="line">    <span class="keyword">@try</span> &#123;</span><br><span class="line">        </span><br><span class="line">        salaryAtIndex = [dic objectForKey:<span class="string">@"salary"</span>];</span><br><span class="line">        salaryLiterals = dic[<span class="string">@"salary"</span>];</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="keyword">@catch</span> (<span class="built_in">NSException</span> *exception) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"error name is %@, reason : %@, userInfo : %@"</span>, exception.name, exception.reason, exception.userInfo);</span><br><span class="line">    &#125; <span class="keyword">@finally</span> &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>经过 Clang 解析后源码如下：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> main() &#123;</span><br><span class="line">    <span class="built_in">NSDictionary</span> *dic = ((<span class="built_in">NSDictionary</span> *(*)(Class, SEL, <span class="keyword">const</span> ObjectType *, <span class="keyword">const</span> <span class="keyword">id</span> *, <span class="built_in">NSUInteger</span>))(<span class="keyword">void</span> *)objc_msgSend)(objc_getClass(<span class="string">"NSDictionary"</span>), </span><br><span class="line">sel_registerName(<span class="string">"dictionaryWithObjects:forKeys:count:"</span>), </span><br><span class="line">(<span class="keyword">const</span> <span class="keyword">id</span> *)__NSContainer_literal(<span class="number">4</span>U, (<span class="built_in">NSString</span> *)&amp;__NSConstantStringImpl__var_folders_tv_4c43vcqx24vcxx6d51n4ntc00000gn_T_main_753a25_mi_1,</span><br><span class="line">(<span class="built_in">NSString</span> *)&amp;__NSConstantStringImpl__var_folders_tv_4c43vcqx24vcxx6d51n4ntc00000gn_T_main_753a25_mi_3, </span><br><span class="line">(<span class="built_in">NSString</span> *)&amp;__NSConstantStringImpl__var_folders_tv_4c43vcqx24vcxx6d51n4ntc00000gn_T_main_753a25_mi_5, </span><br><span class="line">(<span class="built_in">NSString</span> *)&amp;__NSConstantStringImpl__var_folders_tv_4c43vcqx24vcxx6d51n4ntc00000gn_T_main_753a25_mi_7).arr,</span><br><span class="line">(<span class="keyword">const</span> <span class="keyword">id</span> *)__NSContainer_literal(<span class="number">4</span>U, (<span class="built_in">NSString</span> *)&amp;__NSConstantStringImpl__var_folders_tv_4c43vcqx24vcxx6d51n4ntc00000gn_T_main_753a25_mi_0, </span><br><span class="line">(<span class="built_in">NSString</span> *)&amp;__NSConstantStringImpl__var_folders_tv_4c43vcqx24vcxx6d51n4ntc00000gn_T_main_753a25_mi_2,</span><br><span class="line">(<span class="built_in">NSString</span> *)&amp;__NSConstantStringImpl__var_folders_tv_4c43vcqx24vcxx6d51n4ntc00000gn_T_main_753a25_mi_4,</span><br><span class="line">(<span class="built_in">NSString</span> *)&amp;__NSConstantStringImpl__var_folders_tv_4c43vcqx24vcxx6d51n4ntc00000gn_T_main_753a25_mi_6).arr, <span class="number">4</span>U);</span><br><span class="line">    <span class="built_in">NSString</span> *salary = __null;</span><br><span class="line">    &#123; <span class="keyword">id</span> <span class="keyword">volatile</span> _rethrow = <span class="number">0</span>; <span class="comment">//使用 volatile 修饰的 _rethrow 记录异常的局部变量 </span></span><br><span class="line">		try &#123;</span><br><span class="line">			try &#123;</span><br><span class="line">			        salary = ((<span class="keyword">id</span>  _Nullable (*)(<span class="keyword">id</span>, SEL, KeyType))(<span class="keyword">void</span> *)objc_msgSend)((<span class="keyword">id</span>)dic, sel_registerName(<span class="string">"objectForKeyedSubscript:"</span>), </span><br><span class="line">			  (<span class="keyword">id</span>)(<span class="built_in">NSString</span> *)&amp;__NSConstantStringImpl__var_folders_tv_4c43vcqx24vcxx6d51n4ntc00000gn_T_main_753a25_mi_8);</span><br><span class="line">			    &#125; </span><br><span class="line">		    catch (_objc_exc_NSException *_exception) &#123;</span><br><span class="line">		     <span class="built_in">NSException</span> *exception = (<span class="built_in">NSException</span>*)_exception; </span><br><span class="line">		     <span class="built_in">NSLog</span>((<span class="built_in">NSString</span> *)&amp;__NSConstantStringImpl__var_folders_tv_4c43vcqx24vcxx6d51n4ntc00000gn_T_main_753a25_mi_9,</span><br><span class="line">		            ((<span class="built_in">NSExceptionName</span> (*)(<span class="keyword">id</span>, SEL))(<span class="keyword">void</span> *)objc_msgSend)((<span class="keyword">id</span>)exception, sel_registerName(<span class="string">"name"</span>)), </span><br><span class="line">		            ((<span class="built_in">NSString</span> * _Nullable (*)(<span class="keyword">id</span>, SEL))(<span class="keyword">void</span> *)objc_msgSend)((<span class="keyword">id</span>)exception, sel_registerName(<span class="string">"reason"</span>)), </span><br><span class="line">		            ((<span class="built_in">NSDictionary</span> * _Nullable (*)(<span class="keyword">id</span>, SEL))(<span class="keyword">void</span> *)objc_msgSend)((<span class="keyword">id</span>)exception, sel_registerName(<span class="string">"userInfo"</span>)));</span><br><span class="line">		    &#125; </span><br><span class="line">		&#125;</span><br><span class="line">		catch (<span class="keyword">id</span> e) &#123;</span><br><span class="line">		    _rethrow = e;</span><br><span class="line">		&#125;</span><br><span class="line">		 &#123; </span><br><span class="line">			 <span class="keyword">struct</span> _FIN &#123; </span><br><span class="line">			    _FIN(<span class="keyword">id</span> reth) : rethrow(reth) &#123;&#125;</span><br><span class="line">				~_FIN() &#123; </span><br><span class="line">				  <span class="keyword">if</span> (rethrow) objc_exception_throw(rethrow); </span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">id</span> rethrow;</span><br><span class="line">			 &#125; </span><br><span class="line">			 _fin_force_rethow(_rethrow);</span><br><span class="line">			    salary = __null;</span><br><span class="line">		 &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">struct</span> IMAGE_INFO &#123; <span class="keyword">unsigned</span> version; <span class="keyword">unsigned</span> flag; &#125; _OBJC_IMAGE_INFO = &#123; <span class="number">0</span>, <span class="number">2</span> &#125;;</span><br></pre></td></tr></table></figure>
<h3 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h3><blockquote>
<p>（1）遇到奔溃问题或者是错误问题，优先使用 <code>NSError</code> 来对奔溃和错误进行封装，然后使用 <code>NSLog</code> 对其进行打印</p>
<p>（2）<code>@try @catch @finally</code> 在使用的过程中很方便，但是 <code>MRC</code> 中如果变量较多可能会漏掉局部变量内存释放问题和 <code>ARC</code> 中如果抛出问题，不会自动对局部变量释放（开启 <code>-fobjc-arc-expections</code> 模式会进行释放，但是引入代码对性能有所影响）</p>
</blockquote>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">iOS</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/iOS/" class="article-tag-list-link color4">iOS</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2017/05/31/NSError(错误信息)/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>





  
    <article id="post-iOS-Responder Chain" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/15/iOS-Responder Chain/">iOS-Responder Chain (响应链)</a>
    </h1>
  

        
        <a href="/2017/05/15/iOS-Responder Chain/" class="archive-article-date">
  	<time datetime="2017-05-14T16:12:14.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2017-05-15</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>工作接近一年，很久没有更新博客。工作中学到很多知识点后面将花时间整理，作为对一年知识学习的总结：</p>
<p>下面是本篇博客的写作思路：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1877765-56a34538a5ab0e6b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="iOS-Responder Chain.png"></p>
<h1 id="iOS-Responder-Chain-响应链"><a href="#iOS-Responder-Chain-响应链" class="headerlink" title="iOS-Responder Chain (响应链)"></a>iOS-Responder Chain (响应链)</h1><h2 id="人与计算机交互"><a href="#人与计算机交互" class="headerlink" title="人与计算机交互"></a>人与计算机交互</h2><p>目前计算机在我们生活中扮演很重要的角色，我们与计算机之间的交互也很普遍。多数情况使用最多的是 PC 和 移动端，而两种交互方式有很大的不同</p>
<ul>
<li>PC 与人的交互</li>
<li>移动端与人的交互</li>
</ul>
<p>a)  在 PC 端我们通过键盘、鼠标等来对界面的内容进行操作和完成相关的任务</p>
<p>b）在移动端我们可以通过手指对界面内容进行点击控件和实现相应的操作</p>
<blockquote>
<p>这里提出一个疑问，PC 端我们通过点击可以实现控件的相关操作。但是移动端我们手指点击控件是怎么被检测点击的位置、传递信息和做出相应的操作呢？</p>
</blockquote>
<p>这里引入一个概念：Responder Chain (响应者链)</p>
<h2 id="Responder-Chain-响应者链"><a href="#Responder-Chain-响应者链" class="headerlink" title="Responder Chain (响应者链)"></a>Responder Chain (响应者链)</h2><ul>
<li>NSResponder.h 头文件的源码</li>
<li>UIKit 控件之间的继承关系</li>
</ul>
<h5 id="NSResponder-h-头文件的源码"><a href="#NSResponder-h-头文件的源码" class="headerlink" title="NSResponder.h 头文件的源码"></a>NSResponder.h 头文件的源码</h5><p>在我们点击手机屏幕的一个控件时，与 Responder Chain (响应者链)之间联系紧密。下面是小编在 <code>UIKit</code> 框架中找到相应相关的代码，如下：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UIResponder</span> : <span class="title">NSObject</span> &lt;<span class="title">UIResponderStandardEditActions</span>&gt;</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, nullable) <span class="built_in">UIResponder</span> *nextResponder;</span><br><span class="line">- (nullable <span class="built_in">UIResponder</span>*)nextResponder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">BOOL</span> canBecomeFirstResponder;    <span class="comment">// default is NO</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)canBecomeFirstResponder;    <span class="comment">// default is NO</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)becomeFirstResponder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">BOOL</span> canResignFirstResponder;   </span><br><span class="line">- (<span class="built_in">BOOL</span>)canResignFirstResponder;    <span class="comment">// default is YES</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)resignFirstResponder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">BOOL</span> isFirstResponder;</span><br><span class="line">- (<span class="built_in">BOOL</span>)isFirstResponder;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(nullable <span class="built_in">UIEvent</span> *)event;</span><br><span class="line">- (<span class="keyword">void</span>)touchesMoved:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(nullable <span class="built_in">UIEvent</span> *)event;</span><br><span class="line">- (<span class="keyword">void</span>)touchesEnded:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(nullable <span class="built_in">UIEvent</span> *)event;</span><br><span class="line">- (<span class="keyword">void</span>)touchesCancelled:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(nullable <span class="built_in">UIEvent</span> *)event;</span><br><span class="line">- (<span class="keyword">void</span>)touchesEstimatedPropertiesUpdated:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">9</span>_1);</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)pressesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UIPress</span> *&gt; *)presses withEvent:(nullable <span class="built_in">UIPressesEvent</span> *)event <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">9</span>_0);</span><br><span class="line">- (<span class="keyword">void</span>)pressesChanged:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UIPress</span> *&gt; *)presses withEvent:(nullable <span class="built_in">UIPressesEvent</span> *)event <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">9</span>_0);</span><br><span class="line">- (<span class="keyword">void</span>)pressesEnded:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UIPress</span> *&gt; *)presses withEvent:(nullable <span class="built_in">UIPressesEvent</span> *)event <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">9</span>_0);</span><br><span class="line">- (<span class="keyword">void</span>)pressesCancelled:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UIPress</span> *&gt; *)presses withEvent:(nullable <span class="built_in">UIPressesEvent</span> *)event <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">9</span>_0);</span><br></pre></td></tr></table></figure></p>
<p>在上面 <code>&lt;UIKit/UIResponder.h&gt;</code> 的文件中我们可以看出 <code>UIResponder</code> 的类可以实现 <code>Touch</code> 和 <code>Press</code> 相关操作的做出监听</p>
<h5 id="UIKit-控件之间的继承关系"><a href="#UIKit-控件之间的继承关系" class="headerlink" title="UIKit 控件之间的继承关系"></a>UIKit 控件之间的继承关系</h5><p>下面是小编对 <code>UIKit</code> 框架中点击相应控件有关 <code>Class</code> (类)继承关系整理，如下图：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1877765-faaebfb7fe3a7067.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="iOS-Responder Chain-UIKit.png"></p>
<blockquote>
<p>由上面我们可以看出，在界面上我们平时使用控件时通过继承 <code>UIResponder</code> 来实现对界面 <code>Touch</code> 和 <code>Press</code> 相关操作的做出监听</p>
</blockquote>
<h2 id="响应链的创建"><a href="#响应链的创建" class="headerlink" title="响应链的创建"></a>响应链的创建</h2><ul>
<li>控制器中的 <code>View</code> 树状结构</li>
<li>点击相应的测试&amp;打印</li>
</ul>
<h5 id="控制器中的-View-树状结构"><a href="#控制器中的-View-树状结构" class="headerlink" title="控制器中的 View 树状结构"></a>控制器中的 <code>View</code> 树状结构</h5><p>在手机的 GUI 中我们多数情况下使用 <code>UIViewController</code> 和 <code>UINavigationViewController</code> 控制器来实现界面控件的管理，其中以控制器的 <code>View</code> 为界面显示创建和添加控件，最后形成 <code>View</code> 的控件树状结构</p>
<p>GUI 手机界面中，我们知道 <code>UIView</code> 中用 <code>property</code> (属性) <code>superView</code> 可以用来添加新的 <code>UIView</code> 到当前的 <code>View</code> 中，添加的子类 <code>View</code> 中 <code>property</code> (属性) <code>nextResponder</code> 可以指向父类 <code>View</code> 的 <code>property</code> (属性) <code>superView</code></p>
<p>每一个  <code>ViewController</code> 中有 <code>property</code>(属性) <code>view</code> -&gt; 既<code>self.view</code> 来进行添加子类 <code>View</code>，同样：<code>view</code> 的 <code>property</code> (属性) 通过   <code>property</code> (属性) <code>nextResponder</code> 来指向   <code>ViewController</code> </p>
<p>下图是 <code>View</code> 初始化布局：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1877765-ff79d6261a13c062.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="iOS-Responder Chain-View-Front.png"><br><img src="http://upload-images.jianshu.io/upload_images/1877765-bbfe167edcd04fed.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="iOS-Responder Chain-View-Hierarchy.png"></p>
<h5 id="点击相应的测试-amp-打印"><a href="#点击相应的测试-amp-打印" class="headerlink" title="点击相应的测试&amp;打印"></a>点击相应的测试&amp;打印</h5><p>在定义的 ViewA1 中重写<code>touch</code>方法：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line">    <span class="built_in">UIResponder</span> *next = [<span class="keyword">self</span> nextResponder];</span><br><span class="line">    <span class="built_in">NSMutableString</span> *prefix  = <span class="string">@""</span>.mutableCopy;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">nil</span> != next) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@%@"</span>, prefix, [next class]);</span><br><span class="line">        [prefix appendString:<span class="string">@"--"</span>];</span><br><span class="line">        next = [next nextResponder];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>点击 <code>ViewA1</code> 得到的打印结果：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2017</span><span class="number">-05</span><span class="number">-08</span> <span class="number">23</span>:<span class="number">55</span>:<span class="number">12.278</span> DesignPattern-Create[<span class="number">19441</span>:<span class="number">727956</span>] ViewA0</span><br><span class="line"><span class="number">2017</span><span class="number">-05</span><span class="number">-08</span> <span class="number">23</span>:<span class="number">55</span>:<span class="number">12.278</span> DesignPattern-Create[<span class="number">19441</span>:<span class="number">727956</span>] --ViewA</span><br><span class="line"><span class="number">2017</span><span class="number">-05</span><span class="number">-08</span> <span class="number">23</span>:<span class="number">55</span>:<span class="number">12.278</span> DesignPattern-Create[<span class="number">19441</span>:<span class="number">727956</span>] ----<span class="built_in">UIView</span></span><br><span class="line"><span class="number">2017</span><span class="number">-05</span><span class="number">-08</span> <span class="number">23</span>:<span class="number">55</span>:<span class="number">12.279</span> DesignPattern-Create[<span class="number">19441</span>:<span class="number">727956</span>] ------ViewController</span><br><span class="line"><span class="number">2017</span><span class="number">-05</span><span class="number">-08</span> <span class="number">23</span>:<span class="number">55</span>:<span class="number">12.279</span> DesignPattern-Create[<span class="number">19441</span>:<span class="number">727956</span>] --------<span class="built_in">UIWindow</span></span><br><span class="line"><span class="number">2017</span><span class="number">-05</span><span class="number">-08</span> <span class="number">23</span>:<span class="number">55</span>:<span class="number">12.279</span> DesignPattern-Create[<span class="number">19441</span>:<span class="number">727956</span>] ----------<span class="built_in">UIApplication</span></span><br><span class="line"><span class="number">2017</span><span class="number">-05</span><span class="number">-08</span> <span class="number">23</span>:<span class="number">55</span>:<span class="number">12.280</span> DesignPattern-Create[<span class="number">19441</span>:<span class="number">727956</span>] ------------AppDelegate</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>基于上面：小编从上面代码打印的结果可以验证，子 View 的 property(属性) <code>nextResponder</code> 指向父 View，父类的 View 的property(属性) <code>nextResponder</code> 最后指向 ViewController </p>
</blockquote>
<h2 id="如何找打第一响应者"><a href="#如何找打第一响应者" class="headerlink" title="如何找打第一响应者"></a>如何找打第一响应者</h2><ul>
<li>探测器 <code>Hit - Test</code></li>
<li>寻找第一相应的探测猜想</li>
</ul>
<h5 id="探测器-Hit-Test"><a href="#探测器-Hit-Test" class="headerlink" title="探测器 Hit - Test"></a>探测器 <code>Hit - Test</code></h5><p>在响应链查找过程中，有两个函数起到很重要的作用<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">UIView</span> *)hitTest:(<span class="built_in">CGPoint</span>)point withEvent:(<span class="built_in">UIEvent</span> *)event;</span><br><span class="line">- (<span class="built_in">BOOL</span>)pointInside:(<span class="built_in">CGPoint</span>)point withEvent:(<span class="built_in">UIEvent</span> *)event;</span><br></pre></td></tr></table></figure></p>
<p>在响应链创建的情况下，我们在把寻找响应者的过程称为：<code>Hit - Testing View</code> 在寻找相应 View 的过程称为：<code>Hit - Test</code><br>我们把 <code>Hit - Test</code> 可以比作一个探测器，通过这个探测器来检测手指点击在哪个 <code>UIView</code> 上面 </p>
<p>通过上面的继承关系和点击后打印出的结果可以看到，当我们点击界面 <code>UIApplication</code> 就会调用 <code>hitTest: withEvent</code> 查看点击是否在 <code>UIWindow</code> 中如果不在就返回 <code>nil</code> , 如果在 <code>UIWindow</code> 也会调用 <code>hitTest: withEvent</code> 对<code>UIWindow</code> 中 <code>subViews</code> 进行探测</p>
<blockquote>
<p><code>hitTest: withEvent</code> 在探测过程中采用我们比较常见 递归的方式来查找点击 <code>UIView</code>， 通过我们在初始化过程中最后被初始化的放在最上面</p>
</blockquote>
<p>在点击 <code>ViewA1</code> 来进行验证下一个 <code>nextResponder</code> 过程中在每一个 <code>View</code>重写 <code>hitTest</code> 如下：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">UIView</span> *)hitTest:(<span class="built_in">CGPoint</span>)point withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">self</span>.isUserInteractionEnabled || <span class="keyword">self</span>.hidden || <span class="keyword">self</span>.alpha &lt;= <span class="number">0.01</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ResponderChain : %@"</span>, [<span class="keyword">self</span> class]);</span><br><span class="line">    <span class="keyword">if</span> ([<span class="keyword">self</span> pointInside:point withEvent:event]) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">UIView</span> *subView <span class="keyword">in</span> [<span class="keyword">self</span>.subviews reverseObjectEnumerator]) &#123;</span><br><span class="line">            <span class="built_in">CGPoint</span> converPoin = [subView convertPoint:point fromView:<span class="keyword">self</span>];</span><br><span class="line">            <span class="built_in">UIView</span> *hitTestView = [subView hitTest:converPoin withEvent:event];</span><br><span class="line">            <span class="keyword">if</span> (hitTestView) &#123;</span><br><span class="line">                <span class="built_in">NSLog</span>(<span class="string">@"ViewA : hitTestView -&gt; %@"</span>, [hitTestView class]);</span><br><span class="line">                <span class="keyword">return</span> hitTestView;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>点击 <code>ViewA1</code> 得到打印的结果如下：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2017</span><span class="number">-05</span><span class="number">-09</span> <span class="number">07</span>:<span class="number">42</span>:<span class="number">05.968</span> DesignPattern-Create[<span class="number">1197</span>:<span class="number">22554</span>] ResponderChain : ViewB</span><br><span class="line"><span class="number">2017</span><span class="number">-05</span><span class="number">-09</span> <span class="number">07</span>:<span class="number">42</span>:<span class="number">05.969</span> DesignPattern-Create[<span class="number">1197</span>:<span class="number">22554</span>] ResponderChain : ViewA</span><br><span class="line"><span class="number">2017</span><span class="number">-05</span><span class="number">-09</span> <span class="number">07</span>:<span class="number">42</span>:<span class="number">05.969</span> DesignPattern-Create[<span class="number">1197</span>:<span class="number">22554</span>] ResponderChain : ViewA0</span><br><span class="line"><span class="number">2017</span><span class="number">-05</span><span class="number">-09</span> <span class="number">07</span>:<span class="number">42</span>:<span class="number">05.969</span> DesignPattern-Create[<span class="number">1197</span>:<span class="number">22554</span>] ResponderChain : ViewA1</span><br></pre></td></tr></table></figure></p>
<h5 id="寻找第一相应的探测猜想"><a href="#寻找第一相应的探测猜想" class="headerlink" title="寻找第一相应的探测猜想"></a>寻找第一相应的探测猜想</h5><p>根据打印的结果，我们可以验证点击具体查找的流程如下图所示：（实例是点击 viewA1）<br>UIApplication —&gt; UIWindow  —&gt; viewB —&gt; viewA —&gt; viewA0 —&gt; viewA1</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1877765-4b1f59d1c65500ba.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="iOS-Responder Chain-Hit-Testing-View.png"></p>
<h2 id="利用响应者在应用中的体现"><a href="#利用响应者在应用中的体现" class="headerlink" title="利用响应者在应用中的体现"></a>利用响应者在应用中的体现</h2><ul>
<li>改变控件的相应范围</li>
</ul>
<h5 id="改变控件的相应范围"><a href="#改变控件的相应范围" class="headerlink" title="改变控件的相应范围"></a>改变控件的相应范围</h5><p>我们可以利用 <code>hitTest</code> 根据 <code>point</code> 方式来重新设置 <code>ponit</code> 的点击相应的范围大小<br>在 ViewB1 中实现点击相应范围在布局显示基础上下左右拓展 10 px，实现代码如下：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">UIView</span> *)hitTest:(<span class="built_in">CGPoint</span>)point withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">self</span>.isUserInteractionEnabled || <span class="keyword">self</span>.isHidden || <span class="keyword">self</span>.alpha &lt;= <span class="number">0.01</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ResponderChain : %@"</span>, [<span class="keyword">self</span> class]);</span><br><span class="line">    <span class="built_in">CGRect</span> touchRect = <span class="built_in">CGRectInset</span>(<span class="keyword">self</span>.bounds, <span class="number">-10</span>, <span class="number">-10</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">CGRectContainsPoint</span>(touchRect, point)) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">UIView</span> *subView <span class="keyword">in</span> [<span class="keyword">self</span>.subviews reverseObjectEnumerator]) &#123;</span><br><span class="line">            <span class="built_in">CGPoint</span> converPoint = [subView convertPoint:point fromView:<span class="keyword">self</span>];</span><br><span class="line">            <span class="built_in">UIView</span> *hitTestView = [subView hitTest:converPoint withEvent:event];</span><br><span class="line">            <span class="keyword">if</span> (hitTestView) &#123;</span><br><span class="line">                <span class="built_in">NSLog</span>(<span class="string">@"ViewB1 : hitTestView -&gt; %@"</span>, [hitTestView class]);</span><br><span class="line">                <span class="keyword">return</span> hitTestView;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>ViewB1</code> 界面中实际范围，和点击相应的 <code>viewB1</code> 外的虚框的范围也会做出相应的相应。如下图：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1877765-f4e683de8d0ab2cb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="iOS-Responder Chain-Apply.png"></p>
<p>打印的结果：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2017</span><span class="number">-05</span><span class="number">-09</span> <span class="number">10</span>:<span class="number">34</span>:<span class="number">00.437</span> DesignPattern-Create[<span class="number">1197</span>:<span class="number">22554</span>] ResponderChain : ViewB</span><br><span class="line"><span class="number">2017</span><span class="number">-05</span><span class="number">-09</span> <span class="number">10</span>:<span class="number">34</span>:<span class="number">00.437</span> DesignPattern-Create[<span class="number">1197</span>:<span class="number">22554</span>] ResponderChain : ViewB1</span><br><span class="line"><span class="number">2017</span><span class="number">-05</span><span class="number">-09</span> <span class="number">10</span>:<span class="number">34</span>:<span class="number">00.437</span> DesignPattern-Create[<span class="number">1197</span>:<span class="number">22554</span>] ViewB : hitTestView -&gt; ViewB1</span><br></pre></td></tr></table></figure></p>
<p>相关的测试的<a href="https://github.com/boilWater/DesignPattern-Create.git" target="_blank" rel="external">Dome</a>下载地址</p>
<p>时间：2017/5/8 23:58:44 (后面会继承写作)<br>修改时间： 2017/5/9 22:30:45</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">iOS</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/iOS/" class="article-tag-list-link color4">iOS</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2017/05/15/iOS-Responder Chain/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>





  
    <article id="post-16总结-17展望" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/16/16总结-17展望/">2016年末~2017年初</a>
    </h1>
  

        
        <a href="/2017/01/16/16总结-17展望/" class="archive-article-date">
  	<time datetime="2017-01-16T15:56:06.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2017-01-16</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="2016总结"><a href="#2016总结" class="headerlink" title="2016总结"></a>2016总结</h2><p>踩着16年的小尾巴写下这边文章，离回家还有8天时间👊</p>
<p>今年也是自己第一次这么久离开家，大概有近 1 年时间</p>
<p>早上老妹发来语音说，放假回家的（本来说好要QQ和老妹聊天，加班到9：30就忘记啦😛）</p>
<p>16年7月1号离开汕头（头大）截止到今天差不多半年时间</p>
<p>一年来从学生成长为社会工作的 90 后，公司不像学校可以自由的犯错</p>
<p>在这里呆的久啦，感觉学校里原来很难做到的事情越来只要咬牙坚持就可以完成</p>
<h3 id="16观念"><a href="#16观念" class="headerlink" title="16观念"></a>16观念</h3><blockquote>
<ul>
<li><p>以前的 8 千米对我来说很难，现在 20 千米也是可以完成的</p>
</li>
<li><p>以前的自己主张读书无用论，现在自己会主动买书📚来看</p>
</li>
<li><p>以前的自己只知道往前走，现在自己会每天复盘一天中事情查找不足</p>
</li>
<li><p>以前的自己不会妥协，现在自己知道只要大方向不变可以临时做出改变</p>
</li>
<li><p>以前的自己知道说服别人，现在自己知道沟通需要听👂对方所讲</p>
</li>
<li><p>以前自己只知道喜欢一个人就想时刻知道近况，现在自己看到她的开心就感到欣喜</p>
</li>
<li><p>以前自己拥有梦想但所做很少，现在自己脚踏实地并学会与他人分享梦想</p>
</li>
</ul>
</blockquote>
<h3 id="16所做"><a href="#16所做" class="headerlink" title="16所做"></a>16所做</h3><blockquote>
<ul>
<li><p>E 出行目前还在汕大为汕大学子服务</p>
</li>
<li><p>十一背起行囊到达大学期间最想去的地方~拉萨，路程中遇见一位在杭州的做IT老乡哥们，碰到一位杭州生意人;逛过拉萨的寺庙，没有留下一张照片</p>
</li>
<li><p>天河公园独自一个人连续跑近 5 个小时，第一次完成 20 多公里</p>
</li>
<li><p>做过目前最后悔的事，让一位大美女狂怒😂</p>
</li>
<li><p>做过最蠢的事，把楼上大美女删除（16年蠢事的集合都没有这个问题大）</p>
</li>
</ul>
</blockquote>
<h2 id="17年展望"><a href="#17年展望" class="headerlink" title="17年展望"></a>17年展望</h2><h3 id="17四件事"><a href="#17四件事" class="headerlink" title="17四件事"></a>17四件事</h3><blockquote>
<ul>
<li><p>(1)想办法让楼上大美女原谅我，可以正常面对我</p>
</li>
<li><p>(2)完成自己考雅思计划</p>
</li>
<li><p>(3)参加至少 3 次马拉松赛事</p>
</li>
<li><p>(4)进行间隔封闭式编程训练，年底或后年暑假进入一线互联网公司</p>
</li>
</ul>
</blockquote>
<h3 id="17工作"><a href="#17工作" class="headerlink" title="17工作"></a>17工作</h3><blockquote>
<ul>
<li><p>努力工作</p>
</li>
<li><p>后面加班将成为常态</p>
</li>
<li><p>把自己想学习的东西一一实现</p>
</li>
</ul>
</blockquote>
<h4 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h4><p>🙈后面将会慢慢添加和修改，但 17 年四件事不变🙈</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">随笔</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/随笔/" class="article-tag-list-link color3">随笔</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2017/01/16/16总结-17展望/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>





  
    <article id="post-APP控件在屏幕上显示" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/13/APP控件在屏幕上显示/">APP控件在屏幕上显示</a>
    </h1>
  

        
        <a href="/2017/01/13/APP控件在屏幕上显示/" class="archive-article-date">
  	<time datetime="2017-01-13T13:57:36.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2017-01-13</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="APP控件在屏幕上显示"><a href="#APP控件在屏幕上显示" class="headerlink" title="APP控件在屏幕上显示"></a>APP控件在屏幕上显示</h1><p>在每个 APP 中如果想要实现界面的精美，多数情况下我们需要对相关控件进行分装，采用CocoaPods进行插件化管理。<br>但是我们在程序里的空间是怎么显示在屏幕上的，下面将初略的讲述屏幕上显示控件的过程。</p>
<h1 id="文章知识点讲述的思路"><a href="#文章知识点讲述的思路" class="headerlink" title="文章知识点讲述的思路"></a>文章知识点讲述的思路</h1><p>使用 Xmind 来展示博客讲述 APP 控件在屏幕上显示的思路和相关知识点的整理思路，具体思路看下图：</p>
<p><img src="/images/APP控件在屏幕上显示.png" alt="APP 控件在屏幕上显示"></p>
<h2 id="屏幕显示图像的原理"><a href="#屏幕显示图像的原理" class="headerlink" title="屏幕显示图像的原理"></a>屏幕显示图像的原理</h2><p>记得第一台电视机是最老式的黑白电视机，上面具备天线、需要手动转动旋转调台那种，目前这种电视📺很少出现额。<br>上面那种老式的电视机画面的显示就是采用 CRT 显示，显示的原理如下图：</p>
<p><img src="/images/CRT.png" alt="CRT 扫描过程模拟"></p>
<p>其原理：CRT 按照上面图片展示的那样，从上到下进行逐行扫描，当扫描完成就会显示一整张图像，随后电子枪回到原来的位置从头开始进行图像素材的扫描。具体的过程当显示器扫完一行换到新的一行，显示器就会发出一个水平信号：<strong>HSync</strong>，当显示器扫完整张的图片后电子进行复位，开始下一次的重新扫描，显示器也会发出一个新的垂直信号：<strong>VSync</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">我们 APP 在屏幕上的刷新的频率就是 VSync 信号产生的频率，所以我们在解决界面卡顿的过程就要根据 VSync 的基础上进行相关的完善和优化</span><br></pre></td></tr></table></figure>
<p>👈👈👈👈👈👈目前我们一般是采取双缓冲的机制， GPU会预先缓冲好一帧存放在缓冲中，让视频控制器读取，当下一阵渲染好，就直接把视频控制器的指针指向第二个缓冲器 ： 这样做的好处就是可以大大提高缓冲的效率问题👉🏿👉🏿👉🏿👉🏿👉🏿👉🏿</p>
<p>采用双缓存可能会引入一个问题就是屏幕内容显示一半， GPU 将新的内容提交到缓存区对其进行交换，视频控制器把新的下半段的显示在屏幕上<br>可能形成画面撕裂，<br>解决方式：GPU 引入垂直同步（V-Sync）当开启垂直同步后， GPU会等待 VSync 信号发出，才会对缓存的内容进行更新，这样就可以是画面更加流畅，减少延迟</p>
<p>😀😆😆😆😆😆😆😆😆😆😆😆😆😆😆😆😆😆😆😆😆😆</p>
<p>iOS 设备采用双缓存 + 垂直同步； Android采用的三缓存 + 垂直同步</p>
<p>😆😆😆😆😆😆😆😆😆😆😆😆😆😆😆😆😆😆😆😆😆😁</p>
<p>在一些游戏中我们经常会见到一些场景如下：</p>
<p><img src="/images/屏幕错位.png" alt="屏幕错位"></p>
<h2 id="CPU和GPU的工作原理"><a href="#CPU和GPU的工作原理" class="headerlink" title="CPU和GPU的工作原理"></a>CPU和GPU的工作原理</h2><h3 id="CPU工作原理"><a href="#CPU工作原理" class="headerlink" title="CPU工作原理"></a>CPU工作原理</h3><p>CPU（中央处理器，Central Processing Unit）主要是解释计算机中的指令，处理计算机软件中的数据。CPU、内部存储器和输入/输出设备是计算机的三大核心组件。</p>
<p>CPU目前很大一部分是采用 冯·诺依曼结构，在工作的过程之中其过程一般可以分为四个阶段：提取、解码、执行和调回</p>
<p>提取：<br>解码：<br>执行：<br>调回：</p>
<p><img src="/images/CPU.png" alt="CPU AMD Opteron六核心处理器"></p>
<h3 id="GPU工作原理"><a href="#GPU工作原理" class="headerlink" title="GPU工作原理"></a>GPU工作原理</h3><p>GPU（图形处理器，Graphics Processing Unit）主要是进行绘图运算的微处理器，对图像进行处理和相关显示绘制工作<br>后面随着 OpenGL APL 和 DirectX 功能的出现，图形处理器可以增加可编程着色的能力，目前我们处理在屏幕上显示的任何像素，也可以在纹理在屏幕上显示前和每一个几何顶点在投射到屏幕前都可以进行相关的处理工作</p>
<h2 id="iOS-绘制像素在屏幕上"><a href="#iOS-绘制像素在屏幕上" class="headerlink" title="iOS 绘制像素在屏幕上"></a>iOS 绘制像素在屏幕上</h2><h3 id="APP绘制像素过程分析"><a href="#APP绘制像素过程分析" class="headerlink" title="APP绘制像素过程分析"></a>APP绘制像素过程分析</h3><p>下面绘制像素在屏幕上的原理图：</p>
<p><img src="/Images/GPU显示.png" alt="iOS 绘制像素在屏幕"></p>
<p>iOS 界面上的内容大多是通过 Core Animation 来完成绘制<br>在 Mac OS 大多是绕过 Core Animation 使用 Core Graphics 来进行绘制<br>手游行业中直接使用 OpenGL/OpenGL ES 来进行相关材质的内容绘制</p>
<p>Core Animation 大多使用 Core Graphics 来进行内容的渲染</p>
<p>GPU Driver 是直接和 GPU 进行相关交互的代码块，可以对对 GPU 直接操作</p>
<p>GPU 是专门为图形高并发计算量身定制的处理单元，优点：短时间可以实现图像浮点运算，耗电少，高效</p>
<h3 id="APP绘制像素硬件分析"><a href="#APP绘制像素硬件分析" class="headerlink" title="APP绘制像素硬件分析"></a>APP绘制像素硬件分析</h3><p><img src="/images/GPU缓存.png" alt="iOS 绘制像素需要的硬件"></p>
<p>在图片显示的过程中，我们需要相关的 GPU 对图片生成 frame 的纹理，<br>我们在生成纹理的过程中会使用 VRAM 的空间，所以在生成过程是有限制的<br>把相关的数据从 CPU 上传输到 GPU 上 ——&gt; 既是把内容从 RAM 上传到 VRAM 上， 如果上传的纹理太大就会对性能有所影响</p>
<p>在文本显示的过程中，我们使用 GPU 进行文本的绘制比较复杂，这会促使 Core Text 和 Core Graphics 来合成生成一个文本，然后上传到 GPU。<br>但我们在界面滑动过程中， CPU 只需要把相关的文本坐标发送到 GPU 就行， GPU会根据相关的信息进行绘制</p>
<h3 id="APP绘制过程方式和细节讲解"><a href="#APP绘制过程方式和细节讲解" class="headerlink" title="APP绘制过程方式和细节讲解"></a>APP绘制过程方式和细节讲解</h3><h4 id="合成："><a href="#合成：" class="headerlink" title="合成："></a>合成：</h4><p>在我们看到的所有的视图都是基于不同图片进行相关的合成而来<br>这里我么准守一切的图像皆纹理的概念，当把第二个纹理遮在第一个纹理上时， GPU 就会把第二个纹理合成到第一个纹理中</p>
<blockquote>
<ul>
<li>合成方法很多种：</li>
<li>如果两个纹理对其时：采用公式    ——&gt;    R(最终显示的色彩的值) = S(上层纹理的相关的参数) +D(下层纹理相关参数) * (1 - Sa(上层纹理的透明度))</li>
</ul>
</blockquote>
<h4 id="透明-VS-不透明："><a href="#透明-VS-不透明：" class="headerlink" title="透明 VS 不透明："></a>透明 VS 不透明：</h4><p>当纹理完全不透明时目标像素就是纹理的值， GPU 就只会从目标像素直接取出纹理显示 不会做相关的操作<br>在加载一张没有  alpha 的图片进行显示，会被默认为 opaque 的属性是 YES ； 加载一张图片 alpha = 100%， Core Animation 会认为是不为 100% 对其进行解析</p>
<h4 id="像素对其-VS-不重合在一起："><a href="#像素对其-VS-不重合在一起：" class="headerlink" title="像素对其 VS 不重合在一起："></a>像素对其 VS 不重合在一起：</h4><p>当两个 layer 完全重合在一起，这时就需要我们对其进行相关的计算<br>layer 上所有的像素和屏幕上的像素完全对其，这就是 layer 像素对其； </p>
<ol>
<li>像素对不齐主要原因：<blockquote>
<ul>
<li>缩放，在图像进行缩方时，layer 和屏幕的像素很难对其</li>
<li>纹理的起点在在一个像素的边界 </li>
<li>在像素不对其的情况下可能会要经过过多的运算， 在 Core Animation 和 模拟器中 color misaligned images 的选项可以进行相关的调节</li>
</ul>
</blockquote>
</li>
</ol>
<h4 id="离屏渲染："><a href="#离屏渲染：" class="headerlink" title="离屏渲染："></a>离屏渲染：</h4><p>离屏渲染会  合并/渲染 图层树一部分到一个新的缓存区，然后该缓冲区被渲染到屏幕上</p>
<blockquote>
<ul>
<li>离屏渲染也可能产生副作用。如果你正在直接或者间接的将mask应用到一个图层上，Core Animation 为了应用这个 mask，会强制进行屏幕外渲染。这会对 GPU 产生重负。通常情况下 mask 只能被直接渲染到帧的缓冲区中(在屏幕内)</li>
<li>Instrument 的 Core Animation 工具有一个叫做 Color Offscreen-Rendered Yellow 的选项，它会将已经被渲染到屏幕外缓冲区的区域标注为黄色(这个选项在模拟器中也可以用)。同时记得检查 Color Hits Green and Misses Red 选项。绿色代表无论何时一个屏幕外缓冲区被复用，而红色代表当缓冲区被重新创建</li>
</ul>
</blockquote>
<p>rasterized layer 的缓冲区大小是有所限制的，大概是屏幕大小的两倍空间 屏幕外的缓冲区</p>
<h4 id="CALayer："><a href="#CALayer：" class="headerlink" title="CALayer："></a>CALayer：</h4><p>GPU 测试的步骤：<br>要告诉你，如果是 GPU 限制了你的性能，你可以使用 OpenGL ES Driver instrument。点击上面那个小的 i 按钮，配置一下，同时注意勾选 Device Utilization %。现在，当你运行你的 app 时，你可以看到你 GPU 的负荷。如果这个值靠近 100%，那么你就需要把你工作的重心放在GPU方面了。</p>
<h4 id="Core-Graphics-amp-Quartz-2D："><a href="#Core-Graphics-amp-Quartz-2D：" class="headerlink" title="Core Graphics &amp; Quartz 2D："></a>Core Graphics &amp; Quartz 2D：</h4><p>Core Graphics 是功能强大的绘图框架</p>
<p>GPU加速下的图像处理：<br>好的图像处理的开源第三方框架：</p>
<p>GPUImage ：<a href="https://github.com/BradLarson/GPUImage" target="_blank" rel="external">https://github.com/BradLarson/GPUImage</a></p>
<p>ShaderToy :  <a href="https://www.shadertoy.com" target="_blank" rel="external">https://www.shadertoy.com</a></p>
<p>Shaderific :  <a href="http://www.shaderific.com" target="_blank" rel="external">http://www.shaderific.com</a></p>
<p>着色器的调试 ：是测算帧渲染的时间，不是 1s 渲染多少帧<br>FPS是帧时间的倒数，帧渲染的时间：是帧开始处理到完全结束并且渲染到屏幕或者一张图片所花费的时间。</p>
<p>👉🏿 在移动端的 GPU 中有很多是 把指令集中起来，最后统一做一次渲染  ——&gt; 在测试时需要测试整个过程，而不是一个中间过程</p>
<p><a href="http://www.sunsetlakesoftware.com/2013/10/21/optimizing-gaussian-blurs-mobile-gpu" target="_blank" rel="external">测试大🐮的博客 ：</a></p>
<p><a href="https://community.imgtec.com/developers/powervr/" target="_blank" rel="external">GPU 的测试框架：</a></p>
<p>如果想要保持高的帧速  就要保证着色器比较低的周期数  （如果是 60帧每秒， 那么在完成一个周期就需要仅仅 16.67 毫秒）</p>
<h3 id="降低着色器渲染周期方法："><a href="#降低着色器渲染周期方法：" class="headerlink" title="降低着色器渲染周期方法："></a>降低着色器渲染周期方法：</h3><ul>
<li><p>消除条件逻辑 ：条件逻辑有时是必须的，但有时可以做优化。着色器中使用 step（）函数变通避免逻辑的运用</p>
</li>
<li><p>减少依赖纹理的读取 ：在片段的着色器取样时，如果纹理坐标不是以 varying 的形式传入，而是在片段着色器中进行计算，就会发生纹理依赖。（👉🏿想从附近的像素取样，而不是计算和片段着色器中相邻像素的偏差，最好在顶点着色器中进行计算，然后把结果以 varying 的方式传入片段着色器👈）</p>
</li>
<li><p>让计算更加简单 ： 在计算过程中如果使用简单的计算可以得到一个足够近似的值，就需要避免昂贵的计算方式（例如：sin()，cos()，tan() ）</p>
</li>
<li><p>如果有可能的话，把相关计算使用到顶点着色器。    😁 😀😁 😀😁 😀 顶点着色器是每个顶点运行一次，片段着色器是每一个像素运行一次</p>
</li>
</ul>
<p><a href="https://zh.wikipedia.org/wiki/中央处理器" target="_blank" rel="external">CPU 的参考资料</a></p>
<p><a href="https://zh.wikipedia.org/wiki/圖形處理器" target="_blank" rel="external">GPU 的参考资料</a></p>
<p><a href="http://blog.ibireme.com/author/ibireme/" target="_blank" rel="external">资料参考1</a></p>
<p><a href="https://objccn.io/issue-21-7/" target="_blank" rel="external">参考资料2</a></p>
<p><a href="https://objccn.io/issue-21-8/" target="_blank" rel="external">参考资料3</a></p>
<p><a href="https://objccn.io/issue-3-1/" target="_blank" rel="external">参考资料4</a></p>
<p><a href="http://blog.ibireme.com/2015/11/12/smooth_user_interfaces_for_ios/" target="_blank" rel="external">资料的参考5</a></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">IOS</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/IOS/" class="article-tag-list-link color4">IOS</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2017/01/13/APP控件在屏幕上显示/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>





  
    <article id="post-IOS响应者链" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/09/IOS响应者链/">IOS整体框架</a>
    </h1>
  

        
        <a href="/2016/09/09/IOS响应者链/" class="archive-article-date">
  	<time datetime="2016-09-09T06:01:25.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2016-09-09</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="">官方文档</a><br><a href="http://itangqi.me/2016/04/18/the-first-meet-with-event-delivery/" target="_blank" rel="external">初探 iOS 事件分发机制</a></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">IOS</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/IOS/" class="article-tag-list-link color4">IOS</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2016/09/09/IOS响应者链/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>





  
    <article id="post-两周感悟~广州" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/16/两周感悟~广州/">广州~两周感悟</a>
    </h1>
  

        
        <a href="/2016/07/16/两周感悟~广州/" class="archive-article-date">
  	<time datetime="2016-07-15T16:27:32.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2016-07-16</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>从汕大毕业来到广州</p>
<hr>
<p>从汕大毕业来到广州，目前住在棠下村和一个师兄一起住，打算过段时间出去找房子~搬家😉</p>
<hr>
<p>离开汕大本来有些感伤，但是来到这个自己心中有所期望的城市又倍感高兴，因为可以随时去看想看的</p>
<hr>
<p>人😚。心之所向，就会有一种家的感觉，让自己感到放松！嗨，目前自己没有完全确定下来就不知道见</p>
<hr>
<p>到怎么说😂，但是离你很近，打车20分钟多路程… … Miss you!</p>
<hr>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">随笔</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/随笔/" class="article-tag-list-link color3">随笔</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2016/07/16/两周感悟~广州/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>





  
    <article id="post-UIView&amp;CALayer&amp;Core Animation~1" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/16/UIView&CALayer&Core Animation~1/">UIView &amp; CALayer&amp; Core Animation ~ （UIView 和 CALayer）（1）</a>
    </h1>
  

        
        <a href="/2016/06/16/UIView&CALayer&Core Animation~1/" class="archive-article-date">
  	<time datetime="2016-06-16T06:41:28.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2016-06-16</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>目前dome已经做好啦，但是感觉自己理解还不是很透彻。打算改下自己的博客从头开始对博客进行重新更新，更新时间6/12/2016。</p>
<div style="color:#008B8B"><br><p>今天也打算写关于图片、音频和视频在深层原理，以及图像在屏幕显示原理以及后面提出如何进行在此方面优化。<br>下面就讲述在IOS开发过程中经常使用的UIView和CALayer两者之间的关系和在动画使用过程的具体封装（网上也有许多关于这个话题的文章，也是站在巨人肩膀上）。</p><br></div>

<h3 id="UIView和CALayer之间的关系"><a href="#UIView和CALayer之间的关系" class="headerlink" title="UIView和CALayer之间的关系"></a>UIView和CALayer之间的关系</h3><p>打开UIView和CALyer中实际实现的代码，下面是UIView实现源码</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NS_CLASS_AVAILABLE_IOS</span>(<span class="number">2</span>_0) <span class="class"><span class="keyword">@interface</span> <span class="title">UIView</span> : <span class="title">UIResponder</span> &lt;<span class="title">NSCoding</span>, <span class="title">UIAppearance</span>, <span class="title">UIAppearanceContainer</span>, <span class="title">UIDynamicItem</span>, <span class="title">UITraitEnvironment</span>, <span class="title">UICoordinateSpace</span>, <span class="title">UIFocusEnvironment</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>,<span class="keyword">readonly</span>,<span class="keyword">strong</span>)                 <span class="built_in">CALayer</span>  *layer; </span><br></pre></td></tr></table></figure>
<p>CALayer实现源码：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">CALayer</span> : <span class="title">NSObject</span> &lt;<span class="title">NSCoding</span>, <span class="title">CAMediaTiming</span>&gt;</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">@private</span></span><br><span class="line">  <span class="keyword">struct</span> _CALayerIvars &#123;</span><br><span class="line">    int32_t refcount;</span><br><span class="line">    uint32_t magic;</span><br><span class="line">    <span class="keyword">void</span> *layer;</span><br><span class="line"><span class="meta">#if TARGET_OS_MAC &amp;&amp; !TARGET_RT_64_BIT</span></span><br><span class="line">    <span class="keyword">void</span> *unused1[<span class="number">8</span>];</span><br><span class="line"><span class="meta">#endif</span></span><br><span class="line">  &#125; _attr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>我们可以看出UIView是继承自UIResponder，而CALayer继承自NSObject。这也是UIView可以相应触摸事件，并实现响应链中最后一环所在后面我们会具体讲述。CALayer继承自NSObject，其中UIView中又包含自己所特有的layer。我们可以看做CALayer是UIView的具体内容细节的实现，两者具有平行关系。</p>
<div style="color:#008B8B"><p>为什么不把两者何在一起进行实现呢，分开实现具体功能呢？<br>我想可能是为啦分层需要，把功能具体分隔开来。UIView实现触摸响应，CALayer实现具体的内容展示。<br></p><br></div>

<p>参考资料：<br><br><a href="https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/CoreAnimation_guide/CoreAnimationBasics/CoreAnimationBasics.html#//apple_ref/doc/uid/TP40004514-CH2-SW12" target="_blank" rel="external">UIVie和CALayer关系源码</a>;</p>
<p><br><br>下面我们将写关于UIView和CALayer的一些相关的知识：</p>
<hr>
<p>列出在UIView实现不了的CALayer的功能：</p>
<ul><br><li>阴影，圆角，带颜色的边框</li><br><li>3D变换</li><br><li>非矩形范围</li><br><li>透明遮罩</li><br><li>多级非线性动画</li><br></ul>

<hr>
<p>我们也都知道在Iphone手机内存是固定不能进行拓展，所以我们手机内存是很宝贵的。如果我们想要加载大容量的图片，会占用很大的内存。<br><br><br>为此，Apple采用了一种比较巧妙的策略。在低内存的情况下，系统会强制清除UIImage对象所指向的图片数据，以释放部分内存。注意，这种清除行为影响到的只是图片数据，而不会影响到UIImage对象本身。当我们需要绘制那些图片数据已经被清除的UIImage对象时，对象会自动从源文件中重新加载数据。当然，这是以时间换空间的一种策略，会导致一定的性能损耗。下面给出一些图片处理小技巧</p>
<h3 id="UIImage缓存"><a href="#UIImage缓存" class="headerlink" title="UIImage缓存"></a>UIImage缓存</h3><p>我们知道在使用imageNamed进行图片显示，图片会缓存。但具体缓存是怎么实现，其中解析和清除时间是什么时候呢？<div style="color:#008B8B"></div></p>
<p></p><p>当我们使用imageNamed:时创建图片，系统会通过Bundle的文件中找到图片的文件名，然后把相关的名字放到UIImage返回，此时并没有解析图片。当图片在第一次显示时，图片才会调用内部解码方法，解码会放到一个全局变量中。图片在解码后，会在APP第一次进入后台或者内存警告时，该图片的缓存才会被清空，其他情况缓存会一直存在。<br></p><br><p></p>
<h3 id="使用imageWithData可以避免缓存吗？"><a href="#使用imageWithData可以避免缓存吗？" class="headerlink" title="使用imageWithData可以避免缓存吗？"></a>使用imageWithData可以避免缓存吗？</h3><p>我们在创建UIImage时，UIImage的底层会调用ImageIO的CGImageSourceCreateWithData()，此方法有个参数 ShouldCache，在64位的处理器上是默认开启的。图片也会在第一次显示在屏幕上才会被解码，解码数据也会保存在CGimage的内部。</p>
<div style="color:#008B8B"><br><p>但是与上面使用imageName的情况不同，在UIImage被释放是其缓存也会进行释放。</p></div>

<h3 id="怎样避免缓存"><a href="#怎样避免缓存" class="headerlink" title="怎样避免缓存"></a>怎样避免缓存</h3><ul><br><li>上面我们可以看到如果直接使用CGImageSourceCreateWithData()，并且关闭ShouldCache 和 ShouldCacheImmediately，但是这样的话每次图片需要显示的话，都会进行图片解码，这样会占用较大CPU</li><br><li>把图片用 CGContextDrawImage() 绘制到画布上，然后把画布的数据取出来当作图片。这也是常见的网络图片库的做法</li><br></ul>

<p><a href="http://blog.ibireme.com/2015/11/02/ios_image_tips/" target="_blank" rel="external">参考资料~iOS 处理图片的一些小 Tip</a></p>
<hr>
<p><a href="http://bihongbo.com/2016/01/03/memoryGhostdrawRect/" target="_blank" rel="external">内存恶鬼drawRect</a><br><br>总的参考资料地址<br><br><a href="https://github.com/AttackOnDobby/iOS-Core-Animation-Advanced-Techniques/blob/master/1-图层树/图层树.md" target="_blank" rel="external">图层的树状结构</a><br><br><a href="https://github.com/AttackOnDobby/iOS-Core-Animation-Advanced-Techniques/blob/master/2-寄宿图/寄宿图.md#contents属性" target="_blank" rel="external">寄宿图</a><br><br><a href="https://github.com/AttackOnDobby/iOS-Core-Animation-Advanced-Techniques" target="_blank" rel="external">UIView和CALayer总的参考地址</a></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color5">图片视频</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/视图&amp;图层&amp;动画/" class="article-tag-list-link color4">视图&图层&动画</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2016/06/16/UIView&CALayer&Core Animation~1/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>





  
    <article id="post-UIView&amp;CALayer&amp;Core Animation-总体" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/16/UIView&CALayer&Core Animation-总体/">UIView&amp;CALayer&amp;Core Animation~开篇</a>
    </h1>
  

        
        <a href="/2016/06/16/UIView&CALayer&Core Animation-总体/" class="archive-article-date">
  	<time datetime="2016-06-16T06:35:22.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2016-06-16</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>一直想做个dome来实践自己所学的知识，看到网上有很多资料感觉压力比较大，所以决定站在巨人肩膀上对于UIView&amp;CALayer&amp;Core Animation 进行分装做出一个dome。</p>
<p>下面给出整理的思维导图片：</p>
<p><img src="/images/UIView&amp;CALayer动画.png" alt="image"></p>
<p><a href="https://github.com/boilWater/boilWater.github.io/tree/master/Xmind" target="_blank" rel="external">思维导图下载地址</a></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color5">图片视频</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/视图&amp;图层&amp;动画/" class="article-tag-list-link color4">视图&图层&动画</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2016/06/16/UIView&CALayer&Core Animation-总体/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>





  
    <article id="post-IOS 10" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/15/IOS 10/">IOS 10.0</a>
    </h1>
  

        
        <a href="/2016/06/15/IOS 10/" class="archive-article-date">
  	<time datetime="2016-06-14T16:07:59.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2016-06-15</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>今天有点悲剧，回到住的地方身体就开始不舒服，一觉睡到现在。看到11点多，赶紧找时间开始码IOS 10.0新的改变。<br><br>昨天凌晨IOS 举行 WWDC全球发布者大会，watch OS、tv OS、OS X以及iOS 10系统的新特性。<br><br><a href="http://www.apple.com/apple-events/june-2016/" target="_blank" rel="external">WWDC-13/6/2016~视频地址</a></p>
<p>展示会第一个是APPLE的掌舵人是库克，有点搞笑的是大家好像没有理解库克的第一个梗大家都没有欢呼。看完视频给我比较好的感觉就是在siri操作程序和Apple Pay的使用过程，付款使用起来感觉比支付宝更加便捷。</p>
<p>下面我们列表IOS 10的新功能的体现，下面将给出相关知识的思维导图。</p>
<p><img src="/Images/WWDC（2016）.png" alt="image"></p>
<h2 id="Watch-OS"><a href="#Watch-OS" class="headerlink" title="Watch OS"></a>Watch OS</h2><h3 id="寻找APPS"><a href="#寻找APPS" class="headerlink" title="寻找APPS"></a>寻找APPS</h3><p>我们通过Apple Watch傍边的旋转手柄可以快速寻找我们装在的APP以及设定首界面显示的具体内容</p>
<h3 id="表盘界面"><a href="#表盘界面" class="headerlink" title="表盘界面"></a>表盘界面</h3><p>Apple Watch提供多个表盘界面，其中一个竟然是米老鼠的显示时间真心醉啦，没有保持乔帮主时double做法</p>
<h3 id="活动"><a href="#活动" class="headerlink" title="活动"></a>活动</h3><p>活动方面Apple Watch为我们添加一些使用的功能。我们可以对活动任务进行分享、查看活动完成进度和与朋友活动进度进行比较</p>
<h3 id="Wheelchair-Use"><a href="#Wheelchair-Use" class="headerlink" title="Wheelchair Use"></a>Wheelchair Use</h3><p>为做轮椅的人提供可以帮助，可以提醒使用者休息、工作和显示旋转速度</p>
<h3 id="Workout"><a href="#Workout" class="headerlink" title="Workout"></a>Workout</h3><p>在工作之余我们可以使用Apple Watch来查看我们走的距离、watch的活跃内存空间、消耗卡路里、心率和运动时间，可以选择重要的运动项目，进行特别标注，在跑步过程会自动停止</p>
<h3 id="Breathe-App"><a href="#Breathe-App" class="headerlink" title="Breathe App"></a>Breathe App</h3><p>帮助你可以进行冥想，释放自己的压力，把语音信心转换为文字，进行回复</p>
<h3 id="Messages"><a href="#Messages" class="headerlink" title="Messages"></a>Messages</h3><p>把语音信心转换为文字，进行回复，重要的是支持汉字手写</p>
<h3 id="保留功能"><a href="#保留功能" class="headerlink" title="保留功能"></a>保留功能</h3><ul><br><li>Home：可以通过Apple Watch链接控制家中使用Home的所有硬件设备</li><br><li>SOS：试下紧急呼叫的功能</li><br><li>Apple Pay：可以在Mac上购买然后通过IPhone直接指纹识别进行付款</li><br><li>Unlock Mac：解锁我们使用的Mac电脑</li><br></ul>


<h2 id="IOS-10"><a href="#IOS-10" class="headerlink" title="IOS 10"></a>IOS 10</h2><h3 id="全新界面功能设计"><a href="#全新界面功能设计" class="headerlink" title="全新界面功能设计"></a>全新界面功能设计</h3><p>首先是新的锁屏界面，互动性大幅增强，支持新的通知显示方式和手势功能，可以直接使用 3D Touch 进行预览与信息回复，或者重按全部清除通知，更快速的进入拍照界面等，界面看起来更加清晰直观。</p>
<p>值得一提的是，iPhone 支持抬手唤醒屏幕功能了， 当你抬起 iPhone 的时候锁屏界面就会亮起，直接显示通知信息和相关内容，而不触碰任何按键和所动操作，有点类似于竞争对手的平台设计理念。</p>
<p>通知中心和控制中心界面进行了新的设计，包括桌面亦是如此，很多操作操作利用 3D Touch 更加便捷，比如在 app 图标上预览更多相关信息，甚至是视频预览。</p>
<h3 id="Siri"><a href="#Siri" class="headerlink" title="Siri"></a>Siri</h3><p>Siri 果然每一年都会努力提升 Siri 的水平，苹果表示每周有 200 万个用户使用 Siri。新升级之后 Siri 可以搜索的内容更多了，比如图片搜索、应用搜索，同时 Siri 还能够查看日期、打开 app、发送短息。</p>
<p>苹果宣布 Siri SDK 开放，之后开发者可以将第三方应用程序和服务与 Siri 集成，从而在自家的应用中利用 Siri 实现语音交互、人工智能等功能。苹果称 Whatsapp、微信和滴滴打车都会集成，用户可以通过 Siri 语音命令“WeChat xxx to 谁谁谁”，就能够完成微信的发送了，也可以用 Siri 来使用滴滴打车。</p>
<p>另一为 iOS 10 上 Siri 增加的功能是 iCloud Voicemail，可以将语音信箱中的内容转换成文字，让用户能够快速浏览和阅读。</p>
<h3 id="Quick-type"><a href="#Quick-type" class="headerlink" title="Quick type"></a>Quick type</h3><p>Quick type 这部分更行重在 Siri 的全新升级的人工智能特征所带来的便利性，因为 Siri 支持深度学习你的一切信息，包括监测你的日程安排，所以不仅可以帮助更快速的组织语言一边快速回复，还能够根据信息提供相关建议，帮助自动填充地址信息等等。基本上，新升级之后能够为用户省去更多手动输入麻烦。</p>
<h3 id="照片应用"><a href="#照片应用" class="headerlink" title="照片应用"></a>照片应用</h3><p>iOS 10 中的照片应用拥有了更加强大的管理功能，苹果多次提到的就是支持“识别分类”功能，可以进行脸部、对象和场景的识别。比如通过任务的脸部头像进行分类，当智能搜索分类完成之后，用户还可以直接搜索图片上的事件内容，搜索骑马也能找到照片。</p>
<p>总之，利用 iCloud 照片库就可以轻松根据地理位置信息、时间、任务、话题等等进行分类，每一个用户都可以很方便更满意的创建智能相册，并且这些新功能在 Mac上的 Photos 也将同样得到支持。</p>
<h3 id="地图应用"><a href="#地图应用" class="headerlink" title="地图应用"></a>地图应用</h3><p>苹果自家的地图应用在 iOS 10 中得到了较大改进，重新设计之后更简单、更直观也更人性化，无论是导航界面还是路线信息、交通信息等都与以往有所不同。周边智能化建议进一步增强，所在位置打开地图“好去处”的建议更加丰富，附件的加油站、餐馆和咖啡厅等一览无遗，用苹果的话来说简直就是“情报中心”。</p>
<p>苹果地图也将开发 SDK 给开发者，苹果表示中国的大众点评和滴滴打车将全面整合苹果地图，达到与原生无缝斜街的体验，比如说直接在苹果地图上使用滴滴打车进行叫车。另外，苹果地图现在也支持 Carplay 了。</p>
<h3 id="Apple-Music"><a href="#Apple-Music" class="headerlink" title="Apple Music"></a>Apple Music</h3><p>对于 Apple Music 苹果表示，该服务推出至今已经获得了巨大的成功，目前付费订阅用户已经超过 1500 万。</p>
<p>全新的 Apple Music 界面进行了重新设计，新的界面更加简洁、更加漂亮了，如传闻所述去掉了很多丰富的颜色元素，变得更加直观，突出黑白背景和文字。演示来看，新 Apple Music  进一步整合苹果公司自主开发的旧金山字体，菜单和标签的字体会是加粗的、更大的黑色的版本。</p>
<p>另外，Apple Music 可以按照艺术家专辑等进行分类，还支持歌词自动加载显示。电台广播服务得到了改进，不只是分类更直观，用户可以很方便地寻找自己想听的电台，而且苹果表示将会有更多的主播参与当中。</p>
<h3 id="Apple-News"><a href="#Apple-News" class="headerlink" title="Apple News"></a>Apple News</h3><p>苹果表示，Apple News 有超过 600 万的读者，新的更新将拥有全新设计的界面，并可订阅更多频道。推荐功能变得更强大更智能，支持基于用户阅读习惯进行推荐，为每一位用户选择性的推送最需要的新闻信息。</p>
<h3 id="HomeKit"><a href="#HomeKit" class="headerlink" title="HomeKit"></a>HomeKit</h3><p>物联网是大势所趋，苹果为 iOS 10 带来了 HomeKit 的全新进展。首先，HomeKit 将以独立应用的形式出现在 iOS 10 上，命名为 Home，之前苹果可申请过“Home”的商标，并不意外。</p>
<p>当 HomeKit 独立成一个应用之后，它将有能力将平台上所有的兼容设备置于同一个管理中心中。只需要打开 iOS 10 上的 Home  应用，就可以对所有兼容 HomeKit 的设备进行统一的匹配和控制管理，Home  应用中包含了非常全面的家电控制面板选项，支持 3D Touch 也支持 Siri 进行控制，iPad、Apple Watch 也会提供 Home 应用。</p>
<p>苹果表示，今天有好多开发商都参与到了 HomeKit 开发其中，通过 HomeKit 用户可以控制家里所有智能电器，包括控制门锁、风扇、灯，打开房门和车空门等等，不仅可以查看门锁摄像头的实时视频，而且还能控制让浴缸的热水在没回家之前就给用户放好。</p>
<h3 id="电话"><a href="#电话" class="headerlink" title="电话"></a>电话</h3><p>默认电话 app  这部分的内容讲得比较少，一些比较突出的更新包括支持显示垃圾电话，支持 VoIP，支持语音信箱转文本显示等等。从现场图来看，联系人界面进行了全新的设计。</p>
<h3 id="信息"><a href="#信息" class="headerlink" title="信息"></a>信息</h3><p>苹果表示，信息是 iOS 中使用最为频繁的应用之一。所以，这一次信息应用苹果花了大量时间进行演示，不过很多功能都与国内的即时聊天应用类似。</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">IOS</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/随笔/" class="article-tag-list-link color3">随笔</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2016/06/15/IOS 10/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>





  
    <article id="post-SDWebImage之图片缓存分析" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/04/SDWebImage之图片缓存分析/">SDWebImage之图片缓存处理</a>
    </h1>
  

        
        <a href="/2016/06/04/SDWebImage之图片缓存分析/" class="archive-article-date">
  	<time datetime="2016-06-04T08:55:11.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2016-06-04</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>这篇文章我将接着节讲述关于SDWebImage图片下载后处理方式，缓存进行讲解。<br><br><br>经过上面我们可以知道SDWebImage是可以从远程的服务器加载图片，然后在UIImageView上进行显示。但是你有想过SDWebImage到底是什么呢？</p>
<p>在使用时我们知道需要导入包：UIImageView+WebCache.h我们可以根据这看出SDWebImage是一个UIImageView的分类，使用Category进行分装的类。下面列出SDWebImage可以实现的功能：</p>
<p><ul></ul></p>
<p><li>提供UIImageView的一个分类，可以对图片进行异步加载和缓存管理</li></p>
<p><li>一步内存 &amp; 磁盘管理 &amp; 自动对过期的缓存进行相关的处理</li></p>
<p><li>一个一步图片的加载器</li></p>
<p><li>支持GIF的图片加载</li></p>
<p><li>后台对图片进行解压处理</li></p>
<p><li>确保同意URL的图片不会被数次加载</li></p>
<p><li>确保虚假的URL不会被反复加载</li></p>
<p><li>确保下载和缓存时主线程不会被阻塞</li></p>
<p><li>优良使用性能</li></p>
<p><li>采用GCD可以采用并行处理，IOS 5.0的ARC自动计数原则</li></p>
<p><li>支持Arm64(64位CPU处理)</li><br></p>
<div style="color:#008B8B"><p><br>本篇博客是在SDWebImage的图片加载基础之上进行探索，下面我们就来看下SDWebImage是如何实现对图片实行缓存处理。</p></div>

<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p>SDImageCache是图片下载后内存缓存管理和磁盘缓存管理的类，不过还是我们最常见的单例模式sharedImageCache来进行得到实例。默认的缓存空间上是default，如果自己看着不怎么好的话可以自己进行相关的空间申请。下面是SDWebCache的简介：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+ (SDImageCache *)sharedImageCache &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> once;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">id</span> instance;</span><br><span class="line">    <span class="built_in">dispatch_once</span>(&amp;once, ^&#123;</span><br><span class="line">        instance = [<span class="keyword">self</span> new];</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里使用dispatch_once的形式每次开启一个线程，这样可以防止多个单例进行同时的初始化。<a href="http://www.cocoachina.com/ios/20151117/14225.html" target="_blank" rel="external">详情可以参考GCD相关的知识</a></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">id</span>)init &#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> initWithNamespace:<span class="string">@"default"</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)initWithNamespace:(<span class="built_in">NSString</span> *)ns &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *path = [<span class="keyword">self</span> makeDiskCachePath:ns];</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> initWithNamespace:ns diskCacheDirectory:path];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)initWithNamespace:(<span class="built_in">NSString</span> *)ns diskCacheDirectory:(<span class="built_in">NSString</span> *)directory &#123;</span><br><span class="line">    <span class="keyword">if</span> ((<span class="keyword">self</span> = [<span class="keyword">super</span> init])) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *fullNamespace = [<span class="string">@"com.hackemist.SDWebImageCache."</span> stringByAppendingString:ns];</span><br><span class="line"></span><br><span class="line">     <span class="comment">// initialise PNG signature data</span></span><br><span class="line">     kPNGSignatureData = [<span class="built_in">NSData</span> dataWithBytes:kPNGSignatureBytes length:<span class="number">8</span>];</span><br><span class="line"></span><br><span class="line">     <span class="comment">// Create IO serial queue</span></span><br><span class="line">     _ioQueue = dispatch_queue_create(<span class="string">"com.hackemist.SDWebImageCache"</span>, DISPATCH_QUEUE_SERIAL);</span><br><span class="line"></span><br><span class="line">     <span class="comment">// Init default values</span></span><br><span class="line">     _maxCacheAge = kDefaultCacheMaxCacheAge;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// Init the memory cache</span></span><br><span class="line">     _memCache = [[AutoPurgeCache alloc] init];</span><br><span class="line">     _memCache.name = fullNamespace;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// Init the disk cache</span></span><br><span class="line">     <span class="keyword">if</span> (directory != <span class="literal">nil</span>) &#123;</span><br><span class="line">         _diskCachePath = [directory stringByAppendingPathComponent:fullNamespace];</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="built_in">NSString</span> *path = [<span class="keyword">self</span> makeDiskCachePath:ns];</span><br><span class="line">         _diskCachePath = path;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// Set decompression to YES</span></span><br><span class="line">     _shouldDecompressImages = <span class="literal">YES</span>;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// memory cache enabled</span></span><br><span class="line">     _shouldCacheImagesInMemory = <span class="literal">YES</span>;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// Disable iCloud</span></span><br><span class="line">     _shouldDisableiCloud = <span class="literal">YES</span>;</span><br><span class="line"></span><br><span class="line">     <span class="built_in">dispatch_sync</span>(_ioQueue, ^&#123;</span><br><span class="line">         _fileManager = [<span class="built_in">NSFileManager</span> new];</span><br><span class="line">     &#125;);</span><br><span class="line"></span><br><span class="line"><span class="meta">#if TARGET_OS_IPHONE</span></span><br><span class="line">     <span class="comment">// Subscribe to app events</span></span><br><span class="line">     [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span></span><br><span class="line">                                              selector:<span class="keyword">@selector</span>(clearMemory)</span><br><span class="line">                                                  name:<span class="built_in">UIApplicationDidReceiveMemoryWarningNotification</span></span><br><span class="line">                                                object:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line">     [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span></span><br><span class="line">                                              selector:<span class="keyword">@selector</span>(cleanDisk)</span><br><span class="line">                                                  name:<span class="built_in">UIApplicationWillTerminateNotification</span></span><br><span class="line">                                                object:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line">     [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span></span><br><span class="line">                                              selector:<span class="keyword">@selector</span>(backgroundCleanDisk)</span><br><span class="line">                                                  name:<span class="built_in">UIApplicationDidEnterBackgroundNotification</span></span><br><span class="line">                                                object:<span class="literal">nil</span>];</span><br><span class="line"><span class="meta">#endif</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<div style="color:#008B8B"><p><br>上面我们可以看出在我们使用init来进行初始化缓存空间，紧接着就调用initWithNamespace: &amp; initWithNamespace: diskCacheDirectory:来进一步对磁盘进行缓存空间的初始化。<br></p></div>

<h3 id="内存缓存类"><a href="#内存缓存类" class="headerlink" title="内存缓存类"></a>内存缓存类</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AutoPurgeCache</span> : <span class="title">NSCache</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">AutoPurgeCache</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)init</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</span><br><span class="line">        [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(removeAllObjects) name:<span class="built_in">UIApplicationDidReceiveMemoryWarningNotification</span> object:<span class="literal">nil</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)dealloc</span><br><span class="line">&#123;</span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] removeObserver:<span class="keyword">self</span> name:<span class="built_in">UIApplicationDidReceiveMemoryWarningNotification</span> object:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>上面我们可以看出在缓存过程中我们采用的是NSCache的子类AutoPurgeCache进行线管的缓存处理，但是我们也可以直接使用NSdictionary来进行处理，为什么不使用呢？后面我将会讲出😸。返回上面，我们可以看出在缓存时我们采用注册和监听的模式对缓存的内存监听，一旦缓存数据达到临界点就要条用removeAllObjects。这里有关于方法在运行时编译情况下的过程<br><a href="http://boilwater.github.io/2016/05/29/runtime理解/" target="_blank" rel="external">runtime解析</a>。</p>
<div style="color:#008B8B"><p><br>在缓存过程中我们使用的是NSCache而不是用NSDictionary呢，下面我们看下NSCache的优点：<br><ul><br><li>自动删减功能</li><br><li>线程安全</li><br><li>不会拷贝健</li><br></ul><br>基于上面NSCache的特点选着使用NSCache是更加易于对缓存的管理<br></p></div>

<p><a href="http://thenewself.blog.163.com/blog/static/198501330201251311025928/" target="_blank" rel="external">NSCache的参考资料</a><br><br></p>
<h2 id="缓存在APP周期的设置"><a href="#缓存在APP周期的设置" class="headerlink" title="缓存在APP周期的设置"></a>缓存在APP周期的设置</h2><p>在应用开发对内容缓存的过程我们也可以参考下面缓存的处理机制，这也对我们APP的性能会有比较大的提升。下面按照APP的分为：内存警告、程序终止和后台三种情况实现缓存策略。</p>
<h3 id="内存警告"><a href="#内存警告" class="headerlink" title="内存警告"></a>内存警告</h3><p>在我们使用SDWebImage过程时程序一直都会对我们访的图片进行相关缓存处理，但是当我们缓存较大时就会产生警告</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)clearMemory &#123;</span><br><span class="line">    [<span class="keyword">self</span>.memCache removeAllObjects];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面是我们注册发现内存过大需要调用的方法。</p>
<h3 id="程序终止"><a href="#程序终止" class="headerlink" title="程序终止"></a>程序终止</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)cleanDisk &#123;</span><br><span class="line">    [<span class="keyword">self</span> cleanDiskWithCompletionBlock:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)cleanDiskWithCompletionBlock:(SDWebImageNoParamsBlock)completionBlock &#123;</span><br><span class="line">    <span class="built_in">dispatch_async</span>(<span class="keyword">self</span>.ioQueue, ^&#123;</span><br><span class="line">        <span class="built_in">NSURL</span> *diskCacheURL = [<span class="built_in">NSURL</span> fileURLWithPath:<span class="keyword">self</span>.diskCachePath isDirectory:<span class="literal">YES</span>];</span><br><span class="line">        <span class="built_in">NSArray</span> *resourceKeys = @[<span class="built_in">NSURLIsDirectoryKey</span>, <span class="built_in">NSURLContentModificationDateKey</span>, <span class="built_in">NSURLTotalFileAllocatedSizeKey</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// This enumerator prefetches useful properties for our cache files.</span></span><br><span class="line">      <span class="built_in">NSDirectoryEnumerator</span> *fileEnumerator = [_fileManager enumeratorAtURL:diskCacheURL</span><br><span class="line">                                                 includingPropertiesForKeys:resourceKeys</span><br><span class="line">                                                                    options:<span class="built_in">NSDirectoryEnumerationSkipsHiddenFiles</span></span><br><span class="line">                                                               errorHandler:<span class="literal">NULL</span>];</span><br><span class="line"></span><br><span class="line">      <span class="built_in">NSDate</span> *expirationDate = [<span class="built_in">NSDate</span> dateWithTimeIntervalSinceNow:-<span class="keyword">self</span>.maxCacheAge];</span><br><span class="line">      <span class="built_in">NSMutableDictionary</span> *cacheFiles = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line">      <span class="built_in">NSUInteger</span> currentCacheSize = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Enumerate all of the files in the cache directory.  This loop has two purposes:</span></span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">      <span class="comment">//  1. Removing files that are older than the expiration date.</span></span><br><span class="line">      <span class="comment">//  2. Storing file attributes for the size-based cleanup pass.</span></span><br><span class="line">      <span class="built_in">NSMutableArray</span> *urlsToDelete = [[<span class="built_in">NSMutableArray</span> alloc] init];</span><br><span class="line">      <span class="keyword">for</span> (<span class="built_in">NSURL</span> *fileURL <span class="keyword">in</span> fileEnumerator) &#123;</span><br><span class="line">          <span class="built_in">NSDictionary</span> *resourceValues = [fileURL resourceValuesForKeys:resourceKeys error:<span class="literal">NULL</span>];</span><br><span class="line"></span><br><span class="line">          <span class="comment">// Skip directories.</span></span><br><span class="line">          <span class="keyword">if</span> ([resourceValues[<span class="built_in">NSURLIsDirectoryKey</span>] boolValue]) &#123;</span><br><span class="line">              <span class="keyword">continue</span>;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// Remove files that are older than the expiration date;</span></span><br><span class="line">          <span class="built_in">NSDate</span> *modificationDate = resourceValues[<span class="built_in">NSURLContentModificationDateKey</span>];</span><br><span class="line">          <span class="keyword">if</span> ([[modificationDate laterDate:expirationDate] isEqualToDate:expirationDate]) &#123;</span><br><span class="line">              [urlsToDelete addObject:fileURL];</span><br><span class="line">              <span class="keyword">continue</span>;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// Store a reference to this file and account for its total size.</span></span><br><span class="line">          <span class="built_in">NSNumber</span> *totalAllocatedSize = resourceValues[<span class="built_in">NSURLTotalFileAllocatedSizeKey</span>];</span><br><span class="line">          currentCacheSize += [totalAllocatedSize unsignedIntegerValue];</span><br><span class="line">          [cacheFiles setObject:resourceValues forKey:fileURL];</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">for</span> (<span class="built_in">NSURL</span> *fileURL <span class="keyword">in</span> urlsToDelete) &#123;</span><br><span class="line">          [_fileManager removeItemAtURL:fileURL error:<span class="literal">nil</span>];</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// If our remaining disk cache exceeds a configured maximum size, perform a second</span></span><br><span class="line">      <span class="comment">// size-based cleanup pass.  We delete the oldest files first.</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">self</span>.maxCacheSize &gt; <span class="number">0</span> &amp;&amp; currentCacheSize &gt; <span class="keyword">self</span>.maxCacheSize) &#123;</span><br><span class="line">          <span class="comment">// Target half of our maximum cache size for this cleanup pass.</span></span><br><span class="line">          <span class="keyword">const</span> <span class="built_in">NSUInteger</span> desiredCacheSize = <span class="keyword">self</span>.maxCacheSize / <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Sort the remaining cache files by their last modification time (oldest first).</span></span><br><span class="line">        <span class="built_in">NSArray</span> *sortedFiles = [cacheFiles keysSortedByValueWithOptions:<span class="built_in">NSSortConcurrent</span></span><br><span class="line">                                                        usingComparator:^<span class="built_in">NSComparisonResult</span>(<span class="keyword">id</span> obj1, <span class="keyword">id</span> obj2) &#123;</span><br><span class="line">                                                            <span class="keyword">return</span> [obj1[<span class="built_in">NSURLContentModificationDateKey</span>] compare:obj2[<span class="built_in">NSURLContentModificationDateKey</span>]];</span><br><span class="line">                                                        &#125;];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Delete files until we fall below our desired cache size.</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">NSURL</span> *fileURL <span class="keyword">in</span> sortedFiles) &#123;</span><br><span class="line">            <span class="keyword">if</span> ([_fileManager removeItemAtURL:fileURL error:<span class="literal">nil</span>]) &#123;</span><br><span class="line">                <span class="built_in">NSDictionary</span> *resourceValues = cacheFiles[fileURL];</span><br><span class="line">                <span class="built_in">NSNumber</span> *totalAllocatedSize = resourceValues[<span class="built_in">NSURLTotalFileAllocatedSizeKey</span>];</span><br><span class="line">                currentCacheSize -= [totalAllocatedSize unsignedIntegerValue];</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (currentCacheSize &lt; desiredCacheSize) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (completionBlock) &#123;</span><br><span class="line">          <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">              completionBlock();</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从上面我们可以看出当收到UIApplicationWillTerminateNotification时，SDImageCache将会使用ioQueue异步地清理磁盘缓存。</p>
<p>清除过程的逻辑如下：</p>
<div style="color:#008B8B"><p><br><ul><br><li>先清除已超过最大缓存时间的缓存文件（最大缓存时间默认为一星期）</li><br><li>在第一轮清除的过程中保存文件属性，特别是缓存文件大小</li><br><li>在第一轮清除后，如果设置了最大缓存并且保留下来的磁盘缓存文件仍然超过了配置的最大缓存，那么进行第二轮以大小为基础的清除。</li><br><li>首先删除最老的文件，直到达到期望的总的缓存大小，即最大缓存的一半。</li><br></ul><br></p></div>

<h3 id="程序进入后台"><a href="#程序进入后台" class="headerlink" title="程序进入后台"></a>程序进入后台</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)backgroundCleanDisk &#123;</span><br><span class="line">    Class <span class="built_in">UIApplicationClass</span> = <span class="built_in">NSClassFromString</span>(<span class="string">@"UIApplication"</span>);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">UIApplicationClass</span> || ![<span class="built_in">UIApplicationClass</span> respondsToSelector:<span class="keyword">@selector</span>(sharedApplication)]) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">UIApplication</span> *application = [<span class="built_in">UIApplication</span> performSelector:<span class="keyword">@selector</span>(sharedApplication)];</span><br><span class="line">    __block <span class="built_in">UIBackgroundTaskIdentifier</span> bgTask = [application beginBackgroundTaskWithExpirationHandler:^&#123;</span><br><span class="line">        <span class="comment">// Clean up any unfinished task business by marking where you</span></span><br><span class="line">        <span class="comment">// stopped or ending the task outright.</span></span><br><span class="line">        [application endBackgroundTask:bgTask];</span><br><span class="line">        bgTask = <span class="built_in">UIBackgroundTaskInvalid</span>;</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">   <span class="comment">// Start the long-running task and return immediately.</span></span><br><span class="line">   [<span class="keyword">self</span> cleanDiskWithCompletionBlock:^&#123;</span><br><span class="line">       [application endBackgroundTask:bgTask];</span><br><span class="line">       bgTask = <span class="built_in">UIBackgroundTaskInvalid</span>;</span><br><span class="line">   &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当收到UIApplicationDidEnterBackgroundNotification时，在手机系统后台进行如上面描述的异步磁盘缓存清理。这里利用Objective－C的动态语言特性，得到UIApplication的单例sharedApplication，使用sharedApplication开启后台任务cleanDiskWithCompletionBlock:</p>
<p><a href="http://boilwater.github.io/2016/05/29/runtime理解/" target="_blank" rel="external">runtime的详解</a></p>
<h3 id="查询图片"><a href="#查询图片" class="headerlink" title="查询图片"></a>查询图片</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSOperation</span> *)queryDiskCacheForKey:(<span class="built_in">NSString</span> *)key done:(SDWebImageQueryCompletedBlock)doneBlock &#123;</span><br><span class="line">   <span class="keyword">if</span> (!doneBlock) &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (!key) &#123;</span><br><span class="line">       doneBlock(<span class="literal">nil</span>, SDImageCacheTypeNone);</span><br><span class="line">       <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// First check the in-memory cache...</span></span><br><span class="line">   <span class="built_in">UIImage</span> *image = [<span class="keyword">self</span> imageFromMemoryCacheForKey:key];</span><br><span class="line">   <span class="keyword">if</span> (image) &#123;</span><br><span class="line">       doneBlock(image, SDImageCacheTypeMemory);</span><br><span class="line">       <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="built_in">NSOperation</span> *operation = [<span class="built_in">NSOperation</span> new];</span><br><span class="line">   <span class="built_in">dispatch_async</span>(<span class="keyword">self</span>.ioQueue, ^&#123;</span><br><span class="line">       <span class="keyword">if</span> (operation.isCancelled) &#123;</span><br><span class="line">           <span class="keyword">return</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">           <span class="built_in">UIImage</span> *diskImage = [<span class="keyword">self</span> diskImageForKey:key];</span><br><span class="line">           <span class="keyword">if</span> (diskImage &amp;&amp; <span class="keyword">self</span>.shouldCacheImagesInMemory) &#123;</span><br><span class="line">               <span class="built_in">NSUInteger</span> cost = SDCacheCostForImage(diskImage);</span><br><span class="line">               [<span class="keyword">self</span>.memCache setObject:diskImage forKey:key cost:cost];</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">               doneBlock(diskImage, SDImageCacheTypeDisk);</span><br><span class="line">           &#125;);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> operation;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>查询缓存，默认使用方法queryDiskCacheForKey:done:，如果此方法返回nil，则说明缓存中现在还没有这张照片，因此你需要得到并缓存这张图片。缓存key是缓存图片的程序唯一的标识符，一般使用图片的完整URL。</p>
<p>如果不想SDImageCache查询磁盘缓存，你可以调用另一个方法：imageFromMemoryCacheForKey:。</p>
<p>返回值为NSOpration，单独使用SDImageCache没用，但是使用SDWebImageManager就可以对多个任务的优先级、依赖，并且可以取消。</p>
<p>自定义@autoreleasepool，autoreleasepool代码段里面有大量的内存消耗操作，自定义autoreleasepool可以及时地释放掉内存。<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSString</span> *)cachePathForKey:(<span class="built_in">NSString</span> *)key inPath:(<span class="built_in">NSString</span> *)path &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *filename = [<span class="keyword">self</span> cachedFileNameForKey:key];</span><br><span class="line">    <span class="keyword">return</span> [path stringByAppendingPathComponent:filename];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *)defaultCachePathForKey:(<span class="built_in">NSString</span> *)key &#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> cachePathForKey:key inPath:<span class="keyword">self</span>.diskCachePath];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark SDImageCache (private)</span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *)cachedFileNameForKey:(<span class="built_in">NSString</span> *)key &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *str = [key UTF8String];</span><br><span class="line">    <span class="keyword">if</span> (str == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        str = <span class="string">""</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> r[CC_MD5_DIGEST_LENGTH];</span><br><span class="line">    CC_MD5(str, (CC_LONG)strlen(str), r);</span><br><span class="line">    <span class="built_in">NSString</span> *filename = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%@"</span>,</span><br><span class="line">                          r[<span class="number">0</span>], r[<span class="number">1</span>], r[<span class="number">2</span>], r[<span class="number">3</span>], r[<span class="number">4</span>], r[<span class="number">5</span>], r[<span class="number">6</span>], r[<span class="number">7</span>], r[<span class="number">8</span>], r[<span class="number">9</span>], r[<span class="number">10</span>],</span><br><span class="line">                          r[<span class="number">11</span>], r[<span class="number">12</span>], r[<span class="number">13</span>], r[<span class="number">14</span>], r[<span class="number">15</span>], [[key pathExtension] isEqualToString:<span class="string">@""</span>] ? <span class="string">@""</span> : [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@".%@"</span>, [key pathExtension]]];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> filename;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSData</span> *)diskImageDataBySearchingAllPathsForKey:(<span class="built_in">NSString</span> *)key &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *defaultPath = [<span class="keyword">self</span> defaultCachePathForKey:key];</span><br><span class="line">    <span class="built_in">NSData</span> *data = [<span class="built_in">NSData</span> dataWithContentsOfFile:defaultPath];</span><br><span class="line">    <span class="keyword">if</span> (data) &#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// fallback because of https://github.com/rs/SDWebImage/pull/976 that added the extension to the disk file name</span></span><br><span class="line">    <span class="comment">// checking the key with and without the extension</span></span><br><span class="line">    data = [<span class="built_in">NSData</span> dataWithContentsOfFile:[defaultPath stringByDeletingPathExtension]];</span><br><span class="line">    <span class="keyword">if</span> (data) &#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">NSArray</span> *customPaths = [<span class="keyword">self</span>.customPaths <span class="keyword">copy</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">NSString</span> *path <span class="keyword">in</span> customPaths) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *filePath = [<span class="keyword">self</span> cachePathForKey:key inPath:path];</span><br><span class="line">        <span class="built_in">NSData</span> *imageData = [<span class="built_in">NSData</span> dataWithContentsOfFile:filePath];</span><br><span class="line">        <span class="keyword">if</span> (imageData) &#123;</span><br><span class="line">            <span class="keyword">return</span> imageData;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// fallback because of https://github.com/rs/SDWebImage/pull/976 that added the extension to the disk file name</span></span><br><span class="line">        <span class="comment">// checking the key with and without the extension</span></span><br><span class="line">        imageData = [<span class="built_in">NSData</span> dataWithContentsOfFile:[filePath stringByDeletingPathExtension]];</span><br><span class="line">        <span class="keyword">if</span> (imageData) &#123;</span><br><span class="line">            <span class="keyword">return</span> imageData;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<div style="color:#008B8B"><p><br>上面代码段是从磁盘获取图片的代码。得到图片对应的UIData后，还要经过如下步骤，才能返回对应的图片：<br><ul><br><li>根据图片的不同种类，生成对应的UIImage</li><br><li>根据key值，调整image的scale值</li><br><li>如果设置图片需要解压缩，则还需对UIImage进行解码</li><br></ul><br></p></div>

<h3 id="下面是MD5的加密方式"><a href="#下面是MD5的加密方式" class="headerlink" title="下面是MD5的加密方式"></a>下面是MD5的加密方式</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSString</span> *)cachedFileNameForKey:(<span class="built_in">NSString</span> *)key &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *str = [key UTF8String];</span><br><span class="line">    <span class="keyword">if</span> (str == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        str = <span class="string">""</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> r[CC_MD5_DIGEST_LENGTH];</span><br><span class="line">    CC_MD5(str, (CC_LONG)strlen(str), r);</span><br><span class="line">    <span class="built_in">NSString</span> *filename = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%@"</span>,</span><br><span class="line">                          r[<span class="number">0</span>], r[<span class="number">1</span>], r[<span class="number">2</span>], r[<span class="number">3</span>], r[<span class="number">4</span>], r[<span class="number">5</span>], r[<span class="number">6</span>], r[<span class="number">7</span>], r[<span class="number">8</span>], r[<span class="number">9</span>], r[<span class="number">10</span>],</span><br><span class="line">                          r[<span class="number">11</span>], r[<span class="number">12</span>], r[<span class="number">13</span>], r[<span class="number">14</span>], r[<span class="number">15</span>], [[key pathExtension] isEqualToString:<span class="string">@""</span>] ? <span class="string">@""</span> : [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@".%@"</span>, [key pathExtension]]];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> filename;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="图片的保存"><a href="#图片的保存" class="headerlink" title="图片的保存"></a>图片的保存</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)storeImage:(<span class="built_in">UIImage</span> *)image recalculateFromImage:(<span class="built_in">BOOL</span>)recalculate imageData:(<span class="built_in">NSData</span> *)imageData forKey:(<span class="built_in">NSString</span> *)key toDisk:(<span class="built_in">BOOL</span>)toDisk &#123;</span><br><span class="line">    <span class="keyword">if</span> (!image || !key) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// if memory cache is enabled</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.shouldCacheImagesInMemory) &#123;</span><br><span class="line">        <span class="built_in">NSUInteger</span> cost = SDCacheCostForImage(image);</span><br><span class="line">        [<span class="keyword">self</span>.memCache setObject:image forKey:key cost:cost];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (toDisk) &#123;</span><br><span class="line">        <span class="built_in">dispatch_async</span>(<span class="keyword">self</span>.ioQueue, ^&#123;</span><br><span class="line">            <span class="built_in">NSData</span> *data = imageData;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (image &amp;&amp; (recalculate || !data)) &#123;</span><br><span class="line"><span class="meta">#if TARGET_OS_IPHONE</span></span><br><span class="line">                <span class="comment">// We need to determine if the image is a PNG or a JPEG</span></span><br><span class="line">                <span class="comment">// PNGs are easier to detect because they have a unique signature (http://www.w3.org/TR/PNG-Structure.html)</span></span><br><span class="line">                <span class="comment">// The first eight bytes of a PNG file always contain the following (decimal) values:</span></span><br><span class="line">                <span class="comment">// 137 80 78 71 13 10 26 10</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// If the imageData is nil (i.e. if trying to save a UIImage directly or the image was transformed on download)</span></span><br><span class="line">                <span class="comment">// and the image has an alpha channel, we will consider it PNG to avoid losing the transparency</span></span><br><span class="line">                <span class="keyword">int</span> alphaInfo = <span class="built_in">CGImageGetAlphaInfo</span>(image.CGImage);</span><br><span class="line">                <span class="built_in">BOOL</span> hasAlpha = !(alphaInfo == kCGImageAlphaNone ||</span><br><span class="line">                                  alphaInfo == kCGImageAlphaNoneSkipFirst ||</span><br><span class="line">                                  alphaInfo == kCGImageAlphaNoneSkipLast);</span><br><span class="line">                <span class="built_in">BOOL</span> imageIsPng = hasAlpha;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// But if we have an image data, we will look at the preffix</span></span><br><span class="line">                <span class="keyword">if</span> ([imageData length] &gt;= [kPNGSignatureData length]) &#123;</span><br><span class="line">                    imageIsPng = ImageDataHasPNGPreffix(imageData);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (imageIsPng) &#123;</span><br><span class="line">                    data = <span class="built_in">UIImagePNGRepresentation</span>(image);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    data = <span class="built_in">UIImageJPEGRepresentation</span>(image, (<span class="built_in">CGFloat</span>)<span class="number">1.0</span>);</span><br><span class="line">                &#125;</span><br><span class="line"><span class="meta">#else</span></span><br><span class="line">                data = [<span class="built_in">NSBitmapImageRep</span> representationOfImageRepsInArray:image.representations usingType: <span class="built_in">NSJPEGFileType</span> properties:<span class="literal">nil</span>];</span><br><span class="line"><span class="meta">#endif</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (data) &#123;</span><br><span class="line">                <span class="keyword">if</span> (![_fileManager fileExistsAtPath:_diskCachePath]) &#123;</span><br><span class="line">                    [_fileManager createDirectoryAtPath:_diskCachePath withIntermediateDirectories:<span class="literal">YES</span> attributes:<span class="literal">nil</span> error:<span class="literal">NULL</span>];</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// get cache Path for image key</span></span><br><span class="line">                <span class="built_in">NSString</span> *cachePathForKey = [<span class="keyword">self</span> defaultCachePathForKey:key];</span><br><span class="line">                <span class="comment">// transform to NSUrl</span></span><br><span class="line">                <span class="built_in">NSURL</span> *fileURL = [<span class="built_in">NSURL</span> fileURLWithPath:cachePathForKey];</span><br><span class="line"></span><br><span class="line">                [_fileManager createFileAtPath:cachePathForKey contents:data attributes:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line">                <span class="comment">// disable iCloud backup</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">self</span>.shouldDisableiCloud) &#123;</span><br><span class="line">                    [fileURL setResourceValue:[<span class="built_in">NSNumber</span> numberWithBool:<span class="literal">YES</span>] forKey:<span class="built_in">NSURLIsExcludedFromBackupKey</span> error:<span class="literal">nil</span>];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)storeImage:(<span class="built_in">UIImage</span> *)image forKey:(<span class="built_in">NSString</span> *)key &#123;</span><br><span class="line">    [<span class="keyword">self</span> storeImage:image recalculateFromImage:<span class="literal">YES</span> imageData:<span class="literal">nil</span> forKey:key toDisk:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)storeImage:(<span class="built_in">UIImage</span> *)image forKey:(<span class="built_in">NSString</span> *)key toDisk:(<span class="built_in">BOOL</span>)toDisk &#123;</span><br><span class="line">    [<span class="keyword">self</span> storeImage:image recalculateFromImage:<span class="literal">YES</span> imageData:<span class="literal">nil</span> forKey:key toDisk:toDisk];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>存储一个图片到缓存中，可以使用方法storeImage:forKey:method:，默认，图片既会存储到内存缓存中，也会异步地保存到磁盘缓存中。如果只想使用内存缓存，可以使用另外一个方法storeImage:forKey:toDisk，第三个参数传入false值就好了。</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color2">三方框架解析</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/第三方框架/" class="article-tag-list-link color1">第三方框架</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2016/06/04/SDWebImage之图片缓存分析/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>





  
    <article id="post-SDWebImage" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/03/SDWebImage/">SDWebImage之图片下载</a>
    </h1>
  

        
        <a href="/2016/06/03/SDWebImage/" class="archive-article-date">
  	<time datetime="2016-06-03T13:23:21.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2016-06-03</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>我们经常使用SDWebImage在加载图片，但对于图片加载过程中怎么样实现不会深究。下面我们就对SDWebImage进行相应的分析：<br><a href="https://github.com/rs/SDWebImage" target="_blank" rel="external">源码地址</a></p>
<h2 id="SDWebImage的下载器"><a href="#SDWebImage的下载器" class="headerlink" title="SDWebImage的下载器"></a>SDWebImage的下载器</h2><p>SDWebImage的下载器是SDWebImageDownloader利用单例模式sharedDownloader，可以对下载的图片进行相关配置。可以配置的部分如下：</p>
<p><ul></ul></p>
<p><li>下载选项</li></p>
<p><li>HTTP的头部</li></p>
<p><li>压缩、下载超时、下载顺序、最大并发数等</li><br></p>
<h3 id="下载选项"><a href="#下载选项" class="headerlink" title="下载选项"></a>下载选项</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="built_in">NS_OPTIONS</span>(<span class="built_in">NSUInteger</span>, SDWebImageDownloaderOptions) &#123;</span><br><span class="line">   <span class="comment">//下载的优先级</span></span><br><span class="line">   SDWebImageDownloaderLowPriority = <span class="number">1</span> &lt;&lt; <span class="number">0</span>,</span><br><span class="line">   <span class="comment">//下载进度</span></span><br><span class="line">   SDWebImageDownloaderProgressiveDownload = <span class="number">1</span> &lt;&lt; <span class="number">1</span>,</span><br><span class="line">   <span class="comment">//下载路径缓存</span></span><br><span class="line">   SDWebImageDownloaderUseNSURLCache = <span class="number">1</span> &lt;&lt; <span class="number">2</span>,</span><br><span class="line">   <span class="comment">//下载过程的请求缓存</span></span><br><span class="line">   SDWebImageDownloaderIgnoreCachedResponse = <span class="number">1</span> &lt;&lt; <span class="number">3</span>,</span><br><span class="line">   <span class="comment">//后台进行继续下载</span></span><br><span class="line">   SDWebImageDownloaderContinueInBackground = <span class="number">1</span> &lt;&lt; <span class="number">4</span>,</span><br><span class="line">    </span><br><span class="line">   SDWebImageDownloaderHandleCookies = <span class="number">1</span> &lt;&lt; <span class="number">5</span>,</span><br><span class="line">   </span><br><span class="line">   SDWebImageDownloaderAllowInvalidSSLCertificates = <span class="number">1</span> &lt;&lt; <span class="number">6</span>,</span><br><span class="line">   </span><br><span class="line">   SDWebImageDownloaderHighPriority = <span class="number">1</span> &lt;&lt; <span class="number">7</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="HTTP的头部设置"><a href="#HTTP的头部设置" class="headerlink" title="HTTP的头部设置"></a>HTTP的头部设置</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#ifdef SD_WEBP</span></span><br><span class="line">        _HTTPHeaders = [@&#123;<span class="string">@"Accept"</span>: <span class="string">@"image/webp,image/*;q=0.8"</span>&#125; mutableCopy];</span><br><span class="line"><span class="meta">#else</span></span><br><span class="line">        _HTTPHeaders = [@&#123;<span class="string">@"Accept"</span>: <span class="string">@"image/*;q=0.8"</span>&#125; mutableCopy];</span><br><span class="line"><span class="meta">#endif</span></span><br><span class="line"></span><br><span class="line">-(<span class="keyword">void</span>)setValue:(<span class="built_in">NSString</span> *)value forHTTPHeaderField:(<span class="built_in">NSString</span> *)field &#123;</span><br><span class="line">    <span class="keyword">if</span> (value) &#123;</span><br><span class="line">        <span class="keyword">self</span>.HTTPHeaders[field] = value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        [<span class="keyword">self</span>.HTTPHeaders removeObjectForKey:field];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="built_in">NSString</span> *)valueForHTTPHeaderField:(<span class="built_in">NSString</span> *)field &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.HTTPHeaders[field];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以通过上述forHTTPHeaderField的参数进行相应HTTPheader的设置，使用者可以对头部信息进行相关的添加或者是删除HTTP头部信息。</p>
<h3 id="线程安全"><a href="#线程安全" class="headerlink" title="线程安全"></a>线程安全</h3><p>在图片下载过程中我们要保线程访问的安全性，barrierQueue是实现网络响应的序列化实例。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// This queue is used to serialize the handling of the network responses of all</span><br><span class="line">the download operation in a single queue</span><br><span class="line">@property (SDDispatchQueueSetterSementics, nonatomic) dispatch_queue_t barrierQueue;</span><br></pre></td></tr></table></figure></p>
<p>在保证线程安全的起见，我们对于URLCallbacks进行增改都需要放在dispatch_barrier_sync的形式放入到barrierQueue。但是如果我们只要进行相关的查询那就使用dispatch_sync放入barrierQueue中即可。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">__block <span class="built_in">NSArray</span> *callbacksForURL;</span><br><span class="line"><span class="built_in">dispatch_sync</span>(sself.barrierQueue, ^&#123;</span><br><span class="line">    callbacksForURL = [sself.URLCallbacks[url] <span class="keyword">copy</span>];</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">dispatch_barrier_sync(<span class="keyword">self</span>.barrierQueue, ^&#123;</span><br><span class="line">    <span class="built_in">BOOL</span> first = <span class="literal">NO</span>;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">self</span>.URLCallbacks[url]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.URLCallbacks[url] = [<span class="built_in">NSMutableArray</span> new];</span><br><span class="line">        first = <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// Handle single download of simultaneous download request for the same URL</span></span><br><span class="line"><span class="built_in">NSMutableArray</span> *callbacksForURL = <span class="keyword">self</span>.URLCallbacks[url];</span><br><span class="line"><span class="built_in">NSMutableDictionary</span> *callbacks = [<span class="built_in">NSMutableDictionary</span> new];</span><br><span class="line"><span class="keyword">if</span> (progressBlock) callbacks[kProgressCallbackKey] = [progressBlock <span class="keyword">copy</span>];</span><br><span class="line"><span class="keyword">if</span> (completedBlock) callbacks[kCompletedCallbackKey] = [completedBlock <span class="keyword">copy</span>];</span><br><span class="line">[callbacksForURL addObject:callbacks];</span><br><span class="line"><span class="keyword">self</span>.URLCallbacks[url] = callbacksForURL;</span><br><span class="line"><span class="keyword">if</span> (first) &#123;</span><br><span class="line">      createCallback();</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="回调"><a href="#回调" class="headerlink" title="回调"></a>回调</h3><p>在我们下载图片的过程中，每一张图片都需要开启一个线程，在每一个线程中都需要对执行一定的回调信息。这些回调的信息会以block的实行出现：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">typedef void(^SDWebImageDownloaderProgressBlock)(NSInteger receivedSize,</span><br><span class="line">NSInteger expectedSize);</span><br><span class="line"></span><br><span class="line">typedef void(^SDWebImageDownloaderCompletedBlock)(UIImage *image, NSData *data,</span><br><span class="line">NSError *error, BOOL finished);</span><br><span class="line"></span><br><span class="line">typedef NSDictionary *(^SDWebImageDownloaderHeadersFilterBlock)(NSURL *url, </span><br><span class="line">NSDictionary *headers);</span><br></pre></td></tr></table></figure><br>图片下载的这些回调信息存储在SDWebImageDownloader类的URLCallbacks属性中，该属性是一个字典，key是图片的URL地址，value则是一个数组，包含每个图片的多组回调信息。</p>
<h3 id="下载器"><a href="#下载器" class="headerlink" title="下载器"></a>下载器</h3><p>整个下载过程中我们需要执行在本小结讲述的下载器中进行，下载器对于下载的管理都是放在-(id <sdwebimageoperation>)downloadImageWithURL:中的：</sdwebimageoperation></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">- (id &lt;SDWebImageOperation&gt;)downloadImageWithURL:(NSURL *)url options:(SDWebImageDownloaderOptions)options progress:(SDWebImageDownloaderProgressBlock)progressBlock completed:(SDWebImageDownloaderCompletedBlock)completedBlock &#123;</span><br><span class="line">__block SDWebImageDownloaderOperation *operation;</span><br><span class="line">__weak __typeof(self)wself = self;</span><br><span class="line">[self addProgressCallback:progressBlock completedBlock:completedBlock forURL:url createCallback:^&#123;</span><br><span class="line">        NSTimeInterval timeoutInterval = wself.downloadTimeout;</span><br><span class="line">        if (timeoutInterval == 0.0) &#123;</span><br><span class="line">            timeoutInterval = 15.0;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">// In order to prevent from potential duplicate caching (NSURLCache + SDImageCache) we disable the cache for image requests if told otherwise</span><br><span class="line"></span><br><span class="line">NSMutableURLRequest *request = [[NSMutableURLRequest alloc] initWithURL:url</span><br><span class="line">cachePolicy:(options &amp; SDWebImageDownloaderUseNSURLCache ? </span><br><span class="line">NSURLRequestUseProtocolCachePolicy : NSURLRequestReloadIgnoringLocalCacheData)</span><br><span class="line">timeoutInterval:timeoutInterval];</span><br><span class="line">request.HTTPShouldHandleCookies = (options &amp; SDWebImageDownloaderHandleCookies);</span><br><span class="line">request.HTTPShouldUsePipelining = YES;</span><br><span class="line">      if (wself.headersFilter) &#123;</span><br><span class="line">          request.allHTTPHeaderFields = wself.headersFilter(url, [wself.HTTPHeaders copy]);</span><br><span class="line">      &#125;</span><br><span class="line">      else &#123;</span><br><span class="line">          request.allHTTPHeaderFields = wself.HTTPHeaders;</span><br><span class="line">      &#125;</span><br><span class="line">      operation = [[wself.operationClass alloc] initWithRequest:request</span><br><span class="line">                                                        options:options</span><br><span class="line">                                                       progress:^(NSInteger receivedSize, NSInteger expectedSize) &#123;</span><br><span class="line">                                                           SDWebImageDownloader *sself = wself;</span><br><span class="line">                                                           if (!sself) return;</span><br><span class="line">                                                           __block NSArray *callbacksForURL;</span><br><span class="line">                                                           dispatch_sync(sself.barrierQueue, ^&#123;</span><br><span class="line">                                                               callbacksForURL = [sself.URLCallbacks[url] copy];</span><br><span class="line">                                                           &#125;);</span><br><span class="line">                                                           for (NSDictionary *callbacks in callbacksForURL) &#123;</span><br><span class="line">                                                               dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">                                                                   SDWebImageDownloaderProgressBlock callback = callbacks[kProgressCallbackKey];</span><br><span class="line">                                                                   if (callback) callback(receivedSize, expectedSize);</span><br><span class="line">                                                               &#125;);</span><br><span class="line">                                                           &#125;</span><br><span class="line">                                                       &#125;</span><br><span class="line">                                                      completed:^(UIImage *image, NSData *data, NSError *error, BOOL finished) &#123;</span><br><span class="line">                                                          SDWebImageDownloader *sself = wself;</span><br><span class="line">                                                          if (!sself) return;</span><br><span class="line">                                                          __block NSArray *callbacksForURL;</span><br><span class="line">                                                          dispatch_barrier_sync(sself.barrierQueue, ^&#123;</span><br><span class="line">                                                              callbacksForURL = [sself.URLCallbacks[url] copy];</span><br><span class="line">                                                              if (finished) &#123;</span><br><span class="line">                                                                  [sself.URLCallbacks removeObjectForKey:url];</span><br><span class="line">                                                              &#125;</span><br><span class="line">                                                          &#125;);</span><br><span class="line">                                                          for (NSDictionary *callbacks in callbacksForURL) &#123;</span><br><span class="line">                                                              SDWebImageDownloaderCompletedBlock callback = callbacks[kCompletedCallbackKey];</span><br><span class="line">                                                              if (callback) callback(image, data, error, finished);</span><br><span class="line">                                                          &#125;</span><br><span class="line">                                                      &#125;</span><br><span class="line">                                                      cancelled:^&#123;</span><br><span class="line">                                                          SDWebImageDownloader *sself = wself;</span><br><span class="line">                                                          if (!sself) return;</span><br><span class="line">                                                          dispatch_barrier_async(sself.barrierQueue, ^&#123;</span><br><span class="line">                                                              [sself.URLCallbacks removeObjectForKey:url];</span><br><span class="line">                                                          &#125;);</span><br><span class="line">                                                      &#125;];</span><br><span class="line">      operation.shouldDecompressImages = wself.shouldDecompressImages;</span><br><span class="line">      </span><br><span class="line">      if (wself.urlCredential) &#123;</span><br><span class="line">          operation.credential = wself.urlCredential;</span><br><span class="line">      &#125; else if (wself.username &amp;&amp; wself.password) &#123;</span><br><span class="line">          operation.credential = [NSURLCredential credentialWithUser:wself.username password:wself.password persistence:NSURLCredentialPersistenceForSession];</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      if (options &amp; SDWebImageDownloaderHighPriority) &#123;</span><br><span class="line">          operation.queuePriority = NSOperationQueuePriorityHigh;</span><br><span class="line">      &#125; else if (options &amp; SDWebImageDownloaderLowPriority) &#123;</span><br><span class="line">          operation.queuePriority = NSOperationQueuePriorityLow;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      [wself.downloadQueue addOperation:operation];</span><br><span class="line">      if (wself.executionOrder == SDWebImageDownloaderLIFOExecutionOrder) &#123;</span><br><span class="line">          // Emulate LIFO execution order by systematically adding new operations as last operation&apos;s dependency</span><br><span class="line">          [wself.lastAddedOperation addDependency:operation];</span><br><span class="line">          wself.lastAddedOperation = operation;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;];</span><br><span class="line"></span><br><span class="line">  return operation;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们在上面的方法中调用的方法(void)addProgressCallback:completedBlock:forURL:createCallback:将在访问图片请求的信息直接放入下载器。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)addProgressCallback:(SDWebImageDownloaderProgressBlock)progressBlock completedBlock:(SDWebImageDownloaderCompletedBlock)completedBlock forURL:(<span class="built_in">NSURL</span>*)url createCallback:(SDWebImageNoParamsBlock)createCallback &#123;</span><br><span class="line"><span class="comment">// The URL will be used as the key to the callbacks dictionary so it cannot be nil. If it is nil immediately call the completed block with no image or data.</span></span><br><span class="line">    <span class="keyword">if</span> (url == <span class="literal">nil</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (completedBlock != <span class="literal">nil</span>) &#123;</span><br><span class="line">            completedBlock(<span class="literal">nil</span>, <span class="literal">nil</span>, <span class="literal">nil</span>, <span class="literal">NO</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">dispatch_barrier_sync(<span class="keyword">self</span>.barrierQueue, ^&#123;</span><br><span class="line">   <span class="built_in">BOOL</span> first = <span class="literal">NO</span>;</span><br><span class="line">   <span class="keyword">if</span> (!<span class="keyword">self</span>.URLCallbacks[url]) &#123;</span><br><span class="line">       <span class="keyword">self</span>.URLCallbacks[url] = [<span class="built_in">NSMutableArray</span> new];</span><br><span class="line">       first = <span class="literal">YES</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// Handle single download of simultaneous download request for the same URL</span></span><br><span class="line">   <span class="built_in">NSMutableArray</span> *callbacksForURL = <span class="keyword">self</span>.URLCallbacks[url];</span><br><span class="line">   <span class="built_in">NSMutableDictionary</span> *callbacks = [<span class="built_in">NSMutableDictionary</span> new];</span><br><span class="line">   <span class="keyword">if</span> (progressBlock) callbacks[kProgressCallbackKey] = [progressBlock <span class="keyword">copy</span>];</span><br><span class="line">   <span class="keyword">if</span> (completedBlock) callbacks[kCompletedCallbackKey] = [completedBlock <span class="keyword">copy</span>];</span><br><span class="line">   [callbacksForURL addObject:callbacks];</span><br><span class="line">   <span class="keyword">self</span>.URLCallbacks[url] = callbacksForURL;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (first) &#123;</span><br><span class="line">       createCallback();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="下载操作"><a href="#下载操作" class="headerlink" title="下载操作"></a>下载操作</h3><p>在每张图片下载过程中都要调用一次具体的操作都会调用Operation，下面就分析一下中间的具体过程。<br>我们打开SDWebImage的文件夹可以到其中有一个SDWebImageOperation的类，如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">@protocol SDWebImageOperation &lt;NSObject&gt;</span><br><span class="line"></span><br><span class="line">- (void)cancel;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure><br>其中我们使用NSOpation的子类来完成具体图片下载的过程，这个类就是SDWebImageDownloaderOperation。在SDWebImageDownloaderOperation类中继承NSOperation的类而且实现SDWebImageOperation的cancel的取消协议。除了继承而来的方法，该类只向外暴露了一个方法，即上面所用到的初始化方法initWithRequest:options:pregress:completed:cancelled:。</p>
<p>对于图片的下载，SDWebImageDownloaderOperation完全依赖于URL加载系统中的NSURLConnection类（并未使用iOS7以后的NSURLSession类）。我们先来分析一下SDWebImageDownloaderOperation类中对于图片实际数据的下载处理，即NSURLConnection各代理方法的实现。</p>
<p>首先，SDWebImageDownloaderOperation在Extention中采用了NSURLConnectionDataDelegate协议，并实现了协议的以下几个方法：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">connection:didReceiveResponse:</span><br><span class="line">connection:didReceiveData:</span><br><span class="line">connectionDidFinishLoading:</span><br><span class="line">connection:didFailWithError:</span><br><span class="line">connection:willCacheResponse:</span><br><span class="line">connectionShouldUseCredentialStorage:</span><br><span class="line">connection:willSendRequestForAuthenticationChallenge:</span><br></pre></td></tr></table></figure>
<p>这些方法我们就不逐一分析了，就终点分析一下connection:didReceiveResponse:和connection:didReceiveData:两个方法。</p>
<p>connection:didReceiveResponse方法通过判断NSURLResponse的实际类型和状态码，对除304以外400以内的状态码反应。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)connection:(<span class="built_in">NSURLConnection</span> *)connection didReceiveResponse:(<span class="built_in">NSURLResponse</span> *)response &#123;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">//'304 Not Modified' is an exceptional one</span></span><br><span class="line"> <span class="keyword">if</span> (![response respondsToSelector:<span class="keyword">@selector</span>(statusCode)] ||([((<span class="built_in">NSHTTPURLResponse</span> *)response) statusCode] &lt; <span class="number">400</span> &amp;&amp; [((<span class="built_in">NSHTTPURLResponse</span>  *)response) statusCode] != <span class="number">304</span>)) &#123;</span><br><span class="line">      <span class="built_in">NSInteger</span> expected = response.expectedContentLength &gt; <span class="number">0</span> ? (<span class="built_in">NSInteger</span>)</span><br><span class="line">      response.expectedContentLength : <span class="number">0</span>;</span><br><span class="line">     <span class="keyword">self</span>.expectedSize = expected;</span><br><span class="line">     <span class="keyword">if</span> (<span class="keyword">self</span>.progressBlock) &#123;</span><br><span class="line">         <span class="keyword">self</span>.progressBlock(<span class="number">0</span>, expected);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">self</span>.imageData = [[<span class="built_in">NSMutableData</span> alloc] initWithCapacity:expected];</span><br><span class="line">  <span class="keyword">self</span>.response = response;</span><br><span class="line">  <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">      [[<span class="built_in">NSNotificationCenter</span> defaultCenter] postNotificationName:</span><br><span class="line">      SDWebImageDownloadReceiveResponseNotification object:<span class="keyword">self</span>];</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">   <span class="built_in">NSUInteger</span> code = [((<span class="built_in">NSHTTPURLResponse</span> *)response) statusCode];</span><br><span class="line">   </span><br><span class="line">   <span class="comment">//This is the case when server returns '304 Not Modified'. It means that </span></span><br><span class="line">   remote image is not changed.</span><br><span class="line">   <span class="comment">//In case of 304 we need just cancel the operation and return cached image       </span></span><br><span class="line">   from the cache.</span><br><span class="line">   <span class="keyword">if</span> (code == <span class="number">304</span>) &#123;</span><br><span class="line">       [<span class="keyword">self</span> cancelInternal];</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       [<span class="keyword">self</span>.connection cancel];</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">       [[<span class="built_in">NSNotificationCenter</span> defaultCenter] postNotificationName:SDWebImageDownloadStopNotification object:<span class="keyword">self</span>];</span><br><span class="line">   &#125;);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (<span class="keyword">self</span>.completedBlock) &#123;</span><br><span class="line">       <span class="keyword">self</span>.completedBlock(<span class="literal">nil</span>, <span class="literal">nil</span>, [<span class="built_in">NSError</span> errorWithDomain:</span><br><span class="line">       <span class="built_in">NSURLErrorDomain</span> code:[((<span class="built_in">NSHTTPURLResponse</span> *)response) statusCode] </span><br><span class="line">       userInfo:<span class="literal">nil</span>], <span class="literal">YES</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="built_in">CFRunLoopStop</span>(<span class="built_in">CFRunLoopGetCurrent</span>());</span><br><span class="line">   [<span class="keyword">self</span> done];</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>connection:didReceiveData:方法的主要任务是接受数据。每次接收到数据时，都会用现有的数据创建一个CGImageSourceRef对象以作处理。在首次获取到数据时（width+height==0）会从这些包含图像信息的数据中取出图像的长、宽、方向等信息以备使用。而后在图片下载完成之前，会使用CGImageSourceRef对象创建一个图像对象，经过缩放、解压缩操作后生成一个UIImage对象供完成回调使用。当然，在这个方法中还需要处理的就是进度信息。如果我们有设置进度回调的话，就调用进度回调以处理当前图片的下载进度。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)connection:(<span class="built_in">NSURLConnection</span> *)connection didReceiveData:(<span class="built_in">NSData</span> *)data</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.imageData appendData:data];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ((<span class="keyword">self</span>.options &amp; SDWebImageDownloaderProgressiveDownload) &amp;&amp; <span class="keyword">self</span>.expectedSize &gt; <span class="number">0</span> &amp;&amp; <span class="keyword">self</span>.completedBlock) &#123;</span><br><span class="line"><span class="comment">// The following code is from http://www.cocoaintheshell.com/2011/05/</span></span><br><span class="line">progressive-images-download-imageio/</span><br><span class="line"><span class="comment">// Thanks to the author @Nyx0uf</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Get the total bytes downloaded </span></span><br><span class="line">     <span class="keyword">const</span> <span class="built_in">NSInteger</span> totalSize = <span class="keyword">self</span>.imageData.length;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Update the data source, we must pass ALL the data, not just the new bytes</span></span><br><span class="line">     <span class="built_in">CGImageSourceRef</span> imageSource = <span class="built_in">CGImageSourceCreateWithData</span>((__bridge <span class="built_in">CFDataRef</span>)<span class="keyword">self</span>.imageData, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (width + height == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">CFDictionaryRef</span> properties = <span class="built_in">CGImageSourceCopyPropertiesAtIndex</span>(imageSource, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line">            <span class="keyword">if</span> (properties) &#123;</span><br><span class="line">                <span class="built_in">NSInteger</span> orientationValue = <span class="number">-1</span>;</span><br><span class="line">                <span class="built_in">CFTypeRef</span> val = <span class="built_in">CFDictionaryGetValue</span>(properties, kCGImagePropertyPixelHeight);</span><br><span class="line">                <span class="keyword">if</span> (val) <span class="built_in">CFNumberGetValue</span>(val, kCFNumberLongType, &amp;height);</span><br><span class="line">                val = <span class="built_in">CFDictionaryGetValue</span>(properties, kCGImagePropertyPixelWidth);</span><br><span class="line">                <span class="keyword">if</span> (val) <span class="built_in">CFNumberGetValue</span>(val, kCFNumberLongType, &amp;width);</span><br><span class="line">                val = <span class="built_in">CFDictionaryGetValue</span>(properties, kCGImagePropertyOrientation);</span><br><span class="line">                <span class="keyword">if</span> (val) <span class="built_in">CFNumberGetValue</span>(val, kCFNumberNSIntegerType, &amp;orientationValue);</span><br><span class="line">                <span class="built_in">CFRelease</span>(properties);</span><br><span class="line"><span class="comment">// When we draw to Core Graphics, we lose orientation information,</span></span><br><span class="line"><span class="comment">// which means the image below born of initWithCGIImage will be</span></span><br><span class="line"><span class="comment">// oriented incorrectly sometimes. (Unlike the image born of initWithData</span></span><br><span class="line"><span class="comment">// in connectionDidFinishLoading.) So save it here and pass it on later.</span></span><br><span class="line"></span><br><span class="line">                orientation = [[<span class="keyword">self</span> class] orientationFromPropertyValue:(orientationValue == <span class="number">-1</span> ? <span class="number">1</span> : orientationValue)];</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (width + height &gt; <span class="number">0</span> &amp;&amp; totalSize &lt; <span class="keyword">self</span>.expectedSize) &#123;</span><br><span class="line">            <span class="comment">// Create the image</span></span><br><span class="line">            <span class="built_in">CGImageRef</span> partialImageRef = <span class="built_in">CGImageSourceCreateImageAtIndex</span>(imageSource, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">#ifdef TARGET_OS_IPHONE</span></span><br><span class="line">            <span class="comment">// Workaround for iOS anamorphic image</span></span><br><span class="line">            <span class="keyword">if</span> (partialImageRef) &#123;</span><br><span class="line">                <span class="keyword">const</span> size_t partialHeight = <span class="built_in">CGImageGetHeight</span>(partialImageRef);</span><br><span class="line">                <span class="built_in">CGColorSpaceRef</span> colorSpace = <span class="built_in">CGColorSpaceCreateDeviceRGB</span>();</span><br><span class="line">                <span class="built_in">CGContextRef</span> bmContext = <span class="built_in">CGBitmapContextCreate</span>(<span class="literal">NULL</span>, width, height, <span class="number">8</span>, width * <span class="number">4</span>, colorSpace, kCGBitmapByteOrderDefault | kCGImageAlphaPremultipliedFirst);</span><br><span class="line">                <span class="built_in">CGColorSpaceRelease</span>(colorSpace);</span><br><span class="line">                <span class="keyword">if</span> (bmContext) &#123;</span><br><span class="line">                    <span class="built_in">CGContextDrawImage</span>(bmContext, (<span class="built_in">CGRect</span>)&#123;.origin.x = <span class="number">0.0</span>f, .origin.y = <span class="number">0.0</span>f, .size.width = width, .size.height = partialHeight&#125;, partialImageRef);</span><br><span class="line">                    <span class="built_in">CGImageRelease</span>(partialImageRef);</span><br><span class="line">                    partialImageRef = <span class="built_in">CGBitmapContextCreateImage</span>(bmContext);</span><br><span class="line">                    <span class="built_in">CGContextRelease</span>(bmContext);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="built_in">CGImageRelease</span>(partialImageRef);</span><br><span class="line">                    partialImageRef = <span class="literal">nil</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"><span class="meta">#endif</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (partialImageRef) &#123;</span><br><span class="line">                <span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageWithCGImage:partialImageRef scale:<span class="number">1</span> orientation:orientation];</span><br><span class="line">                <span class="built_in">NSString</span> *key = [[SDWebImageManager sharedManager] cacheKeyForURL:<span class="keyword">self</span>.request.URL];</span><br><span class="line">                <span class="built_in">UIImage</span> *scaledImage = [<span class="keyword">self</span> scaledImageForKey:key image:image];</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">self</span>.shouldDecompressImages) &#123;</span><br><span class="line">                    image = [<span class="built_in">UIImage</span> decodedImageWithImage:scaledImage];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    image = scaledImage;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">CGImageRelease</span>(partialImageRef);</span><br><span class="line">                dispatch_main_sync_safe(^&#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">self</span>.completedBlock) &#123;</span><br><span class="line">                        <span class="keyword">self</span>.completedBlock(image, <span class="literal">nil</span>, <span class="literal">nil</span>, <span class="literal">NO</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">CFRelease</span>(imageSource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.progressBlock) &#123;</span><br><span class="line">        <span class="keyword">self</span>.progressBlock(<span class="keyword">self</span>.imageData.length, <span class="keyword">self</span>.expectedSize);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们前面说过SDWebImageDownloaderOperation类是继承自NSOperation类。它没有简单的实现main方法，而是采用更加灵活的start方法，以便自己管理下载的状态。</p>
<p>在start方法中，创建了我们下载所使用的NSURLConnection对象，开启了图片的下载，同时抛出一个下载开始的通知。start方法的具体实现如下：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)start &#123;</span><br><span class="line">    <span class="keyword">@synchronized</span> (<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>.isCancelled) &#123;</span><br><span class="line">            <span class="keyword">self</span>.finished = <span class="literal">YES</span>;</span><br><span class="line">            [<span class="keyword">self</span> reset];</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#if TARGET_OS_IPHONE &amp;&amp; __IPHONE_OS_VERSION_MAX_ALLOWED &gt;= __IPHONE_4_0</span></span><br><span class="line">        Class <span class="built_in">UIApplicationClass</span> = <span class="built_in">NSClassFromString</span>(<span class="string">@"UIApplication"</span>);</span><br><span class="line">        <span class="built_in">BOOL</span> hasApplication = <span class="built_in">UIApplicationClass</span> &amp;&amp; [<span class="built_in">UIApplicationClass</span> respondsToSelector:<span class="keyword">@selector</span>(sharedApplication)];</span><br><span class="line">        <span class="keyword">if</span> (hasApplication &amp;&amp; [<span class="keyword">self</span> shouldContinueWhenAppEntersBackground]) &#123;</span><br><span class="line">            __<span class="keyword">weak</span> __typeof__ (<span class="keyword">self</span>) wself = <span class="keyword">self</span>;</span><br><span class="line">            <span class="built_in">UIApplication</span> * app = [<span class="built_in">UIApplicationClass</span> performSelector:<span class="keyword">@selector</span>(sharedApplication)];</span><br><span class="line">            <span class="keyword">self</span>.backgroundTaskId = [app beginBackgroundTaskWithExpirationHandler:^&#123;</span><br><span class="line">                __<span class="keyword">strong</span> __<span class="keyword">typeof</span> (wself) sself = wself;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (sself) &#123;</span><br><span class="line">                    [sself cancel];</span><br><span class="line"></span><br><span class="line">                    [app endBackgroundTask:sself.backgroundTaskId];</span><br><span class="line">                    sself.backgroundTaskId = <span class="built_in">UIBackgroundTaskInvalid</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;];</span><br><span class="line">        &#125;</span><br><span class="line"><span class="meta">#endif</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">self</span>.executing = <span class="literal">YES</span>;</span><br><span class="line">        <span class="keyword">self</span>.connection = [[<span class="built_in">NSURLConnection</span> alloc] initWithRequest:<span class="keyword">self</span>.request delegate:<span class="keyword">self</span> startImmediately:<span class="literal">NO</span>];</span><br><span class="line">        <span class="keyword">self</span>.thread = [<span class="built_in">NSThread</span> currentThread];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="keyword">self</span>.connection start];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.connection) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>.progressBlock) &#123;</span><br><span class="line">            <span class="keyword">self</span>.progressBlock(<span class="number">0</span>, <span class="built_in">NSURLResponseUnknownLength</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">            [[<span class="built_in">NSNotificationCenter</span> defaultCenter] postNotificationName:SDWebImageDownloadStartNotification object:<span class="keyword">self</span>];</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (floor(<span class="built_in">NSFoundationVersionNumber</span>) &lt;= <span class="built_in">NSFoundationVersionNumber_iOS_5_1</span>) &#123;</span><br><span class="line">            <span class="comment">// Make sure to run the runloop in our background thread so it can process downloaded data</span></span><br><span class="line">            <span class="comment">// Note: we use a timeout to work around an issue with NSURLConnection cancel under iOS 5</span></span><br><span class="line">            <span class="comment">//       not waking up the runloop, leading to dead threads (see https://github.com/rs/SDWebImage/issues/466)</span></span><br><span class="line">            <span class="built_in">CFRunLoopRunInMode</span>(kCFRunLoopDefaultMode, <span class="number">10</span>, <span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">CFRunLoopRun</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">self</span>.isFinished) &#123;</span><br><span class="line">            [<span class="keyword">self</span>.connection cancel];</span><br><span class="line">            [<span class="keyword">self</span> connection:<span class="keyword">self</span>.connection didFailWithError:[<span class="built_in">NSError</span> errorWithDomain:<span class="built_in">NSURLErrorDomain</span> code:<span class="built_in">NSURLErrorTimedOut</span> userInfo:@&#123;<span class="built_in">NSURLErrorFailingURLErrorKey</span> : <span class="keyword">self</span>.request.URL&#125;]];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>.completedBlock) &#123;</span><br><span class="line">            <span class="keyword">self</span>.completedBlock(<span class="literal">nil</span>, <span class="literal">nil</span>, [<span class="built_in">NSError</span> errorWithDomain:<span class="built_in">NSURLErrorDomain</span> code:<span class="number">0</span> userInfo:@&#123;<span class="built_in">NSLocalizedDescriptionKey</span> : <span class="string">@"Connection can't be initialized"</span>&#125;], <span class="literal">YES</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#if TARGET_OS_IPHONE &amp;&amp; __IPHONE_OS_VERSION_MAX_ALLOWED &gt;= __IPHONE_4_0</span></span><br><span class="line">    Class <span class="built_in">UIApplicationClass</span> = <span class="built_in">NSClassFromString</span>(<span class="string">@"UIApplication"</span>);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">UIApplicationClass</span> || ![<span class="built_in">UIApplicationClass</span> respondsToSelector:<span class="keyword">@selector</span>(sharedApplication)]) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.backgroundTaskId != <span class="built_in">UIBackgroundTaskInvalid</span>) &#123;</span><br><span class="line">        <span class="built_in">UIApplication</span> * app = [<span class="built_in">UIApplication</span> performSelector:<span class="keyword">@selector</span>(sharedApplication)];</span><br><span class="line">        [app endBackgroundTask:<span class="keyword">self</span>.backgroundTaskId];</span><br><span class="line">        <span class="keyword">self</span>.backgroundTaskId = <span class="built_in">UIBackgroundTaskInvalid</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#endif</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在下载完后或者是下载失败后都会停止当前调用的runloop，清楚链接随后就抛出下载停止的消息。<br>如果下载成功，则会处理完整的图片数据，对其进行适当的缩放与解压缩操作，以提供给完成回调使用。具体可参考-connectionDidFinishLoading:与-connection:didFailWithError:的实现。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>我们在上面的介绍可以看出在下载图片的过程中，每次下载图片都会调用NSOperation的函数进行处理，每次数据实际实现是使用NSURLConnection。我们把具体实现的线程放置在队列中进行执行操作。如果下载成功，则会处理完整的图片数据，对其进行适当的缩放与解压缩操作，以提供给完成回调使用。具体可参考-connectionDidFinishLoading:与-connection:didFailWithError:的实现。</p>
<p><a href="http://boilwater.github.io/2016/06/04/SDWebImage之图片缓存分析/" target="_blank" rel="external">下一节我们将讲述如何对下载的图片进行缓存处理</a>;</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color2">三方框架解析</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/第三方框架/" class="article-tag-list-link color1">第三方框架</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2016/06/03/SDWebImage/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>





  
    <article id="post-IOS面试梳理&amp;自己理解&amp;详细资料库" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/02/IOS面试梳理&自己理解&详细资料库/">IOS面试&amp;自己理解&amp;详细资料库</a>
    </h1>
  

        
        <a href="/2016/06/02/IOS面试梳理&自己理解&详细资料库/" class="archive-article-date">
  	<time datetime="2016-06-02T11:01:41.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2016-06-02</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>开启关于IOS面试之路总结，说实话目前IOS开发真是太多很多情况下大家情况良莠不齐很难分辨。目前还是在广州，其实还是很开心的，因为这里有自己😍事物所在。</p>
<h3 id="OC的理解和特性"><a href="#OC的理解和特性" class="headerlink" title="OC的理解和特性"></a>OC的理解和特性</h3><p>作为开发者我们都知道语言的特性包括：面对对象，面向过程。Objc就是关于面对对象语言，也就包括面向对象的特点：封装、继承、多态。下面是对三者优点列表😉</p>
<ul><br><li>封装：对于要处理的问题进行模块开发，好处有利于我们对于功能的拓展</li><br><li>继承：通过继承实现对父类方法的实现，也可以在子类中重写父类方法</li><br><li>多态：通过同名函数但是输入形式参数的种类，数目，类型不同实现具体函数功能不同（具体实现可以参照C&amp;C++在编译后形式~想了解的可以自己查找）</li><br></ul><br>Objc的动态特性：动态类型、动态加载、动态绑定。其实前面我们在runtime的理解过程中有所讲解。<a href="http://boilwater.github.io/2016/05/29/runtime理解/" target="_blank" rel="external">参考地址</a><br><ul><br><li>动态类型：在IOS中我们经常见到id类型，id类型指在Objc中动态类型。在实际应用中我们一般使用静态类型，静态类型：固定和可预知性。静态类型是强类型，动态类型是弱类型。例如：我们经常见到的protrcol委托协议就是采取@proerty(nonatomic, weak) id<protrcol> delegate</protrcol></li><br><li>动态加载：基于动态类型，在某个实例对象被确定后，其类型便被确定了，该对象对应的属性和响应消息也被完全确定。</li><br><li>动态绑定：是我们在适配机型加载过程中，动态实现图片的实现。例如，在Retina设备上加载@2x的图片。</li><br></ul>

<h3 id="内存管理原则"><a href="#内存管理原则" class="headerlink" title="内存管理原则"></a>内存管理原则</h3><ul><br><li>IOS5.0之前：在IOS 5.0之前Objc内存管理试行谁创建，谁释放的原则。如果要对是初始化的类型进行alloc,retain,copy，就需要手动进行release进行释放。当计数为0时才会释放对应的初始化内存空间和指针，我们称为MRC时代。</li><br><li>IOS 5.0之后：使用戏言IOS开发那就是一个字：爽。在ARC：自动计数模式开发程序，我们不用再手动释放申请的对象，程序开发过程终于见不到release,autorelease,retain语句。不过我们这是就该注意到strong和weak的细微区别。</li><br></ul>

<hr>
<p>strong &amp; weak区别</p>
<ul><br><li>strong:用来修饰强引用属性</li><br><li>weak:用来修饰弱引用属性</li><br></ul><br>strong &amp; weak实现具体情况<br><ul><br><li>我们知道strong的使用时强引用，使用强引用使我们在赋值时会使计数器+1；<br><br><br>释放时间：当指针指向新值或者指针不存在，指针不存在一般是在自动计数为0时指针会自动释放。</li><br><li>weak是弱引用，悲剧的是弱引用是不会再计数+1的。不过这也使我们在使用时很方便，因为我们如果要防止block中发生循环引用的时候，可以在block外使用_weak进行修饰。<br><br><br>释放时间：对象的拥有者指向新值或者不存在时weak修饰的指针会自动置为nil。<br><br><br>weak的实现原理：在每一个类中都有一个弱引用的列表，在释放时都会对列表进行访问。如果找到相应的对象就执行释放。<br><br><br>Strong：是通过ARC的自动计数来实现对于对象的释放。<br></li><br></ul>

<hr>
<p><a href="http://blog.csdn.net/leikezhu1981/article/details/42697977" target="_blank" rel="external">参考资料</a></p>
<ul><br><li>在想一个对象发送autorelease消息时，其实目标不会立即释放，会有一个具体的时间值。在autorelease调用的时候，会对其中的对象挨个发送release语句对于每个对象进行相应的释放。后面会对于autorelease进行专项讲解，不过这里可以给大牛资料，下文</li><br><li>在ARC中我们不用手动向实例化对象发送release进行释放，但是在MRC中就需要我们对申请的对象进行手动释放对象。那么问题来啦，对象会立即释放吗？<br><br><br>记住一点在MRC也是对象有时也不会立即释放，需要当前对象的计数为0时才会使用dealloc进行对象中所有的内容。<br></li><br></ul><br><a href="http://www.cocoachina.com/ios/20150610/12093.html" target="_blank" rel="external">AutoreleasePool大牛的资料</a><br><br>#### 其他注意事项<br><br><ul><br><li>当一个对象被_strong指向时，该对象是不会被释放的。但是当对象在超出其作用区域时（在C++中局部变量在超出作用区域就会nil），此时指针也会被置为nil于此同时指针所指的内存空间也会被释放。<br><br><br>还有就是当试图控制器（ViewController）进行释放，其中的全局变量和局部变量都会被释放。也有意外就是实现循环引用，恭喜你好好修改下吧，因为这是个BUG。<br></li><br><li>局部变量：上面讲到的局部变量如果超出其范围就会置为nil</li><br><li>在方法中对象创建，为啦使内存能够尽可能的减少可以使用autoreleasepool。使用方法：@autoreleasepool{};</li><br><li>block中为了避免循环引用就会使用_weak进行修饰</li><br><li>ARC不是万能的🔑：ARC是基于在Foundation之上进行的变量的管理，如果是CGtypeRef类型就无法进行管理。例如：CGImageRef的图片的信息</li><br><li>同样我们可以实现ARC和非ARC之间的进行混合编译，具体操作如下：<br><br><br>在ARC中进行非ARC程序的混合编译：-fno-fobjc-arc;<br><br><br>在非ARC中进行ARC的混合编译：-fobjc-arc;<br><br><br>不过目前我们使用ARC较多，所以使用第一种的情形较多。swift毕竟也发布两年之久，很多创业公司已经开始使用swift<br></li><br></ul>



<h4 id="拓展介绍"><a href="#拓展介绍" class="headerlink" title="拓展介绍"></a>拓展介绍</h4><hr>
<ul><br><li>nonatomic:原子操作，禁止多线程进行操作</li><br><li>atomic:原子操作，多线程安全是property的默认操作基本类型</li><br><li>assign:表示设置器可以直接进行复制，基本用于基本数据类型（NSInteger,CGFloat）和C语言的基本数据类型（int,float,double,char）</li><br><li>readwrite:可以进行读写</li><br><li>readonly:进行只读</li><br><li>copy:在赋值过程中传入一份值得copy，地址和内容都会重新赋值</li><br><li>retain:在赋值过程中会使用retain对象，指向内容的指针会copy</li><br></ul>

<hr>
<p><a href="http://blog.csdn.net/Mars2639/article/details/7352540" target="_blank" rel="external">详细内容参考地址</a></p>
<h3 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h3><p>开发过程中我们都会使用到设计模式，这里就以两种设计模式进行举例：</p>
<h4 id="MVC设计模式"><a href="#MVC设计模式" class="headerlink" title="MVC设计模式"></a>MVC设计模式</h4><p>MVC是一种架构模式，M表示MOdel，V表示视图View，C表示控制器Controller：<br>其实重要的还是需要自己动手亲自实现，这样可以锻炼自己的编码能力。<br><a href="http://www.cocoachina.com/design/20130917/7009.html" target="_blank" rel="external">资料点击</a>。</p>
<ul><br><li>Model负责存储、定义、操作数据；</li><br><li>View用来展示书给用户，和用户进行操作交互；</li><br><li>Controller是Model和View的协调者，Controller把Model中的数据拿过来给View用。Controller可以直接与Model和View进行通信，而View不能和Controller直接通信。View与Controller通信需要利用代理协议的方式，当有数据更新时，MOdel也要与Controller进行通信，这个时候就要用Notification和KVO，这个方式就像一个广播一样，MOdel发信号，Controller设置监听接受信号，当有数据更新时就发信号给Controller，Model和View不能直接进行通信，这样会违背MVC设计模式。</li><br></ul>

<h4 id="MVVM设计模式"><a href="#MVVM设计模式" class="headerlink" title="MVVM设计模式"></a>MVVM设计模式</h4><p>这里关于MVVM的设计模式就不多说，因为目前还没有使用过。<br><br><a href="http://www.cocoachina.com/ios/20160301/15425.html" target="_blank" rel="external">MVVM参考资料地址</a><br><br><a href="http://www.cocoachina.com/ios/20160517/16309.html" target="_blank" rel="external">MVVM升级到MVVMM</a><br><br><a href="http://www.cocoachina.com/ios/20160330/15823.html" target="_blank" rel="external">MVVM With ReactiveCocoa</a></p>
<h3 id="Objc中的协议"><a href="#Objc中的协议" class="headerlink" title="Objc中的协议"></a>Objc中的协议</h3><p>我们在IOS开发过程中我们经常会使用协议和代理模式来进行消息传递，协议一般是伴随着代理产生而产生。我们在实现协议的同时一般都会有代理形式进行完成。<br>协议中有两个属性：</p>
<ul><br><li>@required:是表明此中的方法一定要实现，在我们使用UITableViewDataSourceDelete就有两个必须实现的方法</li><br><li>@optional:方法可以根据自己选着实现方法</li><br></ul><br>在博客中有关于protrcol的相关使用<br><br><br><a href="http://boilwater.github.io/2016/05/29/block，注册监听，委托协议和KVO/" target="_blank" rel="external">参考地址</a><br><br>### Category的优缺点<br>我们使用Category一般是在一个现有类中定向添加方法，其实我们使用常见的SDWebImage本质就是一个类的类目：UIImageView<br>优点：<br><ul><br><li>我们在一个现有类中可以增加方法，于此同时我们又不需要改变原来对象的属性。增加方法和原来方法使用是一样的</li><br><li>在多方法的使用过程中我们可以通过使用Category实现对类进行区分，达到方便管理类种方法的原则</li><br></ul>

<p>缺点：</p>
<ul><br><li>Category允许我们对类进行添加特定方法，但是我们不能向类中添加成员变量。但是我们可以继承类在子类中进行相关成员属性添加</li><br><li>在增加方法的过程中，我们增加方法的优先级别比较高因此会覆盖父类中的方法。例如：在界面我们相应手指触摸时有响应链，如果在子类中调用touch方法没有调用父类就会使响应者连中断</li><br></ul>

<p><a href="http://www.cocoachina.com/ios/20120614/4361.html" target="_blank" rel="external">Objective-C Category初体验</a><br> <br><br><a href="http://www.cocoachina.com/ios/20140212/7808.html" target="_blank" rel="external">Objective-C相关Category的收集</a></p>
<h3 id="键路径-keyPath-、键值编码（KVC）和键值观察（KVO）"><a href="#键路径-keyPath-、键值编码（KVC）和键值观察（KVO）" class="headerlink" title="键路径(keyPath)、键值编码（KVC）和键值观察（KVO）"></a>键路径(keyPath)、键值编码（KVC）和键值观察（KVO）</h3><p>在我的博客中有所讲述，在这里就不赘述啦。不过这里给大家留一个问题？为什么使用KVC（Key-value-coding）在效率不是很高？<br><br><a href="http://boilwater.github.io/2016/05/29/block%EF%BC%8C%E6%B3%A8%E5%86%8C%E7%9B%91%E5%90%AC%EF%BC%8C%E5%A7%94%E6%89%98%E5%8D%8F%E8%AE%AE%E5%92%8CKVO/" target="_blank" rel="external">参考路径</a><br>其他参考资料：<br><br><a href="http://www.cocoachina.com/ios/20160408/15868.html" target="_blank" rel="external">谈KVC、KVO（重点观察者模式）机制编程</a><br><br><br><a href="http://www.cocoachina.com/ios/20140224/7866.html" target="_blank" rel="external">iOS KVC &amp; KVO</a></p>
<h3 id="NSNotification、Block、Delegate和KVO的区别"><a href="#NSNotification、Block、Delegate和KVO的区别" class="headerlink" title="NSNotification、Block、Delegate和KVO的区别"></a>NSNotification、Block、Delegate和KVO的区别</h3><p>博客中有详细介绍<br><br><br><a href="http://boilwater.github.io/2016/05/29/block%EF%BC%8C%E6%B3%A8%E5%86%8C%E7%9B%91%E5%90%AC%EF%BC%8C%E5%A7%94%E6%89%98%E5%8D%8F%E8%AE%AE%E5%92%8CKVO/" target="_blank" rel="external">详细参看</a></p>
<h3 id="Objective-C中可修改和不可以修改类型"><a href="#Objective-C中可修改和不可以修改类型" class="headerlink" title="Objective-C中可修改和不可以修改类型"></a>Objective-C中可修改和不可以修改类型</h3><p>可修改和不可修改的集合类，我们在IOS开发过程中经常会遇到NSArray和NSMutableArray两种，两者的区别：</p>
<ul><br><li>一个是可以动态添加，一个不可以动态添加</li><br><li>前者初始化后内存是固定不边的，后者经过初始化内存是可以发生改变的</li><br></ul>

<hr>
<p>这里我就引出一个概念：非容器对象和容器对象。</p>
<ul><br><li>非容器对象：NSNumber，NSSting等只能放单个字符或者数字</li><br><li>容器对象：NSArray，NSDictionary等可以放置多个数据类型</li><br></ul><br>但是在我们熟悉的copy过程中会发生哪些情况呢？<br><br>这里又提出另外的cop的新概念：copy, mutableCopy<br><ul><br><li>copy：复制了一个imutable的对象+ copyWithZone:</li><br><li>mutableCopy：复制的是一个mutable的对象，使用的方法+ mutableCopyWithZone:</li><br></ul><br>下面我们给出在非容器对象复制后的具体情况<br><br>非容器对象     | 不变类（NSString） |  可变类（NSMustbleString）<br>———— | ——————| ————<br>copy         | 浅Copy            | 深Copy~返回的对象是不可变的对象<br>mutableCopy  | 深Copy            | 深Copy<br><br>下面我们给出容器对象中复制的具体情况<br><br>容器类型      | 不变类型（NSArray） | 可变类型（NSMutableArray）<br>———— | —————- | ————<br>copy         | 浅copy            | 深copy<br>mutableCopy  | 深copy            | 深copy<br><br><div style="color:#008B8B"><br><p>但是在容器对象复制过程中我们需要记住一点，我们对于NSArray和NSMutable的copy是对于整体指针和内存来说。但是在容器内部每一个元素我们进行的都是指针copy,也就是我们所说的浅copy。</p><br></div><br>从上面列举的例子我们可以得出一个结论：<br><ul><br><li>无论是非容器类型还是容器类型只有在不可变时（NSArray，NSString）使用copy才是浅复制，也就是说只是复制指针而不复制内存。</li><br><li>在可变的类型（NSMutableString, NSMutableArray）在使用copy时会生成不可变类型。</li><br></ul><br>具体为什么实现这种原理可以看下在NSArray和NSMutable实现接口，以及参照C++的原理进行解释。<br><br>—<br><br>下面是参考资料：<br><br><a href="http://www.fanliugen.com/?p=278" target="_blank" rel="external">copy与mutableCopy</a><br><br><a href="http://www.cnblogs.com/-Eric-Liu/p/5564030.html" target="_blank" rel="external">NSArray与NSMutableArray的区别</a><br><br>### 当我们调用一个静态方法时,需要对对象进行 release 吗?<br><br>不要对静态方法进行释放，因为静态方法会放到自动释放池中，后面会自动释放。<br><br>我在博客中写过关于Runtime的解析，在那里我们可以看出一个类在解析过程中其中类中调用方法是Method形式，放在Struct的Class中的。执行过程AutoReleasePool会进行管理。<br><br><a href="http://www.cocoachina.com/ios/20150601/11970.html" target="_blank" rel="external">深入理解RunLoop</a>大神文章写得很详细<br><br>### 当我们释放我们的对象时,为什么需要调用[super dealloc]方法,它的位置又是如何的呢?<br><br>因为子类的某些实例是继承自父类的,因此需要调用[super dealloc]方法, 来释放父类拥有的实例,其实也就是子类本身的。一般来说我们优先释放子类拥 有的实例,最后释放父类所拥有的实例。<br><br>### static、self、super关键字的作用<br><br>static 是在C和C++中经常使用的，在Objc中我们也是常常使用static来定义cell的identifer目前就想到这些。下面给出static的具体作用：<br><ul><br><li>static修饰的变量只是在第一次调用过程进行初始化，所以在第二次调用时会维持上一次的值</li><br><li>在模块内我们使用的static变量可以在模块中所有函数使用，但是在模块外就不可以进行访问</li><br><li>在模块内的static的函数只能被模块内的函数进行调用，不能被模块外的其他函数声明</li><br><li>在类中的satic的全局变量，在整个类中有且仅仅只有一份的copy</li><br></ul><br>self: 是我们在当前类消息的接受者<br><br>super: 是我们调用父类的方法，消息链过程中我们在touch调用super就是调用父类方法，防止消息链中断。<br><br>### #include与#import的区别，#import 与@class 的区别<br><br><ul><br><li>#include是我们在C/C++经常使用到的引入到文件的方式</li><br><li>#import是我们在Objc中使用引入头文件的方式，可以防止头文件被多次引用（如果头文件被多次应用，程序在编译过程中会把库函数编译到类中这样就占用较多内存）</li><br><br>#import和@class两者之间的区别<br><li>@class是只是定义类名，对其中的行为并不知道，我们经常可以再很多类的.h文件可以看到</li><br><li>@class由于仅仅是定义类的名字，所以在编译过程要比import的效率高</li><br><li>此外@class 和#import 的主要区别在于解决引用死锁的问题</li><br></ul><br><a href="http://www.cnblogs.com/stevenschen/p/3825044.html" target="_blank" rel="external">参考资料点击</a><br><br>### @public、@protected、@private 它们的含义与作用<br><br><ul><br><li>@public:对象的实例变量的作用域在任意地方都可以被访问</li><br><li>@protected:对象的实例变量作用域在本类和子类都可以被访问</li><br><li>@private:实例变量的作用域只能在本类(自身)中访问 </li><br></ul>

<h3 id="解释-id-类型"><a href="#解释-id-类型" class="headerlink" title="解释 id 类型"></a>解释 id 类型</h3><p>任意类型对象，程序运行时才决定对象的类型。 这也是我们在上面解释的动态类型。</p>
<h3 id="switch-语句-if-语句区别与联系"><a href="#switch-语句-if-语句区别与联系" class="headerlink" title="switch 语句 if 语句区别与联系"></a>switch 语句 if 语句区别与联系</h3><p>两者均是判断语句。但是switch只可以判断整形，字符型，枚举类型；但是if并没有类型限制。</p>
<h3 id="isMemberOfClass-和-isKindOfClass-联系与区别"><a href="#isMemberOfClass-和-isKindOfClass-联系与区别" class="headerlink" title="isMemberOfClass 和 isKindOfClass 联系与区别"></a>isMemberOfClass 和 isKindOfClass 联系与区别</h3><ul><br><li>两者都可以判断一个对象是否是某个类的成员</li><br><li>isKindOfClesss不紧可以判断对象是否是一个类的成员，也可以判断一个对象是否派生于类的类成员</li><br><li>举例：如 ClassA派 生 自NSObject 类 , ClassA *a = [ClassA alloc] init];,[a isKindOfClass:[NSObject class]] 可以检查出 a 是否是 NSObject派生类 的成员,但 isMemberOfClass 做不到</li><br></ul>

<h3 id="iOS-开发中数据持久性有哪几种"><a href="#iOS-开发中数据持久性有哪几种" class="headerlink" title="iOS 开发中数据持久性有哪几种?"></a>iOS 开发中数据持久性有哪几种?</h3><p><a href="http://boilwater.github.io/2016/05/29/IOS%E7%9A%84%E6%B0%B8%E4%B9%85%E8%AF%9D%E5%82%A8%E5%AD%98/" target="_blank" rel="external">参考资料~IOS的永久话储存</a></p>
<h3 id="自动释放池工作原理"><a href="#自动释放池工作原理" class="headerlink" title="自动释放池工作原理"></a>自动释放池工作原理</h3><p><a href="http://www.cocoachina.com/ios/20160602/16569.html" target="_blank" rel="external">自动释放池的前世今生</a><br><br><a href="http://www.cocoachina.com/ios/20150610/12093.html" target="_blank" rel="external">Objective-C Autorelease Pool 的实现原理</a></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">IOS基础知识</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/IOS/" class="article-tag-list-link color4">IOS</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2016/06/02/IOS面试梳理&自己理解&详细资料库/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>





  
    <article id="post-cocoaPods使用和静态库的建立" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/29/cocoaPods使用和静态库的建立/">cocoaPods使用和静态库的建立</a>
    </h1>
  

        
        <a href="/2016/05/29/cocoaPods使用和静态库的建立/" class="archive-article-date">
  	<time datetime="2016-05-29T11:47:03.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2016-05-29</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>cocoaPods个人介绍：是基于Ruby的基础之上的，cocoaPods个人作用是可以帮助苦逼的码农对第三方库和框架进行管理，让码农专注于自己APP方面优化</p>
<p>一般我们复制三方框架到项目有两种方式：（1）直接进行复制，（2）使用cocoaPods来进行管理，本人建议可以学习使用cocoaPods这样更加方便，下面讲直接复制问题</p>
<p>但是直接复制存在问题：</p>
<p>(1)库更新存在问题，如果一个库引用另一个库，需要对于库全部更新</p>
<p>(2)对于我们引用的第三方库进行修改，在做更新比较困难。例如：我在使用SedWebImage时对图片进行截图得到圆形图片，如果进行更新就有问题</p>
<p>(3)比较难判断在APP引进库的具体版本，除非在以前APP中进行记录</p>
<p>(4)没有中心管理，很难对于所有的第三方库进行统一管理<br>cocoaPods（<a href="https://realm.io/cn/news/gotocph-rackwitz-therox-learnings-from-cocoapods/" target="_blank" rel="external">cocoaPods链接</a>）对于上面问题有很好处理：可以解决库之间存在依赖关系，而且帮忙发现是新的库，以最简单方式为我们码农配置环</p>
<p>废话不多说，下面开始在mac中配置安装cocoaPods</p>
<p>如果系统是10.7之后系统中带有配置Ruby环境，只需安装cocoaPods即可，如果不是可以搜索下Ruby环境安装</p>
<p>方法一：(1)打开终端：control+空格键，然后搜索“终端”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo gem install cocoaPods </span><br></pre></td></tr></table></figure>
<p>(2)然后在终端中进行设置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pod setup --verbose</span><br></pre></td></tr></table></figure>
<p>如果在执行一时比较慢我们就需要执行其他安装，通过只用淘宝的Ruby进行访问cocoaPod，</p>
<p>方法二：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gem sources --remove https://rubygems.org/</span><br></pre></td></tr></table></figure>
<p>//等有反应之后再敲入以下命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gem sources -a http://ruby.taobao.org/</span><br></pre></td></tr></table></figure>
<p>如果要查看是否是taobao镜像</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gem source -l</span><br></pre></td></tr></table></figure>
<p>如果显示一下情况<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">*** CURRENT SOURCES ***</span><br><span class="line"></span><br><span class="line"><span class="symbol">http:</span>/<span class="regexp">/ruby.taobao.org/</span></span><br></pre></td></tr></table></figure></p>
<p>最后执行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo gem install cocoaPods</span><br></pre></td></tr></table></figure></p>
<p>经过上述爽过之后，我们就成功安装cocosPods，接下来我们来看下怎么使用<br>（1）使用cocoaPods查看相关框架信息，查看AFNetWorking信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pod search AFNetWorking</span><br></pre></td></tr></table></figure>
<p>下面在项目中使用cocoaPods加入第三方框架<br>（1）打开终端，进行项目文件的根目录然后使用vim创建podFile文件：例如我们项目放在 文档/项目名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$cd /users/用户名/documents/项目名</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$vim podFile</span><br></pre></td></tr></table></figure>
<p>（2）再输如框中输入加入平台和相关框架以及框架版本号（如果出现不能输入就要按键a后者是i，进行文本编辑）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">paltform : iOS, &apos;7.0&apos;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod &quot;AFNetworking&quot;, &quot;~&gt; 2.0&quot;</span><br></pre></td></tr></table></figure>
<p>（3）输入上述文本，后保存并退出编辑按键esc进行退出，输入下面文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:wq</span><br></pre></td></tr></table></figure>
<p>（4）最后下载AFNetWorking文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$pod install</span><br></pre></td></tr></table></figure>
<p>大功告成，这样就可以在我们文件中生成一个pods文件，打开项目就可以看到下面除啦我们项目外还多余一个pods文件</p>
<p>注：可以在文件中放置多个框架，只要在上面（2）中pod “框架名”, “~&gt;3.0”<br>cocosPods后续产生问题解析：</p>
<p>如果我们从github上下载开源项目有的项目时需要我们重新更新配置开源框架；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd ~/desktop/项目名                  //我的项目放在桌面</span><br><span class="line"></span><br><span class="line">pod install </span><br></pre></td></tr></table></figure>
<p>如果出现</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[!] The dependency <span class="string">`Masonry (~&gt; 0.6.2)`</span> is <span class="keyword">not</span> used <span class="keyword">in</span> any concrete target.</span><br><span class="line"></span><br><span class="line">The dependency <span class="string">`SDWebImage (~&gt; 3.7)`</span> is <span class="keyword">not</span> used <span class="keyword">in</span> any concrete target.</span><br><span class="line"></span><br><span class="line">The dependency <span class="string">`GPUImage`</span> is <span class="keyword">not</span> used <span class="keyword">in</span> any concrete target.</span><br><span class="line">打开配置文件Podfile文件修改配置文件</span><br><span class="line"></span><br><span class="line">target <span class="string">'BeautifyFaceDemo'</span> <span class="keyword">do</span></span><br><span class="line"></span><br><span class="line">pod <span class="string">'Masonry'</span>, <span class="string">'~&gt; 0.6.2'</span></span><br><span class="line"></span><br><span class="line">pod <span class="string">'SDWebImage'</span>, <span class="string">'~&gt;3.7'</span></span><br><span class="line"></span><br><span class="line">pod <span class="string">'GPUImage'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span> </span><br></pre></td></tr></table></figure>
<p>既可以解决生面的问题。</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">IOS</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/IOS/" class="article-tag-list-link color4">IOS</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2016/05/29/cocoaPods使用和静态库的建立/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>





  
    <article id="post-IOS的永久话储存" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/29/IOS的永久话储存/">IOS的永久话储存</a>
    </h1>
  

        
        <a href="/2016/05/29/IOS的永久话储存/" class="archive-article-date">
  	<time datetime="2016-05-29T11:32:04.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2016-05-29</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>沙盒：IOS应用中每个应用均有自己沙盒，用来储存APP自己的数据，每个应用的沙盒均是应用特有的不能交叉访问。</p>
<p>沙盒中有三个文件夹：document，library，temp</p>
<p>(1)document：保存应用运行时生成重要的数据，Itunes也会同步到进行备份数据。一般储存比较重要数据（数据使用手机连接mac可以在itunes中进行查看）</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *path = <span class="built_in">NSHomeDirectory</span>();</span><br><span class="line"><span class="built_in">NSString</span> *docPath = [path stringByAppendingString:<span class="string">@"/saveMessage"</span>];</span><br><span class="line"><span class="built_in">NSString</span> *docPath1 = [path stringByAppendingPathComponent:<span class="string">@"saveMessage"</span>];</span><br><span class="line"><span class="built_in">NSString</span> *docPath2 = [<span class="built_in">NSSearchPathForDirectoriesInDomains</span>(<span class="built_in">NSDocumentDirectory</span>, <span class="built_in">NSUserDomainMask</span>, <span class="literal">YES</span>)lastObject];</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">对于数据相关的path 进行操作，判断其是否存在，如果存在就可以进行相关操作</span><br></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSFileManager</span> *fileManger = [<span class="built_in">NSFileManager</span> defaultManager];</span><br><span class="line"><span class="built_in">NSArray</span> *pathLists = [fileManger contentsOfDirectoryAtPath:path error:<span class="literal">nil</span>];</span><br><span class="line"><span class="built_in">BOOL</span> flag = [fileManger fileExistsAtPath:docPath1];</span><br><span class="line">[fileManger removeItemAtPath:docPath1 error:<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p>(2)temp：保存运行时需要的临时数据，当APP结束后就会清楚其中的数据。当APP没有运行时其中数据也可能被删除</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSString *temp =  NSTemporaryDirectory();</span><br></pre></td></tr></table></figure>
<p>(3)library：其中有两个文件caches和preference。caches中存放临时程序运行时临时数据，就像我们在每个APP中的缓存可以进行清除。preference中存放我们自己设置是plist文件存放地址</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *library = [<span class="built_in">NSSearchPathForDirectoriesInDomains</span>(<span class="built_in">NSLibraryDirectory</span>, <span class="built_in">NSUserDomainMask</span>, <span class="literal">YES</span>)lastObject];</span><br><span class="line"><span class="built_in">NSString</span> *chches = [<span class="built_in">NSSearchPathForDirectoriesInDomains</span>(<span class="built_in">NSCachesDirectory</span>, <span class="built_in">NSUserDomainMask</span>, <span class="literal">YES</span>)lastObject];</span><br></pre></td></tr></table></figure>
<p>访问上面三个文件夹方法（<a href="http://www.cnblogs.com/xiejw/p/5196798.html" target="_blank" rel="external">参考链接</a>）</p>
<p>上述是关于在IOS储存数据是具体储存位置和其获取的方法，过程大同小异。但是在储存数据是我们要注意细节：比如是使用NSSarry是我们需要储存array数据，如果是其他数据例如NSdata需要将其转化</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSArray</span> *arr1 = [[<span class="built_in">NSArray</span> alloc]initWithObjects:<span class="string">@"0"</span>,<span class="string">@"5"</span>,<span class="literal">nil</span>];</span><br><span class="line"><span class="built_in">NSData</span> *data = [<span class="built_in">NSKeyedArchiver</span> archivedDataWithRootObject:arr1];</span><br></pre></td></tr></table></figure>
<p>除沙盒外IOS还向我们提供其他的储存方式：Sqlite，Core data, NSKeyedArchiver(coding)归档，NSUserDefaults</p>
<p>(1)Sqlite：iOS自带数据库，可以保存数据</p>
<h3 id="使用的第三方的库FMDB"><a href="#使用的第三方的库FMDB" class="headerlink" title="使用的第三方的库FMDB"></a>使用的第三方的库<a href="https://github.com/ccgus/fmdb.git" target="_blank" rel="external">FMDB</a></h3><p>(2)Core data：是苹果提出的基于sqlite储存数据的结构，实际是sqlite只不过对其进行简化</p>
<p>(3)NSkeyedArchiver(coding)：</p>
<p>(4)NSUserDefaults：就是我们上述所说的放在library/preference中的偏好设置，实际是存放在plist文件中。存储数据类型是NSString,NSData,NSInteger,NSDictionary,NSArray,NSNumber,bool和其他的基本数据类型（但是NSUserDefaults有个缺点：在储存过程中可能由于时间问题结束存储，而且如果修改其中一项数据整个数据都要重新加载）</p>
<p><a href="https://developer.apple.com/library/ios/documentation/Cocoa/Reference/Foundation/Classes/NSUserDefaults_Class/" target="_blank" rel="external">官方文档</a>：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The <span class="built_in">NSUserDefaults</span> class provides convenience methods <span class="keyword">for</span> accessing common types such as floats, doubles, integers, Booleans, and URLs. A <span class="keyword">default</span> object must be a property list, that is, an instance of (or <span class="keyword">for</span> collections a combination of instances of): <span class="built_in">NSData</span>, <span class="built_in">NSString</span>, <span class="built_in">NSNumber</span>, <span class="built_in">NSDate</span>, <span class="built_in">NSArray</span>, or <span class="built_in">NSDictionary</span>. If you want to store any other type of object, you should typically archive it to create an instance of <span class="built_in">NSData</span>.</span><br></pre></td></tr></table></figure><br>文章是对于数据储存初次探究，后面会对文章进行修改有详细的使用方法和具体官方文档补充</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">IOS</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/IOS/" class="article-tag-list-link color4">IOS</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2016/05/29/IOS的永久话储存/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>





  
    <article id="post-IOS整体框架" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/29/IOS整体框架/">IOS整体框架</a>
    </h1>
  

        
        <a href="/2016/05/29/IOS整体框架/" class="archive-article-date">
  	<time datetime="2016-05-29T11:21:14.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2016-05-29</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>感觉在博客上有大牛介绍IOS框架讲解的比较详细，在此向大牛致敬写篇文章。<a href="http://www.cnblogs.com/kenshincui/p/3885689.html#foundation" target="_blank" rel="external">大牛文章关于框架</a></p>
<p>我们在做IOS开发过程针对对象来进行类的分装，然后实现具体方法解决问题。但是我们整体语言框架不是很清楚，废话不多说开始：</p>
<p>下面是关于OS X的结构图（<a href="https://developer.apple.com/library/mac/documentation/MacOSX/Conceptual/OSX_Technology_Overview/About/About.html#//apple_ref/doc/uid/TP40001067-CH204-TPXREF101" target="_blank" rel="external">官网地址</a>）：<br><img src="/path/to/img.jpg" alt="alt text" title="Title"></p>
<h3 id="官方文档的具体内容："><a href="#官方文档的具体内容：" class="headerlink" title="官方文档的具体内容："></a>官方文档的具体内容：</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">The Cocoa (Application) layer（应用层） includes technologies <span class="keyword">for</span> building an </span><br><span class="line">app’s user interface, <span class="keyword">for</span> responding to user events, and <span class="keyword">for</span> managing app </span><br><span class="line">behavior.</span><br></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">The Media layer （媒体层）encompasses specialized technologies <span class="keyword">for</span> playing, </span><br><span class="line">recording, and editing audiovisual media and <span class="keyword">for</span> rendering and animating <span class="number">2</span>D and </span><br><span class="line"><span class="number">3</span>D graphics.</span><br></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">The Core Services layer（核心服务层） contains many fundamental services and </span><br><span class="line">technologies that range from Automatic Reference Counting and low-level network </span><br><span class="line">communication to string manipulation and data formatting.</span><br></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">The Core OS layer （核心系统操作层）defines programming interfaces that are </span><br><span class="line">related to hardware and networking, including interfaces <span class="keyword">for</span> running high-</span><br><span class="line">performance computation tasks on a computer’s CPU and GPU.</span><br></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">The Kernel and Device Drivers layer（内核和驱动层） consists of the Mach kernel </span><br><span class="line">environment, device drivers, BSD library functions (libSystem), and other low-</span><br><span class="line">level components. The layer includes support <span class="keyword">for</span> file systems, networking, </span><br><span class="line">security, interprocess communication, programming languages, device drivers, </span><br><span class="line">and extensions to the kernel.</span><br></pre></td></tr></table></figure>
<h3 id="下面对于每层的讲解："><a href="#下面对于每层的讲解：" class="headerlink" title="下面对于每层的讲解："></a>下面对于每层的讲解：</h3><p>（1）应用层即可触摸层（cocoa touch layer）<a href="https://developer.apple.com/library/mac/documentation/MacOSX/Conceptual/OSX_Technology_Overview/CocoaApplicationLayer/CocoaApplicationLayer.html#//apple_ref/doc/uid/TP40001067-CH274-SW1" target="_blank" rel="external">地址</a>:提供接口为应用，主要用于touch和管理应用的操作。其中我们最常用的UIKit的框架在Cocoa Touch层</p>
<p><img src="/path/to/img.jpg" alt="alt text" title="Title"></p>
<p>（2）媒体层（media layer）<a href="https://developer.apple.com/library/mac/documentation/MacOSX/Conceptual/OSX_Technology_Overview/MediaLayer/MediaLayer.html#//apple_ref/doc/uid/TP40001067-CH273-SW1" target="_blank" rel="external">官方地址</a>：包括多种多样的媒体文件，录音，播放，图像绘制，2D和3D图形基础动画</p>
<p><img src="/path/to/img.jpg" alt="alt text" title="Title"></p>
<p>主要包括以下：AV Foundation, Core Animation, Core Audio, Core Image, Core Text, OpenAl, OpenGL, Quartez</p>
<p>（3）核心服务层（Core Service Layer）<a href="https://developer.apple.com/library/mac/documentation/MacOSX/Conceptual/OSX_Technology_Overview/CoreServicesLayer/CoreServicesLayer.html#//apple_ref/doc/uid/TP40001067-CH270-BCICAIFJ" target="_blank" rel="external">官方地址</a>：通过提供一些接口进行网络连接，包括一些在CPU和GPU更高计算性能，使用广泛的Foundation框架位于本层</p>
<p><img src="/path/to/img.jpg" alt="alt text" title="Title"></p>
<p>只要包括以下：Address Book, Core Foundation, Foundation, Core Data, Quick Look</p>
<p>, Social, WebKit, Security</p>
<p>(4)核心系统操作层（Core OS Layer）<a href="https://developer.apple.com/library/mac/documentation/MacOSX/Conceptual/OSX_Technology_Overview/CoreOSLayer/CoreOSLayer.html#//apple_ref/doc/uid/TP40001067-CH9-SW1" target="_blank" rel="external">官方地址</a>：内存管理、文件系统、电源管理以及一些其他的操作系统任务。它可以直接和硬件设备进行交互</p>
<p><img src="/path/to/img.jpg" alt="alt text" title="Title"></p>
<p>只要包括以下：Accelerate, Open CL, Directory Services, System Configuration, Disk Arbitration</p>
<p>这只是写出基本的层次模型，后续将对此进行相关的更新和总结。</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">IOS</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/IOS/" class="article-tag-list-link color4">IOS</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2016/05/29/IOS整体框架/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>





  
    <article id="post-runtime理解" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/29/runtime理解/">runtime理解</a>
    </h1>
  

        
        <a href="/2016/05/29/runtime理解/" class="archive-article-date">
  	<time datetime="2016-05-29T04:15:38.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2016-05-29</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>网上其实有很多关于讲述runtime的学习资料，也是站在巨人肩上看的更远。写这篇文章也是对于其他人借鉴和翻阅源码，向源码寻求解释吧。<br><br>无意间看到一份关于runtime的博客，感觉写的挺不错的就耐心的看下。看后发现自己对runtime的理解还是比较浅，就决定对自己博客进行重新修改。</p>
<div style="color:#008B8B"><br><p>随便在这里抛出一个问题：假如我们程序员自己是系统我们怎么执行程序呢？当然换个高级点的说法，如果我们是系统设计者我们想要runtime怎么运行？</p><br></div>

<p>在介绍runtime之前我现在这里给大家梳理一下我们在Objc类中可能见到的内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-成员变量、成员属性：&lt;br&gt;</span><br><span class="line">-数据成员：&lt;/br&gt;</span><br><span class="line">-协议实现：&lt;/br&gt;</span><br></pre></td></tr></table></figure>
<h3 id="runtime简介"><a href="#runtime简介" class="headerlink" title="runtime简介"></a>runtime简介</h3><p>Objc被我们成为动态语言，换句话说就是把我们平时看到一些关键方法由编译连接推迟到运行时执行。Objc底层是基于C/C++的编译语言，在C/C++项目运行过程中链接、编译生成可执行文件。而Objc语言是在执行过程中进行编译源码，生成我们熟悉的C/C++后面最终生成机器可以识别的汇编语言。Objc中有三大自己特色：动态类型，动态绑定和动态加载。<br><br>获runtime的源码点击<a href="https://developer.apple.com/library/ios/documentation/Cocoa/Reference/ObjCRuntimeRef/index.html#//apple_ref/doc/uid/TP40001418" target="_blank" rel="external">这里</a></p>
<p>这里我们主要探究runtime.h和message.h两个文件夹中一些使用方法。<br>下面列出runtime.h文件中代码：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> objc_method *Method;  <span class="comment">//代表类定义当中的使用方法</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> objc_ivar *Ivar;  <span class="comment">//代表类定义中实例变量和属性</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> objc_category *Category; <span class="comment">//代表添加成员函数</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> objc_property *objc_property_t; <span class="comment">//声明的属性</span></span><br><span class="line"><span class="keyword">struct</span> objc_class &#123;</span><br><span class="line">    Class isa;</span><br><span class="line">    <span class="meta">#if !__OBJC2__</span></span><br><span class="line"></span><br><span class="line">    Class super_class                                        OBJC2_UNAVAILABLE;<span class="comment">//父类</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *name                                         OBJC2_UNAVAILABLE;<span class="comment">//类名</span></span><br><span class="line">    <span class="keyword">long</span> version                                             OBJC2_UNAVAILABLE;<span class="comment">//类的版本信心，默认的情况下是0</span></span><br><span class="line">    <span class="keyword">long</span> info                                                OBJC2_UNAVAILABLE;<span class="comment">//类信息</span></span><br><span class="line">    <span class="keyword">long</span> instance_size                                       OBJC2_UNAVAILABLE;<span class="comment">//类的实例变量的大小</span></span><br><span class="line">    <span class="keyword">struct</span> objc_ivar_list *ivars                             OBJC2_UNAVAILABLE;<span class="comment">//类成员变量的列表</span></span><br><span class="line">    <span class="keyword">struct</span> objc_method_list **methodLists                    OBJC2_UNAVAILABLE;<span class="comment">//类的方法列表</span></span><br><span class="line">    <span class="keyword">struct</span> objc_cache *cache                                 OBJC2_UNAVAILABLE;<span class="comment">//方法缓存</span></span><br><span class="line">    <span class="keyword">struct</span> objc_protocol_list *protocols                     OBJC2_UNAVAILABLE;<span class="comment">//类的协议列表</span></span><br><span class="line">     <span class="meta">#endif&#125; </span></span><br><span class="line">    OBJC2_UNAVAILABLE;</span><br></pre></td></tr></table></figure>
<h3 id="看其中一种实现方式"><a href="#看其中一种实现方式" class="headerlink" title="看其中一种实现方式"></a>看其中一种实现方式</h3><p>其中我们就以类中struct objc_ivar_list *ivars ,为例来看是怎样实现<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> objc_ivar_list &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> ivar_count                                           OBJC2_UNAVAILABLE;<span class="comment">//成员列表的数量</span></span><br><span class="line"><span class="meta">#ifdef __LP64__</span></span><br><span class="line">    <span class="keyword">int</span> space                                                OBJC2_UNAVAILABLE;<span class="comment">//成员列表的空间</span></span><br><span class="line"><span class="meta">#endif</span></span><br><span class="line">    <span class="comment">/* variable length structure */</span></span><br><span class="line">    <span class="keyword">struct</span> objc_ivar ivar_list[<span class="number">1</span>]                            OBJC2_UNAVAILABLE;</span><br><span class="line">&#125;                                                            OBJC2_UNAVAILABLE;</span><br></pre></td></tr></table></figure></p>
<p>可以看出实例变量和属性是存放时一个struct的list的数组中，其中包括list的数目、所占空间和基本储存objc_ivar。<br></p>
<p>上面objc_ivar在runtime.h中形式：<br>typedef struct objc_ivar Ivar;<br>objc_ivar中实例变量储存方式：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> objc_ivar &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> *ivar_name                       OBJC2_UNAVAILABLE;<span class="comment">//成员的名字</span></span><br><span class="line">    <span class="keyword">char</span> *ivar_type                       OBJC2_UNAVAILABLE;<span class="comment">//成员数据的类型</span></span><br><span class="line">    <span class="keyword">int</span> ivar_offset                      OBJC2_UNAVAILABLE;<span class="comment">//成员的偏移量</span></span><br><span class="line">    <span class="meta">#indef _LP64_</span></span><br><span class="line">    <span class="keyword">int</span> space                             OBJC2_UNAVAILABLE;<span class="comment">//成员变量所占空间</span></span><br><span class="line">    <span class="meta">#endif</span></span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从上面可以看出类的实例变量和属性经过runtime编译后是以struct的储存形式存在，并且单个实例变量保存其名字、类型、偏移量和储存空间。类中所有实例变量是以list类型进行储存。</p>
<blockquote>
<p>通过对runtime.h文件源码分析我们可以看出，在IOS程序运行过程中把我们类编译为C/C++形式。且编译过程是一个动态过程，所以我们可以通过此方式对我们程序进行动态操作</p>
</blockquote>
<h3 id="runtime动态操作"><a href="#runtime动态操作" class="headerlink" title="runtime动态操作"></a>runtime动态操作</h3><ul>在动态编译过程中无论是属性、实例变量、成员函数、类方法的均可以操作，一下就以比较简单的进行讲解<br><li>获取类的对象名</li><br><li>获取类中成实例变量和属性</li><br><li>动态添加方法</li><br></ul>

<h3 id="获取类的对象名"><a href="#获取类的对象名" class="headerlink" title="获取类的对象名"></a>获取类的对象名</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">Class *classes = objc_copyClassList(&amp;count);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *name = class_getName(classes[i]);</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%s"</span>, name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>打印出的内容可能出乎你的意料！</p>
<h3 id="获取类的实例变量和属性"><a href="#获取类的实例变量和属性" class="headerlink" title="获取类的实例变量和属性"></a>获取类的实例变量和属性</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Class clazz = <span class="built_in">NSClassFromString</span>(<span class="string">@"Graduater"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    Ivar *var = class_copyIvarList(clazz, &amp;count);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">char</span> *name = ivar_getName(var[i]);</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>, name);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>我定义一个毕业生类，然后就可以打印出其中的函数实例变量和属性（不多记得要引入<objc runtime.h="">的头文件）；</objc></p>
<h3 id="动态的添加方法"><a href="#动态的添加方法" class="headerlink" title="动态的添加方法"></a>动态的添加方法</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> abc(<span class="keyword">id</span> <span class="keyword">self</span>, SEL _cmd)&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@hello"</span>, <span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Graduater</span></span></span><br><span class="line"></span><br><span class="line">+(<span class="built_in">BOOL</span>)resolveInstanceMethod:(SEL)sel&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ([<span class="built_in">NSStringFromSelector</span>(sel) isEqualToString:<span class="string">@"sihai"</span>]) &#123;</span><br><span class="line">        class_addMethod(<span class="keyword">self</span>, sel, abc, <span class="string">"v@:"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在函数调用时执行下列：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Graduater *graduate = [[Graduater alloc] init];</span><br><span class="line"></span><br><span class="line">[graduate performSelector:<span class="keyword">@selector</span>(sihai) withObject:<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p>执行的结果可以条用我们添加的@select(abc)的方法。</p>
<h3 id="runtime使用API的介绍："><a href="#runtime使用API的介绍：" class="headerlink" title="runtime使用API的介绍："></a>runtime使用API的介绍：</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> * class_getName(Class cls) <span class="comment">//获取class的名字</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">BOOL</span> class_addIvar(Class cls, <span class="keyword">const</span> <span class="keyword">char</span> *name, size_t size, uint8_t alignment, <span class="keyword">const</span> <span class="keyword">char</span> *types)  <span class="comment">//增添实例变量</span></span><br><span class="line"></span><br><span class="line">objc_property_t  class_getProperty(Class cls, <span class="keyword">const</span> <span class="keyword">char</span> *name) <span class="comment">//获取属性</span></span><br><span class="line"></span><br><span class="line">objc_property_t * class_copyPropertyList(Class cls, <span class="keyword">unsigned</span> <span class="keyword">int</span> *outCount) <span class="comment">//获取属性列表</span></span><br><span class="line"></span><br><span class="line">Method class_getInstanceMethod(Class aClass, SEL aSelector) <span class="comment">//获取方法</span></span><br><span class="line"></span><br><span class="line">objc_allocateClassPair(Class superclass, <span class="keyword">const</span> <span class="keyword">char</span> *name, size_t extraBytes) <span class="comment">//添加动态类</span></span><br></pre></td></tr></table></figure>
<p>除去上面我们列举其中极少数的调用实例，如果想了解更多点击<a href="https://developer.apple.com/library/ios/documentation/Cocoa/Reference/ObjCRuntimeRef/index.html#//apple_ref/doc/uid/TP40001418-CH1g-211911" target="_blank" rel="external">这里</a>。</p>
<blockquote>
<p>在使用runtime过程，对于操作对象实行方法改善<br>对于对象进行相关操作一般以objc<em>开头<br>对于类的对象进行操作一般以class</em>开头<br>对于使用方法对象操作一般以method<em>开头<br>对于使用申明属性（property）一般是以property</em>开头<br>对于使用类成员变量一般使用ivar_开头</p>
</blockquote>
<h3 id="消息传送机制"><a href="#消息传送机制" class="headerlink" title="消息传送机制"></a>消息传送机制</h3><p>在IOS的一个类中我们调用方法使用也是比较多，如</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="keyword">self</span> method];</span><br></pre></td></tr></table></figure>
<p>但是在runtime编译过程中具体实现的方式是什么呢？<br>首先我们看先message.h中的源码</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Basic Messaging Primitives</span><br><span class="line"> * On some architectures, use objc_msgSend_stret for some struct return types.</span><br><span class="line"> * On some architectures, use objc_msgSend_fpret for some float return types.</span><br><span class="line"> * These functions must be cast to an appropriate function pointer type </span><br><span class="line"> * before being called. */</span></span><br><span class="line"></span><br><span class="line">OBJC_EXPORT <span class="keyword">id</span> objc_msgSend(<span class="keyword">id</span> <span class="keyword">self</span>, SEL op, ...);</span><br><span class="line"></span><br><span class="line">OBJC_EXPORT <span class="keyword">id</span> objc_msgSendSuper(<span class="keyword">struct</span> objc_super *<span class="keyword">super</span>, SEL op, ...);</span><br></pre></td></tr></table></figure>
<p>从上面的解释我们可以的出如果返回类型为float调用objc_msgSend_fpret，如果是数据结构返回使用objc_msgSend_stret。而我们讲解时使用 objc_msgSend(id self, SEL op, …)，就像我们上面的例子就会转化为objc_msgSend(self @select(method))，但是找到我们所使用的方法具体是怎么实现的？</p>
<div style="color:#008B8B"><br><p>在此地方我就将添加上面看到的关于objc_msgSend,objc_msgSendSuper,SEL</p><br></div>

<hr>
<p>数据类型：<br>（1）SEL:<br>     SEL又叫做选择器，表示一个@selector的指针，映射方法的名字。在Objc编译的过程中通过每个方法的名字和参数是生成的唯一的标示（此标示是int的类型），我们把这个标示称作为SEL。<br><br>     SEl的作用是作为IMP（关于IMP的具体说明会在下面展示）的key存在，存储在NSSet的中，这样可以方便我们使用hash的快速查找。SEL使我们查找IMP（指向实现函数的指针）key，如果SEL可以相同的话我们调用函数就会发生错误。所以SEL是不可以重复的，方法也是不可以重复的。这也就是我们在Objc开发过程中在同一个类中不可以使用同名的函数~~~此处和C++支持重载有很大区别。<br><br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> objc_selector *SEL;</span><br></pre></td></tr></table></figure><br>虽说在runtime.h中没有显示objc_selector结构体类型，但是作为程序员的我们可以找到方法进行验证，使用log打印SEL试下？<br><br>（2）IMP:<br>      IMP上面讲到IMP把SEL作为key值，IMP说白啦就是指向我们方法的指针，也就是我们条用具体函数方法的入口。</p>
<figure class="highlight plain"><figcaption><span>lang: objc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typedefine id (*IMP)(id, SEL, ...)</span><br></pre></td></tr></table></figure>
<p>（3）Method<br>       Method:上面我们在类的Struct的结构中可以看出Method是放置我们使用的方法，也是我们使用SEL和IMP的一个具体的绑定。通过使用SEL来找到对应的IMP进而实现我们方法的具体调用。下面看代码：</p>
<figure class="highlight plain"><figcaption><span>lang: objc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">typedef struct objc_method *Method;</span><br><span class="line"></span><br><span class="line">struct objc_method &#123;</span><br><span class="line">    SEL method_name                 OBJC2_UNAVAILABLE;  // 方法名</span><br><span class="line">    char *method_types                  OBJC2_UNAVAILABLE; // 参数类型</span><br><span class="line">    IMP method_imp                      OBJC2_UNAVAILABLE;  // 方法实现</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下面我们看下在类中方法具体实现的形式：</p>
<figure class="highlight plain"><figcaption><span>lang: objc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">struct objc_method_list &#123;</span><br><span class="line">    struct objc_method_list *obsolete                        OBJC2_UNAVAILABLE;</span><br><span class="line">    int method_count                                                 OBJC2_UNAVAILABLE;</span><br><span class="line">#ifdef __LP64__</span><br><span class="line">    int space                                                              OBJC2_UNAVAILABLE;</span><br><span class="line">#endif</span><br><span class="line">    /* variable length structure */</span><br><span class="line">    struct objc_method method_list[1]                        OBJC2_UNAVAILABLE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（4）方法缓存<br>我们在调用方法的过程其实是Lazy调用的过程，方法在第一次调用加载后会放到缓存池中。objc程序启动后，需要进行类的初始化、调用方法时的cache初始化，再发送消息的时候就直接走缓存。<br><br>下面我会对方法缓存做详细的解释。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> objc_cache &#123;</span><br><span class="line">    <span class="comment">// 缓存bucket的总数</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> mask <span class="comment">/* total = mask + 1 */</span>                 OBJC2_UNAVAILABLE;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 实际缓存bucket的总数</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> occupied                                    OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="comment">// 指向Method数据结构指针的数组</span></span><br><span class="line">    Method buckets[<span class="number">1</span>]                                        OBJC2_UNAVAILABLE;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="消息转发机制具体实现"><a href="#消息转发机制具体实现" class="headerlink" title="消息转发机制具体实现"></a>消息转发机制具体实现</h3><p>在动态添加方法过程中，我们使用如下方式：</p>
<h3 id="1动态解析方法"><a href="#1动态解析方法" class="headerlink" title="1动态解析方法"></a>1动态解析方法</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+(<span class="built_in">BOOL</span>)resolveInstanceMethod:(SEL)sel;</span><br></pre></td></tr></table></figure>
<p>具体实例如下：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">+(<span class="built_in">BOOL</span>)resolveInstanceMethod:(SEL)sel&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ([<span class="built_in">NSStringFromSelector</span>(sel) isEqualToString:<span class="string">@"sihai"</span>])</span><br><span class="line"> &#123;</span><br><span class="line"></span><br><span class="line">   class_addMethod(<span class="keyword">self</span>, sel, abc, <span class="string">"v@:"</span>);</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line"></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure></p>
<p>从这里我们就可以看出在函数调用过程中runtime会根据SEl识别子进行寻找，在例子中我们有相应的识别可以查询，如果没有相应的识别子呢？</p>
<blockquote>
<p>在系统中如果在查找过程中没有找到相应的选择子，就会调用上面的函数<br>+(BOOL)resolveInstanceMethod:(SEL)sel；生成实例方法，如上面例子（添加相应的实例方法可以实现，就跳转方法实现）。把添加方法放入到缓存中，可以供我们进行下次的调用</p>
</blockquote>
<p>如果上面我们找到相应的识别子，就会进行第二次对选择子进行相关的处理。</p>
<h3 id="2备援接收到"><a href="#2备援接收到" class="headerlink" title="2备援接收到"></a>2备援接收到</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="keyword">id</span>)forwardingTargetForSelector:(SEL)aSelector;</span><br><span class="line">具体实例如下：</span><br><span class="line"></span><br><span class="line">-(<span class="keyword">id</span>)forwardingTargetForSelector:(SEL)aSelector&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ([<span class="built_in">NSStringFromSelector</span>(aSelector) isEqualToString:<span class="string">@"sihai"</span>]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">    &#125;</span><br><span class="line">        <span class="keyword">return</span> [<span class="keyword">super</span> forwardingTargetForSelector:aSelector];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>系统会把选择子作为参数，返回给我们一个选择子对象。运行的系统就会对相关方法实例进行查找，如果找到相关方法就实行，找不到就结束转发。</p>
<h3 id="3完整的消息传递"><a href="#3完整的消息传递" class="headerlink" title="3完整的消息传递"></a>3完整的消息传递</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="keyword">void</span>)forwardInvocation:(<span class="built_in">NSInvocation</span> *)anInvocation;</span><br><span class="line">实现的具体方法如下：</span><br><span class="line"></span><br><span class="line">-(<span class="built_in">NSMethodSignature</span>*)methodSignatureForSelector:(SEL)aSelector&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ([<span class="built_in">NSStringFromSelector</span>(aSelector) isEqualToString:<span class="string">@"sihai"</span>]) &#123;</span><br><span class="line">        <span class="keyword">return</span> [<span class="built_in">NSMethodSignature</span> signatureWithObjCTypes:<span class="string">"v@:"</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">super</span> methodSignatureForSelector:aSelector];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="keyword">void</span>)forwardInvocation:(<span class="built_in">NSInvocation</span> *)anInvocation&#123;</span><br><span class="line"></span><br><span class="line">        anInvocation.selector = <span class="keyword">@selector</span>(fly);</span><br><span class="line">        [anInvocation invokeWithTarget:<span class="keyword">self</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果上面2步骤中返回依然是nil，也会执行完整的消息传输消息机制。在该方法中我们可以改变其目标，然后运行系统就会根据改变的目标，在其目标中查询实现方法别调用。当然也可以进行修改选择子。</p>
<h3 id="如果方法调用失败"><a href="#如果方法调用失败" class="headerlink" title="如果方法调用失败"></a>如果方法调用失败</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="keyword">void</span>)doesNotRecognizeSelector:(SEL)aSelector;</span><br></pre></td></tr></table></figure>
<p>通过对于[self method];方法的实现过程的进行探究我们我们可以了解到在消息传递过程是如何实现的，而且我们可以更具我们需求对其中的方法进行相应的而修改。</p>
<blockquote>
<p>runtime是Objc语言特性，本人通过对于的研究理解是：通过runtime我们可以等到我们类中所有元素的资料信息，可以使用期同工的API对类进行我们想到达到的目的；在我们调试过程中也可以通过打印来简化我们调试信息；最棒的就是我们可以了解程序运行过程可以在开发中使我们更加得心应手。</p>
</blockquote>
<p><br></p>
<h3 id="参考来之："><a href="#参考来之：" class="headerlink" title="参考来之："></a>参考来之：</h3><p><a href="http://www.cocoachina.com/ios/20151015/13769.html" target="_blank" rel="external">Runtime初涉之消息转发</a><br><br><br><a href="http://www.cocoachina.com/ios/20150901/13173.html" target="_blank" rel="external">学习runtime的理解和心得</a><br><br><br><a href="https://developer.apple.com/library/ios/documentation/Cocoa/Reference/ObjCRuntimeRef/index.html#//apple_ref/doc/uid/TP40001418-CH1g-88778" target="_blank" rel="external">runtime 源码</a><br><br><a href="http://www.jianshu.com/p/f900de4a1495#" target="_blank" rel="external">OC刨根问底-Runtime简单粗暴理解</a></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">IOS</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/IOS/" class="article-tag-list-link color4">IOS</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2016/05/29/runtime理解/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>





  
    <article id="post-Fastlane讲解" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/29/Fastlane讲解/">Fastlane讲解</a>
    </h1>
  

        
        <a href="/2016/05/29/Fastlane讲解/" class="archive-article-date">
  	<time datetime="2016-05-29T04:13:46.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2016-05-29</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>大概在一个月左右写过关于cocoaPods安装和使用方法，如果说cocoaPods是我们盾牌（可以让我们在开发过程中专注实现代码部分），那么fastlane就会是我们开发过程中的长矛（帮助我们在开发过程中提交测试、快速发布）。<br>想知道fastlane了解点击<a href="https://fastlane.tools" target="_blank" rel="external">这里<br></a>获取fastlan的github下载点击<a href="https://github.com/fastlane/fastlane" target="_blank" rel="external">这里</a></p>
<h3 id="fastlane安装"><a href="#fastlane安装" class="headerlink" title="fastlane安装"></a>fastlane安装</h3><p>fastlane是基于Ruby的开发脚本集合有助于我们在IOS开发过程中达到简便的开发。如果你在自己MAC上已经安装Ruby及其环境，只需要执行下列安装就可以实现<br>    sudo gem install fastlane –verbose<br>确定自己安装的是最新版本的Xcode:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Xcode-select --install</span><br><span class="line"></span><br><span class="line">如果在启动fastlane比较慢的情况可以执行:</span><br><span class="line"></span><br><span class="line">gem cleanup</span><br></pre></td></tr></table></figure>
<h3 id="fastlane使用具体方法和具体功能"><a href="#fastlane使用具体方法和具体功能" class="headerlink" title="fastlane使用具体方法和具体功能"></a>fastlane使用具体方法和具体功能</h3><p>了解具体使用点击<a href="https://github.com/fastlane/fastlane/tree/master/deliver" target="_blank" rel="external">这里</a></p>
<ul><br><li>deliver：上传屏幕截图、二进制程序数据和应用程序到AppStore</li><br><li>snapshot：自动截取你的程序在每个设备上的图片</li><br><li>frameit：应用截屏外添加设备框架</li><br><li>pem：可以自动化地生成和更新应用推送通知描述文件</li><br><li>sigh：生成下载开发商店的配置文件</li><br><li>pilot：最好的在终端管理测试和建立的文件</li><br><li>boarding：很容易的方式邀请你测试beta测试</li><br><li>gyp：建立新的发布的版本</li><br><li>match：使用git同步你成员间的开发者证书和文件配置</li><br></ul>

<h3 id="fastlane举例："><a href="#fastlane举例：" class="headerlink" title="fastlane举例："></a>fastlane举例：</h3><p>使用deliver自动打包我们App提交到AppStore，官方使用点击<a href="https://github.com/fastlane/fastlane/tree/master/deliver" target="_blank" rel="external">这里</a><br>打开终端进行我们项目所在的floder，我的项目是在桌面上名称是hello<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cd ~/desktop/hello</span><br><span class="line"></span><br><span class="line">然后输入：</span><br><span class="line"></span><br><span class="line">deliver init</span><br><span class="line"></span><br><span class="line">然后输入我们的Apple ID Username:</span><br><span class="line">再输入我们的Password </span><br></pre></td></tr></table></figure></p>
<h3 id="fastlane使用场景"><a href="#fastlane使用场景" class="headerlink" title="fastlane使用场景"></a>fastlane使用场景</h3><ul><br><li>在我们开发后每次提交时执行的测试（有team的单元测试和团队开发的集成测试）(pilot)</li><br><li>构建我们使用的Bate版本时（boarding）</li><br><li>开发好项目需要提给界面截图时(snapshot)</li><br><li>构建并分发至应用商店（这包括更新配置文件，创建新的屏幕截图，上传应用至应用商店并提交应用）(deliver)</li><br></ul>

<h3 id="fastlane典型的开发流程"><a href="#fastlane典型的开发流程" class="headerlink" title="fastlane典型的开发流程"></a>fastlane典型的开发流程</h3><p>此开发流程也是我们团队开发过程中基本开发顺序<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">lane :appstore <span class="keyword">do</span></span><br><span class="line">  increment_build_number</span><br><span class="line">  cocoapods</span><br><span class="line">  xctool</span><br><span class="line">  snapshot</span><br><span class="line">  sigh</span><br><span class="line">  deliver</span><br><span class="line">  frameit</span><br><span class="line">  sh <span class="string">"./customScript.sh"</span></span><br><span class="line">  slack</span><br><span class="line">end</span><br></pre></td></tr></table></figure></p>
<p>cocoaPods帮助我们管理三方开源库，fastlane可以在我们开发过程中简化我们开发过程以及简化我们发布流程。如果要提高自己IOS方面能力需要我们进一步深入研究。</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">IOS</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/IOS/" class="article-tag-list-link color4">IOS</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2016/05/29/Fastlane讲解/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>





  
    <article id="post-block，注册监听，委托协议和KVO" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/29/block，注册监听，委托协议和KVO/">block，注册监听，委托协议和KVO</a>
    </h1>
  

        
        <a href="/2016/05/29/block，注册监听，委托协议和KVO/" class="archive-article-date">
  	<time datetime="2016-05-29T04:12:40.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2016-05-29</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>IOS中关于信息传递过程中经常会使用block，委托代理，NSNotification，KVO进行调用，但是查找资料后有些资料不是很全。</p>
<h3 id="四者总体比较然后进行一一详解进行讲解："><a href="#四者总体比较然后进行一一详解进行讲解：" class="headerlink" title="四者总体比较然后进行一一详解进行讲解："></a>四者总体比较然后进行一一详解进行讲解：</h3><p>block：一对一进行通信，比起其他三者更加简洁，但是事件比较多时可以使用delegate。<br>委托代理：和block一样是一对一，我们使用时要先进行协议方法然后实现协议代理，如果需要通信就需要实现代理。<br>NSNotification：在进行注册监听时，可以进行一对多的情况，一个进行注册可以多种情况下进行监听。<br>KVO：就是我们所说的键值监听模式，其主要是在KVC基础上完后才能。</p>
<p>以前读过一个砍柴的故事，如果我们想要追求搞得效率就要对所用到的工具了解，下面我们就开始磨我们搜中的刀。 </p>
<h3 id="block的来龙去脉："><a href="#block的来龙去脉：" class="headerlink" title="block的来龙去脉："></a>block的来龙去脉：</h3><p>block是IOS SDK 4.0中引入的，block在IOS中实际就是一个代码块，有点像C++中内联函数inline有点相似，最让人惊奇的是我们还可以向其传递参数。闲来没事想要知道block在C++中的具体实现就是用Clang编辑^{printf”Hello, World!”}()，此时我们在block仅仅是输出一个语句。<br>//hello.c是我们把想要编辑的内容放置的文件名称</p>
<h3 id="block在没有传入参数情况"><a href="#block在没有传入参数情况" class="headerlink" title="block在没有传入参数情况"></a>block在没有传入参数情况</h3><blockquote>
<p>$ clang -rewrite-objc hello.c </p>
</blockquote>
<p></p><p>在编译后再文件后会生成 hello.cpp文件</p><br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> __mian_block_impl_0 </span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">struct</span> __block_impl impl;</span><br><span class="line">  <span class="keyword">struct</span> __mian_block_desc_0* Desc;</span><br><span class="line"> __mian_block_impl_0(<span class="keyword">void</span> *fp, <span class="keyword">struct</span> __mian_block_desc_0 *desc, <span class="keyword">int</span> flags=<span class="number">0</span>)</span><br><span class="line"> &#123;    impl.isa = &amp;_NSConcreteStackBlock;</span><br><span class="line">          impl.Flags = flags;</span><br><span class="line">          impl.FuncPtr = fp;</span><br><span class="line">          Desc = desc;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> __mian_block_func_0(<span class="keyword">struct</span> __mian_block_impl_0 *__cself) </span><br><span class="line">&#123;</span><br><span class="line">     printf(<span class="string">"Hello, World!\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">struct</span> __mian_block_desc_0 &#123;</span><br><span class="line">  size_t reserved;</span><br><span class="line">  size_t Block_size;</span><br><span class="line">&#125; </span><br><span class="line">__mian_block_desc_0_DATA = &#123; <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> __mian_block_impl_0)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> mian()&#123;</span><br><span class="line">     ((<span class="keyword">void</span> (*)())&amp;__mian_block_impl_0((<span class="keyword">void</span> *)</span><br><span class="line">__mian_block_func_0, &amp;__mian_block_desc_0_DATA)) ();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">struct</span> IMAGE_INFO </span><br><span class="line">&#123; <span class="keyword">unsigned</span> version; <span class="keyword">unsigned</span> flag; &#125; </span><br><span class="line">_OBJC_IMAGE_INFO = &#123; <span class="number">0</span>, <span class="number">2</span> &#125;;</span><br></pre></td></tr></table></figure><p></p>
<p>上面的代码既是我们通过编译截取的hello.cpp的具体代码，根据上面代码我们可以看到block实际是struct结构。看出_mian_block_impl_0 其中传入其中也是block_impl&amp;mian_block_desc_0两个block，下面是_mian_block_impl_0的构造函数。</p>
<h3 id="block在有传入参数情况"><a href="#block在有传入参数情况" class="headerlink" title="block在有传入参数情况"></a>block在有传入参数情况</h3><blockquote>
<p>clang -rewrite-objc hello1.c</p>
</blockquote>
<p>同样在我们编译过后会生成hello.cpp</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> __mian_block_impl_0 &#123;</span><br><span class="line">  <span class="keyword">struct</span> __block_impl impl;</span><br><span class="line">  <span class="keyword">struct</span> __mian_block_desc_0* Desc;</span><br><span class="line">  <span class="keyword">float</span> perperson;</span><br><span class="line">  __mian_block_impl_0(<span class="keyword">void</span> *fp, <span class="keyword">struct</span> __mian_block_desc_0 </span><br><span class="line">*desc, <span class="keyword">float</span> _perperson, <span class="keyword">int</span> flags=<span class="number">0</span>) : perperson(_perperson)</span><br><span class="line"> &#123;</span><br><span class="line">    impl.isa = &amp;_NSConcreteStackBlock;</span><br><span class="line">    impl.Flags = flags;</span><br><span class="line">    impl.FuncPtr = fp;</span><br><span class="line">    Desc = desc;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">float</span> __mian_block_func_0(<span class="keyword">struct</span> __mian_block_impl_0 *__cself, </span><br><span class="line"><span class="keyword">int</span> totalNum) &#123;</span><br><span class="line">  <span class="keyword">float</span> perperson = __cself-&gt;perperson; <span class="comment">// bound by copy</span></span><br><span class="line">        <span class="keyword">return</span> perperson * totalNum;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">struct</span> __mian_block_desc_0 &#123;</span><br><span class="line">  size_t reserved;</span><br><span class="line">  size_t Block_size;</span><br><span class="line">&#125;</span><br><span class="line"> __mian_block_desc_0_DATA = &#123; <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> __mian_block_impl_0)&#125;;</span><br><span class="line"><span class="keyword">int</span> mian()&#123;</span><br><span class="line">    <span class="keyword">float</span> perperson = <span class="number">34.5</span>;</span><br><span class="line">    <span class="keyword">float</span> (*sunClassFee)(<span class="keyword">int</span>) = ((<span class="keyword">float</span> (*)(<span class="keyword">int</span>))</span><br><span class="line">&amp;__mian_block_impl_0((<span class="keyword">void</span> *)__mian_block_func_0, &amp;__mian_block_desc_0_DATA, </span><br><span class="line">perperson));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">struct</span> IMAGE_INFO &#123; <span class="keyword">unsigned</span> version; <span class="keyword">unsigned</span> flag; &#125; </span><br><span class="line">_OBJC_IMAGE_INFO = &#123; <span class="number">0</span>, <span class="number">2</span> &#125;;</span><br></pre></td></tr></table></figure>
<p>可以看出在block中使用外部变量perperson时，block初始化时这样的：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">是在__mian_block_impl_0进行初始化perperson，在block构造时作为block的其中</span><br><span class="line">一个成员初始。在访问时通过__cself-&gt;perperson指针进行访问。</span><br></pre></td></tr></table></figure></p>
<h3 id="block在有传入参数情况-1"><a href="#block在有传入参数情况-1" class="headerlink" title="block在有传入参数情况"></a>block在有传入参数情况</h3><blockquote>
<p>clang -rewrite-objc hello2.c</p>
</blockquote>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> __Block_byref_perperson_0 &#123;</span><br><span class="line">  <span class="keyword">void</span> *__isa;   </span><br><span class="line"> __Block_byref_perperson_0 *__forwarding;</span><br><span class="line">  <span class="keyword">int</span> __flags;</span><br><span class="line"> <span class="keyword">int</span> __size;</span><br><span class="line"> <span class="keyword">float</span> perperson;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">struct</span> __mian_block_impl_0 &#123;</span><br><span class="line">  <span class="keyword">struct</span> __block_impl impl;</span><br><span class="line">  <span class="keyword">struct</span> __mian_block_desc_0* Desc;</span><br><span class="line">  __Block_byref_perperson_0 *perperson; <span class="comment">// by ref</span></span><br><span class="line">  __mian_block_impl_0(<span class="keyword">void</span> *fp, <span class="keyword">struct</span> __mian_block_desc_0 *desc, </span><br><span class="line"> __Block_byref_perperson_0 *_perperson, <span class="keyword">int</span> flags=<span class="number">0</span>) : </span><br><span class="line">perperson(_perperson-&gt;__forwarding) &#123;</span><br><span class="line">    impl.isa = &amp;_NSConcreteStackBlock;</span><br><span class="line">    impl.Flags = flags;</span><br><span class="line">    impl.FuncPtr = fp;</span><br><span class="line">    Desc = desc;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">float</span> __mian_block_func_0(<span class="keyword">struct</span> __mian_block_impl_0 *__cself,</span><br><span class="line"> <span class="keyword">int</span> totalNum) &#123;</span><br><span class="line">    __Block_byref_perperson_0 *perperson = __cself-&gt;perperson; <span class="comment">// bound by ref</span></span><br><span class="line">     (perperson-&gt;__forwarding-&gt;perperson) = (perperson-&gt;__forwarding-</span><br><span class="line">perperson) + <span class="number">6</span>;</span><br><span class="line">        <span class="keyword">return</span> (perperson-&gt;__forwarding-&gt;perperson) * totalNum;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> __mian_block_copy_0(<span class="keyword">struct</span> __mian_block_impl_0*dst, </span><br><span class="line"><span class="keyword">struct</span> __mian_block_impl_0*src) </span><br><span class="line">&#123;_Block_object_assign((<span class="keyword">void</span>*)&amp;dst-&gt;perperson, </span><br><span class="line">(<span class="keyword">void</span>*)src-&gt;perperson, <span class="number">8</span><span class="comment">/*BLOCK_FIELD_IS_BYREF*/</span>);&#125;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> __mian_block_dispose_0(<span class="keyword">struct</span> __mian_block_impl_0*src) &#123;</span><br><span class="line">_Block_object_dispose((<span class="keyword">void</span>*)src-&gt;perperson, <span class="number">8</span><span class="comment">/*BLOCK_FIELD_IS_BYREF*/</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">struct</span> __mian_block_desc_0 &#123;</span><br><span class="line">  size_t reserved;</span><br><span class="line">  size_t Block_size;</span><br><span class="line">  <span class="keyword">void</span> (*<span class="keyword">copy</span>)(<span class="keyword">struct</span> __mian_block_impl_0*, <span class="keyword">struct</span> __mian_block_impl_0*);</span><br><span class="line">  <span class="keyword">void</span> (*dispose)(<span class="keyword">struct</span> __mian_block_impl_0*);</span><br><span class="line">&#125; __mian_block_desc_0_DATA = &#123; </span><br><span class="line"><span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> __mian_block_impl_0), __mian_block_copy_0, </span><br><span class="line">__mian_block_dispose_0&#125;;</span><br><span class="line"><span class="keyword">int</span> mian()&#123;</span><br><span class="line">    __attribute__((__blocks__(<span class="keyword">byref</span>))) __Block_byref_perperson_0 perperson = &#123;</span><br><span class="line">(<span class="keyword">void</span>*)<span class="number">0</span>,(__Block_byref_perperson_0 *)&amp;perperson, <span class="number">0</span>, </span><br><span class="line"><span class="keyword">sizeof</span>(__Block_byref_perperson_0), <span class="number">34.5</span></span><br><span class="line">&#125;;</span><br><span class="line">    <span class="keyword">float</span> (*sunClassFee)(<span class="keyword">int</span>) = ((<span class="keyword">float</span> (*)(<span class="keyword">int</span>))&amp;__mian_block_impl_0((<span class="keyword">void</span> *)</span><br><span class="line">__mian_block_func_0, &amp;__mian_block_desc_0_DATA, </span><br><span class="line">(__Block_byref_perperson_0 *)&amp;perperson, <span class="number">570425344</span>));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">struct</span> IMAGE_INFO &#123; <span class="keyword">unsigned</span> version; <span class="keyword">unsigned</span> flag; &#125; </span><br><span class="line">_OBJC_IMAGE_INFO = &#123; <span class="number">0</span>, <span class="number">2</span> &#125;;</span><br></pre></td></tr></table></figure>
<p>我们在对于block外的perperson计算重新复制，和上面在block仅仅在block中使用外面的参数。两者经过对比可以看出：在block中对于外部值进行复制，会出现下面的情况。使用clang对于block进行编码，可以看书对于perperson进行_block的修饰后编码生成Block_byref_perperson_0的struct结构体，其中__Block_byref_perperson_0的指针指向在block中perperson的地址。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> __Block_byref_perperson_0 &#123;</span><br><span class="line">  <span class="keyword">void</span> *__isa;</span><br><span class="line"> __Block_byref_perperson_0 *__forwarding;  <span class="keyword">int</span> __flags;</span><br><span class="line"> <span class="keyword">int</span> __size; <span class="keyword">float</span> perperson;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="block的使用方法-传入参数："><a href="#block的使用方法-传入参数：" class="headerlink" title="block的使用方法~传入参数："></a>block的使用方法~传入参数：</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">int</span> (^isInputEven)(<span class="keyword">int</span>) = ^(<span class="keyword">int</span> n)&#123;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (n&gt;<span class="number">1</span>) &#123;</span><br><span class="line">              <span class="keyword">return</span> n*isInputEven(n<span class="number">-1</span>);</span><br><span class="line">           &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">              <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">         &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>上面我们定义一个block代码段，代码的实现功能是利用递归计算n的基乘。代码可以作为整个代码块进行调用，而且在调用过程中我们只需isInputEven（）函数名和传入参数即可实现。</p>
<h3 id="block的使用方法-使用外部参数参数："><a href="#block的使用方法-使用外部参数参数：" class="headerlink" title="block的使用方法~使用外部参数参数："></a>block的使用方法~使用外部参数参数：</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">float</span> perperson = <span class="number">34.5</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> (^sunClassFee)(<span class="keyword">int</span>) = ^(<span class="keyword">int</span> totalNum)&#123;</span><br><span class="line">        <span class="keyword">return</span> perperson * totalNum;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>使用外部参数perperson，让我们感觉block可以想一个类一样使用socpe里面的变量目前无法做到。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">主要原因是因为：在block的编译过程中我们看到，在block中进行访问其中元素时需要是</span><br><span class="line">block默认构造函数对于block其中的元素访问。</span><br></pre></td></tr></table></figure></p>
<h3 id="block的使用方法-使用外部参数参数：-1"><a href="#block的使用方法-使用外部参数参数：-1" class="headerlink" title="block的使用方法~使用外部参数参数："></a>block的使用方法~使用外部参数参数：</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">__block <span class="keyword">float</span> perperson = <span class="number">34.5</span>;</span><br><span class="line">    <span class="keyword">float</span> (^sunClassFee)(<span class="keyword">int</span>) = ^(<span class="keyword">int</span> totalNum)&#123;</span><br><span class="line">        perperson = perperson + <span class="number">6</span>;</span><br><span class="line">        <span class="keyword">return</span> perperson * totalNum;</span><br><span class="line"> &#125;;</span><br></pre></td></tr></table></figure>
<h3 id="block的使用方法-在（UIView）的动画中使用："><a href="#block的使用方法-在（UIView）的动画中使用：" class="headerlink" title="block的使用方法~在（UIView）的动画中使用："></a>block的使用方法~在（UIView）的动画中使用：</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">UIView</span> animateWithDuration:<span class="number">3.0</span>f animations:^&#123;</span><br><span class="line"></span><br><span class="line">        view.alpha = <span class="number">0</span>;</span><br><span class="line"> &#125;];</span><br></pre></td></tr></table></figure>
<p>IOS的开发到今天差不多已经有7年之久，block在开发中使用广度越来越广泛：</p>
<p><ul></ul></p>
<p><li>枚举–来过去对象。例如：NSDictionary的枚举过程</li></p>
<p><li>UIView–对于UIView的动画设置，后面有机会会对动画专门讲述…</li></p>
<p><li>通知–在本文讲述的就是在调用过程中与其他通知不同点所在</li></p>
<p><li>完成处理–在相应程序结束后，需要对于程序结果的处理。例如：AFNetWork在访问网络后，对于成功和失败进行处理</li></p>
<p><li>GCD–在GCD的过程中都是含有block使用的方法</li></p>
<p><li>排序–平时我们使用的一些简单算法均可以block进行相关处理</li><br></p>
<h3 id="委托代理详解"><a href="#委托代理详解" class="headerlink" title="委托代理详解"></a>委托代理详解</h3><p>在发C++过程中经常见到多组继承，但是在IOS开发过程中只能进行单继承，很多方法我们需要实现接口的形式。正如我们在使用UITableView时，经常会用到UITableViewDataSource和UITableViewDelegate。<br>如果要使用使用委托代理，需要知道协议和委托两者关系。</p>
<h3 id="协议"><a href="#协议" class="headerlink" title="协议"></a>协议</h3><p>协议一般分为两种：</p>
<blockquote>
<p>@ required:        //是我们在继承过程中必须实现的<br>   @optional :        //在实现接口中需要进行选择性实现的方式</p>
</blockquote>
<h3 id="委托"><a href="#委托" class="headerlink" title="委托"></a>委托</h3><p>常见的一种设计模式，身为老板一般负责管理员工、打电话、发薪水，这样由于公司业务发展就请一个秘书负责：打电话和发薪水。</p>
<blockquote>
<p>首先进行协议提取（需要员工所得事情）：(boss.h文件中声明)</p>
</blockquote>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">protocol</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line">-(<span class="keyword">void</span>)payoff;</span><br><span class="line">-(<span class="keyword">void</span>)tel;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">boss</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>) <span class="keyword">id</span>&lt;protocol&gt; delegate;</span><br><span class="line">-(<span class="keyword">void</span>)manage;</span><br><span class="line">-(<span class="keyword">void</span>)payoff;</span><br><span class="line">-(<span class="keyword">void</span>)tel;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>对于老板在具体工作的实现：(boss.m文件中实现)</p>
</blockquote>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">boss</span></span></span><br><span class="line">-(<span class="keyword">void</span>)manage&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"boss--&gt;manage"</span>);</span><br><span class="line">&#125;</span><br><span class="line">-(<span class="keyword">void</span>)payoff&#123;</span><br><span class="line">    [<span class="keyword">self</span>.delegate payoff];</span><br><span class="line">&#125;</span><br><span class="line">-(<span class="keyword">void</span>)tel&#123;</span><br><span class="line">    [<span class="keyword">self</span>.delegate tel];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>委托秘书所要做的事物：（在sec.m的文件中实现完成boss的代理）</p>
</blockquote>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Sec</span> ()&lt;<span class="title">protocol</span>&gt;</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Sec</span></span></span><br><span class="line">-(<span class="keyword">void</span>)payoff&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"sec--&gt;payoff"</span>);</span><br><span class="line">&#125;</span><br><span class="line">-(<span class="keyword">void</span>)tel&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"sec--&gt;tel"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="注册监听小试"><a href="#注册监听小试" class="headerlink" title="注册监听小试"></a>注册监听小试</h3><p>NSNotificationCenter就相当于广播一样，可以对对象进行一次注册然后有多个监听。就像我们知道如果有注册的话，就需要我们对于对象进行释放（remove）。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[[<span class="built_in">NSNotificationCenter</span> defaultCenter] postNotificationName:<span class="string">@"clickbt"</span> object:<span class="literal">nil</span>];</span><br><span class="line">[[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(click) name:<span class="string">@"clickbt"</span> object:<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p>在上面的代码可以看出我们在使用注册监听时可以进行相关内容传递，需要传递的内容放在object（为id类型）。<br>在remove监听的方法，经过查找资料：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> -(<span class="keyword">void</span>)viewWillAppear:(<span class="built_in">BOOL</span>)animated</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">   [<span class="keyword">super</span> viewWillAppear:animated];</span><br><span class="line"></span><br><span class="line">   [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(test) name:<span class="string">@"clickbt"</span> object:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="keyword">void</span>)viewWillDisappear:(<span class="built_in">BOOL</span>)animated</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">   [<span class="keyword">super</span> viewWillDisappear:animated];</span><br><span class="line"></span><br><span class="line">   [[<span class="built_in">NSNotificationCenter</span> defaultCenter] removeObserver:<span class="keyword">self</span> name:<span class="string">@"clickbt"</span> object:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="KVO简史"><a href="#KVO简史" class="headerlink" title="KVO简史"></a>KVO简史</h3><p>当我们说起KVO(key-value-observe)时不免想起他的孪生大哥KVC（key-value-coding）。KVO是观察者模式的继承者，基于键值变化监听者，基于KVC基础完成之一。</p>
<blockquote>
<p>下列对于界面的UILabel进行监听：</p>
</blockquote>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="keyword">self</span>.label addObserver:<span class="keyword">self</span> forKeyPath:<span class="string">@"narcotics"</span> options:</span><br><span class="line"><span class="built_in">NSKeyValueObservingOptionNew</span> |<span class="built_in">NSKeyValueObservingOptionOld</span> context:<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<blockquote>
<p>一旦UILabel发生变化就会调用方法：</p>
</blockquote>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="keyword">void</span>)observeValueForKeyPath:(<span class="built_in">NSString</span> *)keyPath ofObject:(<span class="keyword">id</span>)object </span><br><span class="line">change:(<span class="built_in">NSDictionary</span> *)change context:(<span class="keyword">void</span> *)context&#123;</span><br><span class="line">     <span class="comment">//一旦有所变化调用方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>附带：</p>
<blockquote>
<p>KVC：通过设置key值，进行标记。然后通过key值找到进行重新设置，说的通俗点点就是键值对。类似NSDictionary相似。</p>
</blockquote>
<p>以前经常看些大牛写的博客，在看博客过程中也学到很多知识。心向往之，开始动手写关于自己在IOS成长路上见证。</p>
<h3 id="简述block和delegation使用场景的比较"><a href="#简述block和delegation使用场景的比较" class="headerlink" title="简述block和delegation使用场景的比较"></a>简述block和delegation使用场景的比较</h3><p>我们知道<code>block</code>和<code>delegation</code>是关于通信方面，在开发的过程中我们也经常会使用两者。面对具体情况我们需要怎么样做出选着呢？</p>
<h3 id="1-当在一个方法的参数中需要多个对象时使用delegation"><a href="#1-当在一个方法的参数中需要多个对象时使用delegation" class="headerlink" title="1.当在一个方法的参数中需要多个对象时使用delegation"></a>1.当在一个方法的参数中需要多个对象时使用delegation</h3><p>我们在开发过程中经常使用<code>UITableView</code>，这时我们就要实现接口协议<code>UITableViewDataSource</code>, <code>UITableViewDelegate</code>两者是我们在使用<code>UITableView</code>的相关数据协议和相关协议。从tableView角度出发：实现展示需要数据、对一些展示过程的控制等，这些可以使用<code>block</code>来进行实现。</p>
<blockquote>
<p>void (^ showTableView)(NSData *data, NSInteger number, CGFloat heightForRowAtIndexPath);</p>
</blockquote>
<p>上面我们定义告诉过程需要参数在<code>NSIndexPath</code>,所以第三个参数应该是 <code>block</code>形式。我们上面知道block在编译过程会被编译为<strong>struct</strong>结构，在相互嵌套过程中使用<code>delegation</code>更加方便。</p>
<h3 id="2-一个对象只能有一个delegation"><a href="#2-一个对象只能有一个delegation" class="headerlink" title="2. 一个对象只能有一个delegation"></a>2. 一个对象只能有一个delegation</h3><p>由于一个对象只能有一个delegate，而且它只能与这个delegate通信。让我们看看CLLocationManager 这个类，当发现地理位置后，location manager 只会通知一个对象（有且只有一个）。当然，如果我们需要更多的对象去知道这个更新，我们最好创建其他的location manager。</p>
<p>这里有的人可能想到，如果CLLocationManager是个单例呢？如果我们不能创建CLLocationManager的其他实例，就必须不断地切换delegate指针到需要地理数据的对象上（或者创建一个只有你理解的精密的广播系统）。因此，这样看起来，delegatetion在单例上没有多大意义。</p>
<p>关于这点，最好的印证例子就是UIAccelerometer。在早期版本的iOS中，单例的 accelerometer 实例有一个delegate，导致我们必须偶尔切换一下。这个愚蠢的问题在之后的IOS版本被修改了，现在，任意一个对象都可以访问CMMotionManager block，而不需要阻止其他的对象来接收更新。</p>
<p>因此，我们可以得出另一个结论：“如果一个对象是单例，不要使用delegation”。</p>
<h3 id="3-一般delegation都有自己的而返回值"><a href="#3-一般delegation都有自己的而返回值" class="headerlink" title="3. 一般delegation都有自己的而返回值"></a>3. 一般delegation都有自己的而返回值</h3><p>还是拿上面的例子说明：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSInteger</span>)tableView:(<span class="built_in">UITableView</span> *)tableView numberOfRowsInSection:(<span class="built_in">NSInteger</span>)section;</span><br><span class="line"></span><br><span class="line">-(<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath;</span><br></pre></td></tr></table></figure></p>
<p>上面是<code>UITableViewDataSource</code>协议中必须实现协议，可看出是使用返回值。而我们也可以看其他的一些协议表示情况，一般均是需要返回值的。</p>
<h3 id="4-delegation偏向于使用的过程-VS-block偏向于使用结果"><a href="#4-delegation偏向于使用的过程-VS-block偏向于使用结果" class="headerlink" title="4.delegation偏向于使用的过程 VS block偏向于使用结果"></a>4.delegation偏向于使用的过程 VS block偏向于使用结果</h3><p>如果查看<code>NSURLConnectionDelegate</code> 以及 <code>NSURLConnectionDataDelegate</code>，我们在可以<strong>protocol</strong>中看到这样的消息：我将要做什么（如： <strong>willSendRequest</strong>，将要发送请求）、到目前为止我知道的信息（如：<code>canAuthenticateAgainstProtectionSpace</code>）、我已经完成这些啦（ <strong>didReceiveResponse</strong>，收到请求的回复，即完成请求）。这些消息组成一个流程，而那些对流程感兴趣的<strong>delegate</strong>将会在每一步得到相应的通知。</p>
<p>当我们观察<strong>handler</strong>和完整的方法时，我们发现一个<strong>block</strong>包含一个响应对象和一个错误对象。显然这里没有任何有关“我在哪里，我正在做什么的”的交互。</p>
<p>因此我们可以这样认为，<strong>delegate</strong>的回调更多的面向过程，而<strong>block</strong>则是面向结果的。如果你需要得到一条多步进程的通知，你应该使用<strong>delegation</strong>。而当你只是希望得到你请求的信息（或者获取信息时的错误提示），你应该使用<strong>block</strong>。（如果你结合之前的3个结论，你会发现<strong>delegate</strong>可以在所有事件中维持<strong>state</strong>，而多个独立的<strong>block</strong>确不能）。<br><br></p>
<h3 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h3><p><a herf="http://www.cocoachina.com/ios/20150925/13525.html">开发该选择Blocks还是Delegates</a></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">IOS</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/IOS/" class="article-tag-list-link color4">IOS</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2016/05/29/block，注册监听，委托协议和KVO/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>





  
    <article id="post-从叮叮CTO采访演讲随笔" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/29/从叮叮CTO采访演讲随笔/">从叮叮CTO采访演讲随笔</a>
    </h1>
  

        
        <a href="/2016/05/29/从叮叮CTO采访演讲随笔/" class="archive-article-date">
  	<time datetime="2016-05-29T04:09:11.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2016-05-29</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>今天在看One’s Cat大神的博客时讲到如何创建我们个人的开源框架，就涉及到fastlane就找来看下，无意中看到叮叮的CTO朱鸿大神（又一尊大神）讲述自己的产品。短短22：05的视频让自己感触很大，写这篇文章也就是无聊说下自己所学知识吧。</p>
<h3 id="总的来说以技术来简化我们生活，目前比想象中要难。"><a href="#总的来说以技术来简化我们生活，目前比想象中要难。" class="headerlink" title="总的来说以技术来简化我们生活，目前比想象中要难。"></a>总的来说以技术来简化我们生活，目前比想象中要难。</h3><h3 id="人员配置方面"><a href="#人员配置方面" class="headerlink" title="人员配置方面"></a>人员配置方面</h3><p>首先朱大神讲述团队人数有120人，而在客户端和后端比例2：1估计这样的标配也只有像阿里这样想要在移动端尤其社交这块站住一定地位强悍标配。</p>
<h3 id="踩过的大坑"><a href="#踩过的大坑" class="headerlink" title="踩过的大坑"></a>踩过的大坑</h3><p>朱大神讲述在数据解析方便曾经踩过一个大坑，所谓大坑就是在IOS&amp;Android两个客户端对于数据解析有所不同。就是在于基本数据类型方面对于数据解析产生不同的结果，估计是使用加密方式在服务器得到数据解析有一定乱码想象只是不知道是Json还是Xml得解析（小编自己猜测）。</p>
<h3 id="企业电话方面"><a href="#企业电话方面" class="headerlink" title="企业电话方面"></a>企业电话方面</h3><p>大神说出目前我们移动的端所在2G用户比重挺大，采用融合通信方向期间还是用阿里的线路。关于在WiFi情况下测试使用OA通信方式，随便讲述在手机网络提供商不同的情况下具体情况（联通网络通信一旦打开网络就会占用一条信道进行通信，所以在数据较大时带宽就是占用较大问题~小心脏作为客户端开发的小编之前竟没有听说过）。</p>
<h3 id="发布机制和团队意思"><a href="#发布机制和团队意思" class="headerlink" title="发布机制和团队意思"></a>发布机制和团队意思</h3><p>由于叮叮是基于企业通信服务的行业应用性能方便真是个大问题。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> 嗨，记得去年的暑假在参加深圳一个活动时，黄老大奔去深圳创业~那时我们住在旅社</span><br><span class="line">他说要做企业OA，我随口说现在创业那么火要不做一个给创业者做个服务型的应用提高效率。看到这个感觉</span><br><span class="line">事情真的不想我们想象的那么简单！</span><br></pre></td></tr></table></figure></p>
<p>作为开发人员我们都知道如何做到流畅滚动界面和通信方面及时，这个是很大的挑战。这个后面有所涉及大家还是耐心看下去。<br>其实真正触动💘项目组技术、产品和运营拆分为7个team，实行竞争估计机制。产品经理对于自己team负责的功能进行跟进，技术和运营负责相关技术开发。这样完成每天都可以进行一个bate的提交，三周进行产品的一次迭代。项目开发之快。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> 最让小编疑惑的是产品之间功能可以进行模块开发~基于面向对象有点（针对功能实现</span><br><span class="line">可以进行模块划分），但是运营是怎么在一个大的team然后7个小团队之间实现😂</span><br></pre></td></tr></table></figure>
<p>记得不久前有个标题党：BAT未来还会存在吗？中间就是利用“二八法则”来讲述大企业面对科技什么鬼突变时难以进行改革，小企业更有活力。来辩证讲述自己的观点，看小编微微一笑就喝下水平静平静。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> 不过目前看来这个定理估计是有自己价值，以后如果是自己出来尝试就可以试验下，此</span><br><span class="line">处可以hulue</span><br></pre></td></tr></table></figure></p>
<h3 id="灰度用户"><a href="#灰度用户" class="headerlink" title="灰度用户"></a>灰度用户</h3><p>听到的第一感觉就是“恩？”请问和37度灰有关系不。我可是窦文涛的粉丝啊，难道是自己见识太少。认认真<br>真百度一下关于灰度的问题，所说没有找到灰度用户说法但是却看到关于QQ传授灰度法则：需求度、速度、灵活度、冗余度、开放协作度、创新度和进化度。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">小编下面就为大家讲述下：</span><br><span class="line">需求度：用户需求就是使用者最想要。例如：只从去年国家放开二胎政策，我们就会看到今年母婴行业天天</span><br><span class="line">火爆的行业，毕竟70，80后大叔和阿姨估计从那天就开始人类伟大的传承奋斗啦😛</span><br><span class="line">速度：这个估计大家都知道，刘翔110跨栏成为亚洲飞人的称号。对于互联网而言速度就更难能可贵的，估</span><br><span class="line">计这也是面对微信的叮叮三周一个版本更新具体体现吧。</span><br><span class="line">灵活度：面对当前局势有所判断和对未知的预见，就像神雕侠侣里的段誉，面对强大恶老三（一直都自称老</span><br><span class="line">二来着）虽说武术哥不行。但是好在凌波微步，照样在打赌中成为你小子的师傅不是。</span><br><span class="line">冗余度：看到这心里凉把把的，QQ老大你也是程序员开始的，冗余度是在程序开发过程中我们想法设法解</span><br><span class="line">决。后来定睛一看，哦，原来是是试错啊，好吧奉上我的膝盖👍🏻。</span><br><span class="line">开放协作度：在互联网中把自家的资源拿来共享合作，大家都知道蜜蜂一般蜂巢中只有一个蜂后无数工蜂，</span><br><span class="line">蜂后向工蜂提供生命工蜂负责具体事务。之后大家在一个集体里把自己越做越大，蜂后后期几乎可以独资。</span><br><span class="line">创新度：只记得去年克强大大所得万众创新，大众创业。后面身边很多人就去啦，一路好走🌵</span><br><span class="line">进化度：QQ大佬说6个如果做到的话，这个会自动完成。有点生物进化的味道，但是缺少物竞天择。</span><br></pre></td></tr></table></figure>
<h3 id="问题调试"><a href="#问题调试" class="headerlink" title="问题调试"></a>问题调试</h3><blockquote><p>这里之所使用代码格式是真的有重要，仅对于码农来说，比方说本人。<br>还像是Android段可以进行fix后台自动修复功能，IOS客户端是在IOS端直接进行修改。</p>
</blockquote>
<h3 id="性能优化要求"><a href="#性能优化要求" class="headerlink" title="性能优化要求"></a>性能优化要求</h3><p>省电和顺滑，具体怎么完成和实现，朱大神微微😃。当讲到在图片下载处理时主要将海外，朱大神说我们在海外有简历服务器然后跟具体的路由优化选择可以对图片下载加快速度。</p>
<h3 id="企业群聊处理"><a href="#企业群聊处理" class="headerlink" title="企业群聊处理"></a>企业群聊处理</h3><p>假设一种情况：当很多在一个群组中一起聊天，一秒可以让数据达到几千条。请问你怎么解决？<br>朱大神解决方式：一起把数据下载下来，保存不至于丢失。但是最后显示的数据大多是最后十几二十几条。这样可以减少屏幕的刷屏率，优化性能。至少在GPU渲染显示方面肯定有所优化🙅🏻</p>
<blockquote><p>之所以写这些随笔，是想让自己记住自己看过知识。毕竟好记性是在不如一个烂笔头，写的过程也是在记忆<br>中重新思考的过程。</p>
</blockquote>
      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color5">视频心得</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/随笔/" class="article-tag-list-link color3">随笔</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2016/05/29/从叮叮CTO采访演讲随笔/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>





  
    <article id="post-博客开启" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/28/博客开启/">博客搬家感觉</a>
    </h1>
  

        
        <a href="/2016/05/28/博客开启/" class="archive-article-date">
  	<time datetime="2016-05-28T13:44:27.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2016-05-28</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <br><br> <br> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">博客地址有经常使p用的博客园搬至简书，从简书搬到Hexo建立的Github上面。从此开启自己在跟人博客学</span><br><span class="line"></span><br><span class="line">习和分享征程，要是说写这些对我最大驱动力是一条自己一直对技术喜爱和完成自己蜕变之路。 </span><br></pre></td></tr></table></figure>
<p><br><br><br></p>
<hr>
<p>昨天把博客搬至自己的博客，虽说花费的时间有点多，但是看着自己花费的时间有所收获还是很开心</p>
<hr>
<p>的。而且自己也将要离开生活四年头大开始新的征程，有的同学说自己上大学优劣，不过我是真心感</p>
<hr>
<p>谢头大。在四年间自己做过很多事情，也收获很多。其实最大的收获是有一件事值得自己一直去等待</p>
<hr>
<p>这也需是自己在大学最大的收获，也是在大学最开心大三下半学期╮(╯▽╰)╭。</p>
<hr>
<p><br><br><br></p>
<p style="text-align:right;"><br>    – <a href="https://github.com/boilWater/boilWater.github.io" target="_blank" rel="external"> 后面会附上自己简历独自介绍😘</a><br></p>



      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color5">博客之初</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/随笔/" class="article-tag-list-link color3">随笔</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2016/05/28/博客开启/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>





  
  


          </div>
        </div>
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2017 JackJin
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		mathjax: false,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: "/",
		innerArchive: true,
		showTags: false
	}
</script>

<script>!function(t){function n(e){if(r[e])return r[e].exports;var i=r[e]={exports:{},id:e,loaded:!1};return t[e].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}var r={};n.m=t,n.c=r,n.p="./",n(0)}([function(t,n,r){r(194),t.exports=r(190)},function(t,n,r){var e=r(3),i=r(52),o=r(27),u=r(28),c=r(53),f="prototype",a=function(t,n,r){var s,l,h,v,p=t&a.F,d=t&a.G,y=t&a.S,g=t&a.P,b=t&a.B,m=d?e:y?e[n]||(e[n]={}):(e[n]||{})[f],x=d?i:i[n]||(i[n]={}),w=x[f]||(x[f]={});d&&(r=n);for(s in r)l=!p&&m&&void 0!==m[s],h=(l?m:r)[s],v=b&&l?c(h,e):g&&"function"==typeof h?c(Function.call,h):h,m&&u(m,s,h,t&a.U),x[s]!=h&&o(x,s,v),g&&w[s]!=h&&(w[s]=h)};e.core=i,a.F=1,a.G=2,a.S=4,a.P=8,a.B=16,a.W=32,a.U=64,a.R=128,t.exports=a},function(t,n,r){var e=r(6);t.exports=function(t){if(!e(t))throw TypeError(t+" is not an object!");return t}},function(t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(t,n){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,n,r){var e=r(126)("wks"),i=r(76),o=r(3).Symbol,u="function"==typeof o;(t.exports=function(t){return e[t]||(e[t]=u&&o[t]||(u?o:i)("Symbol."+t))}).store=e},function(t,n){var r={}.hasOwnProperty;t.exports=function(t,n){return r.call(t,n)}},function(t,n,r){var e=r(94),i=r(33);t.exports=function(t){return e(i(t))}},function(t,n,r){t.exports=!r(4)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(2),i=r(167),o=r(50),u=Object.defineProperty;n.f=r(10)?Object.defineProperty:function(t,n,r){if(e(t),n=o(n,!0),e(r),i)try{return u(t,n,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[n]=r.value),t}},function(t,n,r){t.exports=!r(18)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(14),i=r(22);t.exports=r(12)?function(t,n,r){return e.f(t,n,i(1,r))}:function(t,n,r){return t[n]=r,t}},function(t,n,r){var e=r(20),i=r(58),o=r(42),u=Object.defineProperty;n.f=r(12)?Object.defineProperty:function(t,n,r){if(e(t),n=o(n,!0),e(r),i)try{return u(t,n,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[n]=r.value),t}},function(t,n,r){var e=r(40)("wks"),i=r(23),o=r(5).Symbol,u="function"==typeof o;(t.exports=function(t){return e[t]||(e[t]=u&&o[t]||(u?o:i)("Symbol."+t))}).store=e},function(t,n,r){var e=r(67),i=Math.min;t.exports=function(t){return t>0?i(e(t),9007199254740991):0}},function(t,n,r){var e=r(46);t.exports=function(t){return Object(e(t))}},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n,r){var e=r(63),i=r(34);t.exports=Object.keys||function(t){return e(t,i)}},function(t,n,r){var e=r(21);t.exports=function(t){if(!e(t))throw TypeError(t+" is not an object!");return t}},function(t,n){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n){var r=0,e=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++r+e).toString(36))}},function(t,n){var r={}.hasOwnProperty;t.exports=function(t,n){return r.call(t,n)}},function(t,n){var r=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=r)},function(t,n){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,n,r){var e=r(11),i=r(66);t.exports=r(10)?function(t,n,r){return e.f(t,n,i(1,r))}:function(t,n,r){return t[n]=r,t}},function(t,n,r){var e=r(3),i=r(27),o=r(24),u=r(76)("src"),c="toString",f=Function[c],a=(""+f).split(c);r(52).inspectSource=function(t){return f.call(t)},(t.exports=function(t,n,r,c){var f="function"==typeof r;f&&(o(r,"name")||i(r,"name",n)),t[n]!==r&&(f&&(o(r,u)||i(r,u,t[n]?""+t[n]:a.join(String(n)))),t===e?t[n]=r:c?t[n]?t[n]=r:i(t,n,r):(delete t[n],i(t,n,r)))})(Function.prototype,c,function(){return"function"==typeof this&&this[u]||f.call(this)})},function(t,n,r){var e=r(1),i=r(4),o=r(46),u=function(t,n,r,e){var i=String(o(t)),u="<"+n;return""!==r&&(u+=" "+r+'="'+String(e).replace(/"/g,"&quot;")+'"'),u+">"+i+"</"+n+">"};t.exports=function(t,n){var r={};r[t]=n(u),e(e.P+e.F*i(function(){var n=""[t]('"');return n!==n.toLowerCase()||n.split('"').length>3}),"String",r)}},function(t,n,r){var e=r(115),i=r(46);t.exports=function(t){return e(i(t))}},function(t,n,r){var e=r(116),i=r(66),o=r(30),u=r(50),c=r(24),f=r(167),a=Object.getOwnPropertyDescriptor;n.f=r(10)?a:function(t,n){if(t=o(t),n=u(n,!0),f)try{return a(t,n)}catch(t){}if(c(t,n))return i(!e.f.call(t,n),t[n])}},function(t,n,r){var e=r(24),i=r(17),o=r(145)("IE_PROTO"),u=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=i(t),e(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,n){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,n){t.exports={}},function(t,n){t.exports=!0},function(t,n){n.f={}.propertyIsEnumerable},function(t,n,r){var e=r(14).f,i=r(8),o=r(15)("toStringTag");t.exports=function(t,n,r){t&&!i(t=r?t:t.prototype,o)&&e(t,o,{configurable:!0,value:n})}},function(t,n,r){var e=r(40)("keys"),i=r(23);t.exports=function(t){return e[t]||(e[t]=i(t))}},function(t,n,r){var e=r(5),i="__core-js_shared__",o=e[i]||(e[i]={});t.exports=function(t){return o[t]||(o[t]={})}},function(t,n){var r=Math.ceil,e=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?e:r)(t)}},function(t,n,r){var e=r(21);t.exports=function(t,n){if(!e(t))return t;var r,i;if(n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;if("function"==typeof(r=t.valueOf)&&!e(i=r.call(t)))return i;if(!n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;throw TypeError("Can't convert object to primitive value")}},function(t,n,r){var e=r(5),i=r(25),o=r(36),u=r(44),c=r(14).f;t.exports=function(t){var n=i.Symbol||(i.Symbol=o?{}:e.Symbol||{});"_"==t.charAt(0)||t in n||c(n,t,{value:u.f(t)})}},function(t,n,r){n.f=r(15)},function(t,n){var r={}.toString;t.exports=function(t){return r.call(t).slice(8,-1)}},function(t,n){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,n,r){var e=r(4);t.exports=function(t,n){return!!t&&e(function(){n?t.call(null,function(){},1):t.call(null)})}},function(t,n,r){var e=r(53),i=r(115),o=r(17),u=r(16),c=r(202);t.exports=function(t,n){var r=1==t,f=2==t,a=3==t,s=4==t,l=6==t,h=5==t||l,v=n||c;return function(n,c,p){for(var d,y,g=o(n),b=i(g),m=e(c,p,3),x=u(b.length),w=0,S=r?v(n,x):f?v(n,0):void 0;x>w;w++)if((h||w in b)&&(d=b[w],y=m(d,w,g),t))if(r)S[w]=y;else if(y)switch(t){case 3:return!0;case 5:return d;case 6:return w;case 2:S.push(d)}else if(s)return!1;return l?-1:a||s?s:S}}},function(t,n,r){var e=r(1),i=r(52),o=r(4);t.exports=function(t,n){var r=(i.Object||{})[t]||Object[t],u={};u[t]=n(r),e(e.S+e.F*o(function(){r(1)}),"Object",u)}},function(t,n,r){var e=r(6);t.exports=function(t,n){if(!e(t))return t;var r,i;if(n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;if("function"==typeof(r=t.valueOf)&&!e(i=r.call(t)))return i;if(!n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;throw TypeError("Can't convert object to primitive value")}},function(t,n,r){var e=r(5),i=r(25),o=r(91),u=r(13),c="prototype",f=function(t,n,r){var a,s,l,h=t&f.F,v=t&f.G,p=t&f.S,d=t&f.P,y=t&f.B,g=t&f.W,b=v?i:i[n]||(i[n]={}),m=b[c],x=v?e:p?e[n]:(e[n]||{})[c];v&&(r=n);for(a in r)(s=!h&&x&&void 0!==x[a])&&a in b||(l=s?x[a]:r[a],b[a]=v&&"function"!=typeof x[a]?r[a]:y&&s?o(l,e):g&&x[a]==l?function(t){var n=function(n,r,e){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,r)}return new t(n,r,e)}return t.apply(this,arguments)};return n[c]=t[c],n}(l):d&&"function"==typeof l?o(Function.call,l):l,d&&((b.virtual||(b.virtual={}))[a]=l,t&f.R&&m&&!m[a]&&u(m,a,l)))};f.F=1,f.G=2,f.S=4,f.P=8,f.B=16,f.W=32,f.U=64,f.R=128,t.exports=f},function(t,n){var r=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=r)},function(t,n,r){var e=r(26);t.exports=function(t,n,r){if(e(t),void 0===n)return t;switch(r){case 1:return function(r){return t.call(n,r)};case 2:return function(r,e){return t.call(n,r,e)};case 3:return function(r,e,i){return t.call(n,r,e,i)}}return function(){return t.apply(n,arguments)}}},function(t,n,r){var e=r(183),i=r(1),o=r(126)("metadata"),u=o.store||(o.store=new(r(186))),c=function(t,n,r){var i=u.get(t);if(!i){if(!r)return;u.set(t,i=new e)}var o=i.get(n);if(!o){if(!r)return;i.set(n,o=new e)}return o},f=function(t,n,r){var e=c(n,r,!1);return void 0!==e&&e.has(t)},a=function(t,n,r){var e=c(n,r,!1);return void 0===e?void 0:e.get(t)},s=function(t,n,r,e){c(r,e,!0).set(t,n)},l=function(t,n){var r=c(t,n,!1),e=[];return r&&r.forEach(function(t,n){e.push(n)}),e},h=function(t){return void 0===t||"symbol"==typeof t?t:String(t)},v=function(t){i(i.S,"Reflect",t)};t.exports={store:u,map:c,has:f,get:a,set:s,keys:l,key:h,exp:v}},function(t,n,r){"use strict";if(r(10)){var e=r(69),i=r(3),o=r(4),u=r(1),c=r(127),f=r(152),a=r(53),s=r(68),l=r(66),h=r(27),v=r(73),p=r(67),d=r(16),y=r(75),g=r(50),b=r(24),m=r(180),x=r(114),w=r(6),S=r(17),_=r(137),O=r(70),E=r(32),P=r(71).f,j=r(154),F=r(76),M=r(7),A=r(48),N=r(117),T=r(146),I=r(155),k=r(80),L=r(123),R=r(74),C=r(130),D=r(160),U=r(11),W=r(31),G=U.f,B=W.f,V=i.RangeError,z=i.TypeError,q=i.Uint8Array,K="ArrayBuffer",J="Shared"+K,Y="BYTES_PER_ELEMENT",H="prototype",$=Array[H],X=f.ArrayBuffer,Q=f.DataView,Z=A(0),tt=A(2),nt=A(3),rt=A(4),et=A(5),it=A(6),ot=N(!0),ut=N(!1),ct=I.values,ft=I.keys,at=I.entries,st=$.lastIndexOf,lt=$.reduce,ht=$.reduceRight,vt=$.join,pt=$.sort,dt=$.slice,yt=$.toString,gt=$.toLocaleString,bt=M("iterator"),mt=M("toStringTag"),xt=F("typed_constructor"),wt=F("def_constructor"),St=c.CONSTR,_t=c.TYPED,Ot=c.VIEW,Et="Wrong length!",Pt=A(1,function(t,n){return Tt(T(t,t[wt]),n)}),jt=o(function(){return 1===new q(new Uint16Array([1]).buffer)[0]}),Ft=!!q&&!!q[H].set&&o(function(){new q(1).set({})}),Mt=function(t,n){if(void 0===t)throw z(Et);var r=+t,e=d(t);if(n&&!m(r,e))throw V(Et);return e},At=function(t,n){var r=p(t);if(r<0||r%n)throw V("Wrong offset!");return r},Nt=function(t){if(w(t)&&_t in t)return t;throw z(t+" is not a typed array!")},Tt=function(t,n){if(!(w(t)&&xt in t))throw z("It is not a typed array constructor!");return new t(n)},It=function(t,n){return kt(T(t,t[wt]),n)},kt=function(t,n){for(var r=0,e=n.length,i=Tt(t,e);e>r;)i[r]=n[r++];return i},Lt=function(t,n,r){G(t,n,{get:function(){return this._d[r]}})},Rt=function(t){var n,r,e,i,o,u,c=S(t),f=arguments.length,s=f>1?arguments[1]:void 0,l=void 0!==s,h=j(c);if(void 0!=h&&!_(h)){for(u=h.call(c),e=[],n=0;!(o=u.next()).done;n++)e.push(o.value);c=e}for(l&&f>2&&(s=a(s,arguments[2],2)),n=0,r=d(c.length),i=Tt(this,r);r>n;n++)i[n]=l?s(c[n],n):c[n];return i},Ct=function(){for(var t=0,n=arguments.length,r=Tt(this,n);n>t;)r[t]=arguments[t++];return r},Dt=!!q&&o(function(){gt.call(new q(1))}),Ut=function(){return gt.apply(Dt?dt.call(Nt(this)):Nt(this),arguments)},Wt={copyWithin:function(t,n){return D.call(Nt(this),t,n,arguments.length>2?arguments[2]:void 0)},every:function(t){return rt(Nt(this),t,arguments.length>1?arguments[1]:void 0)},fill:function(t){return C.apply(Nt(this),arguments)},filter:function(t){return It(this,tt(Nt(this),t,arguments.length>1?arguments[1]:void 0))},find:function(t){return et(Nt(this),t,arguments.length>1?arguments[1]:void 0)},findIndex:function(t){return it(Nt(this),t,arguments.length>1?arguments[1]:void 0)},forEach:function(t){Z(Nt(this),t,arguments.length>1?arguments[1]:void 0)},indexOf:function(t){return ut(Nt(this),t,arguments.length>1?arguments[1]:void 0)},includes:function(t){return ot(Nt(this),t,arguments.length>1?arguments[1]:void 0)},join:function(t){return vt.apply(Nt(this),arguments)},lastIndexOf:function(t){return st.apply(Nt(this),arguments)},map:function(t){return Pt(Nt(this),t,arguments.length>1?arguments[1]:void 0)},reduce:function(t){return lt.apply(Nt(this),arguments)},reduceRight:function(t){return ht.apply(Nt(this),arguments)},reverse:function(){for(var t,n=this,r=Nt(n).length,e=Math.floor(r/2),i=0;i<e;)t=n[i],n[i++]=n[--r],n[r]=t;return n},some:function(t){return nt(Nt(this),t,arguments.length>1?arguments[1]:void 0)},sort:function(t){return pt.call(Nt(this),t)},subarray:function(t,n){var r=Nt(this),e=r.length,i=y(t,e);return new(T(r,r[wt]))(r.buffer,r.byteOffset+i*r.BYTES_PER_ELEMENT,d((void 0===n?e:y(n,e))-i))}},Gt=function(t,n){return It(this,dt.call(Nt(this),t,n))},Bt=function(t){Nt(this);var n=At(arguments[1],1),r=this.length,e=S(t),i=d(e.length),o=0;if(i+n>r)throw V(Et);for(;o<i;)this[n+o]=e[o++]},Vt={entries:function(){return at.call(Nt(this))},keys:function(){return ft.call(Nt(this))},values:function(){return ct.call(Nt(this))}},zt=function(t,n){return w(t)&&t[_t]&&"symbol"!=typeof n&&n in t&&String(+n)==String(n)},qt=function(t,n){return zt(t,n=g(n,!0))?l(2,t[n]):B(t,n)},Kt=function(t,n,r){return!(zt(t,n=g(n,!0))&&w(r)&&b(r,"value"))||b(r,"get")||b(r,"set")||r.configurable||b(r,"writable")&&!r.writable||b(r,"enumerable")&&!r.enumerable?G(t,n,r):(t[n]=r.value,t)};St||(W.f=qt,U.f=Kt),u(u.S+u.F*!St,"Object",{getOwnPropertyDescriptor:qt,defineProperty:Kt}),o(function(){yt.call({})})&&(yt=gt=function(){return vt.call(this)});var Jt=v({},Wt);v(Jt,Vt),h(Jt,bt,Vt.values),v(Jt,{slice:Gt,set:Bt,constructor:function(){},toString:yt,toLocaleString:Ut}),Lt(Jt,"buffer","b"),Lt(Jt,"byteOffset","o"),Lt(Jt,"byteLength","l"),Lt(Jt,"length","e"),G(Jt,mt,{get:function(){return this[_t]}}),t.exports=function(t,n,r,f){f=!!f;var a=t+(f?"Clamped":"")+"Array",l="Uint8Array"!=a,v="get"+t,p="set"+t,y=i[a],g=y||{},b=y&&E(y),m=!y||!c.ABV,S={},_=y&&y[H],j=function(t,r){var e=t._d;return e.v[v](r*n+e.o,jt)},F=function(t,r,e){var i=t._d;f&&(e=(e=Math.round(e))<0?0:e>255?255:255&e),i.v[p](r*n+i.o,e,jt)},M=function(t,n){G(t,n,{get:function(){return j(this,n)},set:function(t){return F(this,n,t)},enumerable:!0})};m?(y=r(function(t,r,e,i){s(t,y,a,"_d");var o,u,c,f,l=0,v=0;if(w(r)){if(!(r instanceof X||(f=x(r))==K||f==J))return _t in r?kt(y,r):Rt.call(y,r);o=r,v=At(e,n);var p=r.byteLength;if(void 0===i){if(p%n)throw V(Et);if((u=p-v)<0)throw V(Et)}else if((u=d(i)*n)+v>p)throw V(Et);c=u/n}else c=Mt(r,!0),u=c*n,o=new X(u);for(h(t,"_d",{b:o,o:v,l:u,e:c,v:new Q(o)});l<c;)M(t,l++)}),_=y[H]=O(Jt),h(_,"constructor",y)):L(function(t){new y(null),new y(t)},!0)||(y=r(function(t,r,e,i){s(t,y,a);var o;return w(r)?r instanceof X||(o=x(r))==K||o==J?void 0!==i?new g(r,At(e,n),i):void 0!==e?new g(r,At(e,n)):new g(r):_t in r?kt(y,r):Rt.call(y,r):new g(Mt(r,l))}),Z(b!==Function.prototype?P(g).concat(P(b)):P(g),function(t){t in y||h(y,t,g[t])}),y[H]=_,e||(_.constructor=y));var A=_[bt],N=!!A&&("values"==A.name||void 0==A.name),T=Vt.values;h(y,xt,!0),h(_,_t,a),h(_,Ot,!0),h(_,wt,y),(f?new y(1)[mt]==a:mt in _)||G(_,mt,{get:function(){return a}}),S[a]=y,u(u.G+u.W+u.F*(y!=g),S),u(u.S,a,{BYTES_PER_ELEMENT:n,from:Rt,of:Ct}),Y in _||h(_,Y,n),u(u.P,a,Wt),R(a),u(u.P+u.F*Ft,a,{set:Bt}),u(u.P+u.F*!N,a,Vt),u(u.P+u.F*(_.toString!=yt),a,{toString:yt}),u(u.P+u.F*o(function(){new y(1).slice()}),a,{slice:Gt}),u(u.P+u.F*(o(function(){return[1,2].toLocaleString()!=new y([1,2]).toLocaleString()})||!o(function(){_.toLocaleString.call([1,2])})),a,{toLocaleString:Ut}),k[a]=N?A:T,e||N||h(_,bt,T)}}else t.exports=function(){}},function(t,n){var r={}.toString;t.exports=function(t){return r.call(t).slice(8,-1)}},function(t,n,r){var e=r(21),i=r(5).document,o=e(i)&&e(i.createElement);t.exports=function(t){return o?i.createElement(t):{}}},function(t,n,r){t.exports=!r(12)&&!r(18)(function(){return 7!=Object.defineProperty(r(57)("div"),"a",{get:function(){return 7}}).a})},function(t,n,r){"use strict";var e=r(36),i=r(51),o=r(64),u=r(13),c=r(8),f=r(35),a=r(96),s=r(38),l=r(103),h=r(15)("iterator"),v=!([].keys&&"next"in[].keys()),p="keys",d="values",y=function(){return this};t.exports=function(t,n,r,g,b,m,x){a(r,n,g);var w,S,_,O=function(t){if(!v&&t in F)return F[t];switch(t){case p:case d:return function(){return new r(this,t)}}return function(){return new r(this,t)}},E=n+" Iterator",P=b==d,j=!1,F=t.prototype,M=F[h]||F["@@iterator"]||b&&F[b],A=M||O(b),N=b?P?O("entries"):A:void 0,T="Array"==n?F.entries||M:M;if(T&&(_=l(T.call(new t)))!==Object.prototype&&(s(_,E,!0),e||c(_,h)||u(_,h,y)),P&&M&&M.name!==d&&(j=!0,A=function(){return M.call(this)}),e&&!x||!v&&!j&&F[h]||u(F,h,A),f[n]=A,f[E]=y,b)if(w={values:P?A:O(d),keys:m?A:O(p),entries:N},x)for(S in w)S in F||o(F,S,w[S]);else i(i.P+i.F*(v||j),n,w);return w}},function(t,n,r){var e=r(20),i=r(100),o=r(34),u=r(39)("IE_PROTO"),c=function(){},f="prototype",a=function(){var t,n=r(57)("iframe"),e=o.length;for(n.style.display="none",r(93).appendChild(n),n.src="javascript:",t=n.contentWindow.document,t.open(),t.write("<script>document.F=Object<\/script>"),t.close(),a=t.F;e--;)delete a[f][o[e]];return a()};t.exports=Object.create||function(t,n){var r;return null!==t?(c[f]=e(t),r=new c,c[f]=null,r[u]=t):r=a(),void 0===n?r:i(r,n)}},function(t,n,r){var e=r(63),i=r(34).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return e(t,i)}},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,r){var e=r(8),i=r(9),o=r(90)(!1),u=r(39)("IE_PROTO");t.exports=function(t,n){var r,c=i(t),f=0,a=[];for(r in c)r!=u&&e(c,r)&&a.push(r);for(;n.length>f;)e(c,r=n[f++])&&(~o(a,r)||a.push(r));return a}},function(t,n,r){t.exports=r(13)},function(t,n,r){var e=r(76)("meta"),i=r(6),o=r(24),u=r(11).f,c=0,f=Object.isExtensible||function(){return!0},a=!r(4)(function(){return f(Object.preventExtensions({}))}),s=function(t){u(t,e,{value:{i:"O"+ ++c,w:{}}})},l=function(t,n){if(!i(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,e)){if(!f(t))return"F";if(!n)return"E";s(t)}return t[e].i},h=function(t,n){if(!o(t,e)){if(!f(t))return!0;if(!n)return!1;s(t)}return t[e].w},v=function(t){return a&&p.NEED&&f(t)&&!o(t,e)&&s(t),t},p=t.exports={KEY:e,NEED:!1,fastKey:l,getWeak:h,onFreeze:v}},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n){var r=Math.ceil,e=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?e:r)(t)}},function(t,n){t.exports=function(t,n,r,e){if(!(t instanceof n)||void 0!==e&&e in t)throw TypeError(r+": incorrect invocation!");return t}},function(t,n){t.exports=!1},function(t,n,r){var e=r(2),i=r(173),o=r(133),u=r(145)("IE_PROTO"),c=function(){},f="prototype",a=function(){var t,n=r(132)("iframe"),e=o.length;for(n.style.display="none",r(135).appendChild(n),n.src="javascript:",t=n.contentWindow.document,t.open(),t.write("<script>document.F=Object<\/script>"),t.close(),a=t.F;e--;)delete a[f][o[e]];return a()};t.exports=Object.create||function(t,n){var r;return null!==t?(c[f]=e(t),r=new c,c[f]=null,r[u]=t):r=a(),void 0===n?r:i(r,n)}},function(t,n,r){var e=r(175),i=r(133).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return e(t,i)}},function(t,n,r){var e=r(175),i=r(133);t.exports=Object.keys||function(t){return e(t,i)}},function(t,n,r){var e=r(28);t.exports=function(t,n,r){for(var i in n)e(t,i,n[i],r);return t}},function(t,n,r){"use strict";var e=r(3),i=r(11),o=r(10),u=r(7)("species");t.exports=function(t){var n=e[t];o&&n&&!n[u]&&i.f(n,u,{configurable:!0,get:function(){return this}})}},function(t,n,r){var e=r(67),i=Math.max,o=Math.min;t.exports=function(t,n){return t=e(t),t<0?i(t+n,0):o(t,n)}},function(t,n){var r=0,e=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++r+e).toString(36))}},function(t,n,r){var e=r(33);t.exports=function(t){return Object(e(t))}},function(t,n,r){var e=r(7)("unscopables"),i=Array.prototype;void 0==i[e]&&r(27)(i,e,{}),t.exports=function(t){i[e][t]=!0}},function(t,n,r){var e=r(53),i=r(169),o=r(137),u=r(2),c=r(16),f=r(154),a={},s={},n=t.exports=function(t,n,r,l,h){var v,p,d,y,g=h?function(){return t}:f(t),b=e(r,l,n?2:1),m=0;if("function"!=typeof g)throw TypeError(t+" is not iterable!");if(o(g)){for(v=c(t.length);v>m;m++)if((y=n?b(u(p=t[m])[0],p[1]):b(t[m]))===a||y===s)return y}else for(d=g.call(t);!(p=d.next()).done;)if((y=i(d,b,p.value,n))===a||y===s)return y};n.BREAK=a,n.RETURN=s},function(t,n){t.exports={}},function(t,n,r){var e=r(11).f,i=r(24),o=r(7)("toStringTag");t.exports=function(t,n,r){t&&!i(t=r?t:t.prototype,o)&&e(t,o,{configurable:!0,value:n})}},function(t,n,r){var e=r(1),i=r(46),o=r(4),u=r(150),c="["+u+"]",f="​",a=RegExp("^"+c+c+"*"),s=RegExp(c+c+"*$"),l=function(t,n,r){var i={},c=o(function(){return!!u[t]()||f[t]()!=f}),a=i[t]=c?n(h):u[t];r&&(i[r]=a),e(e.P+e.F*c,"String",i)},h=l.trim=function(t,n){return t=String(i(t)),1&n&&(t=t.replace(a,"")),2&n&&(t=t.replace(s,"")),t};t.exports=l},function(t,n,r){t.exports={default:r(86),__esModule:!0}},function(t,n,r){t.exports={default:r(87),__esModule:!0}},function(t,n,r){"use strict";function e(t){return t&&t.__esModule?t:{default:t}}n.__esModule=!0;var i=r(84),o=e(i),u=r(83),c=e(u),f="function"==typeof c.default&&"symbol"==typeof o.default?function(t){return typeof t}:function(t){return t&&"function"==typeof c.default&&t.constructor===c.default&&t!==c.default.prototype?"symbol":typeof t};n.default="function"==typeof c.default&&"symbol"===f(o.default)?function(t){return void 0===t?"undefined":f(t)}:function(t){return t&&"function"==typeof c.default&&t.constructor===c.default&&t!==c.default.prototype?"symbol":void 0===t?"undefined":f(t)}},function(t,n,r){r(110),r(108),r(111),r(112),t.exports=r(25).Symbol},function(t,n,r){r(109),r(113),t.exports=r(44).f("iterator")},function(t,n){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,n){t.exports=function(){}},function(t,n,r){var e=r(9),i=r(106),o=r(105);t.exports=function(t){return function(n,r,u){var c,f=e(n),a=i(f.length),s=o(u,a);if(t&&r!=r){for(;a>s;)if((c=f[s++])!=c)return!0}else for(;a>s;s++)if((t||s in f)&&f[s]===r)return t||s||0;return!t&&-1}}},function(t,n,r){var e=r(88);t.exports=function(t,n,r){if(e(t),void 0===n)return t;switch(r){case 1:return function(r){return t.call(n,r)};case 2:return function(r,e){return t.call(n,r,e)};case 3:return function(r,e,i){return t.call(n,r,e,i)}}return function(){return t.apply(n,arguments)}}},function(t,n,r){var e=r(19),i=r(62),o=r(37);t.exports=function(t){var n=e(t),r=i.f;if(r)for(var u,c=r(t),f=o.f,a=0;c.length>a;)f.call(t,u=c[a++])&&n.push(u);return n}},function(t,n,r){t.exports=r(5).document&&document.documentElement},function(t,n,r){var e=r(56);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==e(t)?t.split(""):Object(t)}},function(t,n,r){var e=r(56);t.exports=Array.isArray||function(t){return"Array"==e(t)}},function(t,n,r){"use strict";var e=r(60),i=r(22),o=r(38),u={};r(13)(u,r(15)("iterator"),function(){return this}),t.exports=function(t,n,r){t.prototype=e(u,{next:i(1,r)}),o(t,n+" Iterator")}},function(t,n){t.exports=function(t,n){return{value:n,done:!!t}}},function(t,n,r){var e=r(19),i=r(9);t.exports=function(t,n){for(var r,o=i(t),u=e(o),c=u.length,f=0;c>f;)if(o[r=u[f++]]===n)return r}},function(t,n,r){var e=r(23)("meta"),i=r(21),o=r(8),u=r(14).f,c=0,f=Object.isExtensible||function(){return!0},a=!r(18)(function(){return f(Object.preventExtensions({}))}),s=function(t){u(t,e,{value:{i:"O"+ ++c,w:{}}})},l=function(t,n){if(!i(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,e)){if(!f(t))return"F";if(!n)return"E";s(t)}return t[e].i},h=function(t,n){if(!o(t,e)){if(!f(t))return!0;if(!n)return!1;s(t)}return t[e].w},v=function(t){return a&&p.NEED&&f(t)&&!o(t,e)&&s(t),t},p=t.exports={KEY:e,NEED:!1,fastKey:l,getWeak:h,onFreeze:v}},function(t,n,r){var e=r(14),i=r(20),o=r(19);t.exports=r(12)?Object.defineProperties:function(t,n){i(t);for(var r,u=o(n),c=u.length,f=0;c>f;)e.f(t,r=u[f++],n[r]);return t}},function(t,n,r){var e=r(37),i=r(22),o=r(9),u=r(42),c=r(8),f=r(58),a=Object.getOwnPropertyDescriptor;n.f=r(12)?a:function(t,n){if(t=o(t),n=u(n,!0),f)try{return a(t,n)}catch(t){}if(c(t,n))return i(!e.f.call(t,n),t[n])}},function(t,n,r){var e=r(9),i=r(61).f,o={}.toString,u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],c=function(t){try{return i(t)}catch(t){return u.slice()}};t.exports.f=function(t){return u&&"[object Window]"==o.call(t)?c(t):i(e(t))}},function(t,n,r){var e=r(8),i=r(77),o=r(39)("IE_PROTO"),u=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=i(t),e(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,n,r){var e=r(41),i=r(33);t.exports=function(t){return function(n,r){var o,u,c=String(i(n)),f=e(r),a=c.length;return f<0||f>=a?t?"":void 0:(o=c.charCodeAt(f),o<55296||o>56319||f+1===a||(u=c.charCodeAt(f+1))<56320||u>57343?t?c.charAt(f):o:t?c.slice(f,f+2):u-56320+(o-55296<<10)+65536)}}},function(t,n,r){var e=r(41),i=Math.max,o=Math.min;t.exports=function(t,n){return t=e(t),t<0?i(t+n,0):o(t,n)}},function(t,n,r){var e=r(41),i=Math.min;t.exports=function(t){return t>0?i(e(t),9007199254740991):0}},function(t,n,r){"use strict";var e=r(89),i=r(97),o=r(35),u=r(9);t.exports=r(59)(Array,"Array",function(t,n){this._t=u(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,r=this._i++;return!t||r>=t.length?(this._t=void 0,i(1)):"keys"==n?i(0,r):"values"==n?i(0,t[r]):i(0,[r,t[r]])},"values"),o.Arguments=o.Array,e("keys"),e("values"),e("entries")},function(t,n){},function(t,n,r){"use strict";var e=r(104)(!0);r(59)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,r=this._i;return r>=n.length?{value:void 0,done:!0}:(t=e(n,r),this._i+=t.length,{value:t,done:!1})})},function(t,n,r){"use strict";var e=r(5),i=r(8),o=r(12),u=r(51),c=r(64),f=r(99).KEY,a=r(18),s=r(40),l=r(38),h=r(23),v=r(15),p=r(44),d=r(43),y=r(98),g=r(92),b=r(95),m=r(20),x=r(9),w=r(42),S=r(22),_=r(60),O=r(102),E=r(101),P=r(14),j=r(19),F=E.f,M=P.f,A=O.f,N=e.Symbol,T=e.JSON,I=T&&T.stringify,k="prototype",L=v("_hidden"),R=v("toPrimitive"),C={}.propertyIsEnumerable,D=s("symbol-registry"),U=s("symbols"),W=s("op-symbols"),G=Object[k],B="function"==typeof N,V=e.QObject,z=!V||!V[k]||!V[k].findChild,q=o&&a(function(){return 7!=_(M({},"a",{get:function(){return M(this,"a",{value:7}).a}})).a})?function(t,n,r){var e=F(G,n);e&&delete G[n],M(t,n,r),e&&t!==G&&M(G,n,e)}:M,K=function(t){var n=U[t]=_(N[k]);return n._k=t,n},J=B&&"symbol"==typeof N.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof N},Y=function(t,n,r){return t===G&&Y(W,n,r),m(t),n=w(n,!0),m(r),i(U,n)?(r.enumerable?(i(t,L)&&t[L][n]&&(t[L][n]=!1),r=_(r,{enumerable:S(0,!1)})):(i(t,L)||M(t,L,S(1,{})),t[L][n]=!0),q(t,n,r)):M(t,n,r)},H=function(t,n){m(t);for(var r,e=g(n=x(n)),i=0,o=e.length;o>i;)Y(t,r=e[i++],n[r]);return t},$=function(t,n){return void 0===n?_(t):H(_(t),n)},X=function(t){var n=C.call(this,t=w(t,!0));return!(this===G&&i(U,t)&&!i(W,t))&&(!(n||!i(this,t)||!i(U,t)||i(this,L)&&this[L][t])||n)},Q=function(t,n){if(t=x(t),n=w(n,!0),t!==G||!i(U,n)||i(W,n)){var r=F(t,n);return!r||!i(U,n)||i(t,L)&&t[L][n]||(r.enumerable=!0),r}},Z=function(t){for(var n,r=A(x(t)),e=[],o=0;r.length>o;)i(U,n=r[o++])||n==L||n==f||e.push(n);return e},tt=function(t){for(var n,r=t===G,e=A(r?W:x(t)),o=[],u=0;e.length>u;)!i(U,n=e[u++])||r&&!i(G,n)||o.push(U[n]);return o};B||(N=function(){if(this instanceof N)throw TypeError("Symbol is not a constructor!");var t=h(arguments.length>0?arguments[0]:void 0),n=function(r){this===G&&n.call(W,r),i(this,L)&&i(this[L],t)&&(this[L][t]=!1),q(this,t,S(1,r))};return o&&z&&q(G,t,{configurable:!0,set:n}),K(t)},c(N[k],"toString",function(){return this._k}),E.f=Q,P.f=Y,r(61).f=O.f=Z,r(37).f=X,r(62).f=tt,o&&!r(36)&&c(G,"propertyIsEnumerable",X,!0),p.f=function(t){return K(v(t))}),u(u.G+u.W+u.F*!B,{Symbol:N});for(var nt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),rt=0;nt.length>rt;)v(nt[rt++]);for(var nt=j(v.store),rt=0;nt.length>rt;)d(nt[rt++]);u(u.S+u.F*!B,"Symbol",{for:function(t){return i(D,t+="")?D[t]:D[t]=N(t)},keyFor:function(t){if(J(t))return y(D,t);throw TypeError(t+" is not a symbol!")},useSetter:function(){z=!0},useSimple:function(){z=!1}}),u(u.S+u.F*!B,"Object",{create:$,defineProperty:Y,defineProperties:H,getOwnPropertyDescriptor:Q,getOwnPropertyNames:Z,getOwnPropertySymbols:tt}),T&&u(u.S+u.F*(!B||a(function(){var t=N();return"[null]"!=I([t])||"{}"!=I({a:t})||"{}"!=I(Object(t))})),"JSON",{stringify:function(t){if(void 0!==t&&!J(t)){for(var n,r,e=[t],i=1;arguments.length>i;)e.push(arguments[i++]);return n=e[1],"function"==typeof n&&(r=n),!r&&b(n)||(n=function(t,n){if(r&&(n=r.call(this,t,n)),!J(n))return n}),e[1]=n,I.apply(T,e)}}}),N[k][R]||r(13)(N[k],R,N[k].valueOf),l(N,"Symbol"),l(Math,"Math",!0),l(e.JSON,"JSON",!0)},function(t,n,r){r(43)("asyncIterator")},function(t,n,r){r(43)("observable")},function(t,n,r){r(107);for(var e=r(5),i=r(13),o=r(35),u=r(15)("toStringTag"),c=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],f=0;f<5;f++){var a=c[f],s=e[a],l=s&&s.prototype;l&&!l[u]&&i(l,u,a),o[a]=o.Array}},function(t,n,r){var e=r(45),i=r(7)("toStringTag"),o="Arguments"==e(function(){return arguments}()),u=function(t,n){try{return t[n]}catch(t){}};t.exports=function(t){var n,r,c;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=u(n=Object(t),i))?r:o?e(n):"Object"==(c=e(n))&&"function"==typeof n.callee?"Arguments":c}},function(t,n,r){var e=r(45);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==e(t)?t.split(""):Object(t)}},function(t,n){n.f={}.propertyIsEnumerable},function(t,n,r){var e=r(30),i=r(16),o=r(75);t.exports=function(t){return function(n,r,u){var c,f=e(n),a=i(f.length),s=o(u,a);if(t&&r!=r){for(;a>s;)if((c=f[s++])!=c)return!0}else for(;a>s;s++)if((t||s in f)&&f[s]===r)return t||s||0;return!t&&-1}}},function(t,n,r){"use strict";var e=r(3),i=r(1),o=r(28),u=r(73),c=r(65),f=r(79),a=r(68),s=r(6),l=r(4),h=r(123),v=r(81),p=r(136);t.exports=function(t,n,r,d,y,g){var b=e[t],m=b,x=y?"set":"add",w=m&&m.prototype,S={},_=function(t){var n=w[t];o(w,t,"delete"==t?function(t){return!(g&&!s(t))&&n.call(this,0===t?0:t)}:"has"==t?function(t){return!(g&&!s(t))&&n.call(this,0===t?0:t)}:"get"==t?function(t){return g&&!s(t)?void 0:n.call(this,0===t?0:t)}:"add"==t?function(t){return n.call(this,0===t?0:t),this}:function(t,r){return n.call(this,0===t?0:t,r),this})};if("function"==typeof m&&(g||w.forEach&&!l(function(){(new m).entries().next()}))){var O=new m,E=O[x](g?{}:-0,1)!=O,P=l(function(){O.has(1)}),j=h(function(t){new m(t)}),F=!g&&l(function(){for(var t=new m,n=5;n--;)t[x](n,n);return!t.has(-0)});j||(m=n(function(n,r){a(n,m,t);var e=p(new b,n,m);return void 0!=r&&f(r,y,e[x],e),e}),m.prototype=w,w.constructor=m),(P||F)&&(_("delete"),_("has"),y&&_("get")),(F||E)&&_(x),g&&w.clear&&delete w.clear}else m=d.getConstructor(n,t,y,x),u(m.prototype,r),c.NEED=!0;return v(m,t),S[t]=m,i(i.G+i.W+i.F*(m!=b),S),g||d.setStrong(m,t,y),m}},function(t,n,r){"use strict";var e=r(27),i=r(28),o=r(4),u=r(46),c=r(7);t.exports=function(t,n,r){var f=c(t),a=r(u,f,""[t]),s=a[0],l=a[1];o(function(){var n={};return n[f]=function(){return 7},7!=""[t](n)})&&(i(String.prototype,t,s),e(RegExp.prototype,f,2==n?function(t,n){return l.call(t,this,n)}:function(t){return l.call(t,this)}))}
},function(t,n,r){"use strict";var e=r(2);t.exports=function(){var t=e(this),n="";return t.global&&(n+="g"),t.ignoreCase&&(n+="i"),t.multiline&&(n+="m"),t.unicode&&(n+="u"),t.sticky&&(n+="y"),n}},function(t,n){t.exports=function(t,n,r){var e=void 0===r;switch(n.length){case 0:return e?t():t.call(r);case 1:return e?t(n[0]):t.call(r,n[0]);case 2:return e?t(n[0],n[1]):t.call(r,n[0],n[1]);case 3:return e?t(n[0],n[1],n[2]):t.call(r,n[0],n[1],n[2]);case 4:return e?t(n[0],n[1],n[2],n[3]):t.call(r,n[0],n[1],n[2],n[3])}return t.apply(r,n)}},function(t,n,r){var e=r(6),i=r(45),o=r(7)("match");t.exports=function(t){var n;return e(t)&&(void 0!==(n=t[o])?!!n:"RegExp"==i(t))}},function(t,n,r){var e=r(7)("iterator"),i=!1;try{var o=[7][e]();o.return=function(){i=!0},Array.from(o,function(){throw 2})}catch(t){}t.exports=function(t,n){if(!n&&!i)return!1;var r=!1;try{var o=[7],u=o[e]();u.next=function(){return{done:r=!0}},o[e]=function(){return u},t(o)}catch(t){}return r}},function(t,n,r){t.exports=r(69)||!r(4)(function(){var t=Math.random();__defineSetter__.call(null,t,function(){}),delete r(3)[t]})},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,r){var e=r(3),i="__core-js_shared__",o=e[i]||(e[i]={});t.exports=function(t){return o[t]||(o[t]={})}},function(t,n,r){for(var e,i=r(3),o=r(27),u=r(76),c=u("typed_array"),f=u("view"),a=!(!i.ArrayBuffer||!i.DataView),s=a,l=0,h="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");l<9;)(e=i[h[l++]])?(o(e.prototype,c,!0),o(e.prototype,f,!0)):s=!1;t.exports={ABV:a,CONSTR:s,TYPED:c,VIEW:f}},function(t,n){"use strict";var r={versions:function(){var t=window.navigator.userAgent;return{trident:t.indexOf("Trident")>-1,presto:t.indexOf("Presto")>-1,webKit:t.indexOf("AppleWebKit")>-1,gecko:t.indexOf("Gecko")>-1&&-1==t.indexOf("KHTML"),mobile:!!t.match(/AppleWebKit.*Mobile.*/),ios:!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:t.indexOf("Android")>-1||t.indexOf("Linux")>-1,iPhone:t.indexOf("iPhone")>-1||t.indexOf("Mac")>-1,iPad:t.indexOf("iPad")>-1,webApp:-1==t.indexOf("Safari"),weixin:-1==t.indexOf("MicroMessenger")}}()};t.exports=r},function(t,n,r){"use strict";var e=r(85),i=function(t){return t&&t.__esModule?t:{default:t}}(e),o=function(){function t(t,n,e){return n||e?String.fromCharCode(n||e):r[t]||t}function n(t){return e[t]}var r={"&quot;":'"',"&lt;":"<","&gt;":">","&amp;":"&","&nbsp;":" "},e={};for(var u in r)e[r[u]]=u;return r["&apos;"]="'",e["'"]="&#39;",{encode:function(t){return t?(""+t).replace(/['<> "&]/g,n).replace(/\r?\n/g,"<br/>").replace(/\s/g,"&nbsp;"):""},decode:function(n){return n?(""+n).replace(/<br\s*\/?>/gi,"\n").replace(/&quot;|&lt;|&gt;|&amp;|&nbsp;|&apos;|&#(\d+);|&#(\d+)/g,t).replace(/\u00a0/g," "):""},encodeBase16:function(t){if(!t)return t;t+="";for(var n=[],r=0,e=t.length;e>r;r++)n.push(t.charCodeAt(r).toString(16).toUpperCase());return n.join("")},encodeBase16forJSON:function(t){if(!t)return t;t=t.replace(/[\u4E00-\u9FBF]/gi,function(t){return escape(t).replace("%u","\\u")});for(var n=[],r=0,e=t.length;e>r;r++)n.push(t.charCodeAt(r).toString(16).toUpperCase());return n.join("")},decodeBase16:function(t){if(!t)return t;t+="";for(var n=[],r=0,e=t.length;e>r;r+=2)n.push(String.fromCharCode("0x"+t.slice(r,r+2)));return n.join("")},encodeObject:function(t){if(t instanceof Array)for(var n=0,r=t.length;r>n;n++)t[n]=o.encodeObject(t[n]);else if("object"==(void 0===t?"undefined":(0,i.default)(t)))for(var e in t)t[e]=o.encodeObject(t[e]);else if("string"==typeof t)return o.encode(t);return t},loadScript:function(t){var n=document.createElement("script");document.getElementsByTagName("body")[0].appendChild(n),n.setAttribute("src",t)},addLoadEvent:function(t){var n=window.onload;"function"!=typeof window.onload?window.onload=t:window.onload=function(){n(),t()}}}}();t.exports=o},function(t,n,r){"use strict";var e=r(17),i=r(75),o=r(16);t.exports=function(t){for(var n=e(this),r=o(n.length),u=arguments.length,c=i(u>1?arguments[1]:void 0,r),f=u>2?arguments[2]:void 0,a=void 0===f?r:i(f,r);a>c;)n[c++]=t;return n}},function(t,n,r){"use strict";var e=r(11),i=r(66);t.exports=function(t,n,r){n in t?e.f(t,n,i(0,r)):t[n]=r}},function(t,n,r){var e=r(6),i=r(3).document,o=e(i)&&e(i.createElement);t.exports=function(t){return o?i.createElement(t):{}}},function(t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,n,r){var e=r(7)("match");t.exports=function(t){var n=/./;try{"/./"[t](n)}catch(r){try{return n[e]=!1,!"/./"[t](n)}catch(t){}}return!0}},function(t,n,r){t.exports=r(3).document&&document.documentElement},function(t,n,r){var e=r(6),i=r(144).set;t.exports=function(t,n,r){var o,u=n.constructor;return u!==r&&"function"==typeof u&&(o=u.prototype)!==r.prototype&&e(o)&&i&&i(t,o),t}},function(t,n,r){var e=r(80),i=r(7)("iterator"),o=Array.prototype;t.exports=function(t){return void 0!==t&&(e.Array===t||o[i]===t)}},function(t,n,r){var e=r(45);t.exports=Array.isArray||function(t){return"Array"==e(t)}},function(t,n,r){"use strict";var e=r(70),i=r(66),o=r(81),u={};r(27)(u,r(7)("iterator"),function(){return this}),t.exports=function(t,n,r){t.prototype=e(u,{next:i(1,r)}),o(t,n+" Iterator")}},function(t,n,r){"use strict";var e=r(69),i=r(1),o=r(28),u=r(27),c=r(24),f=r(80),a=r(139),s=r(81),l=r(32),h=r(7)("iterator"),v=!([].keys&&"next"in[].keys()),p="keys",d="values",y=function(){return this};t.exports=function(t,n,r,g,b,m,x){a(r,n,g);var w,S,_,O=function(t){if(!v&&t in F)return F[t];switch(t){case p:case d:return function(){return new r(this,t)}}return function(){return new r(this,t)}},E=n+" Iterator",P=b==d,j=!1,F=t.prototype,M=F[h]||F["@@iterator"]||b&&F[b],A=M||O(b),N=b?P?O("entries"):A:void 0,T="Array"==n?F.entries||M:M;if(T&&(_=l(T.call(new t)))!==Object.prototype&&(s(_,E,!0),e||c(_,h)||u(_,h,y)),P&&M&&M.name!==d&&(j=!0,A=function(){return M.call(this)}),e&&!x||!v&&!j&&F[h]||u(F,h,A),f[n]=A,f[E]=y,b)if(w={values:P?A:O(d),keys:m?A:O(p),entries:N},x)for(S in w)S in F||o(F,S,w[S]);else i(i.P+i.F*(v||j),n,w);return w}},function(t,n){var r=Math.expm1;t.exports=!r||r(10)>22025.465794806718||r(10)<22025.465794806718||-2e-17!=r(-2e-17)?function(t){return 0==(t=+t)?t:t>-1e-6&&t<1e-6?t+t*t/2:Math.exp(t)-1}:r},function(t,n){t.exports=Math.sign||function(t){return 0==(t=+t)||t!=t?t:t<0?-1:1}},function(t,n,r){var e=r(3),i=r(151).set,o=e.MutationObserver||e.WebKitMutationObserver,u=e.process,c=e.Promise,f="process"==r(45)(u);t.exports=function(){var t,n,r,a=function(){var e,i;for(f&&(e=u.domain)&&e.exit();t;){i=t.fn,t=t.next;try{i()}catch(e){throw t?r():n=void 0,e}}n=void 0,e&&e.enter()};if(f)r=function(){u.nextTick(a)};else if(o){var s=!0,l=document.createTextNode("");new o(a).observe(l,{characterData:!0}),r=function(){l.data=s=!s}}else if(c&&c.resolve){var h=c.resolve();r=function(){h.then(a)}}else r=function(){i.call(e,a)};return function(e){var i={fn:e,next:void 0};n&&(n.next=i),t||(t=i,r()),n=i}}},function(t,n,r){var e=r(6),i=r(2),o=function(t,n){if(i(t),!e(n)&&null!==n)throw TypeError(n+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,n,e){try{e=r(53)(Function.call,r(31).f(Object.prototype,"__proto__").set,2),e(t,[]),n=!(t instanceof Array)}catch(t){n=!0}return function(t,r){return o(t,r),n?t.__proto__=r:e(t,r),t}}({},!1):void 0),check:o}},function(t,n,r){var e=r(126)("keys"),i=r(76);t.exports=function(t){return e[t]||(e[t]=i(t))}},function(t,n,r){var e=r(2),i=r(26),o=r(7)("species");t.exports=function(t,n){var r,u=e(t).constructor;return void 0===u||void 0==(r=e(u)[o])?n:i(r)}},function(t,n,r){var e=r(67),i=r(46);t.exports=function(t){return function(n,r){var o,u,c=String(i(n)),f=e(r),a=c.length;return f<0||f>=a?t?"":void 0:(o=c.charCodeAt(f),o<55296||o>56319||f+1===a||(u=c.charCodeAt(f+1))<56320||u>57343?t?c.charAt(f):o:t?c.slice(f,f+2):u-56320+(o-55296<<10)+65536)}}},function(t,n,r){var e=r(122),i=r(46);t.exports=function(t,n,r){if(e(n))throw TypeError("String#"+r+" doesn't accept regex!");return String(i(t))}},function(t,n,r){"use strict";var e=r(67),i=r(46);t.exports=function(t){var n=String(i(this)),r="",o=e(t);if(o<0||o==1/0)throw RangeError("Count can't be negative");for(;o>0;(o>>>=1)&&(n+=n))1&o&&(r+=n);return r}},function(t,n){t.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},function(t,n,r){var e,i,o,u=r(53),c=r(121),f=r(135),a=r(132),s=r(3),l=s.process,h=s.setImmediate,v=s.clearImmediate,p=s.MessageChannel,d=0,y={},g="onreadystatechange",b=function(){var t=+this;if(y.hasOwnProperty(t)){var n=y[t];delete y[t],n()}},m=function(t){b.call(t.data)};h&&v||(h=function(t){for(var n=[],r=1;arguments.length>r;)n.push(arguments[r++]);return y[++d]=function(){c("function"==typeof t?t:Function(t),n)},e(d),d},v=function(t){delete y[t]},"process"==r(45)(l)?e=function(t){l.nextTick(u(b,t,1))}:p?(i=new p,o=i.port2,i.port1.onmessage=m,e=u(o.postMessage,o,1)):s.addEventListener&&"function"==typeof postMessage&&!s.importScripts?(e=function(t){s.postMessage(t+"","*")},s.addEventListener("message",m,!1)):e=g in a("script")?function(t){f.appendChild(a("script"))[g]=function(){f.removeChild(this),b.call(t)}}:function(t){setTimeout(u(b,t,1),0)}),t.exports={set:h,clear:v}},function(t,n,r){"use strict";var e=r(3),i=r(10),o=r(69),u=r(127),c=r(27),f=r(73),a=r(4),s=r(68),l=r(67),h=r(16),v=r(71).f,p=r(11).f,d=r(130),y=r(81),g="ArrayBuffer",b="DataView",m="prototype",x="Wrong length!",w="Wrong index!",S=e[g],_=e[b],O=e.Math,E=e.RangeError,P=e.Infinity,j=S,F=O.abs,M=O.pow,A=O.floor,N=O.log,T=O.LN2,I="buffer",k="byteLength",L="byteOffset",R=i?"_b":I,C=i?"_l":k,D=i?"_o":L,U=function(t,n,r){var e,i,o,u=Array(r),c=8*r-n-1,f=(1<<c)-1,a=f>>1,s=23===n?M(2,-24)-M(2,-77):0,l=0,h=t<0||0===t&&1/t<0?1:0;for(t=F(t),t!=t||t===P?(i=t!=t?1:0,e=f):(e=A(N(t)/T),t*(o=M(2,-e))<1&&(e--,o*=2),t+=e+a>=1?s/o:s*M(2,1-a),t*o>=2&&(e++,o/=2),e+a>=f?(i=0,e=f):e+a>=1?(i=(t*o-1)*M(2,n),e+=a):(i=t*M(2,a-1)*M(2,n),e=0));n>=8;u[l++]=255&i,i/=256,n-=8);for(e=e<<n|i,c+=n;c>0;u[l++]=255&e,e/=256,c-=8);return u[--l]|=128*h,u},W=function(t,n,r){var e,i=8*r-n-1,o=(1<<i)-1,u=o>>1,c=i-7,f=r-1,a=t[f--],s=127&a;for(a>>=7;c>0;s=256*s+t[f],f--,c-=8);for(e=s&(1<<-c)-1,s>>=-c,c+=n;c>0;e=256*e+t[f],f--,c-=8);if(0===s)s=1-u;else{if(s===o)return e?NaN:a?-P:P;e+=M(2,n),s-=u}return(a?-1:1)*e*M(2,s-n)},G=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},B=function(t){return[255&t]},V=function(t){return[255&t,t>>8&255]},z=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},q=function(t){return U(t,52,8)},K=function(t){return U(t,23,4)},J=function(t,n,r){p(t[m],n,{get:function(){return this[r]}})},Y=function(t,n,r,e){var i=+r,o=l(i);if(i!=o||o<0||o+n>t[C])throw E(w);var u=t[R]._b,c=o+t[D],f=u.slice(c,c+n);return e?f:f.reverse()},H=function(t,n,r,e,i,o){var u=+r,c=l(u);if(u!=c||c<0||c+n>t[C])throw E(w);for(var f=t[R]._b,a=c+t[D],s=e(+i),h=0;h<n;h++)f[a+h]=s[o?h:n-h-1]},$=function(t,n){s(t,S,g);var r=+n,e=h(r);if(r!=e)throw E(x);return e};if(u.ABV){if(!a(function(){new S})||!a(function(){new S(.5)})){S=function(t){return new j($(this,t))};for(var X,Q=S[m]=j[m],Z=v(j),tt=0;Z.length>tt;)(X=Z[tt++])in S||c(S,X,j[X]);o||(Q.constructor=S)}var nt=new _(new S(2)),rt=_[m].setInt8;nt.setInt8(0,2147483648),nt.setInt8(1,2147483649),!nt.getInt8(0)&&nt.getInt8(1)||f(_[m],{setInt8:function(t,n){rt.call(this,t,n<<24>>24)},setUint8:function(t,n){rt.call(this,t,n<<24>>24)}},!0)}else S=function(t){var n=$(this,t);this._b=d.call(Array(n),0),this[C]=n},_=function(t,n,r){s(this,_,b),s(t,S,b);var e=t[C],i=l(n);if(i<0||i>e)throw E("Wrong offset!");if(r=void 0===r?e-i:h(r),i+r>e)throw E(x);this[R]=t,this[D]=i,this[C]=r},i&&(J(S,k,"_l"),J(_,I,"_b"),J(_,k,"_l"),J(_,L,"_o")),f(_[m],{getInt8:function(t){return Y(this,1,t)[0]<<24>>24},getUint8:function(t){return Y(this,1,t)[0]},getInt16:function(t){var n=Y(this,2,t,arguments[1]);return(n[1]<<8|n[0])<<16>>16},getUint16:function(t){var n=Y(this,2,t,arguments[1]);return n[1]<<8|n[0]},getInt32:function(t){return G(Y(this,4,t,arguments[1]))},getUint32:function(t){return G(Y(this,4,t,arguments[1]))>>>0},getFloat32:function(t){return W(Y(this,4,t,arguments[1]),23,4)},getFloat64:function(t){return W(Y(this,8,t,arguments[1]),52,8)},setInt8:function(t,n){H(this,1,t,B,n)},setUint8:function(t,n){H(this,1,t,B,n)},setInt16:function(t,n){H(this,2,t,V,n,arguments[2])},setUint16:function(t,n){H(this,2,t,V,n,arguments[2])},setInt32:function(t,n){H(this,4,t,z,n,arguments[2])},setUint32:function(t,n){H(this,4,t,z,n,arguments[2])},setFloat32:function(t,n){H(this,4,t,K,n,arguments[2])},setFloat64:function(t,n){H(this,8,t,q,n,arguments[2])}});y(S,g),y(_,b),c(_[m],u.VIEW,!0),n[g]=S,n[b]=_},function(t,n,r){var e=r(3),i=r(52),o=r(69),u=r(182),c=r(11).f;t.exports=function(t){var n=i.Symbol||(i.Symbol=o?{}:e.Symbol||{});"_"==t.charAt(0)||t in n||c(n,t,{value:u.f(t)})}},function(t,n,r){var e=r(114),i=r(7)("iterator"),o=r(80);t.exports=r(52).getIteratorMethod=function(t){if(void 0!=t)return t[i]||t["@@iterator"]||o[e(t)]}},function(t,n,r){"use strict";var e=r(78),i=r(170),o=r(80),u=r(30);t.exports=r(140)(Array,"Array",function(t,n){this._t=u(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,r=this._i++;return!t||r>=t.length?(this._t=void 0,i(1)):"keys"==n?i(0,r):"values"==n?i(0,t[r]):i(0,[r,t[r]])},"values"),o.Arguments=o.Array,e("keys"),e("values"),e("entries")},function(t,n){function r(t,n){t.classList?t.classList.add(n):t.className+=" "+n}t.exports=r},function(t,n){function r(t,n){if(t.classList)t.classList.remove(n);else{var r=new RegExp("(^|\\b)"+n.split(" ").join("|")+"(\\b|$)","gi");t.className=t.className.replace(r," ")}}t.exports=r},function(t,n){function r(){throw new Error("setTimeout has not been defined")}function e(){throw new Error("clearTimeout has not been defined")}function i(t){if(s===setTimeout)return setTimeout(t,0);if((s===r||!s)&&setTimeout)return s=setTimeout,setTimeout(t,0);try{return s(t,0)}catch(n){try{return s.call(null,t,0)}catch(n){return s.call(this,t,0)}}}function o(t){if(l===clearTimeout)return clearTimeout(t);if((l===e||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(t);try{return l(t)}catch(n){try{return l.call(null,t)}catch(n){return l.call(this,t)}}}function u(){d&&v&&(d=!1,v.length?p=v.concat(p):y=-1,p.length&&c())}function c(){if(!d){var t=i(u);d=!0;for(var n=p.length;n;){for(v=p,p=[];++y<n;)v&&v[y].run();y=-1,n=p.length}v=null,d=!1,o(t)}}function f(t,n){this.fun=t,this.array=n}function a(){}var s,l,h=t.exports={};!function(){try{s="function"==typeof setTimeout?setTimeout:r}catch(t){s=r}try{l="function"==typeof clearTimeout?clearTimeout:e}catch(t){l=e}}();var v,p=[],d=!1,y=-1;h.nextTick=function(t){var n=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)n[r-1]=arguments[r];p.push(new f(t,n)),1!==p.length||d||i(c)},f.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=a,h.addListener=a,h.once=a,h.off=a,h.removeListener=a,h.removeAllListeners=a,h.emit=a,h.prependListener=a,h.prependOnceListener=a,h.listeners=function(t){return[]},h.binding=function(t){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(t){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(t,n,r){var e=r(45);t.exports=function(t,n){if("number"!=typeof t&&"Number"!=e(t))throw TypeError(n);return+t}},function(t,n,r){"use strict";var e=r(17),i=r(75),o=r(16);t.exports=[].copyWithin||function(t,n){var r=e(this),u=o(r.length),c=i(t,u),f=i(n,u),a=arguments.length>2?arguments[2]:void 0,s=Math.min((void 0===a?u:i(a,u))-f,u-c),l=1;for(f<c&&c<f+s&&(l=-1,f+=s-1,c+=s-1);s-- >0;)f in r?r[c]=r[f]:delete r[c],c+=l,f+=l;return r}},function(t,n,r){var e=r(79);t.exports=function(t,n){var r=[];return e(t,!1,r.push,r,n),r}},function(t,n,r){var e=r(26),i=r(17),o=r(115),u=r(16);t.exports=function(t,n,r,c,f){e(n);var a=i(t),s=o(a),l=u(a.length),h=f?l-1:0,v=f?-1:1;if(r<2)for(;;){if(h in s){c=s[h],h+=v;break}if(h+=v,f?h<0:l<=h)throw TypeError("Reduce of empty array with no initial value")}for(;f?h>=0:l>h;h+=v)h in s&&(c=n(c,s[h],h,a));return c}},function(t,n,r){"use strict";var e=r(26),i=r(6),o=r(121),u=[].slice,c={},f=function(t,n,r){if(!(n in c)){for(var e=[],i=0;i<n;i++)e[i]="a["+i+"]";c[n]=Function("F,a","return new F("+e.join(",")+")")}return c[n](t,r)};t.exports=Function.bind||function(t){var n=e(this),r=u.call(arguments,1),c=function(){var e=r.concat(u.call(arguments));return this instanceof c?f(n,e.length,e):o(n,e,t)};return i(n.prototype)&&(c.prototype=n.prototype),c}},function(t,n,r){"use strict";var e=r(11).f,i=r(70),o=r(73),u=r(53),c=r(68),f=r(46),a=r(79),s=r(140),l=r(170),h=r(74),v=r(10),p=r(65).fastKey,d=v?"_s":"size",y=function(t,n){var r,e=p(n);if("F"!==e)return t._i[e];for(r=t._f;r;r=r.n)if(r.k==n)return r};t.exports={getConstructor:function(t,n,r,s){var l=t(function(t,e){c(t,l,n,"_i"),t._i=i(null),t._f=void 0,t._l=void 0,t[d]=0,void 0!=e&&a(e,r,t[s],t)});return o(l.prototype,{clear:function(){for(var t=this,n=t._i,r=t._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];t._f=t._l=void 0,t[d]=0},delete:function(t){var n=this,r=y(n,t);if(r){var e=r.n,i=r.p;delete n._i[r.i],r.r=!0,i&&(i.n=e),e&&(e.p=i),n._f==r&&(n._f=e),n._l==r&&(n._l=i),n[d]--}return!!r},forEach:function(t){c(this,l,"forEach");for(var n,r=u(t,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(t){return!!y(this,t)}}),v&&e(l.prototype,"size",{get:function(){return f(this[d])}}),l},def:function(t,n,r){var e,i,o=y(t,n);return o?o.v=r:(t._l=o={i:i=p(n,!0),k:n,v:r,p:e=t._l,n:void 0,r:!1},t._f||(t._f=o),e&&(e.n=o),t[d]++,"F"!==i&&(t._i[i]=o)),t},getEntry:y,setStrong:function(t,n,r){s(t,n,function(t,n){this._t=t,this._k=n,this._l=void 0},function(){for(var t=this,n=t._k,r=t._l;r&&r.r;)r=r.p;return t._t&&(t._l=r=r?r.n:t._t._f)?"keys"==n?l(0,r.k):"values"==n?l(0,r.v):l(0,[r.k,r.v]):(t._t=void 0,l(1))},r?"entries":"values",!r,!0),h(n)}}},function(t,n,r){var e=r(114),i=r(161);t.exports=function(t){return function(){if(e(this)!=t)throw TypeError(t+"#toJSON isn't generic");return i(this)}}},function(t,n,r){"use strict";var e=r(73),i=r(65).getWeak,o=r(2),u=r(6),c=r(68),f=r(79),a=r(48),s=r(24),l=a(5),h=a(6),v=0,p=function(t){return t._l||(t._l=new d)},d=function(){this.a=[]},y=function(t,n){return l(t.a,function(t){return t[0]===n})};d.prototype={get:function(t){var n=y(this,t);if(n)return n[1]},has:function(t){return!!y(this,t)},set:function(t,n){var r=y(this,t);r?r[1]=n:this.a.push([t,n])},delete:function(t){var n=h(this.a,function(n){return n[0]===t});return~n&&this.a.splice(n,1),!!~n}},t.exports={getConstructor:function(t,n,r,o){var a=t(function(t,e){c(t,a,n,"_i"),t._i=v++,t._l=void 0,void 0!=e&&f(e,r,t[o],t)});return e(a.prototype,{delete:function(t){if(!u(t))return!1;var n=i(t);return!0===n?p(this).delete(t):n&&s(n,this._i)&&delete n[this._i]},has:function(t){if(!u(t))return!1;var n=i(t);return!0===n?p(this).has(t):n&&s(n,this._i)}}),a},def:function(t,n,r){var e=i(o(n),!0);return!0===e?p(t).set(n,r):e[t._i]=r,t},ufstore:p}},function(t,n,r){t.exports=!r(10)&&!r(4)(function(){return 7!=Object.defineProperty(r(132)("div"),"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(6),i=Math.floor;t.exports=function(t){return!e(t)&&isFinite(t)&&i(t)===t}},function(t,n,r){var e=r(2);t.exports=function(t,n,r,i){try{return i?n(e(r)[0],r[1]):n(r)}catch(n){var o=t.return;throw void 0!==o&&e(o.call(t)),n}}},function(t,n){t.exports=function(t,n){return{value:n,done:!!t}}},function(t,n){t.exports=Math.log1p||function(t){return(t=+t)>-1e-8&&t<1e-8?t-t*t/2:Math.log(1+t)}},function(t,n,r){"use strict";var e=r(72),i=r(125),o=r(116),u=r(17),c=r(115),f=Object.assign;t.exports=!f||r(4)(function(){var t={},n={},r=Symbol(),e="abcdefghijklmnopqrst";return t[r]=7,e.split("").forEach(function(t){n[t]=t}),7!=f({},t)[r]||Object.keys(f({},n)).join("")!=e})?function(t,n){for(var r=u(t),f=arguments.length,a=1,s=i.f,l=o.f;f>a;)for(var h,v=c(arguments[a++]),p=s?e(v).concat(s(v)):e(v),d=p.length,y=0;d>y;)l.call(v,h=p[y++])&&(r[h]=v[h]);return r}:f},function(t,n,r){var e=r(11),i=r(2),o=r(72);t.exports=r(10)?Object.defineProperties:function(t,n){i(t);for(var r,u=o(n),c=u.length,f=0;c>f;)e.f(t,r=u[f++],n[r]);return t}},function(t,n,r){var e=r(30),i=r(71).f,o={}.toString,u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],c=function(t){try{return i(t)}catch(t){return u.slice()}};t.exports.f=function(t){return u&&"[object Window]"==o.call(t)?c(t):i(e(t))}},function(t,n,r){var e=r(24),i=r(30),o=r(117)(!1),u=r(145)("IE_PROTO");t.exports=function(t,n){var r,c=i(t),f=0,a=[];for(r in c)r!=u&&e(c,r)&&a.push(r);for(;n.length>f;)e(c,r=n[f++])&&(~o(a,r)||a.push(r));return a}},function(t,n,r){var e=r(72),i=r(30),o=r(116).f;t.exports=function(t){return function(n){for(var r,u=i(n),c=e(u),f=c.length,a=0,s=[];f>a;)o.call(u,r=c[a++])&&s.push(t?[r,u[r]]:u[r]);return s}}},function(t,n,r){var e=r(71),i=r(125),o=r(2),u=r(3).Reflect;t.exports=u&&u.ownKeys||function(t){var n=e.f(o(t)),r=i.f;return r?n.concat(r(t)):n}},function(t,n,r){var e=r(3).parseFloat,i=r(82).trim;t.exports=1/e(r(150)+"-0")!=-1/0?function(t){var n=i(String(t),3),r=e(n);return 0===r&&"-"==n.charAt(0)?-0:r}:e},function(t,n,r){var e=r(3).parseInt,i=r(82).trim,o=r(150),u=/^[\-+]?0[xX]/;t.exports=8!==e(o+"08")||22!==e(o+"0x16")?function(t,n){var r=i(String(t),3);return e(r,n>>>0||(u.test(r)?16:10))}:e},function(t,n){t.exports=Object.is||function(t,n){return t===n?0!==t||1/t==1/n:t!=t&&n!=n}},function(t,n,r){var e=r(16),i=r(149),o=r(46);t.exports=function(t,n,r,u){var c=String(o(t)),f=c.length,a=void 0===r?" ":String(r),s=e(n);if(s<=f||""==a)return c;var l=s-f,h=i.call(a,Math.ceil(l/a.length));return h.length>l&&(h=h.slice(0,l)),u?h+c:c+h}},function(t,n,r){n.f=r(7)},function(t,n,r){"use strict";var e=r(164);t.exports=r(118)("Map",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{get:function(t){var n=e.getEntry(this,t);return n&&n.v},set:function(t,n){return e.def(this,0===t?0:t,n)}},e,!0)},function(t,n,r){r(10)&&"g"!=/./g.flags&&r(11).f(RegExp.prototype,"flags",{configurable:!0,get:r(120)})},function(t,n,r){"use strict";var e=r(164);t.exports=r(118)("Set",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return e.def(this,t=0===t?0:t,t)}},e)},function(t,n,r){"use strict";var e,i=r(48)(0),o=r(28),u=r(65),c=r(172),f=r(166),a=r(6),s=u.getWeak,l=Object.isExtensible,h=f.ufstore,v={},p=function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},d={get:function(t){if(a(t)){var n=s(t);return!0===n?h(this).get(t):n?n[this._i]:void 0}},set:function(t,n){return f.def(this,t,n)}},y=t.exports=r(118)("WeakMap",p,d,f,!0,!0);7!=(new y).set((Object.freeze||Object)(v),7).get(v)&&(e=f.getConstructor(p),c(e.prototype,d),u.NEED=!0,i(["delete","has","get","set"],function(t){var n=y.prototype,r=n[t];o(n,t,function(n,i){if(a(n)&&!l(n)){this._f||(this._f=new e);var o=this._f[t](n,i);return"set"==t?this:o}return r.call(this,n,i)})}))},,,function(t,n){"use strict";function r(){var t=document.querySelector("#page-nav");if(t&&!document.querySelector("#page-nav .extend.prev")&&(t.innerHTML='<a class="extend prev disabled" rel="prev">&laquo; Prev</a>'+t.innerHTML),t&&!document.querySelector("#page-nav .extend.next")&&(t.innerHTML=t.innerHTML+'<a class="extend next disabled" rel="next">Next &raquo;</a>'),yiliaConfig&&yiliaConfig.open_in_new){document.querySelectorAll(".article-entry a:not(.article-more-a)").forEach(function(t){var n=t.getAttribute("target");n&&""!==n||t.setAttribute("target","_blank")})}var n=document.querySelector("#js-aboutme");n&&0!==n.length&&(n.innerHTML=n.innerText)}t.exports={init:r}},function(t,n,r){"use strict";function e(t){return t&&t.__esModule?t:{default:t}}function i(t,n){var r=/\/|index.html/g;return t.replace(r,"")===n.replace(r,"")}function o(){for(var t=document.querySelectorAll(".js-header-menu li a"),n=window.location.pathname,r=0,e=t.length;r<e;r++){var o=t[r];i(n,o.getAttribute("href"))&&(0,h.default)(o,"active")}}function u(t){for(var n=t.offsetLeft,r=t.offsetParent;null!==r;)n+=r.offsetLeft,r=r.offsetParent;return n}function c(t){for(var n=t.offsetTop,r=t.offsetParent;null!==r;)n+=r.offsetTop,r=r.offsetParent;return n}function f(t,n,r,e,i){var o=u(t),f=c(t)-n;if(f-r<=i){var a=t.$newDom;a||(a=t.cloneNode(!0),(0,d.default)(t,a),t.$newDom=a,a.style.position="fixed",a.style.top=(r||f)+"px",a.style.left=o+"px",a.style.zIndex=e||2,a.style.width="100%",a.style.color="#fff"),a.style.visibility="visible",t.style.visibility="hidden"}else{t.style.visibility="visible";var s=t.$newDom;s&&(s.style.visibility="hidden")}}function a(){var t=document.querySelector(".js-overlay"),n=document.querySelector(".js-header-menu");f(t,document.body.scrollTop,-63,2,0),f(n,document.body.scrollTop,1,3,0)}function s(){document.querySelector("#container").addEventListener("scroll",function(t){a()}),window.addEventListener("scroll",function(t){a()}),a()}var l=r(156),h=e(l),v=r(157),p=(e(v),r(381)),d=e(p),y=r(128),g=e(y),b=r(189),m=e(b),x=r(129);(function(){g.default.versions.mobile&&window.screen.width<800&&(o(),s())})(),(0,x.addLoadEvent)(function(){m.default.init()}),t.exports={}},,,,function(t,n,r){(function(t){"use strict";function n(t,n,r){t[n]||Object[e](t,n,{writable:!0,configurable:!0,value:r})}if(r(380),r(390),r(197),t._babelPolyfill)throw new Error("only one instance of babel-polyfill is allowed");t._babelPolyfill=!0;var e="defineProperty";n(String.prototype,"padLeft","".padStart),n(String.prototype,"padRight","".padEnd),"pop,reverse,shift,keys,values,entries,indexOf,every,some,forEach,map,filter,find,findIndex,includes,join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill".split(",").forEach(function(t){[][t]&&n(Array,t,Function.call.bind([][t]))})}).call(n,function(){return this}())},,,function(t,n,r){r(209),t.exports=r(52).RegExp.escape},,,,function(t,n,r){var e=r(6),i=r(138),o=r(7)("species");t.exports=function(t){var n;return i(t)&&(n=t.constructor,"function"!=typeof n||n!==Array&&!i(n.prototype)||(n=void 0),e(n)&&null===(n=n[o])&&(n=void 0)),void 0===n?Array:n}},function(t,n,r){var e=r(201);t.exports=function(t,n){return new(e(t))(n)}},function(t,n,r){"use strict";var e=r(2),i=r(50),o="number";t.exports=function(t){if("string"!==t&&t!==o&&"default"!==t)throw TypeError("Incorrect hint");return i(e(this),t!=o)}},function(t,n,r){var e=r(72),i=r(125),o=r(116);t.exports=function(t){var n=e(t),r=i.f;if(r)for(var u,c=r(t),f=o.f,a=0;c.length>a;)f.call(t,u=c[a++])&&n.push(u);return n}},function(t,n,r){var e=r(72),i=r(30);t.exports=function(t,n){for(var r,o=i(t),u=e(o),c=u.length,f=0;c>f;)if(o[r=u[f++]]===n)return r}},function(t,n,r){"use strict";var e=r(207),i=r(121),o=r(26);t.exports=function(){for(var t=o(this),n=arguments.length,r=Array(n),u=0,c=e._,f=!1;n>u;)(r[u]=arguments[u++])===c&&(f=!0);return function(){var e,o=this,u=arguments.length,a=0,s=0;if(!f&&!u)return i(t,r,o);if(e=r.slice(),f)for(;n>a;a++)e[a]===c&&(e[a]=arguments[s++]);for(;u>s;)e.push(arguments[s++]);return i(t,e,o)}}},function(t,n,r){t.exports=r(3)},function(t,n){t.exports=function(t,n){var r=n===Object(n)?function(t){return n[t]}:n;return function(n){return String(n).replace(t,r)}}},function(t,n,r){var e=r(1),i=r(208)(/[\\^$*+?.()|[\]{}]/g,"\\$&");e(e.S,"RegExp",{escape:function(t){return i(t)}})},function(t,n,r){var e=r(1);e(e.P,"Array",{copyWithin:r(160)}),r(78)("copyWithin")},function(t,n,r){"use strict";var e=r(1),i=r(48)(4);e(e.P+e.F*!r(47)([].every,!0),"Array",{every:function(t){return i(this,t,arguments[1])}})},function(t,n,r){var e=r(1);e(e.P,"Array",{fill:r(130)}),r(78)("fill")},function(t,n,r){"use strict";var e=r(1),i=r(48)(2);e(e.P+e.F*!r(47)([].filter,!0),"Array",{filter:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(48)(6),o="findIndex",u=!0;o in[]&&Array(1)[o](function(){u=!1}),e(e.P+e.F*u,"Array",{findIndex:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),r(78)(o)},function(t,n,r){"use strict";var e=r(1),i=r(48)(5),o="find",u=!0;o in[]&&Array(1)[o](function(){u=!1}),e(e.P+e.F*u,"Array",{find:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),r(78)(o)},function(t,n,r){"use strict";var e=r(1),i=r(48)(0),o=r(47)([].forEach,!0);e(e.P+e.F*!o,"Array",{forEach:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(53),i=r(1),o=r(17),u=r(169),c=r(137),f=r(16),a=r(131),s=r(154);i(i.S+i.F*!r(123)(function(t){Array.from(t)}),"Array",{from:function(t){var n,r,i,l,h=o(t),v="function"==typeof this?this:Array,p=arguments.length,d=p>1?arguments[1]:void 0,y=void 0!==d,g=0,b=s(h);if(y&&(d=e(d,p>2?arguments[2]:void 0,2)),void 0==b||v==Array&&c(b))for(n=f(h.length),r=new v(n);n>g;g++)a(r,g,y?d(h[g],g):h[g]);else for(l=b.call(h),r=new v;!(i=l.next()).done;g++)a(r,g,y?u(l,d,[i.value,g],!0):i.value);return r.length=g,r}})},function(t,n,r){"use strict";var e=r(1),i=r(117)(!1),o=[].indexOf,u=!!o&&1/[1].indexOf(1,-0)<0;e(e.P+e.F*(u||!r(47)(o)),"Array",{indexOf:function(t){return u?o.apply(this,arguments)||0:i(this,t,arguments[1])}})},function(t,n,r){var e=r(1);e(e.S,"Array",{isArray:r(138)})},function(t,n,r){"use strict";var e=r(1),i=r(30),o=[].join;e(e.P+e.F*(r(115)!=Object||!r(47)(o)),"Array",{join:function(t){return o.call(i(this),void 0===t?",":t)}})},function(t,n,r){"use strict";var e=r(1),i=r(30),o=r(67),u=r(16),c=[].lastIndexOf,f=!!c&&1/[1].lastIndexOf(1,-0)<0;e(e.P+e.F*(f||!r(47)(c)),"Array",{lastIndexOf:function(t){if(f)return c.apply(this,arguments)||0;var n=i(this),r=u(n.length),e=r-1;for(arguments.length>1&&(e=Math.min(e,o(arguments[1]))),e<0&&(e=r+e);e>=0;e--)if(e in n&&n[e]===t)return e||0;return-1}})},function(t,n,r){"use strict";var e=r(1),i=r(48)(1);e(e.P+e.F*!r(47)([].map,!0),"Array",{map:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(131);e(e.S+e.F*r(4)(function(){function t(){}return!(Array.of.call(t)instanceof t)}),"Array",{of:function(){for(var t=0,n=arguments.length,r=new("function"==typeof this?this:Array)(n);n>t;)i(r,t,arguments[t++]);return r.length=n,r}})},function(t,n,r){"use strict";var e=r(1),i=r(162);e(e.P+e.F*!r(47)([].reduceRight,!0),"Array",{reduceRight:function(t){return i(this,t,arguments.length,arguments[1],!0)}})},function(t,n,r){"use strict";var e=r(1),i=r(162);e(e.P+e.F*!r(47)([].reduce,!0),"Array",{reduce:function(t){return i(this,t,arguments.length,arguments[1],!1)}})},function(t,n,r){"use strict";var e=r(1),i=r(135),o=r(45),u=r(75),c=r(16),f=[].slice;e(e.P+e.F*r(4)(function(){i&&f.call(i)}),"Array",{slice:function(t,n){var r=c(this.length),e=o(this);if(n=void 0===n?r:n,"Array"==e)return f.call(this,t,n);for(var i=u(t,r),a=u(n,r),s=c(a-i),l=Array(s),h=0;h<s;h++)l[h]="String"==e?this.charAt(i+h):this[i+h];return l}})},function(t,n,r){"use strict";var e=r(1),i=r(48)(3);e(e.P+e.F*!r(47)([].some,!0),"Array",{some:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(26),o=r(17),u=r(4),c=[].sort,f=[1,2,3];e(e.P+e.F*(u(function(){f.sort(void 0)})||!u(function(){f.sort(null)})||!r(47)(c)),"Array",{sort:function(t){return void 0===t?c.call(o(this)):c.call(o(this),i(t))}})},function(t,n,r){r(74)("Array")},function(t,n,r){var e=r(1);e(e.S,"Date",{now:function(){return(new Date).getTime()}})},function(t,n,r){"use strict";var e=r(1),i=r(4),o=Date.prototype.getTime,u=function(t){return t>9?t:"0"+t};e(e.P+e.F*(i(function(){return"0385-07-25T07:06:39.999Z"!=new Date(-5e13-1).toISOString()})||!i(function(){new Date(NaN).toISOString()})),"Date",{toISOString:function(){if(!isFinite(o.call(this)))throw RangeError("Invalid time value");var t=this,n=t.getUTCFullYear(),r=t.getUTCMilliseconds(),e=n<0?"-":n>9999?"+":""
;return e+("00000"+Math.abs(n)).slice(e?-6:-4)+"-"+u(t.getUTCMonth()+1)+"-"+u(t.getUTCDate())+"T"+u(t.getUTCHours())+":"+u(t.getUTCMinutes())+":"+u(t.getUTCSeconds())+"."+(r>99?r:"0"+u(r))+"Z"}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(50);e(e.P+e.F*r(4)(function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}),"Date",{toJSON:function(t){var n=i(this),r=o(n);return"number"!=typeof r||isFinite(r)?n.toISOString():null}})},function(t,n,r){var e=r(7)("toPrimitive"),i=Date.prototype;e in i||r(27)(i,e,r(203))},function(t,n,r){var e=Date.prototype,i="Invalid Date",o="toString",u=e[o],c=e.getTime;new Date(NaN)+""!=i&&r(28)(e,o,function(){var t=c.call(this);return t===t?u.call(this):i})},function(t,n,r){var e=r(1);e(e.P,"Function",{bind:r(163)})},function(t,n,r){"use strict";var e=r(6),i=r(32),o=r(7)("hasInstance"),u=Function.prototype;o in u||r(11).f(u,o,{value:function(t){if("function"!=typeof this||!e(t))return!1;if(!e(this.prototype))return t instanceof this;for(;t=i(t);)if(this.prototype===t)return!0;return!1}})},function(t,n,r){var e=r(11).f,i=r(66),o=r(24),u=Function.prototype,c="name",f=Object.isExtensible||function(){return!0};c in u||r(10)&&e(u,c,{configurable:!0,get:function(){try{var t=this,n=(""+t).match(/^\s*function ([^ (]*)/)[1];return o(t,c)||!f(t)||e(t,c,i(5,n)),n}catch(t){return""}}})},function(t,n,r){var e=r(1),i=r(171),o=Math.sqrt,u=Math.acosh;e(e.S+e.F*!(u&&710==Math.floor(u(Number.MAX_VALUE))&&u(1/0)==1/0),"Math",{acosh:function(t){return(t=+t)<1?NaN:t>94906265.62425156?Math.log(t)+Math.LN2:i(t-1+o(t-1)*o(t+1))}})},function(t,n,r){function e(t){return isFinite(t=+t)&&0!=t?t<0?-e(-t):Math.log(t+Math.sqrt(t*t+1)):t}var i=r(1),o=Math.asinh;i(i.S+i.F*!(o&&1/o(0)>0),"Math",{asinh:e})},function(t,n,r){var e=r(1),i=Math.atanh;e(e.S+e.F*!(i&&1/i(-0)<0),"Math",{atanh:function(t){return 0==(t=+t)?t:Math.log((1+t)/(1-t))/2}})},function(t,n,r){var e=r(1),i=r(142);e(e.S,"Math",{cbrt:function(t){return i(t=+t)*Math.pow(Math.abs(t),1/3)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{clz32:function(t){return(t>>>=0)?31-Math.floor(Math.log(t+.5)*Math.LOG2E):32}})},function(t,n,r){var e=r(1),i=Math.exp;e(e.S,"Math",{cosh:function(t){return(i(t=+t)+i(-t))/2}})},function(t,n,r){var e=r(1),i=r(141);e(e.S+e.F*(i!=Math.expm1),"Math",{expm1:i})},function(t,n,r){var e=r(1),i=r(142),o=Math.pow,u=o(2,-52),c=o(2,-23),f=o(2,127)*(2-c),a=o(2,-126),s=function(t){return t+1/u-1/u};e(e.S,"Math",{fround:function(t){var n,r,e=Math.abs(t),o=i(t);return e<a?o*s(e/a/c)*a*c:(n=(1+c/u)*e,r=n-(n-e),r>f||r!=r?o*(1/0):o*r)}})},function(t,n,r){var e=r(1),i=Math.abs;e(e.S,"Math",{hypot:function(t,n){for(var r,e,o=0,u=0,c=arguments.length,f=0;u<c;)r=i(arguments[u++]),f<r?(e=f/r,o=o*e*e+1,f=r):r>0?(e=r/f,o+=e*e):o+=r;return f===1/0?1/0:f*Math.sqrt(o)}})},function(t,n,r){var e=r(1),i=Math.imul;e(e.S+e.F*r(4)(function(){return-5!=i(4294967295,5)||2!=i.length}),"Math",{imul:function(t,n){var r=65535,e=+t,i=+n,o=r&e,u=r&i;return 0|o*u+((r&e>>>16)*u+o*(r&i>>>16)<<16>>>0)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{log10:function(t){return Math.log(t)/Math.LN10}})},function(t,n,r){var e=r(1);e(e.S,"Math",{log1p:r(171)})},function(t,n,r){var e=r(1);e(e.S,"Math",{log2:function(t){return Math.log(t)/Math.LN2}})},function(t,n,r){var e=r(1);e(e.S,"Math",{sign:r(142)})},function(t,n,r){var e=r(1),i=r(141),o=Math.exp;e(e.S+e.F*r(4)(function(){return-2e-17!=!Math.sinh(-2e-17)}),"Math",{sinh:function(t){return Math.abs(t=+t)<1?(i(t)-i(-t))/2:(o(t-1)-o(-t-1))*(Math.E/2)}})},function(t,n,r){var e=r(1),i=r(141),o=Math.exp;e(e.S,"Math",{tanh:function(t){var n=i(t=+t),r=i(-t);return n==1/0?1:r==1/0?-1:(n-r)/(o(t)+o(-t))}})},function(t,n,r){var e=r(1);e(e.S,"Math",{trunc:function(t){return(t>0?Math.floor:Math.ceil)(t)}})},function(t,n,r){"use strict";var e=r(3),i=r(24),o=r(45),u=r(136),c=r(50),f=r(4),a=r(71).f,s=r(31).f,l=r(11).f,h=r(82).trim,v="Number",p=e[v],d=p,y=p.prototype,g=o(r(70)(y))==v,b="trim"in String.prototype,m=function(t){var n=c(t,!1);if("string"==typeof n&&n.length>2){n=b?n.trim():h(n,3);var r,e,i,o=n.charCodeAt(0);if(43===o||45===o){if(88===(r=n.charCodeAt(2))||120===r)return NaN}else if(48===o){switch(n.charCodeAt(1)){case 66:case 98:e=2,i=49;break;case 79:case 111:e=8,i=55;break;default:return+n}for(var u,f=n.slice(2),a=0,s=f.length;a<s;a++)if((u=f.charCodeAt(a))<48||u>i)return NaN;return parseInt(f,e)}}return+n};if(!p(" 0o1")||!p("0b1")||p("+0x1")){p=function(t){var n=arguments.length<1?0:t,r=this;return r instanceof p&&(g?f(function(){y.valueOf.call(r)}):o(r)!=v)?u(new d(m(n)),r,p):m(n)};for(var x,w=r(10)?a(d):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),S=0;w.length>S;S++)i(d,x=w[S])&&!i(p,x)&&l(p,x,s(d,x));p.prototype=y,y.constructor=p,r(28)(e,v,p)}},function(t,n,r){var e=r(1);e(e.S,"Number",{EPSILON:Math.pow(2,-52)})},function(t,n,r){var e=r(1),i=r(3).isFinite;e(e.S,"Number",{isFinite:function(t){return"number"==typeof t&&i(t)}})},function(t,n,r){var e=r(1);e(e.S,"Number",{isInteger:r(168)})},function(t,n,r){var e=r(1);e(e.S,"Number",{isNaN:function(t){return t!=t}})},function(t,n,r){var e=r(1),i=r(168),o=Math.abs;e(e.S,"Number",{isSafeInteger:function(t){return i(t)&&o(t)<=9007199254740991}})},function(t,n,r){var e=r(1);e(e.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(t,n,r){var e=r(1);e(e.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(t,n,r){var e=r(1),i=r(178);e(e.S+e.F*(Number.parseFloat!=i),"Number",{parseFloat:i})},function(t,n,r){var e=r(1),i=r(179);e(e.S+e.F*(Number.parseInt!=i),"Number",{parseInt:i})},function(t,n,r){"use strict";var e=r(1),i=r(67),o=r(159),u=r(149),c=1..toFixed,f=Math.floor,a=[0,0,0,0,0,0],s="Number.toFixed: incorrect invocation!",l="0",h=function(t,n){for(var r=-1,e=n;++r<6;)e+=t*a[r],a[r]=e%1e7,e=f(e/1e7)},v=function(t){for(var n=6,r=0;--n>=0;)r+=a[n],a[n]=f(r/t),r=r%t*1e7},p=function(){for(var t=6,n="";--t>=0;)if(""!==n||0===t||0!==a[t]){var r=String(a[t]);n=""===n?r:n+u.call(l,7-r.length)+r}return n},d=function(t,n,r){return 0===n?r:n%2==1?d(t,n-1,r*t):d(t*t,n/2,r)},y=function(t){for(var n=0,r=t;r>=4096;)n+=12,r/=4096;for(;r>=2;)n+=1,r/=2;return n};e(e.P+e.F*(!!c&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!r(4)(function(){c.call({})})),"Number",{toFixed:function(t){var n,r,e,c,f=o(this,s),a=i(t),g="",b=l;if(a<0||a>20)throw RangeError(s);if(f!=f)return"NaN";if(f<=-1e21||f>=1e21)return String(f);if(f<0&&(g="-",f=-f),f>1e-21)if(n=y(f*d(2,69,1))-69,r=n<0?f*d(2,-n,1):f/d(2,n,1),r*=4503599627370496,(n=52-n)>0){for(h(0,r),e=a;e>=7;)h(1e7,0),e-=7;for(h(d(10,e,1),0),e=n-1;e>=23;)v(1<<23),e-=23;v(1<<e),h(1,1),v(2),b=p()}else h(0,r),h(1<<-n,0),b=p()+u.call(l,a);return a>0?(c=b.length,b=g+(c<=a?"0."+u.call(l,a-c)+b:b.slice(0,c-a)+"."+b.slice(c-a))):b=g+b,b}})},function(t,n,r){"use strict";var e=r(1),i=r(4),o=r(159),u=1..toPrecision;e(e.P+e.F*(i(function(){return"1"!==u.call(1,void 0)})||!i(function(){u.call({})})),"Number",{toPrecision:function(t){var n=o(this,"Number#toPrecision: incorrect invocation!");return void 0===t?u.call(n):u.call(n,t)}})},function(t,n,r){var e=r(1);e(e.S+e.F,"Object",{assign:r(172)})},function(t,n,r){var e=r(1);e(e.S,"Object",{create:r(70)})},function(t,n,r){var e=r(1);e(e.S+e.F*!r(10),"Object",{defineProperties:r(173)})},function(t,n,r){var e=r(1);e(e.S+e.F*!r(10),"Object",{defineProperty:r(11).f})},function(t,n,r){var e=r(6),i=r(65).onFreeze;r(49)("freeze",function(t){return function(n){return t&&e(n)?t(i(n)):n}})},function(t,n,r){var e=r(30),i=r(31).f;r(49)("getOwnPropertyDescriptor",function(){return function(t,n){return i(e(t),n)}})},function(t,n,r){r(49)("getOwnPropertyNames",function(){return r(174).f})},function(t,n,r){var e=r(17),i=r(32);r(49)("getPrototypeOf",function(){return function(t){return i(e(t))}})},function(t,n,r){var e=r(6);r(49)("isExtensible",function(t){return function(n){return!!e(n)&&(!t||t(n))}})},function(t,n,r){var e=r(6);r(49)("isFrozen",function(t){return function(n){return!e(n)||!!t&&t(n)}})},function(t,n,r){var e=r(6);r(49)("isSealed",function(t){return function(n){return!e(n)||!!t&&t(n)}})},function(t,n,r){var e=r(1);e(e.S,"Object",{is:r(180)})},function(t,n,r){var e=r(17),i=r(72);r(49)("keys",function(){return function(t){return i(e(t))}})},function(t,n,r){var e=r(6),i=r(65).onFreeze;r(49)("preventExtensions",function(t){return function(n){return t&&e(n)?t(i(n)):n}})},function(t,n,r){var e=r(6),i=r(65).onFreeze;r(49)("seal",function(t){return function(n){return t&&e(n)?t(i(n)):n}})},function(t,n,r){var e=r(1);e(e.S,"Object",{setPrototypeOf:r(144).set})},function(t,n,r){"use strict";var e=r(114),i={};i[r(7)("toStringTag")]="z",i+""!="[object z]"&&r(28)(Object.prototype,"toString",function(){return"[object "+e(this)+"]"},!0)},function(t,n,r){var e=r(1),i=r(178);e(e.G+e.F*(parseFloat!=i),{parseFloat:i})},function(t,n,r){var e=r(1),i=r(179);e(e.G+e.F*(parseInt!=i),{parseInt:i})},function(t,n,r){"use strict";var e,i,o,u=r(69),c=r(3),f=r(53),a=r(114),s=r(1),l=r(6),h=r(26),v=r(68),p=r(79),d=r(146),y=r(151).set,g=r(143)(),b="Promise",m=c.TypeError,x=c.process,w=c[b],x=c.process,S="process"==a(x),_=function(){},O=!!function(){try{var t=w.resolve(1),n=(t.constructor={})[r(7)("species")]=function(t){t(_,_)};return(S||"function"==typeof PromiseRejectionEvent)&&t.then(_)instanceof n}catch(t){}}(),E=function(t,n){return t===n||t===w&&n===o},P=function(t){var n;return!(!l(t)||"function"!=typeof(n=t.then))&&n},j=function(t){return E(w,t)?new F(t):new i(t)},F=i=function(t){var n,r;this.promise=new t(function(t,e){if(void 0!==n||void 0!==r)throw m("Bad Promise constructor");n=t,r=e}),this.resolve=h(n),this.reject=h(r)},M=function(t){try{t()}catch(t){return{error:t}}},A=function(t,n){if(!t._n){t._n=!0;var r=t._c;g(function(){for(var e=t._v,i=1==t._s,o=0;r.length>o;)!function(n){var r,o,u=i?n.ok:n.fail,c=n.resolve,f=n.reject,a=n.domain;try{u?(i||(2==t._h&&I(t),t._h=1),!0===u?r=e:(a&&a.enter(),r=u(e),a&&a.exit()),r===n.promise?f(m("Promise-chain cycle")):(o=P(r))?o.call(r,c,f):c(r)):f(e)}catch(t){f(t)}}(r[o++]);t._c=[],t._n=!1,n&&!t._h&&N(t)})}},N=function(t){y.call(c,function(){var n,r,e,i=t._v;if(T(t)&&(n=M(function(){S?x.emit("unhandledRejection",i,t):(r=c.onunhandledrejection)?r({promise:t,reason:i}):(e=c.console)&&e.error&&e.error("Unhandled promise rejection",i)}),t._h=S||T(t)?2:1),t._a=void 0,n)throw n.error})},T=function(t){if(1==t._h)return!1;for(var n,r=t._a||t._c,e=0;r.length>e;)if(n=r[e++],n.fail||!T(n.promise))return!1;return!0},I=function(t){y.call(c,function(){var n;S?x.emit("rejectionHandled",t):(n=c.onrejectionhandled)&&n({promise:t,reason:t._v})})},k=function(t){var n=this;n._d||(n._d=!0,n=n._w||n,n._v=t,n._s=2,n._a||(n._a=n._c.slice()),A(n,!0))},L=function(t){var n,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===t)throw m("Promise can't be resolved itself");(n=P(t))?g(function(){var e={_w:r,_d:!1};try{n.call(t,f(L,e,1),f(k,e,1))}catch(t){k.call(e,t)}}):(r._v=t,r._s=1,A(r,!1))}catch(t){k.call({_w:r,_d:!1},t)}}};O||(w=function(t){v(this,w,b,"_h"),h(t),e.call(this);try{t(f(L,this,1),f(k,this,1))}catch(t){k.call(this,t)}},e=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},e.prototype=r(73)(w.prototype,{then:function(t,n){var r=j(d(this,w));return r.ok="function"!=typeof t||t,r.fail="function"==typeof n&&n,r.domain=S?x.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&A(this,!1),r.promise},catch:function(t){return this.then(void 0,t)}}),F=function(){var t=new e;this.promise=t,this.resolve=f(L,t,1),this.reject=f(k,t,1)}),s(s.G+s.W+s.F*!O,{Promise:w}),r(81)(w,b),r(74)(b),o=r(52)[b],s(s.S+s.F*!O,b,{reject:function(t){var n=j(this);return(0,n.reject)(t),n.promise}}),s(s.S+s.F*(u||!O),b,{resolve:function(t){if(t instanceof w&&E(t.constructor,this))return t;var n=j(this);return(0,n.resolve)(t),n.promise}}),s(s.S+s.F*!(O&&r(123)(function(t){w.all(t).catch(_)})),b,{all:function(t){var n=this,r=j(n),e=r.resolve,i=r.reject,o=M(function(){var r=[],o=0,u=1;p(t,!1,function(t){var c=o++,f=!1;r.push(void 0),u++,n.resolve(t).then(function(t){f||(f=!0,r[c]=t,--u||e(r))},i)}),--u||e(r)});return o&&i(o.error),r.promise},race:function(t){var n=this,r=j(n),e=r.reject,i=M(function(){p(t,!1,function(t){n.resolve(t).then(r.resolve,e)})});return i&&e(i.error),r.promise}})},function(t,n,r){var e=r(1),i=r(26),o=r(2),u=(r(3).Reflect||{}).apply,c=Function.apply;e(e.S+e.F*!r(4)(function(){u(function(){})}),"Reflect",{apply:function(t,n,r){var e=i(t),f=o(r);return u?u(e,n,f):c.call(e,n,f)}})},function(t,n,r){var e=r(1),i=r(70),o=r(26),u=r(2),c=r(6),f=r(4),a=r(163),s=(r(3).Reflect||{}).construct,l=f(function(){function t(){}return!(s(function(){},[],t)instanceof t)}),h=!f(function(){s(function(){})});e(e.S+e.F*(l||h),"Reflect",{construct:function(t,n){o(t),u(n);var r=arguments.length<3?t:o(arguments[2]);if(h&&!l)return s(t,n,r);if(t==r){switch(n.length){case 0:return new t;case 1:return new t(n[0]);case 2:return new t(n[0],n[1]);case 3:return new t(n[0],n[1],n[2]);case 4:return new t(n[0],n[1],n[2],n[3])}var e=[null];return e.push.apply(e,n),new(a.apply(t,e))}var f=r.prototype,v=i(c(f)?f:Object.prototype),p=Function.apply.call(t,v,n);return c(p)?p:v}})},function(t,n,r){var e=r(11),i=r(1),o=r(2),u=r(50);i(i.S+i.F*r(4)(function(){Reflect.defineProperty(e.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(t,n,r){o(t),n=u(n,!0),o(r);try{return e.f(t,n,r),!0}catch(t){return!1}}})},function(t,n,r){var e=r(1),i=r(31).f,o=r(2);e(e.S,"Reflect",{deleteProperty:function(t,n){var r=i(o(t),n);return!(r&&!r.configurable)&&delete t[n]}})},function(t,n,r){"use strict";var e=r(1),i=r(2),o=function(t){this._t=i(t),this._i=0;var n,r=this._k=[];for(n in t)r.push(n)};r(139)(o,"Object",function(){var t,n=this,r=n._k;do{if(n._i>=r.length)return{value:void 0,done:!0}}while(!((t=r[n._i++])in n._t));return{value:t,done:!1}}),e(e.S,"Reflect",{enumerate:function(t){return new o(t)}})},function(t,n,r){var e=r(31),i=r(1),o=r(2);i(i.S,"Reflect",{getOwnPropertyDescriptor:function(t,n){return e.f(o(t),n)}})},function(t,n,r){var e=r(1),i=r(32),o=r(2);e(e.S,"Reflect",{getPrototypeOf:function(t){return i(o(t))}})},function(t,n,r){function e(t,n){var r,c,s=arguments.length<3?t:arguments[2];return a(t)===s?t[n]:(r=i.f(t,n))?u(r,"value")?r.value:void 0!==r.get?r.get.call(s):void 0:f(c=o(t))?e(c,n,s):void 0}var i=r(31),o=r(32),u=r(24),c=r(1),f=r(6),a=r(2);c(c.S,"Reflect",{get:e})},function(t,n,r){var e=r(1);e(e.S,"Reflect",{has:function(t,n){return n in t}})},function(t,n,r){var e=r(1),i=r(2),o=Object.isExtensible;e(e.S,"Reflect",{isExtensible:function(t){return i(t),!o||o(t)}})},function(t,n,r){var e=r(1);e(e.S,"Reflect",{ownKeys:r(177)})},function(t,n,r){var e=r(1),i=r(2),o=Object.preventExtensions;e(e.S,"Reflect",{preventExtensions:function(t){i(t);try{return o&&o(t),!0}catch(t){return!1}}})},function(t,n,r){var e=r(1),i=r(144);i&&e(e.S,"Reflect",{setPrototypeOf:function(t,n){i.check(t,n);try{return i.set(t,n),!0}catch(t){return!1}}})},function(t,n,r){function e(t,n,r){var f,h,v=arguments.length<4?t:arguments[3],p=o.f(s(t),n);if(!p){if(l(h=u(t)))return e(h,n,r,v);p=a(0)}return c(p,"value")?!(!1===p.writable||!l(v)||(f=o.f(v,n)||a(0),f.value=r,i.f(v,n,f),0)):void 0!==p.set&&(p.set.call(v,r),!0)}var i=r(11),o=r(31),u=r(32),c=r(24),f=r(1),a=r(66),s=r(2),l=r(6);f(f.S,"Reflect",{set:e})},function(t,n,r){var e=r(3),i=r(136),o=r(11).f,u=r(71).f,c=r(122),f=r(120),a=e.RegExp,s=a,l=a.prototype,h=/a/g,v=/a/g,p=new a(h)!==h;if(r(10)&&(!p||r(4)(function(){return v[r(7)("match")]=!1,a(h)!=h||a(v)==v||"/a/i"!=a(h,"i")}))){a=function(t,n){var r=this instanceof a,e=c(t),o=void 0===n;return!r&&e&&t.constructor===a&&o?t:i(p?new s(e&&!o?t.source:t,n):s((e=t instanceof a)?t.source:t,e&&o?f.call(t):n),r?this:l,a)};for(var d=u(s),y=0;d.length>y;)!function(t){t in a||o(a,t,{configurable:!0,get:function(){return s[t]},set:function(n){s[t]=n}})}(d[y++]);l.constructor=a,a.prototype=l,r(28)(e,"RegExp",a)}r(74)("RegExp")},function(t,n,r){r(119)("match",1,function(t,n,r){return[function(r){"use strict";var e=t(this),i=void 0==r?void 0:r[n];return void 0!==i?i.call(r,e):new RegExp(r)[n](String(e))},r]})},function(t,n,r){r(119)("replace",2,function(t,n,r){return[function(e,i){"use strict";var o=t(this),u=void 0==e?void 0:e[n];return void 0!==u?u.call(e,o,i):r.call(String(o),e,i)},r]})},function(t,n,r){r(119)("search",1,function(t,n,r){return[function(r){"use strict";var e=t(this),i=void 0==r?void 0:r[n];return void 0!==i?i.call(r,e):new RegExp(r)[n](String(e))},r]})},function(t,n,r){r(119)("split",2,function(t,n,e){"use strict";var i=r(122),o=e,u=[].push,c="split",f="length",a="lastIndex";if("c"=="abbc"[c](/(b)*/)[1]||4!="test"[c](/(?:)/,-1)[f]||2!="ab"[c](/(?:ab)*/)[f]||4!="."[c](/(.?)(.?)/)[f]||"."[c](/()()/)[f]>1||""[c](/.?/)[f]){var s=void 0===/()??/.exec("")[1];e=function(t,n){var r=String(this);if(void 0===t&&0===n)return[];if(!i(t))return o.call(r,t,n);var e,c,l,h,v,p=[],d=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),y=0,g=void 0===n?4294967295:n>>>0,b=new RegExp(t.source,d+"g");for(s||(e=new RegExp("^"+b.source+"$(?!\\s)",d));(c=b.exec(r))&&!((l=c.index+c[0][f])>y&&(p.push(r.slice(y,c.index)),!s&&c[f]>1&&c[0].replace(e,function(){for(v=1;v<arguments[f]-2;v++)void 0===arguments[v]&&(c[v]=void 0)}),c[f]>1&&c.index<r[f]&&u.apply(p,c.slice(1)),h=c[0][f],y=l,p[f]>=g));)b[a]===c.index&&b[a]++;return y===r[f]?!h&&b.test("")||p.push(""):p.push(r.slice(y)),p[f]>g?p.slice(0,g):p}}else"0"[c](void 0,0)[f]&&(e=function(t,n){return void 0===t&&0===n?[]:o.call(this,t,n)});return[function(r,i){var o=t(this),u=void 0==r?void 0:r[n];return void 0!==u?u.call(r,o,i):e.call(String(o),r,i)},e]})},function(t,n,r){"use strict";r(184);var e=r(2),i=r(120),o=r(10),u="toString",c=/./[u],f=function(t){r(28)(RegExp.prototype,u,t,!0)};r(4)(function(){return"/a/b"!=c.call({source:"a",flags:"b"})})?f(function(){var t=e(this);return"/".concat(t.source,"/","flags"in t?t.flags:!o&&t instanceof RegExp?i.call(t):void 0)}):c.name!=u&&f(function(){return c.call(this)})},function(t,n,r){"use strict";r(29)("anchor",function(t){return function(n){return t(this,"a","name",n)}})},function(t,n,r){"use strict";r(29)("big",function(t){return function(){return t(this,"big","","")}})},function(t,n,r){"use strict";r(29)("blink",function(t){return function(){return t(this,"blink","","")}})},function(t,n,r){"use strict";r(29)("bold",function(t){return function(){return t(this,"b","","")}})},function(t,n,r){"use strict";var e=r(1),i=r(147)(!1);e(e.P,"String",{codePointAt:function(t){return i(this,t)}})},function(t,n,r){"use strict";var e=r(1),i=r(16),o=r(148),u="endsWith",c=""[u];e(e.P+e.F*r(134)(u),"String",{endsWith:function(t){var n=o(this,t,u),r=arguments.length>1?arguments[1]:void 0,e=i(n.length),f=void 0===r?e:Math.min(i(r),e),a=String(t);return c?c.call(n,a,f):n.slice(f-a.length,f)===a}})},function(t,n,r){"use strict";r(29)("fixed",function(t){return function(){return t(this,"tt","","")}})},function(t,n,r){"use strict";r(29)("fontcolor",function(t){return function(n){return t(this,"font","color",n)}})},function(t,n,r){"use strict";r(29)("fontsize",function(t){return function(n){return t(this,"font","size",n)}})},function(t,n,r){var e=r(1),i=r(75),o=String.fromCharCode,u=String.fromCodePoint;e(e.S+e.F*(!!u&&1!=u.length),"String",{fromCodePoint:function(t){for(var n,r=[],e=arguments.length,u=0;e>u;){if(n=+arguments[u++],i(n,1114111)!==n)throw RangeError(n+" is not a valid code point");r.push(n<65536?o(n):o(55296+((n-=65536)>>10),n%1024+56320))}return r.join("")}})},function(t,n,r){"use strict";var e=r(1),i=r(148),o="includes";e(e.P+e.F*r(134)(o),"String",{includes:function(t){return!!~i(this,t,o).indexOf(t,arguments.length>1?arguments[1]:void 0)}})},function(t,n,r){"use strict";r(29)("italics",function(t){return function(){return t(this,"i","","")}})},function(t,n,r){"use strict";var e=r(147)(!0);r(140)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,r=this._i;return r>=n.length?{value:void 0,done:!0}:(t=e(n,r),this._i+=t.length,{value:t,done:!1})})},function(t,n,r){"use strict";r(29)("link",function(t){return function(n){return t(this,"a","href",n)}})},function(t,n,r){var e=r(1),i=r(30),o=r(16);e(e.S,"String",{raw:function(t){for(var n=i(t.raw),r=o(n.length),e=arguments.length,u=[],c=0;r>c;)u.push(String(n[c++])),c<e&&u.push(String(arguments[c]));return u.join("")}})},function(t,n,r){var e=r(1);e(e.P,"String",{repeat:r(149)})},function(t,n,r){"use strict";r(29)("small",function(t){return function(){return t(this,"small","","")}})},function(t,n,r){"use strict";var e=r(1),i=r(16),o=r(148),u="startsWith",c=""[u];e(e.P+e.F*r(134)(u),"String",{startsWith:function(t){var n=o(this,t,u),r=i(Math.min(arguments.length>1?arguments[1]:void 0,n.length)),e=String(t);return c?c.call(n,e,r):n.slice(r,r+e.length)===e}})},function(t,n,r){"use strict";r(29)("strike",function(t){return function(){return t(this,"strike","","")}})},function(t,n,r){"use strict";r(29)("sub",function(t){return function(){return t(this,"sub","","")}})},function(t,n,r){"use strict";r(29)("sup",function(t){return function(){return t(this,"sup","","")}})},function(t,n,r){"use strict";r(82)("trim",function(t){return function(){return t(this,3)}})},function(t,n,r){"use strict";var e=r(3),i=r(24),o=r(10),u=r(1),c=r(28),f=r(65).KEY,a=r(4),s=r(126),l=r(81),h=r(76),v=r(7),p=r(182),d=r(153),y=r(205),g=r(204),b=r(138),m=r(2),x=r(30),w=r(50),S=r(66),_=r(70),O=r(174),E=r(31),P=r(11),j=r(72),F=E.f,M=P.f,A=O.f,N=e.Symbol,T=e.JSON,I=T&&T.stringify,k="prototype",L=v("_hidden"),R=v("toPrimitive"),C={}.propertyIsEnumerable,D=s("symbol-registry"),U=s("symbols"),W=s("op-symbols"),G=Object[k],B="function"==typeof N,V=e.QObject,z=!V||!V[k]||!V[k].findChild,q=o&&a(function(){return 7!=_(M({},"a",{get:function(){return M(this,"a",{value:7}).a}})).a})?function(t,n,r){var e=F(G,n);e&&delete G[n],M(t,n,r),e&&t!==G&&M(G,n,e)}:M,K=function(t){var n=U[t]=_(N[k]);return n._k=t,n},J=B&&"symbol"==typeof N.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof N},Y=function(t,n,r){return t===G&&Y(W,n,r),m(t),n=w(n,!0),m(r),i(U,n)?(r.enumerable?(i(t,L)&&t[L][n]&&(t[L][n]=!1),r=_(r,{enumerable:S(0,!1)})):(i(t,L)||M(t,L,S(1,{})),t[L][n]=!0),q(t,n,r)):M(t,n,r)},H=function(t,n){m(t);for(var r,e=g(n=x(n)),i=0,o=e.length;o>i;)Y(t,r=e[i++],n[r]);return t},$=function(t,n){return void 0===n?_(t):H(_(t),n)},X=function(t){var n=C.call(this,t=w(t,!0));return!(this===G&&i(U,t)&&!i(W,t))&&(!(n||!i(this,t)||!i(U,t)||i(this,L)&&this[L][t])||n)},Q=function(t,n){if(t=x(t),n=w(n,!0),t!==G||!i(U,n)||i(W,n)){var r=F(t,n);return!r||!i(U,n)||i(t,L)&&t[L][n]||(r.enumerable=!0),r}},Z=function(t){for(var n,r=A(x(t)),e=[],o=0;r.length>o;)i(U,n=r[o++])||n==L||n==f||e.push(n);return e},tt=function(t){for(var n,r=t===G,e=A(r?W:x(t)),o=[],u=0;e.length>u;)!i(U,n=e[u++])||r&&!i(G,n)||o.push(U[n]);return o};B||(N=function(){if(this instanceof N)throw TypeError("Symbol is not a constructor!");var t=h(arguments.length>0?arguments[0]:void 0),n=function(r){this===G&&n.call(W,r),i(this,L)&&i(this[L],t)&&(this[L][t]=!1),q(this,t,S(1,r))};return o&&z&&q(G,t,{configurable:!0,set:n}),K(t)},c(N[k],"toString",function(){return this._k}),E.f=Q,P.f=Y,r(71).f=O.f=Z,r(116).f=X,r(125).f=tt,o&&!r(69)&&c(G,"propertyIsEnumerable",X,!0),p.f=function(t){return K(v(t))}),u(u.G+u.W+u.F*!B,{Symbol:N});for(var nt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),rt=0;nt.length>rt;)v(nt[rt++]);for(var nt=j(v.store),rt=0;nt.length>rt;)d(nt[rt++]);u(u.S+u.F*!B,"Symbol",{for:function(t){return i(D,t+="")?D[t]:D[t]=N(t)},keyFor:function(t){if(J(t))return y(D,t);throw TypeError(t+" is not a symbol!")},useSetter:function(){z=!0},useSimple:function(){z=!1}}),u(u.S+u.F*!B,"Object",{create:$,defineProperty:Y,defineProperties:H,getOwnPropertyDescriptor:Q,getOwnPropertyNames:Z,getOwnPropertySymbols:tt}),T&&u(u.S+u.F*(!B||a(function(){var t=N();return"[null]"!=I([t])||"{}"!=I({a:t})||"{}"!=I(Object(t))})),"JSON",{stringify:function(t){if(void 0!==t&&!J(t)){for(var n,r,e=[t],i=1;arguments.length>i;)e.push(arguments[i++]);return n=e[1],"function"==typeof n&&(r=n),!r&&b(n)||(n=function(t,n){if(r&&(n=r.call(this,t,n)),!J(n))return n}),e[1]=n,I.apply(T,e)}}}),N[k][R]||r(27)(N[k],R,N[k].valueOf),l(N,"Symbol"),l(Math,"Math",!0),l(e.JSON,"JSON",!0)},function(t,n,r){"use strict";var e=r(1),i=r(127),o=r(152),u=r(2),c=r(75),f=r(16),a=r(6),s=r(3).ArrayBuffer,l=r(146),h=o.ArrayBuffer,v=o.DataView,p=i.ABV&&s.isView,d=h.prototype.slice,y=i.VIEW,g="ArrayBuffer";e(e.G+e.W+e.F*(s!==h),{ArrayBuffer:h}),e(e.S+e.F*!i.CONSTR,g,{isView:function(t){return p&&p(t)||a(t)&&y in t}}),e(e.P+e.U+e.F*r(4)(function(){return!new h(2).slice(1,void 0).byteLength}),g,{slice:function(t,n){if(void 0!==d&&void 0===n)return d.call(u(this),t);for(var r=u(this).byteLength,e=c(t,r),i=c(void 0===n?r:n,r),o=new(l(this,h))(f(i-e)),a=new v(this),s=new v(o),p=0;e<i;)s.setUint8(p++,a.getUint8(e++));return o}}),r(74)(g)},function(t,n,r){var e=r(1);e(e.G+e.W+e.F*!r(127).ABV,{DataView:r(152).DataView})},function(t,n,r){r(55)("Float32",4,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Float64",8,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Int16",2,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Int32",4,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Int8",1,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint16",2,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint32",4,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint8",1,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint8",1,function(t){return function(n,r,e){return t(this,n,r,e)}},!0)},function(t,n,r){"use strict";var e=r(166);r(118)("WeakSet",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return e.def(this,t,!0)}},e,!1,!0)},function(t,n,r){"use strict";var e=r(1),i=r(117)(!0);e(e.P,"Array",{includes:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),r(78)("includes")},function(t,n,r){var e=r(1),i=r(143)(),o=r(3).process,u="process"==r(45)(o);e(e.G,{asap:function(t){var n=u&&o.domain;i(n?n.bind(t):t)}})},function(t,n,r){var e=r(1),i=r(45);e(e.S,"Error",{isError:function(t){return"Error"===i(t)}})},function(t,n,r){var e=r(1);e(e.P+e.R,"Map",{toJSON:r(165)("Map")})},function(t,n,r){var e=r(1);e(e.S,"Math",{iaddh:function(t,n,r,e){var i=t>>>0,o=n>>>0,u=r>>>0;return o+(e>>>0)+((i&u|(i|u)&~(i+u>>>0))>>>31)|0}})},function(t,n,r){var e=r(1);e(e.S,"Math",{imulh:function(t,n){var r=65535,e=+t,i=+n,o=e&r,u=i&r,c=e>>16,f=i>>16,a=(c*u>>>0)+(o*u>>>16);return c*f+(a>>16)+((o*f>>>0)+(a&r)>>16)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{isubh:function(t,n,r,e){var i=t>>>0,o=n>>>0,u=r>>>0;return o-(e>>>0)-((~i&u|~(i^u)&i-u>>>0)>>>31)|0}})},function(t,n,r){var e=r(1);e(e.S,"Math",{umulh:function(t,n){var r=65535,e=+t,i=+n,o=e&r,u=i&r,c=e>>>16,f=i>>>16,a=(c*u>>>0)+(o*u>>>16);return c*f+(a>>>16)+((o*f>>>0)+(a&r)>>>16)}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(26),u=r(11);r(10)&&e(e.P+r(124),"Object",{__defineGetter__:function(t,n){u.f(i(this),t,{get:o(n),enumerable:!0,configurable:!0})}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(26),u=r(11);r(10)&&e(e.P+r(124),"Object",{__defineSetter__:function(t,n){u.f(i(this),t,{set:o(n),enumerable:!0,configurable:!0})}})},function(t,n,r){var e=r(1),i=r(176)(!0);e(e.S,"Object",{entries:function(t){return i(t)}})},function(t,n,r){var e=r(1),i=r(177),o=r(30),u=r(31),c=r(131);e(e.S,"Object",{getOwnPropertyDescriptors:function(t){for(var n,r=o(t),e=u.f,f=i(r),a={},s=0;f.length>s;)c(a,n=f[s++],e(r,n));return a}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(50),u=r(32),c=r(31).f;r(10)&&e(e.P+r(124),"Object",{__lookupGetter__:function(t){var n,r=i(this),e=o(t,!0);do{if(n=c(r,e))return n.get}while(r=u(r))}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(50),u=r(32),c=r(31).f;r(10)&&e(e.P+r(124),"Object",{__lookupSetter__:function(t){var n,r=i(this),e=o(t,!0);do{if(n=c(r,e))return n.set}while(r=u(r))}})},function(t,n,r){var e=r(1),i=r(176)(!1);e(e.S,"Object",{values:function(t){return i(t)}})},function(t,n,r){"use strict";var e=r(1),i=r(3),o=r(52),u=r(143)(),c=r(7)("observable"),f=r(26),a=r(2),s=r(68),l=r(73),h=r(27),v=r(79),p=v.RETURN,d=function(t){return null==t?void 0:f(t)},y=function(t){var n=t._c;n&&(t._c=void 0,n())},g=function(t){return void 0===t._o},b=function(t){g(t)||(t._o=void 0,y(t))},m=function(t,n){a(t),this._c=void 0,this._o=t,t=new x(this);try{var r=n(t),e=r;null!=r&&("function"==typeof r.unsubscribe?r=function(){e.unsubscribe()}:f(r),this._c=r)}catch(n){return void t.error(n)}g(this)&&y(this)};m.prototype=l({},{unsubscribe:function(){b(this)}});var x=function(t){this._s=t};x.prototype=l({},{next:function(t){var n=this._s;if(!g(n)){var r=n._o;try{var e=d(r.next);if(e)return e.call(r,t)}catch(t){try{b(n)}finally{throw t}}}},error:function(t){var n=this._s;if(g(n))throw t;var r=n._o;n._o=void 0;try{var e=d(r.error);if(!e)throw t;t=e.call(r,t)}catch(t){try{y(n)}finally{throw t}}return y(n),t},complete:function(t){var n=this._s;if(!g(n)){var r=n._o;n._o=void 0;try{var e=d(r.complete);t=e?e.call(r,t):void 0}catch(t){try{y(n)}finally{throw t}}return y(n),t}}});var w=function(t){s(this,w,"Observable","_f")._f=f(t)};l(w.prototype,{subscribe:function(t){return new m(t,this._f)},forEach:function(t){var n=this;return new(o.Promise||i.Promise)(function(r,e){f(t);var i=n.subscribe({next:function(n){try{return t(n)}catch(t){e(t),i.unsubscribe()}},error:e,complete:r})})}}),l(w,{from:function(t){var n="function"==typeof this?this:w,r=d(a(t)[c]);if(r){var e=a(r.call(t));return e.constructor===n?e:new n(function(t){return e.subscribe(t)})}return new n(function(n){var r=!1;return u(function(){if(!r){try{if(v(t,!1,function(t){if(n.next(t),r)return p})===p)return}catch(t){if(r)throw t;return void n.error(t)}n.complete()}}),function(){r=!0}})},of:function(){for(var t=0,n=arguments.length,r=Array(n);t<n;)r[t]=arguments[t++];return new("function"==typeof this?this:w)(function(t){var n=!1;return u(function(){if(!n){for(var e=0;e<r.length;++e)if(t.next(r[e]),n)return;t.complete()}}),function(){n=!0}})}}),h(w.prototype,c,function(){return this}),e(e.G,{Observable:w}),r(74)("Observable")},function(t,n,r){var e=r(54),i=r(2),o=e.key,u=e.set;e.exp({defineMetadata:function(t,n,r,e){u(t,n,i(r),o(e))}})},function(t,n,r){var e=r(54),i=r(2),o=e.key,u=e.map,c=e.store;e.exp({deleteMetadata:function(t,n){var r=arguments.length<3?void 0:o(arguments[2]),e=u(i(n),r,!1);if(void 0===e||!e.delete(t))return!1;if(e.size)return!0;var f=c.get(n);return f.delete(r),!!f.size||c.delete(n)}})},function(t,n,r){var e=r(185),i=r(161),o=r(54),u=r(2),c=r(32),f=o.keys,a=o.key,s=function(t,n){var r=f(t,n),o=c(t);if(null===o)return r;var u=s(o,n);return u.length?r.length?i(new e(r.concat(u))):u:r};o.exp({getMetadataKeys:function(t){return s(u(t),arguments.length<2?void 0:a(arguments[1]))}})},function(t,n,r){var e=r(54),i=r(2),o=r(32),u=e.has,c=e.get,f=e.key,a=function(t,n,r){if(u(t,n,r))return c(t,n,r);var e=o(n);return null!==e?a(t,e,r):void 0};e.exp({getMetadata:function(t,n){return a(t,i(n),arguments.length<3?void 0:f(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=e.keys,u=e.key;e.exp({getOwnMetadataKeys:function(t){return o(i(t),arguments.length<2?void 0:u(arguments[1]))}})},function(t,n,r){var e=r(54),i=r(2),o=e.get,u=e.key;e.exp({getOwnMetadata:function(t,n){
return o(t,i(n),arguments.length<3?void 0:u(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=r(32),u=e.has,c=e.key,f=function(t,n,r){if(u(t,n,r))return!0;var e=o(n);return null!==e&&f(t,e,r)};e.exp({hasMetadata:function(t,n){return f(t,i(n),arguments.length<3?void 0:c(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=e.has,u=e.key;e.exp({hasOwnMetadata:function(t,n){return o(t,i(n),arguments.length<3?void 0:u(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=r(26),u=e.key,c=e.set;e.exp({metadata:function(t,n){return function(r,e){c(t,n,(void 0!==e?i:o)(r),u(e))}}})},function(t,n,r){var e=r(1);e(e.P+e.R,"Set",{toJSON:r(165)("Set")})},function(t,n,r){"use strict";var e=r(1),i=r(147)(!0);e(e.P,"String",{at:function(t){return i(this,t)}})},function(t,n,r){"use strict";var e=r(1),i=r(46),o=r(16),u=r(122),c=r(120),f=RegExp.prototype,a=function(t,n){this._r=t,this._s=n};r(139)(a,"RegExp String",function(){var t=this._r.exec(this._s);return{value:t,done:null===t}}),e(e.P,"String",{matchAll:function(t){if(i(this),!u(t))throw TypeError(t+" is not a regexp!");var n=String(this),r="flags"in f?String(t.flags):c.call(t),e=new RegExp(t.source,~r.indexOf("g")?r:"g"+r);return e.lastIndex=o(t.lastIndex),new a(e,n)}})},function(t,n,r){"use strict";var e=r(1),i=r(181);e(e.P,"String",{padEnd:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0,!1)}})},function(t,n,r){"use strict";var e=r(1),i=r(181);e(e.P,"String",{padStart:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0,!0)}})},function(t,n,r){"use strict";r(82)("trimLeft",function(t){return function(){return t(this,1)}},"trimStart")},function(t,n,r){"use strict";r(82)("trimRight",function(t){return function(){return t(this,2)}},"trimEnd")},function(t,n,r){r(153)("asyncIterator")},function(t,n,r){r(153)("observable")},function(t,n,r){var e=r(1);e(e.S,"System",{global:r(3)})},function(t,n,r){for(var e=r(155),i=r(28),o=r(3),u=r(27),c=r(80),f=r(7),a=f("iterator"),s=f("toStringTag"),l=c.Array,h=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],v=0;v<5;v++){var p,d=h[v],y=o[d],g=y&&y.prototype;if(g){g[a]||u(g,a,l),g[s]||u(g,s,d),c[d]=l;for(p in e)g[p]||i(g,p,e[p],!0)}}},function(t,n,r){var e=r(1),i=r(151);e(e.G+e.B,{setImmediate:i.set,clearImmediate:i.clear})},function(t,n,r){var e=r(3),i=r(1),o=r(121),u=r(206),c=e.navigator,f=!!c&&/MSIE .\./.test(c.userAgent),a=function(t){return f?function(n,r){return t(o(u,[].slice.call(arguments,2),"function"==typeof n?n:Function(n)),r)}:t};i(i.G+i.B+i.F*f,{setTimeout:a(e.setTimeout),setInterval:a(e.setInterval)})},function(t,n,r){r(329),r(268),r(270),r(269),r(272),r(274),r(279),r(273),r(271),r(281),r(280),r(276),r(277),r(275),r(267),r(278),r(282),r(283),r(235),r(237),r(236),r(285),r(284),r(255),r(265),r(266),r(256),r(257),r(258),r(259),r(260),r(261),r(262),r(263),r(264),r(238),r(239),r(240),r(241),r(242),r(243),r(244),r(245),r(246),r(247),r(248),r(249),r(250),r(251),r(252),r(253),r(254),r(316),r(321),r(328),r(319),r(311),r(312),r(317),r(322),r(324),r(307),r(308),r(309),r(310),r(313),r(314),r(315),r(318),r(320),r(323),r(325),r(326),r(327),r(230),r(232),r(231),r(234),r(233),r(219),r(217),r(223),r(220),r(226),r(228),r(216),r(222),r(213),r(227),r(211),r(225),r(224),r(218),r(221),r(210),r(212),r(215),r(214),r(229),r(155),r(301),r(306),r(184),r(302),r(303),r(304),r(305),r(286),r(183),r(185),r(186),r(341),r(330),r(331),r(336),r(339),r(340),r(334),r(337),r(335),r(338),r(332),r(333),r(287),r(288),r(289),r(290),r(291),r(294),r(292),r(293),r(295),r(296),r(297),r(298),r(300),r(299),r(342),r(368),r(371),r(370),r(372),r(373),r(369),r(374),r(375),r(353),r(356),r(352),r(350),r(351),r(354),r(355),r(345),r(367),r(376),r(344),r(346),r(348),r(347),r(349),r(358),r(359),r(361),r(360),r(363),r(362),r(364),r(365),r(366),r(343),r(357),r(379),r(378),r(377),t.exports=r(52)},function(t,n){function r(t,n){if("string"==typeof n)return t.insertAdjacentHTML("afterend",n);var r=t.nextSibling;return r?t.parentNode.insertBefore(n,r):t.parentNode.appendChild(n)}t.exports=r},,,,,,,,,function(t,n,r){(function(n,r){!function(n){"use strict";function e(t,n,r,e){var i=n&&n.prototype instanceof o?n:o,u=Object.create(i.prototype),c=new p(e||[]);return u._invoke=s(t,r,c),u}function i(t,n,r){try{return{type:"normal",arg:t.call(n,r)}}catch(t){return{type:"throw",arg:t}}}function o(){}function u(){}function c(){}function f(t){["next","throw","return"].forEach(function(n){t[n]=function(t){return this._invoke(n,t)}})}function a(t){function n(r,e,o,u){var c=i(t[r],t,e);if("throw"!==c.type){var f=c.arg,a=f.value;return a&&"object"==typeof a&&m.call(a,"__await")?Promise.resolve(a.__await).then(function(t){n("next",t,o,u)},function(t){n("throw",t,o,u)}):Promise.resolve(a).then(function(t){f.value=t,o(f)},u)}u(c.arg)}function e(t,r){function e(){return new Promise(function(e,i){n(t,r,e,i)})}return o=o?o.then(e,e):e()}"object"==typeof r&&r.domain&&(n=r.domain.bind(n));var o;this._invoke=e}function s(t,n,r){var e=P;return function(o,u){if(e===F)throw new Error("Generator is already running");if(e===M){if("throw"===o)throw u;return y()}for(r.method=o,r.arg=u;;){var c=r.delegate;if(c){var f=l(c,r);if(f){if(f===A)continue;return f}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(e===P)throw e=M,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);e=F;var a=i(t,n,r);if("normal"===a.type){if(e=r.done?M:j,a.arg===A)continue;return{value:a.arg,done:r.done}}"throw"===a.type&&(e=M,r.method="throw",r.arg=a.arg)}}}function l(t,n){var r=t.iterator[n.method];if(r===g){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=g,l(t,n),"throw"===n.method))return A;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return A}var e=i(r,t.iterator,n.arg);if("throw"===e.type)return n.method="throw",n.arg=e.arg,n.delegate=null,A;var o=e.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=g),n.delegate=null,A):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,A)}function h(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function v(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function p(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(h,this),this.reset(!0)}function d(t){if(t){var n=t[w];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,e=function n(){for(;++r<t.length;)if(m.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=g,n.done=!0,n};return e.next=e}}return{next:y}}function y(){return{value:g,done:!0}}var g,b=Object.prototype,m=b.hasOwnProperty,x="function"==typeof Symbol?Symbol:{},w=x.iterator||"@@iterator",S=x.asyncIterator||"@@asyncIterator",_=x.toStringTag||"@@toStringTag",O="object"==typeof t,E=n.regeneratorRuntime;if(E)return void(O&&(t.exports=E));E=n.regeneratorRuntime=O?t.exports:{},E.wrap=e;var P="suspendedStart",j="suspendedYield",F="executing",M="completed",A={},N={};N[w]=function(){return this};var T=Object.getPrototypeOf,I=T&&T(T(d([])));I&&I!==b&&m.call(I,w)&&(N=I);var k=c.prototype=o.prototype=Object.create(N);u.prototype=k.constructor=c,c.constructor=u,c[_]=u.displayName="GeneratorFunction",E.isGeneratorFunction=function(t){var n="function"==typeof t&&t.constructor;return!!n&&(n===u||"GeneratorFunction"===(n.displayName||n.name))},E.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,_ in t||(t[_]="GeneratorFunction")),t.prototype=Object.create(k),t},E.awrap=function(t){return{__await:t}},f(a.prototype),a.prototype[S]=function(){return this},E.AsyncIterator=a,E.async=function(t,n,r,i){var o=new a(e(t,n,r,i));return E.isGeneratorFunction(n)?o:o.next().then(function(t){return t.done?t.value:o.next()})},f(k),k[_]="Generator",k.toString=function(){return"[object Generator]"},E.keys=function(t){var n=[];for(var r in t)n.push(r);return n.reverse(),function r(){for(;n.length;){var e=n.pop();if(e in t)return r.value=e,r.done=!1,r}return r.done=!0,r}},E.values=d,p.prototype={constructor:p,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=g,this.done=!1,this.delegate=null,this.method="next",this.arg=g,this.tryEntries.forEach(v),!t)for(var n in this)"t"===n.charAt(0)&&m.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=g)},stop:function(){this.done=!0;var t=this.tryEntries[0],n=t.completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(t){function n(n,e){return o.type="throw",o.arg=t,r.next=n,e&&(r.method="next",r.arg=g),!!e}if(this.done)throw t;for(var r=this,e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e],o=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var u=m.call(i,"catchLoc"),c=m.call(i,"finallyLoc");if(u&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,n){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.tryLoc<=this.prev&&m.call(e,"finallyLoc")&&this.prev<e.finallyLoc){var i=e;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=n&&n<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=n,i?(this.method="next",this.next=i.finallyLoc,A):this.complete(o)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),A},finish:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),v(r),A}},catch:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc===t){var e=r.completion;if("throw"===e.type){var i=e.arg;v(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:d(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=g),A}}}("object"==typeof n?n:"object"==typeof window?window:"object"==typeof self?self:this)}).call(n,function(){return this}(),r(158))}])</script><script src="/./main.b3331d.js"></script><script>!function(){!function(e){var t=document.createElement("script");document.getElementsByTagName("body")[0].appendChild(t),t.setAttribute("src",e)}("/slider.445162.js")}()</script>


    
<div class="tools-col" q-class="show:isShow,hide:isShow|isFalse" q-on="click:stop(e)">
  <div class="tools-nav header-menu">
    
    
      
      
      
    
      
      
      
    
      
      
      
    
    

    <ul style="width: 70%">
    
    
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'innerArchive')"><a href="javascript:void(0)" q-class="active:innerArchive">所有文章</a></li>
      
        
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'friends')"><a href="javascript:void(0)" q-class="active:friends">友链</a></li>
      
        
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'aboutme')"><a href="javascript:void(0)" q-class="active:aboutme">关于我</a></li>
      
        
    </ul>
  </div>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all" q-show="innerArchive">
        <div class="search-wrap">
          <input class="search-ipt" q-model="search" type="text" placeholder="find something…">
          <i class="icon-search icon" q-show="search|isEmptyStr"></i>
          <i class="icon-close icon" q-show="search|isNotEmptyStr" q-on="click:clearChose(e)"></i>
        </div>
        <div class="widget tagcloud search-tag">
          <p class="search-tag-wording">tag:</p>
          <label class="search-switch">
            <input type="checkbox" q-on="click:toggleTag(e)" q-attr="checked:showTags">
          </label>
          <ul class="article-tag-list" q-show="showTags">
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">IOS</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">随笔</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">iOS</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">IOS基础知识</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">三方框架解析</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">图片视频</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">视频心得</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">博客之初</a>
              </li>
            
            <div class="clearfix"></div>
          </ul>
        </div>
        <ul class="search-ul">
          <p q-show="jsonFail" style="padding: 20px; font-size: 12px;">
            缺失模块。<br/>1、请确保node版本大于6.2<br/>2、在博客根目录（注意不是yilia根目录）执行以下命令：<br/> npm i hexo-generator-json-content --save<br/><br/>
            3、在根目录_config.yml里添加配置：
<pre style="font-size: 12px;" q-show="jsonFail">
  jsonContent:
    meta: false
    pages: false
    posts:
      title: true
      date: true
      path: true
      text: false
      raw: false
      content: false
      slug: false
      updated: false
      comments: false
      link: false
      permalink: false
      excerpt: false
      categories: false
      tags: true
</pre>
          </p>
          <li class="search-li" q-repeat="items" q-show="isShow">
            <a q-attr="href:path|urlformat" class="search-title"><i class="icon-quo-left icon"></i><span q-text="title"></span></a>
            <p class="search-time">
              <i class="icon-calendar icon"></i>
              <span q-text="date|dateformat"></span>
            </p>
            <p class="search-tag">
              <i class="icon-price-tags icon"></i>
              <span q-repeat="tags" q-on="click:choseTag(e, name)" q-text="name|tagformat"></span>
            </p>
          </li>
        </ul>
    	</section>
    

    
    	<section class="tools-section tools-section-friends" q-show="friends">
  		
        <ul class="search-ul">
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接1</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接2</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接3</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接4</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接5</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接6</a>
            </li>
          
        </ul>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me" q-show="aboutme">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">很惭愧&lt;br&gt;&lt;br&gt;只做了一点微小的工作&lt;br&gt;谢谢大家</div>
  	  	
    	</section>
    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>