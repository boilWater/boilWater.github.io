<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>SDWebImageä¹‹å›¾ç‰‡ç¼“å­˜å¤„ç† | JackJin's åšå®¢</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.1.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.2/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/2.2.3/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">SDWebImageä¹‹å›¾ç‰‡ç¼“å­˜å¤„ç†</h1><a id="logo" href="/.">JackJin's åšå®¢</a><p class="description">ä¸€ä½è„šè¸å®åœ°ï¼Œæ‹¥æœ‰æ¢¦æƒ³çš„90åï¼Œæƒ³è¦ä¸€ç›´åŠªåŠ›è¿½ä¸Šä½ ï¼</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> é¦–é¡µ</i></a><a href="/archives/"><i class="fa fa-archive"> å½’æ¡£</i></a><a href="/about/"><i class="fa fa-user"> å…³äº</i></a><a href="/atom.xml"><i class="fa fa-rss"> è®¢é˜…</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">SDWebImageä¹‹å›¾ç‰‡ç¼“å­˜å¤„ç†</h1><div class="post-meta">Jun 4, 2016<span> | </span><span class="category"><a href="/categories/ç¬¬ä¸‰æ–¹æ¡†æ¶/">ç¬¬ä¸‰æ–¹æ¡†æ¶</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-disqus-identifier="2016/06/04/SDWebImageä¹‹å›¾ç‰‡ç¼“å­˜åˆ†æ/" href="/2016/06/04/SDWebImageä¹‹å›¾ç‰‡ç¼“å­˜åˆ†æ/#disqus_thread" class="disqus-comment-count"></a><div class="post-content"><p>è¿™ç¯‡æ–‡ç« æˆ‘å°†æ¥ç€èŠ‚è®²è¿°å…³äºSDWebImageå›¾ç‰‡ä¸‹è½½åå¤„ç†æ–¹å¼ï¼Œç¼“å­˜è¿›è¡Œè®²è§£ã€‚<br><br><br>ç»è¿‡ä¸Šé¢æˆ‘ä»¬å¯ä»¥çŸ¥é“SDWebImageæ˜¯å¯ä»¥ä»è¿œç¨‹çš„æœåŠ¡å™¨åŠ è½½å›¾ç‰‡ï¼Œç„¶ååœ¨UIImageViewä¸Šè¿›è¡Œæ˜¾ç¤ºã€‚ä½†æ˜¯ä½ æœ‰æƒ³è¿‡SDWebImageåˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>åœ¨ä½¿ç”¨æ—¶æˆ‘ä»¬çŸ¥é“éœ€è¦å¯¼å…¥åŒ…ï¼šUIImageView+WebCache.hæˆ‘ä»¬å¯ä»¥æ ¹æ®è¿™çœ‹å‡ºSDWebImageæ˜¯ä¸€ä¸ªUIImageViewçš„åˆ†ç±»ï¼Œä½¿ç”¨Categoryè¿›è¡Œåˆ†è£…çš„ç±»ã€‚ä¸‹é¢åˆ—å‡ºSDWebImageå¯ä»¥å®ç°çš„åŠŸèƒ½ï¼š</p>
<p><ul></ul></p>
<p><li>æä¾›UIImageViewçš„ä¸€ä¸ªåˆ†ç±»ï¼Œå¯ä»¥å¯¹å›¾ç‰‡è¿›è¡Œå¼‚æ­¥åŠ è½½å’Œç¼“å­˜ç®¡ç†</li></p>
<p><li>ä¸€æ­¥å†…å­˜ &amp; ç£ç›˜ç®¡ç† &amp; è‡ªåŠ¨å¯¹è¿‡æœŸçš„ç¼“å­˜è¿›è¡Œç›¸å…³çš„å¤„ç†</li></p>
<p><li>ä¸€ä¸ªä¸€æ­¥å›¾ç‰‡çš„åŠ è½½å™¨</li></p>
<p><li>æ”¯æŒGIFçš„å›¾ç‰‡åŠ è½½</li></p>
<p><li>åå°å¯¹å›¾ç‰‡è¿›è¡Œè§£å‹å¤„ç†</li></p>
<p><li>ç¡®ä¿åŒæ„URLçš„å›¾ç‰‡ä¸ä¼šè¢«æ•°æ¬¡åŠ è½½</li></p>
<p><li>ç¡®ä¿è™šå‡çš„URLä¸ä¼šè¢«åå¤åŠ è½½</li></p>
<p><li>ç¡®ä¿ä¸‹è½½å’Œç¼“å­˜æ—¶ä¸»çº¿ç¨‹ä¸ä¼šè¢«é˜»å¡</li></p>
<p><li>ä¼˜è‰¯ä½¿ç”¨æ€§èƒ½</li></p>
<p><li>é‡‡ç”¨GCDå¯ä»¥é‡‡ç”¨å¹¶è¡Œå¤„ç†ï¼ŒIOS 5.0çš„ARCè‡ªåŠ¨è®¡æ•°åŸåˆ™</li></p>
<p><li>æ”¯æŒArm64(64ä½CPUå¤„ç†)</li><br></p>
<div style="color:#008B8B"><p><br>æœ¬ç¯‡åšå®¢æ˜¯åœ¨SDWebImageçš„å›¾ç‰‡åŠ è½½åŸºç¡€ä¹‹ä¸Šè¿›è¡Œæ¢ç´¢ï¼Œä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹ä¸‹SDWebImageæ˜¯å¦‚ä½•å®ç°å¯¹å›¾ç‰‡å®è¡Œç¼“å­˜å¤„ç†ã€‚</p></div>

<h3 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h3><p>SDImageCacheæ˜¯å›¾ç‰‡ä¸‹è½½åå†…å­˜ç¼“å­˜ç®¡ç†å’Œç£ç›˜ç¼“å­˜ç®¡ç†çš„ç±»ï¼Œä¸è¿‡è¿˜æ˜¯æˆ‘ä»¬æœ€å¸¸è§çš„å•ä¾‹æ¨¡å¼sharedImageCacheæ¥è¿›è¡Œå¾—åˆ°å®ä¾‹ã€‚é»˜è®¤çš„ç¼“å­˜ç©ºé—´ä¸Šæ˜¯defaultï¼Œå¦‚æœè‡ªå·±çœ‹ç€ä¸æ€ä¹ˆå¥½çš„è¯å¯ä»¥è‡ªå·±è¿›è¡Œç›¸å…³çš„ç©ºé—´ç”³è¯·ã€‚ä¸‹é¢æ˜¯SDWebCacheçš„ç®€ä»‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+ (SDImageCache *)sharedImageCache &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> once;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">id</span> instance;</span><br><span class="line">    <span class="built_in">dispatch_once</span>(&amp;once, ^&#123;</span><br><span class="line">        instance = [<span class="keyword">self</span> new];</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œä½¿ç”¨dispatch_onceçš„å½¢å¼æ¯æ¬¡å¼€å¯ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢å¤šä¸ªå•ä¾‹è¿›è¡ŒåŒæ—¶çš„åˆå§‹åŒ–ã€‚<a href="http://www.cocoachina.com/ios/20151117/14225.html" target="_blank" rel="external">è¯¦æƒ…å¯ä»¥å‚è€ƒGCDç›¸å…³çš„çŸ¥è¯†</a></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">id</span>)init &#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> initWithNamespace:<span class="string">@"default"</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)initWithNamespace:(<span class="built_in">NSString</span> *)ns &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *path = [<span class="keyword">self</span> makeDiskCachePath:ns];</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> initWithNamespace:ns diskCacheDirectory:path];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)initWithNamespace:(<span class="built_in">NSString</span> *)ns diskCacheDirectory:(<span class="built_in">NSString</span> *)directory &#123;</span><br><span class="line">    <span class="keyword">if</span> ((<span class="keyword">self</span> = [<span class="keyword">super</span> init])) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *fullNamespace = [<span class="string">@"com.hackemist.SDWebImageCache."</span> stringByAppendingString:ns];</span><br><span class="line"></span><br><span class="line">     <span class="comment">// initialise PNG signature data</span></span><br><span class="line">     kPNGSignatureData = [<span class="built_in">NSData</span> dataWithBytes:kPNGSignatureBytes length:<span class="number">8</span>];</span><br><span class="line"></span><br><span class="line">     <span class="comment">// Create IO serial queue</span></span><br><span class="line">     _ioQueue = dispatch_queue_create(<span class="string">"com.hackemist.SDWebImageCache"</span>, DISPATCH_QUEUE_SERIAL);</span><br><span class="line"></span><br><span class="line">     <span class="comment">// Init default values</span></span><br><span class="line">     _maxCacheAge = kDefaultCacheMaxCacheAge;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// Init the memory cache</span></span><br><span class="line">     _memCache = [[AutoPurgeCache alloc] init];</span><br><span class="line">     _memCache.name = fullNamespace;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// Init the disk cache</span></span><br><span class="line">     <span class="keyword">if</span> (directory != <span class="literal">nil</span>) &#123;</span><br><span class="line">         _diskCachePath = [directory stringByAppendingPathComponent:fullNamespace];</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="built_in">NSString</span> *path = [<span class="keyword">self</span> makeDiskCachePath:ns];</span><br><span class="line">         _diskCachePath = path;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// Set decompression to YES</span></span><br><span class="line">     _shouldDecompressImages = <span class="literal">YES</span>;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// memory cache enabled</span></span><br><span class="line">     _shouldCacheImagesInMemory = <span class="literal">YES</span>;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// Disable iCloud</span></span><br><span class="line">     _shouldDisableiCloud = <span class="literal">YES</span>;</span><br><span class="line"></span><br><span class="line">     <span class="built_in">dispatch_sync</span>(_ioQueue, ^&#123;</span><br><span class="line">         _fileManager = [<span class="built_in">NSFileManager</span> new];</span><br><span class="line">     &#125;);</span><br><span class="line"></span><br><span class="line"><span class="meta">#if TARGET_OS_IPHONE</span></span><br><span class="line">     <span class="comment">// Subscribe to app events</span></span><br><span class="line">     [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span></span><br><span class="line">                                              selector:<span class="keyword">@selector</span>(clearMemory)</span><br><span class="line">                                                  name:<span class="built_in">UIApplicationDidReceiveMemoryWarningNotification</span></span><br><span class="line">                                                object:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line">     [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span></span><br><span class="line">                                              selector:<span class="keyword">@selector</span>(cleanDisk)</span><br><span class="line">                                                  name:<span class="built_in">UIApplicationWillTerminateNotification</span></span><br><span class="line">                                                object:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line">     [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span></span><br><span class="line">                                              selector:<span class="keyword">@selector</span>(backgroundCleanDisk)</span><br><span class="line">                                                  name:<span class="built_in">UIApplicationDidEnterBackgroundNotification</span></span><br><span class="line">                                                object:<span class="literal">nil</span>];</span><br><span class="line"><span class="meta">#endif</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<div style="color:#008B8B"><p><br>ä¸Šé¢æˆ‘ä»¬å¯ä»¥çœ‹å‡ºåœ¨æˆ‘ä»¬ä½¿ç”¨initæ¥è¿›è¡Œåˆå§‹åŒ–ç¼“å­˜ç©ºé—´ï¼Œç´§æ¥ç€å°±è°ƒç”¨initWithNamespace: &amp; initWithNamespace: diskCacheDirectory:æ¥è¿›ä¸€æ­¥å¯¹ç£ç›˜è¿›è¡Œç¼“å­˜ç©ºé—´çš„åˆå§‹åŒ–ã€‚<br></p></div>

<h3 id="å†…å­˜ç¼“å­˜ç±»"><a href="#å†…å­˜ç¼“å­˜ç±»" class="headerlink" title="å†…å­˜ç¼“å­˜ç±»"></a>å†…å­˜ç¼“å­˜ç±»</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AutoPurgeCache</span> : <span class="title">NSCache</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">AutoPurgeCache</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)init</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</span><br><span class="line">        [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(removeAllObjects) name:<span class="built_in">UIApplicationDidReceiveMemoryWarningNotification</span> object:<span class="literal">nil</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)dealloc</span><br><span class="line">&#123;</span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] removeObserver:<span class="keyword">self</span> name:<span class="built_in">UIApplicationDidReceiveMemoryWarningNotification</span> object:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢æˆ‘ä»¬å¯ä»¥çœ‹å‡ºåœ¨ç¼“å­˜è¿‡ç¨‹ä¸­æˆ‘ä»¬é‡‡ç”¨çš„æ˜¯NSCacheçš„å­ç±»AutoPurgeCacheè¿›è¡Œçº¿ç®¡çš„ç¼“å­˜å¤„ç†ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨NSdictionaryæ¥è¿›è¡Œå¤„ç†ï¼Œä¸ºä»€ä¹ˆä¸ä½¿ç”¨å‘¢ï¼Ÿåé¢æˆ‘å°†ä¼šè®²å‡ºğŸ˜¸ã€‚è¿”å›ä¸Šé¢ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºåœ¨ç¼“å­˜æ—¶æˆ‘ä»¬é‡‡ç”¨æ³¨å†Œå’Œç›‘å¬çš„æ¨¡å¼å¯¹ç¼“å­˜çš„å†…å­˜ç›‘å¬ï¼Œä¸€æ—¦ç¼“å­˜æ•°æ®è¾¾åˆ°ä¸´ç•Œç‚¹å°±è¦æ¡ç”¨removeAllObjectsã€‚è¿™é‡Œæœ‰å…³äºæ–¹æ³•åœ¨è¿è¡Œæ—¶ç¼–è¯‘æƒ…å†µä¸‹çš„è¿‡ç¨‹<br><a href="http://boilwater.github.io/2016/05/29/runtimeç†è§£/" target="_blank" rel="external">runtimeè§£æ</a>ã€‚</p>
<div style="color:#008B8B"><p><br>åœ¨ç¼“å­˜è¿‡ç¨‹ä¸­æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯NSCacheè€Œä¸æ˜¯ç”¨NSDictionaryå‘¢ï¼Œä¸‹é¢æˆ‘ä»¬çœ‹ä¸‹NSCacheçš„ä¼˜ç‚¹ï¼š<br><ul><br><li>è‡ªåŠ¨åˆ å‡åŠŸèƒ½</li><br><li>çº¿ç¨‹å®‰å…¨</li><br><li>ä¸ä¼šæ‹·è´å¥</li><br></ul><br>åŸºäºä¸Šé¢NSCacheçš„ç‰¹ç‚¹é€‰ç€ä½¿ç”¨NSCacheæ˜¯æ›´åŠ æ˜“äºå¯¹ç¼“å­˜çš„ç®¡ç†<br></p></div>

<p><a href="http://thenewself.blog.163.com/blog/static/198501330201251311025928/" target="_blank" rel="external">NSCacheçš„å‚è€ƒèµ„æ–™</a><br><br></p>
<h2 id="ç¼“å­˜åœ¨APPå‘¨æœŸçš„è®¾ç½®"><a href="#ç¼“å­˜åœ¨APPå‘¨æœŸçš„è®¾ç½®" class="headerlink" title="ç¼“å­˜åœ¨APPå‘¨æœŸçš„è®¾ç½®"></a>ç¼“å­˜åœ¨APPå‘¨æœŸçš„è®¾ç½®</h2><p>åœ¨åº”ç”¨å¼€å‘å¯¹å†…å®¹ç¼“å­˜çš„è¿‡ç¨‹æˆ‘ä»¬ä¹Ÿå¯ä»¥å‚è€ƒä¸‹é¢ç¼“å­˜çš„å¤„ç†æœºåˆ¶ï¼Œè¿™ä¹Ÿå¯¹æˆ‘ä»¬APPçš„æ€§èƒ½ä¼šæœ‰æ¯”è¾ƒå¤§çš„æå‡ã€‚ä¸‹é¢æŒ‰ç…§APPçš„åˆ†ä¸ºï¼šå†…å­˜è­¦å‘Šã€ç¨‹åºç»ˆæ­¢å’Œåå°ä¸‰ç§æƒ…å†µå®ç°ç¼“å­˜ç­–ç•¥ã€‚</p>
<h3 id="å†…å­˜è­¦å‘Š"><a href="#å†…å­˜è­¦å‘Š" class="headerlink" title="å†…å­˜è­¦å‘Š"></a>å†…å­˜è­¦å‘Š</h3><p>åœ¨æˆ‘ä»¬ä½¿ç”¨SDWebImageè¿‡ç¨‹æ—¶ç¨‹åºä¸€ç›´éƒ½ä¼šå¯¹æˆ‘ä»¬è®¿çš„å›¾ç‰‡è¿›è¡Œç›¸å…³ç¼“å­˜å¤„ç†ï¼Œä½†æ˜¯å½“æˆ‘ä»¬ç¼“å­˜è¾ƒå¤§æ—¶å°±ä¼šäº§ç”Ÿè­¦å‘Š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)clearMemory &#123;</span><br><span class="line">    [<span class="keyword">self</span>.memCache removeAllObjects];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢æ˜¯æˆ‘ä»¬æ³¨å†Œå‘ç°å†…å­˜è¿‡å¤§éœ€è¦è°ƒç”¨çš„æ–¹æ³•ã€‚</p>
<h3 id="ç¨‹åºç»ˆæ­¢"><a href="#ç¨‹åºç»ˆæ­¢" class="headerlink" title="ç¨‹åºç»ˆæ­¢"></a>ç¨‹åºç»ˆæ­¢</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)cleanDisk &#123;</span><br><span class="line">    [<span class="keyword">self</span> cleanDiskWithCompletionBlock:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)cleanDiskWithCompletionBlock:(SDWebImageNoParamsBlock)completionBlock &#123;</span><br><span class="line">    <span class="built_in">dispatch_async</span>(<span class="keyword">self</span>.ioQueue, ^&#123;</span><br><span class="line">        <span class="built_in">NSURL</span> *diskCacheURL = [<span class="built_in">NSURL</span> fileURLWithPath:<span class="keyword">self</span>.diskCachePath isDirectory:<span class="literal">YES</span>];</span><br><span class="line">        <span class="built_in">NSArray</span> *resourceKeys = @[<span class="built_in">NSURLIsDirectoryKey</span>, <span class="built_in">NSURLContentModificationDateKey</span>, <span class="built_in">NSURLTotalFileAllocatedSizeKey</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// This enumerator prefetches useful properties for our cache files.</span></span><br><span class="line">      <span class="built_in">NSDirectoryEnumerator</span> *fileEnumerator = [_fileManager enumeratorAtURL:diskCacheURL</span><br><span class="line">                                                 includingPropertiesForKeys:resourceKeys</span><br><span class="line">                                                                    options:<span class="built_in">NSDirectoryEnumerationSkipsHiddenFiles</span></span><br><span class="line">                                                               errorHandler:<span class="literal">NULL</span>];</span><br><span class="line"></span><br><span class="line">      <span class="built_in">NSDate</span> *expirationDate = [<span class="built_in">NSDate</span> dateWithTimeIntervalSinceNow:-<span class="keyword">self</span>.maxCacheAge];</span><br><span class="line">      <span class="built_in">NSMutableDictionary</span> *cacheFiles = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line">      <span class="built_in">NSUInteger</span> currentCacheSize = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Enumerate all of the files in the cache directory.  This loop has two purposes:</span></span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">      <span class="comment">//  1. Removing files that are older than the expiration date.</span></span><br><span class="line">      <span class="comment">//  2. Storing file attributes for the size-based cleanup pass.</span></span><br><span class="line">      <span class="built_in">NSMutableArray</span> *urlsToDelete = [[<span class="built_in">NSMutableArray</span> alloc] init];</span><br><span class="line">      <span class="keyword">for</span> (<span class="built_in">NSURL</span> *fileURL <span class="keyword">in</span> fileEnumerator) &#123;</span><br><span class="line">          <span class="built_in">NSDictionary</span> *resourceValues = [fileURL resourceValuesForKeys:resourceKeys error:<span class="literal">NULL</span>];</span><br><span class="line"></span><br><span class="line">          <span class="comment">// Skip directories.</span></span><br><span class="line">          <span class="keyword">if</span> ([resourceValues[<span class="built_in">NSURLIsDirectoryKey</span>] boolValue]) &#123;</span><br><span class="line">              <span class="keyword">continue</span>;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// Remove files that are older than the expiration date;</span></span><br><span class="line">          <span class="built_in">NSDate</span> *modificationDate = resourceValues[<span class="built_in">NSURLContentModificationDateKey</span>];</span><br><span class="line">          <span class="keyword">if</span> ([[modificationDate laterDate:expirationDate] isEqualToDate:expirationDate]) &#123;</span><br><span class="line">              [urlsToDelete addObject:fileURL];</span><br><span class="line">              <span class="keyword">continue</span>;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// Store a reference to this file and account for its total size.</span></span><br><span class="line">          <span class="built_in">NSNumber</span> *totalAllocatedSize = resourceValues[<span class="built_in">NSURLTotalFileAllocatedSizeKey</span>];</span><br><span class="line">          currentCacheSize += [totalAllocatedSize unsignedIntegerValue];</span><br><span class="line">          [cacheFiles setObject:resourceValues forKey:fileURL];</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">for</span> (<span class="built_in">NSURL</span> *fileURL <span class="keyword">in</span> urlsToDelete) &#123;</span><br><span class="line">          [_fileManager removeItemAtURL:fileURL error:<span class="literal">nil</span>];</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// If our remaining disk cache exceeds a configured maximum size, perform a second</span></span><br><span class="line">      <span class="comment">// size-based cleanup pass.  We delete the oldest files first.</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">self</span>.maxCacheSize &gt; <span class="number">0</span> &amp;&amp; currentCacheSize &gt; <span class="keyword">self</span>.maxCacheSize) &#123;</span><br><span class="line">          <span class="comment">// Target half of our maximum cache size for this cleanup pass.</span></span><br><span class="line">          <span class="keyword">const</span> <span class="built_in">NSUInteger</span> desiredCacheSize = <span class="keyword">self</span>.maxCacheSize / <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Sort the remaining cache files by their last modification time (oldest first).</span></span><br><span class="line">        <span class="built_in">NSArray</span> *sortedFiles = [cacheFiles keysSortedByValueWithOptions:<span class="built_in">NSSortConcurrent</span></span><br><span class="line">                                                        usingComparator:^<span class="built_in">NSComparisonResult</span>(<span class="keyword">id</span> obj1, <span class="keyword">id</span> obj2) &#123;</span><br><span class="line">                                                            <span class="keyword">return</span> [obj1[<span class="built_in">NSURLContentModificationDateKey</span>] compare:obj2[<span class="built_in">NSURLContentModificationDateKey</span>]];</span><br><span class="line">                                                        &#125;];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Delete files until we fall below our desired cache size.</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">NSURL</span> *fileURL <span class="keyword">in</span> sortedFiles) &#123;</span><br><span class="line">            <span class="keyword">if</span> ([_fileManager removeItemAtURL:fileURL error:<span class="literal">nil</span>]) &#123;</span><br><span class="line">                <span class="built_in">NSDictionary</span> *resourceValues = cacheFiles[fileURL];</span><br><span class="line">                <span class="built_in">NSNumber</span> *totalAllocatedSize = resourceValues[<span class="built_in">NSURLTotalFileAllocatedSizeKey</span>];</span><br><span class="line">                currentCacheSize -= [totalAllocatedSize unsignedIntegerValue];</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (currentCacheSize &lt; desiredCacheSize) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (completionBlock) &#123;</span><br><span class="line">          <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">              completionBlock();</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢æˆ‘ä»¬å¯ä»¥çœ‹å‡ºå½“æ”¶åˆ°UIApplicationWillTerminateNotificationæ—¶ï¼ŒSDImageCacheå°†ä¼šä½¿ç”¨ioQueueå¼‚æ­¥åœ°æ¸…ç†ç£ç›˜ç¼“å­˜ã€‚</p>
<p>æ¸…é™¤è¿‡ç¨‹çš„é€»è¾‘å¦‚ä¸‹ï¼š</p>
<div style="color:#008B8B"><p><br><ul><br><li>å…ˆæ¸…é™¤å·²è¶…è¿‡æœ€å¤§ç¼“å­˜æ—¶é—´çš„ç¼“å­˜æ–‡ä»¶ï¼ˆæœ€å¤§ç¼“å­˜æ—¶é—´é»˜è®¤ä¸ºä¸€æ˜ŸæœŸï¼‰</li><br><li>åœ¨ç¬¬ä¸€è½®æ¸…é™¤çš„è¿‡ç¨‹ä¸­ä¿å­˜æ–‡ä»¶å±æ€§ï¼Œç‰¹åˆ«æ˜¯ç¼“å­˜æ–‡ä»¶å¤§å°</li><br><li>åœ¨ç¬¬ä¸€è½®æ¸…é™¤åï¼Œå¦‚æœè®¾ç½®äº†æœ€å¤§ç¼“å­˜å¹¶ä¸”ä¿ç•™ä¸‹æ¥çš„ç£ç›˜ç¼“å­˜æ–‡ä»¶ä»ç„¶è¶…è¿‡äº†é…ç½®çš„æœ€å¤§ç¼“å­˜ï¼Œé‚£ä¹ˆè¿›è¡Œç¬¬äºŒè½®ä»¥å¤§å°ä¸ºåŸºç¡€çš„æ¸…é™¤ã€‚</li><br><li>é¦–å…ˆåˆ é™¤æœ€è€çš„æ–‡ä»¶ï¼Œç›´åˆ°è¾¾åˆ°æœŸæœ›çš„æ€»çš„ç¼“å­˜å¤§å°ï¼Œå³æœ€å¤§ç¼“å­˜çš„ä¸€åŠã€‚</li><br></ul><br></p></div>

<h3 id="ç¨‹åºè¿›å…¥åå°"><a href="#ç¨‹åºè¿›å…¥åå°" class="headerlink" title="ç¨‹åºè¿›å…¥åå°"></a>ç¨‹åºè¿›å…¥åå°</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)backgroundCleanDisk &#123;</span><br><span class="line">    Class <span class="built_in">UIApplicationClass</span> = <span class="built_in">NSClassFromString</span>(<span class="string">@"UIApplication"</span>);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">UIApplicationClass</span> || ![<span class="built_in">UIApplicationClass</span> respondsToSelector:<span class="keyword">@selector</span>(sharedApplication)]) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">UIApplication</span> *application = [<span class="built_in">UIApplication</span> performSelector:<span class="keyword">@selector</span>(sharedApplication)];</span><br><span class="line">    __block <span class="built_in">UIBackgroundTaskIdentifier</span> bgTask = [application beginBackgroundTaskWithExpirationHandler:^&#123;</span><br><span class="line">        <span class="comment">// Clean up any unfinished task business by marking where you</span></span><br><span class="line">        <span class="comment">// stopped or ending the task outright.</span></span><br><span class="line">        [application endBackgroundTask:bgTask];</span><br><span class="line">        bgTask = <span class="built_in">UIBackgroundTaskInvalid</span>;</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">   <span class="comment">// Start the long-running task and return immediately.</span></span><br><span class="line">   [<span class="keyword">self</span> cleanDiskWithCompletionBlock:^&#123;</span><br><span class="line">       [application endBackgroundTask:bgTask];</span><br><span class="line">       bgTask = <span class="built_in">UIBackgroundTaskInvalid</span>;</span><br><span class="line">   &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“æ”¶åˆ°UIApplicationDidEnterBackgroundNotificationæ—¶ï¼Œåœ¨æ‰‹æœºç³»ç»Ÿåå°è¿›è¡Œå¦‚ä¸Šé¢æè¿°çš„å¼‚æ­¥ç£ç›˜ç¼“å­˜æ¸…ç†ã€‚è¿™é‡Œåˆ©ç”¨Objectiveï¼Cçš„åŠ¨æ€è¯­è¨€ç‰¹æ€§ï¼Œå¾—åˆ°UIApplicationçš„å•ä¾‹sharedApplicationï¼Œä½¿ç”¨sharedApplicationå¼€å¯åå°ä»»åŠ¡cleanDiskWithCompletionBlock:</p>
<p><a href="http://boilwater.github.io/2016/05/29/runtimeç†è§£/" target="_blank" rel="external">runtimeçš„è¯¦è§£</a></p>
<h3 id="æŸ¥è¯¢å›¾ç‰‡"><a href="#æŸ¥è¯¢å›¾ç‰‡" class="headerlink" title="æŸ¥è¯¢å›¾ç‰‡"></a>æŸ¥è¯¢å›¾ç‰‡</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSOperation</span> *)queryDiskCacheForKey:(<span class="built_in">NSString</span> *)key done:(SDWebImageQueryCompletedBlock)doneBlock &#123;</span><br><span class="line">   <span class="keyword">if</span> (!doneBlock) &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (!key) &#123;</span><br><span class="line">       doneBlock(<span class="literal">nil</span>, SDImageCacheTypeNone);</span><br><span class="line">       <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// First check the in-memory cache...</span></span><br><span class="line">   <span class="built_in">UIImage</span> *image = [<span class="keyword">self</span> imageFromMemoryCacheForKey:key];</span><br><span class="line">   <span class="keyword">if</span> (image) &#123;</span><br><span class="line">       doneBlock(image, SDImageCacheTypeMemory);</span><br><span class="line">       <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="built_in">NSOperation</span> *operation = [<span class="built_in">NSOperation</span> new];</span><br><span class="line">   <span class="built_in">dispatch_async</span>(<span class="keyword">self</span>.ioQueue, ^&#123;</span><br><span class="line">       <span class="keyword">if</span> (operation.isCancelled) &#123;</span><br><span class="line">           <span class="keyword">return</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">           <span class="built_in">UIImage</span> *diskImage = [<span class="keyword">self</span> diskImageForKey:key];</span><br><span class="line">           <span class="keyword">if</span> (diskImage &amp;&amp; <span class="keyword">self</span>.shouldCacheImagesInMemory) &#123;</span><br><span class="line">               <span class="built_in">NSUInteger</span> cost = SDCacheCostForImage(diskImage);</span><br><span class="line">               [<span class="keyword">self</span>.memCache setObject:diskImage forKey:key cost:cost];</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">               doneBlock(diskImage, SDImageCacheTypeDisk);</span><br><span class="line">           &#125;);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> operation;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æŸ¥è¯¢ç¼“å­˜ï¼Œé»˜è®¤ä½¿ç”¨æ–¹æ³•queryDiskCacheForKey:done:ï¼Œå¦‚æœæ­¤æ–¹æ³•è¿”å›nilï¼Œåˆ™è¯´æ˜ç¼“å­˜ä¸­ç°åœ¨è¿˜æ²¡æœ‰è¿™å¼ ç…§ç‰‡ï¼Œå› æ­¤ä½ éœ€è¦å¾—åˆ°å¹¶ç¼“å­˜è¿™å¼ å›¾ç‰‡ã€‚ç¼“å­˜keyæ˜¯ç¼“å­˜å›¾ç‰‡çš„ç¨‹åºå”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œä¸€èˆ¬ä½¿ç”¨å›¾ç‰‡çš„å®Œæ•´URLã€‚</p>
<p>å¦‚æœä¸æƒ³SDImageCacheæŸ¥è¯¢ç£ç›˜ç¼“å­˜ï¼Œä½ å¯ä»¥è°ƒç”¨å¦ä¸€ä¸ªæ–¹æ³•ï¼šimageFromMemoryCacheForKey:ã€‚</p>
<p>è¿”å›å€¼ä¸ºNSOprationï¼Œå•ç‹¬ä½¿ç”¨SDImageCacheæ²¡ç”¨ï¼Œä½†æ˜¯ä½¿ç”¨SDWebImageManagerå°±å¯ä»¥å¯¹å¤šä¸ªä»»åŠ¡çš„ä¼˜å…ˆçº§ã€ä¾èµ–ï¼Œå¹¶ä¸”å¯ä»¥å–æ¶ˆã€‚</p>
<p>è‡ªå®šä¹‰@autoreleasepoolï¼Œautoreleasepoolä»£ç æ®µé‡Œé¢æœ‰å¤§é‡çš„å†…å­˜æ¶ˆè€—æ“ä½œï¼Œè‡ªå®šä¹‰autoreleasepoolå¯ä»¥åŠæ—¶åœ°é‡Šæ”¾æ‰å†…å­˜ã€‚<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSString</span> *)cachePathForKey:(<span class="built_in">NSString</span> *)key inPath:(<span class="built_in">NSString</span> *)path &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *filename = [<span class="keyword">self</span> cachedFileNameForKey:key];</span><br><span class="line">    <span class="keyword">return</span> [path stringByAppendingPathComponent:filename];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *)defaultCachePathForKey:(<span class="built_in">NSString</span> *)key &#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> cachePathForKey:key inPath:<span class="keyword">self</span>.diskCachePath];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark SDImageCache (private)</span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *)cachedFileNameForKey:(<span class="built_in">NSString</span> *)key &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *str = [key UTF8String];</span><br><span class="line">    <span class="keyword">if</span> (str == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        str = <span class="string">""</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> r[CC_MD5_DIGEST_LENGTH];</span><br><span class="line">    CC_MD5(str, (CC_LONG)strlen(str), r);</span><br><span class="line">    <span class="built_in">NSString</span> *filename = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%@"</span>,</span><br><span class="line">                          r[<span class="number">0</span>], r[<span class="number">1</span>], r[<span class="number">2</span>], r[<span class="number">3</span>], r[<span class="number">4</span>], r[<span class="number">5</span>], r[<span class="number">6</span>], r[<span class="number">7</span>], r[<span class="number">8</span>], r[<span class="number">9</span>], r[<span class="number">10</span>],</span><br><span class="line">                          r[<span class="number">11</span>], r[<span class="number">12</span>], r[<span class="number">13</span>], r[<span class="number">14</span>], r[<span class="number">15</span>], [[key pathExtension] isEqualToString:<span class="string">@""</span>] ? <span class="string">@""</span> : [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@".%@"</span>, [key pathExtension]]];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> filename;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSData</span> *)diskImageDataBySearchingAllPathsForKey:(<span class="built_in">NSString</span> *)key &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *defaultPath = [<span class="keyword">self</span> defaultCachePathForKey:key];</span><br><span class="line">    <span class="built_in">NSData</span> *data = [<span class="built_in">NSData</span> dataWithContentsOfFile:defaultPath];</span><br><span class="line">    <span class="keyword">if</span> (data) &#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// fallback because of https://github.com/rs/SDWebImage/pull/976 that added the extension to the disk file name</span></span><br><span class="line">    <span class="comment">// checking the key with and without the extension</span></span><br><span class="line">    data = [<span class="built_in">NSData</span> dataWithContentsOfFile:[defaultPath stringByDeletingPathExtension]];</span><br><span class="line">    <span class="keyword">if</span> (data) &#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">NSArray</span> *customPaths = [<span class="keyword">self</span>.customPaths <span class="keyword">copy</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">NSString</span> *path <span class="keyword">in</span> customPaths) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *filePath = [<span class="keyword">self</span> cachePathForKey:key inPath:path];</span><br><span class="line">        <span class="built_in">NSData</span> *imageData = [<span class="built_in">NSData</span> dataWithContentsOfFile:filePath];</span><br><span class="line">        <span class="keyword">if</span> (imageData) &#123;</span><br><span class="line">            <span class="keyword">return</span> imageData;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// fallback because of https://github.com/rs/SDWebImage/pull/976 that added the extension to the disk file name</span></span><br><span class="line">        <span class="comment">// checking the key with and without the extension</span></span><br><span class="line">        imageData = [<span class="built_in">NSData</span> dataWithContentsOfFile:[filePath stringByDeletingPathExtension]];</span><br><span class="line">        <span class="keyword">if</span> (imageData) &#123;</span><br><span class="line">            <span class="keyword">return</span> imageData;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<div style="color:#008B8B"><p><br>ä¸Šé¢ä»£ç æ®µæ˜¯ä»ç£ç›˜è·å–å›¾ç‰‡çš„ä»£ç ã€‚å¾—åˆ°å›¾ç‰‡å¯¹åº”çš„UIDataåï¼Œè¿˜è¦ç»è¿‡å¦‚ä¸‹æ­¥éª¤ï¼Œæ‰èƒ½è¿”å›å¯¹åº”çš„å›¾ç‰‡ï¼š<br><ul><br><li>æ ¹æ®å›¾ç‰‡çš„ä¸åŒç§ç±»ï¼Œç”Ÿæˆå¯¹åº”çš„UIImage</li><br><li>æ ¹æ®keyå€¼ï¼Œè°ƒæ•´imageçš„scaleå€¼</li><br><li>å¦‚æœè®¾ç½®å›¾ç‰‡éœ€è¦è§£å‹ç¼©ï¼Œåˆ™è¿˜éœ€å¯¹UIImageè¿›è¡Œè§£ç </li><br></ul><br></p></div>

<h3 id="ä¸‹é¢æ˜¯MD5çš„åŠ å¯†æ–¹å¼"><a href="#ä¸‹é¢æ˜¯MD5çš„åŠ å¯†æ–¹å¼" class="headerlink" title="ä¸‹é¢æ˜¯MD5çš„åŠ å¯†æ–¹å¼"></a>ä¸‹é¢æ˜¯MD5çš„åŠ å¯†æ–¹å¼</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSString</span> *)cachedFileNameForKey:(<span class="built_in">NSString</span> *)key &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *str = [key UTF8String];</span><br><span class="line">    <span class="keyword">if</span> (str == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        str = <span class="string">""</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> r[CC_MD5_DIGEST_LENGTH];</span><br><span class="line">    CC_MD5(str, (CC_LONG)strlen(str), r);</span><br><span class="line">    <span class="built_in">NSString</span> *filename = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%@"</span>,</span><br><span class="line">                          r[<span class="number">0</span>], r[<span class="number">1</span>], r[<span class="number">2</span>], r[<span class="number">3</span>], r[<span class="number">4</span>], r[<span class="number">5</span>], r[<span class="number">6</span>], r[<span class="number">7</span>], r[<span class="number">8</span>], r[<span class="number">9</span>], r[<span class="number">10</span>],</span><br><span class="line">                          r[<span class="number">11</span>], r[<span class="number">12</span>], r[<span class="number">13</span>], r[<span class="number">14</span>], r[<span class="number">15</span>], [[key pathExtension] isEqualToString:<span class="string">@""</span>] ? <span class="string">@""</span> : [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@".%@"</span>, [key pathExtension]]];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> filename;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å›¾ç‰‡çš„ä¿å­˜"><a href="#å›¾ç‰‡çš„ä¿å­˜" class="headerlink" title="å›¾ç‰‡çš„ä¿å­˜"></a>å›¾ç‰‡çš„ä¿å­˜</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)storeImage:(<span class="built_in">UIImage</span> *)image recalculateFromImage:(<span class="built_in">BOOL</span>)recalculate imageData:(<span class="built_in">NSData</span> *)imageData forKey:(<span class="built_in">NSString</span> *)key toDisk:(<span class="built_in">BOOL</span>)toDisk &#123;</span><br><span class="line">    <span class="keyword">if</span> (!image || !key) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// if memory cache is enabled</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.shouldCacheImagesInMemory) &#123;</span><br><span class="line">        <span class="built_in">NSUInteger</span> cost = SDCacheCostForImage(image);</span><br><span class="line">        [<span class="keyword">self</span>.memCache setObject:image forKey:key cost:cost];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (toDisk) &#123;</span><br><span class="line">        <span class="built_in">dispatch_async</span>(<span class="keyword">self</span>.ioQueue, ^&#123;</span><br><span class="line">            <span class="built_in">NSData</span> *data = imageData;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (image &amp;&amp; (recalculate || !data)) &#123;</span><br><span class="line"><span class="meta">#if TARGET_OS_IPHONE</span></span><br><span class="line">                <span class="comment">// We need to determine if the image is a PNG or a JPEG</span></span><br><span class="line">                <span class="comment">// PNGs are easier to detect because they have a unique signature (http://www.w3.org/TR/PNG-Structure.html)</span></span><br><span class="line">                <span class="comment">// The first eight bytes of a PNG file always contain the following (decimal) values:</span></span><br><span class="line">                <span class="comment">// 137 80 78 71 13 10 26 10</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// If the imageData is nil (i.e. if trying to save a UIImage directly or the image was transformed on download)</span></span><br><span class="line">                <span class="comment">// and the image has an alpha channel, we will consider it PNG to avoid losing the transparency</span></span><br><span class="line">                <span class="keyword">int</span> alphaInfo = <span class="built_in">CGImageGetAlphaInfo</span>(image.CGImage);</span><br><span class="line">                <span class="built_in">BOOL</span> hasAlpha = !(alphaInfo == kCGImageAlphaNone ||</span><br><span class="line">                                  alphaInfo == kCGImageAlphaNoneSkipFirst ||</span><br><span class="line">                                  alphaInfo == kCGImageAlphaNoneSkipLast);</span><br><span class="line">                <span class="built_in">BOOL</span> imageIsPng = hasAlpha;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// But if we have an image data, we will look at the preffix</span></span><br><span class="line">                <span class="keyword">if</span> ([imageData length] &gt;= [kPNGSignatureData length]) &#123;</span><br><span class="line">                    imageIsPng = ImageDataHasPNGPreffix(imageData);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (imageIsPng) &#123;</span><br><span class="line">                    data = <span class="built_in">UIImagePNGRepresentation</span>(image);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    data = <span class="built_in">UIImageJPEGRepresentation</span>(image, (<span class="built_in">CGFloat</span>)<span class="number">1.0</span>);</span><br><span class="line">                &#125;</span><br><span class="line"><span class="meta">#else</span></span><br><span class="line">                data = [<span class="built_in">NSBitmapImageRep</span> representationOfImageRepsInArray:image.representations usingType: <span class="built_in">NSJPEGFileType</span> properties:<span class="literal">nil</span>];</span><br><span class="line"><span class="meta">#endif</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (data) &#123;</span><br><span class="line">                <span class="keyword">if</span> (![_fileManager fileExistsAtPath:_diskCachePath]) &#123;</span><br><span class="line">                    [_fileManager createDirectoryAtPath:_diskCachePath withIntermediateDirectories:<span class="literal">YES</span> attributes:<span class="literal">nil</span> error:<span class="literal">NULL</span>];</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// get cache Path for image key</span></span><br><span class="line">                <span class="built_in">NSString</span> *cachePathForKey = [<span class="keyword">self</span> defaultCachePathForKey:key];</span><br><span class="line">                <span class="comment">// transform to NSUrl</span></span><br><span class="line">                <span class="built_in">NSURL</span> *fileURL = [<span class="built_in">NSURL</span> fileURLWithPath:cachePathForKey];</span><br><span class="line"></span><br><span class="line">                [_fileManager createFileAtPath:cachePathForKey contents:data attributes:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line">                <span class="comment">// disable iCloud backup</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">self</span>.shouldDisableiCloud) &#123;</span><br><span class="line">                    [fileURL setResourceValue:[<span class="built_in">NSNumber</span> numberWithBool:<span class="literal">YES</span>] forKey:<span class="built_in">NSURLIsExcludedFromBackupKey</span> error:<span class="literal">nil</span>];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)storeImage:(<span class="built_in">UIImage</span> *)image forKey:(<span class="built_in">NSString</span> *)key &#123;</span><br><span class="line">    [<span class="keyword">self</span> storeImage:image recalculateFromImage:<span class="literal">YES</span> imageData:<span class="literal">nil</span> forKey:key toDisk:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)storeImage:(<span class="built_in">UIImage</span> *)image forKey:(<span class="built_in">NSString</span> *)key toDisk:(<span class="built_in">BOOL</span>)toDisk &#123;</span><br><span class="line">    [<span class="keyword">self</span> storeImage:image recalculateFromImage:<span class="literal">YES</span> imageData:<span class="literal">nil</span> forKey:key toDisk:toDisk];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å­˜å‚¨ä¸€ä¸ªå›¾ç‰‡åˆ°ç¼“å­˜ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ–¹æ³•storeImage:forKey:method:ï¼Œé»˜è®¤ï¼Œå›¾ç‰‡æ—¢ä¼šå­˜å‚¨åˆ°å†…å­˜ç¼“å­˜ä¸­ï¼Œä¹Ÿä¼šå¼‚æ­¥åœ°ä¿å­˜åˆ°ç£ç›˜ç¼“å­˜ä¸­ã€‚å¦‚æœåªæƒ³ä½¿ç”¨å†…å­˜ç¼“å­˜ï¼Œå¯ä»¥ä½¿ç”¨å¦å¤–ä¸€ä¸ªæ–¹æ³•storeImage:forKey:toDiskï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¼ å…¥falseå€¼å°±å¥½äº†ã€‚</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://yoursite.com/2016/06/04/SDWebImageä¹‹å›¾ç‰‡ç¼“å­˜åˆ†æ/" data-id="cj2kni9rp001l6r421m1sl6ix" class="article-share-link">åˆ†äº«åˆ°</a><div class="tags"><a href="/tags/ä¸‰æ–¹æ¡†æ¶è§£æ/">ä¸‰æ–¹æ¡†æ¶è§£æ</a></div><div class="post-nav"><a href="/2016/06/15/IOS 10/" class="pre">IOS 10.0</a><a href="/2016/06/03/SDWebImage/" class="next">SDWebImageä¹‹å›¾ç‰‡ä¸‹è½½</a></div><div id="disqus_thread"><script>var disqus_shortname = 'JackJin## Your disqus_shortname, e.g. username';
var disqus_identifier = '2016/06/04/SDWebImageä¹‹å›¾ç‰‡ç¼“å­˜åˆ†æ/';
var disqus_title = 'SDWebImageä¹‹å›¾ç‰‡ç¼“å­˜å¤„ç†';
var disqus_url = 'http://yoursite.com/2016/06/04/SDWebImageä¹‹å›¾ç‰‡ç¼“å­˜åˆ†æ/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//JackJin## Your disqus_shortname, e.g. username.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="search" name="word" maxlength="20" placeholder="Search"/><input type="hidden" name="si" value="http://yoursite.com"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> åˆ†ç±»</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/IOS/">IOS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ç¬¬ä¸‰æ–¹æ¡†æ¶/">ç¬¬ä¸‰æ–¹æ¡†æ¶</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/è§†å›¾-å›¾å±‚-åŠ¨ç”»/">è§†å›¾&å›¾å±‚&åŠ¨ç”»</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/éšç¬”/">éšç¬”</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> æ ‡ç­¾</i></div><div class="tagcloud"><a href="/tags/IOS/" style="font-size: 15px;">IOS</a> <a href="/tags/éšç¬”/" style="font-size: 15px;">éšç¬”</a> <a href="/tags/IOSåŸºç¡€çŸ¥è¯†/" style="font-size: 15px;">IOSåŸºç¡€çŸ¥è¯†</a> <a href="/tags/å›¾ç‰‡è§†é¢‘/" style="font-size: 15px;">å›¾ç‰‡è§†é¢‘</a> <a href="/tags/ä¸‰æ–¹æ¡†æ¶è§£æ/" style="font-size: 15px;">ä¸‰æ–¹æ¡†æ¶è§£æ</a> <a href="/tags/åšå®¢ä¹‹åˆ/" style="font-size: 15px;">åšå®¢ä¹‹åˆ</a> <a href="/tags/è§†é¢‘å¿ƒå¾—/" style="font-size: 15px;">è§†é¢‘å¿ƒå¾—</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> æœ€æ–°æ–‡ç« </i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/01/16/16æ€»ç»“-17å±•æœ›/">2016å¹´æœ«~2017å¹´åˆ</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/13/APPæ§ä»¶åœ¨å±å¹•ä¸Šæ˜¾ç¤º/">APPæ§ä»¶åœ¨å±å¹•ä¸Šæ˜¾ç¤º</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/09/IOSå“åº”è€…é“¾/">IOSæ•´ä½“æ¡†æ¶</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/16/ä¸¤å‘¨æ„Ÿæ‚Ÿ~å¹¿å·/">å¹¿å·~ä¸¤å‘¨æ„Ÿæ‚Ÿ</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/16/UIView&CALayer&Core Animation~1/">UIView & CALayer& Core Animation ~ ï¼ˆUIView å’Œ CALayerï¼‰ï¼ˆ1ï¼‰</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/16/UIView&CALayer&Core Animation-æ€»ä½“/">UIView&CALayer&Core Animation~å¼€ç¯‡</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> æœ€æ–°è¯„è®º</i></div><script type="text/javascript" src="//JackJin## Your disqus_shortname, e.g. username.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> é“¾æ¥</i></div><ul></ul><a href="https://github.com/boilWater" title="Github" target="_blank">Github</a><ul></ul><a href="http://weibo.com/u/2815612403?is_all=1" title="å¾®åš" target="_blank">å¾®åš</a><ul></ul><a href="http://www.jianshu.com/users/c48ed5ae3925/latest_articles" title="ç®€ä¹¦" target="_blank">ç®€ä¹¦</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Â© <a href="/." rel="nofollow">JackJin's åšå®¢.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>