<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>JackJin&#39;s 博客</title>
  <subtitle>一位脚踏实地，拥有梦想的90后，想要一直努力追上你！</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2017-08-25T09:29:18.000Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>JackJin</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>iOS-镜头采集(AVCaptureDevice)</title>
    <link href="http://yoursite.com/2017/08/17/iOS-%E9%95%9C%E5%A4%B4%E9%87%87%E9%9B%86(AVCaptureDevice)/"/>
    <id>http://yoursite.com/2017/08/17/iOS-镜头采集(AVCaptureDevice)/</id>
    <published>2017-08-17T09:42:32.000Z</published>
    <updated>2017-08-25T09:29:18.000Z</updated>
    
    <content type="html">&lt;p&gt;承接上一篇博文小编讲述在镜头采集过程所需知识点和 &lt;code&gt;AVCaptureSession&lt;/code&gt; 基本使用方法，本篇博文将要讲述 &lt;code&gt;AVCaptureDevice&lt;/code&gt; 相关使用方法。&lt;/p&gt;
&lt;p&gt;下图为本博文写作思路：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1877765-02f3ce2f37fba73c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;AVCaptureDevice博文写作思维导图.png&quot;&gt;&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h1 id=&quot;AVCaptureDevice&quot;&gt;&lt;a href=&quot;#AVCaptureDevice&quot; class=&quot;headerlink&quot; title=&quot;AVCaptureDevice&quot;&gt;&lt;/a&gt;AVCaptureDevice&lt;/h1&gt;&lt;p&gt;AVCaptureDevice 在这个采集过程中相当于在发电过程中“发电设备”，提供实现摄像头和麦克风相关初始化。而且可以对摄像头进行一些基本设置，例如：闪光灯、手电筒、聚焦、曝光、白平衡等一些基本设置。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;AVCaptureDevice 实现摄像头初始化&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在 &lt;code&gt;AVCaptureDevice&lt;/code&gt; 初始化前需要对镜头申请权限，具体实现如下：&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;switch&lt;/span&gt; ([&lt;span class=&quot;built_in&quot;&gt;AVCaptureDevice&lt;/span&gt; authorizationStatusForMediaType:&lt;span class=&quot;built_in&quot;&gt;AVMediaTypeVideo&lt;/span&gt;]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;AVAuthorizationStatusAuthorized&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;//获取授权成功&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;AVAuthorizationStatusNotDetermined&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;//目前用户为选择&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            dispatch_suspend(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.sessionQueue);&lt;span class=&quot;comment&quot;&gt;//self.seaaionQueue 是串行线程&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            [&lt;span class=&quot;built_in&quot;&gt;AVCaptureDevice&lt;/span&gt; requestAccessForMediaType:&lt;span class=&quot;built_in&quot;&gt;AVMediaTypeVideo&lt;/span&gt; completionHandler:^(&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; granted) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!granted) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.setupResult = FYCameraCaptureSetupResultNotAuthorized;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                dispatch_resume(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.sessionQueue);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;comment&quot;&gt;//处理其余情况&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;请求硬件的获取状态，如下：&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVAuthorizationStatusNotDetermined&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;comment&quot;&gt;//用户暂时没有做相关选着&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVAuthorizationStatusRestricted&lt;/span&gt;    = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;comment&quot;&gt;//没有改媒体类型&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVAuthorizationStatusDenied&lt;/span&gt;        = &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;span class=&quot;comment&quot;&gt;//用户拒绝&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVAuthorizationStatusAuthorized&lt;/span&gt;    = &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;,&lt;span class=&quot;comment&quot;&gt;//用户允许&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;在获取对 &lt;code&gt;AVCaptureDevice&lt;/code&gt; 使用允许的情况中，可以获取上面四中情况。可以依次对上面三种情况进行处理。下面👇列出初始方法。 &lt;/p&gt;
&lt;p&gt;1） &lt;code&gt;AVCaptureDevice&lt;/code&gt;基本初始方法&lt;br&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//方法(1)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureDevice&lt;/span&gt; *videoDevice = [&lt;span class=&quot;built_in&quot;&gt;AVCaptureDevice&lt;/span&gt; defaultDeviceWithMediaType:&lt;span class=&quot;built_in&quot;&gt;AVMediaTypeVideo&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//方法(2)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureDevice&lt;/span&gt; *videoDevice = [&lt;span class=&quot;built_in&quot;&gt;AVCaptureDevice&lt;/span&gt; defaultDeviceWithDeviceType:&lt;span class=&quot;built_in&quot;&gt;AVCaptureDeviceTypeBuiltInDuoCamera&lt;/span&gt; mediaType:&lt;span class=&quot;built_in&quot;&gt;AVMediaTypeVideo&lt;/span&gt; position:&lt;span class=&quot;built_in&quot;&gt;AVCaptureDevicePositionBack&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;2）&lt;code&gt;AVCaptureDevice&lt;/code&gt; 实现镜头自动变焦&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSArray&lt;/span&gt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureDeviceType&lt;/span&gt;&amp;gt; *deviceType = @[&lt;span class=&quot;built_in&quot;&gt;AVCaptureDeviceTypeBuiltInWideAngleCamera&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;AVCaptureDeviceTypeBuiltInDualCamera&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureDeviceDiscoverySession&lt;/span&gt; *videoDeviceDiscoverySession = [&lt;span class=&quot;built_in&quot;&gt;AVCaptureDeviceDiscoverySession&lt;/span&gt; discoverySessionWithDeviceTypes:deviceType mediaType:&lt;span class=&quot;built_in&quot;&gt;AVMediaTypeVideo&lt;/span&gt; position:&lt;span class=&quot;built_in&quot;&gt;AVCaptureDevicePositionUnspecified&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//获取 devices &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSArray&lt;/span&gt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureDevice&lt;/span&gt; *&amp;gt; *devices = videoDeviceDiscoverySession.devices;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;在使用 &lt;code&gt;AVCaptureDeviceDiscoverySession&lt;/code&gt; 获取 &lt;code&gt;AVCaptureDevice&lt;/code&gt; 过程中，使用 &lt;code&gt;AVCaptureDeviceType&lt;/code&gt;。&lt;br&gt;下面列出 &lt;code&gt;AVCaptureDeviceType&lt;/code&gt; 种类：&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//AVCaptureDeviceType 种类&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureDeviceTypeBuiltInMicrophone&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;//创建麦克风&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureDeviceTypeBuiltInWideAngleCamera&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;//创建广角相机&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureDeviceTypeBuiltInTelephotoCamera&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;//创建比广角相机更长的焦距。只有使用 AVCaptureDeviceDiscoverySession 可以使用&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureDeviceTypeBuiltInDualCamera&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;//创建变焦的相机，可以实现广角和变焦的自动切换。使用同AVCaptureDeviceTypeBuiltInTelephotoCamera 一样。&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureDeviceTypeBuiltInDuoCamera&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;//iOS 10.2 被 AVCaptureDeviceTypeBuiltInDualCamera 替换&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;注释：&lt;code&gt;iOS 10.2&lt;/code&gt; 之后添加自动变焦功能, 而且在查找自动变焦镜头时需要采用 &lt;code&gt;AVCaptureDeviceDiscoverySession&lt;/code&gt; 进行查找。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;AVCaptureDevice&lt;/code&gt; 实现的通知&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;下面👇列出通知的类型：&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// Notification type &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureDeviceWasConnectedNotification&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;//设备被链接时发出通知&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureDeviceWasDisconnectedNotification&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;//设备被去去除时发出通知&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureDeviceSubjectAreaDidChangeNotification&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;//设备中场景改变时发出通知，既预览发生变化&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;AVCaptureDevice&lt;/code&gt; 的位置&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureDevicePositionUnspecified&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;comment&quot;&gt;//不确定&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureDevicePositionBack&lt;/span&gt;        = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;comment&quot;&gt;//后置&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureDevicePositionFront&lt;/span&gt;       = &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;span class=&quot;comment&quot;&gt;//前置&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 如果初始的 AVMediaType 是 AVMediaTypeVideo 表示前置和后置摄像头&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;AVCaptureDeviceFlash-闪光灯&quot;&gt;&lt;a href=&quot;#AVCaptureDeviceFlash-闪光灯&quot; class=&quot;headerlink&quot; title=&quot;AVCaptureDeviceFlash(闪光灯)&quot;&gt;&lt;/a&gt;AVCaptureDeviceFlash(闪光灯)&lt;/h4&gt;&lt;p&gt;在光线不足的情况下，需要开启屏幕的闪光灯来进行补光。便于镜头可以捕捉更好的场景，拍摄出好的照片和视频。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;iOS 10_0&lt;/code&gt;之前闪光灯设置&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureDevice&lt;/span&gt; *device = &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSArray&lt;/span&gt; *inputs = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.session.inputs;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;built_in&quot;&gt;AVCaptureDeviceInput&lt;/span&gt; *input &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; inputs) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([device.deviceType isEqual:&lt;span class=&quot;built_in&quot;&gt;AVMediaTypeVideo&lt;/span&gt;]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        device = input.device;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSError&lt;/span&gt; *errorProperty = &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([device hasFlash]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([device isFlashAvailable]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([device isFlashModeSupported:&lt;span class=&quot;built_in&quot;&gt;AVCaptureFlashModeOn&lt;/span&gt;]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; result = &lt;span class=&quot;literal&quot;&gt;NO&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            result = [device lockForConfiguration:&amp;amp;errorProperty];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (result) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                [device setFlashMode:&lt;span class=&quot;built_in&quot;&gt;AVCaptureFlashModeOn&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;ERROR : CONFIGURATION CAPTURE DEVICE FLASH FAILURE, ERROR CODE:%ld&quot;&lt;/span&gt;, (&lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt;)errorProperty.code);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            [device unlockForConfiguration];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;ERROR : FLASH IS UNAVAILABLE BECAUSE THE DEVCICE OVERHEATS&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;ERROR : SOFTWARE DEVICE HAVE NO FLASH&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;iOS 10_0&lt;/code&gt;之后设置&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSArray&lt;/span&gt; *outputs = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.session.outputs;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;built_in&quot;&gt;AVCaptureOutput&lt;/span&gt; *output &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; outputs) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([output isMemberOfClass:[&lt;span class=&quot;built_in&quot;&gt;AVCapturePhotoOutput&lt;/span&gt; class]]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;AVCapturePhotoOutput&lt;/span&gt; *photoOutput = (&lt;span class=&quot;built_in&quot;&gt;AVCapturePhotoOutput&lt;/span&gt; *)output;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; flashSupported = [[photoOutput supportedFlashModes] containsObject:@(&lt;span class=&quot;built_in&quot;&gt;AVCaptureFlashModeAuto&lt;/span&gt;)];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (flashSupported) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;AVCapturePhotoSettings&lt;/span&gt; *photoSettings = photoOutput.photoSettingsForSceneMonitoring;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            photoSettings.flashMode = &lt;span class=&quot;built_in&quot;&gt;AVCaptureFlashModeAuto&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;ERROR : PHOTOOUTPUT CAN NOT SUPPORT AVCAPTUREMODE TYPE&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;下面👇列出闪光灯类型：&lt;br&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureFlashModeOff&lt;/span&gt;  = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;comment&quot;&gt;//闪光灯关闭&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureFlashModeOn&lt;/span&gt;   = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;comment&quot;&gt;//闪光灯开启&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureFlashModeAuto&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;span class=&quot;comment&quot;&gt;//闪光灯自动&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;太困了，晚上跑 10 公里。目前👁都睁不开。&lt;/code&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;在 iPhone 6s 开始，如果是前置摄像头并且开启闪光灯，可以实现屏幕闪光灯补光。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&quot;AVCaptureDeviceTorch-手电筒&quot;&gt;&lt;a href=&quot;#AVCaptureDeviceTorch-手电筒&quot; class=&quot;headerlink&quot; title=&quot;AVCaptureDeviceTorch(手电筒)&quot;&gt;&lt;/a&gt;AVCaptureDeviceTorch(手电筒)&lt;/h4&gt;&lt;p&gt;在光线不是很暗的情况下我们可以用手机的 LED 灯当做手电筒使用，具体实现如下：&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureDevice&lt;/span&gt; *device = &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSArray&lt;/span&gt; *inputs = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.session.inputs;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;built_in&quot;&gt;AVCaptureDeviceInput&lt;/span&gt; *input &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; inputs) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([device.deviceType isEqual:&lt;span class=&quot;built_in&quot;&gt;AVMediaTypeVideo&lt;/span&gt;]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        device = input.device;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSError&lt;/span&gt; *error = &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([device hasTorch]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([device isFlashAvailable]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([device isTorchModeSupported:&lt;span class=&quot;built_in&quot;&gt;AVCaptureTorchModeOn&lt;/span&gt;]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; result = &lt;span class=&quot;literal&quot;&gt;NO&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            result = [device lockForConfiguration:&amp;amp;error];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (result) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                [device setTorchMode:&lt;span class=&quot;built_in&quot;&gt;AVCaptureTorchModeOn&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;ERROR : CONFIGURATION DEVICE TORCH FAIL AND ERROR CODE %ld&quot;&lt;/span&gt;, (&lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt;)error.code);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            error = &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// Torch light&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            result = [device setTorchModeOnWithLevel:&lt;span class=&quot;number&quot;&gt;0.5&lt;/span&gt; error:&amp;amp;error];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!result) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;ERROR : DEVICE SET TORCH FAILURE AND ERROR CODE %ld&quot;&lt;/span&gt;, error.code);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            [device unlockForConfiguration];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;ERROR : DEVICE CAN NO SUPPORT TORCH&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;ERROR : SOFTHARE DEVICE TORCH IS UNAVAILABLE BECAUSE OVERHEATS&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;ERROR : SOFFHARE DEVICE HAS NO TORCH&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;下面列出 &lt;code&gt;Torch&lt;/code&gt; 类型，使用方法和闪关灯类型：&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureTorchModeOff&lt;/span&gt;  = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;comment&quot;&gt;//关闭&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureTorchModeOn&lt;/span&gt;   = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;comment&quot;&gt;//打开&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureTorchModeAuto&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;span class=&quot;comment&quot;&gt;//自动&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;AVCaptureDeviceFocus-聚焦&quot;&gt;&lt;a href=&quot;#AVCaptureDeviceFocus-聚焦&quot; class=&quot;headerlink&quot; title=&quot;AVCaptureDeviceFocus(聚焦)&quot;&gt;&lt;/a&gt;AVCaptureDeviceFocus(聚焦)&lt;/h4&gt;&lt;p&gt;实现摄像头聚焦有两种情况：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;镜头位置(AVCaptureFocusMode)&lt;/li&gt;
&lt;li&gt;范围烧苗(AVCaptureAutoFocusRangeRestriction)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;1）镜头位置(AVCaptureFocusMode)&lt;br&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureDevice&lt;/span&gt; *device = &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSArray&lt;/span&gt; *inputs = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.session.inputs;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;built_in&quot;&gt;AVCaptureDeviceInput&lt;/span&gt; *input &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; inputs) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([device.deviceType isEqual:&lt;span class=&quot;built_in&quot;&gt;AVMediaTypeVideo&lt;/span&gt;]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        device = input.device;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([device isFocusModeSupported:&lt;span class=&quot;built_in&quot;&gt;AVCaptureFocusModeAutoFocus&lt;/span&gt;]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSError&lt;/span&gt; *error;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([device lockForConfiguration:&amp;amp;error]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [device setFocusMode:&lt;span class=&quot;built_in&quot;&gt;AVCaptureFocusModeAutoFocus&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//设置聚焦在设备坐标的中点&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (device.focusPointOfInterestSupported) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            device.focusPointOfInterest = &lt;span class=&quot;built_in&quot;&gt;CGPointMake&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;0.5&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0.5&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [device unlockForConfiguration];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;上述代码实现聚焦在设备坐标 中心位置。&lt;/p&gt;
&lt;p&gt;下面👇列出实现聚焦设置类型：&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureFocusModeLocked&lt;/span&gt;              = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;comment&quot;&gt;//锁定当前镜头位置&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureFocusModeAutoFocus&lt;/span&gt;           = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;comment&quot;&gt;//镜头自动调焦&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureFocusModeContinuousAutoFocus&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;span class=&quot;comment&quot;&gt;//镜头连续自动调焦&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;AVCaptureDeviceExposure-曝光&quot;&gt;&lt;a href=&quot;#AVCaptureDeviceExposure-曝光&quot; class=&quot;headerlink&quot; title=&quot;AVCaptureDeviceExposure(曝光)&quot;&gt;&lt;/a&gt;AVCaptureDeviceExposure(曝光)&lt;/h4&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureDevice&lt;/span&gt; *device = &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;built_in&quot;&gt;NSArray&lt;/span&gt; *inputs = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.session.inputs;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;built_in&quot;&gt;AVCaptureDeviceInput&lt;/span&gt; *input &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; inputs) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([device.deviceType isEqual:&lt;span class=&quot;built_in&quot;&gt;AVMediaTypeVideo&lt;/span&gt;]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         device = input.device;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([device isExposureModeSupported:&lt;span class=&quot;built_in&quot;&gt;AVCaptureExposureModeAutoExpose&lt;/span&gt;]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;built_in&quot;&gt;NSError&lt;/span&gt; *error;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([device lockForConfiguration:&amp;amp;error]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         [device setExposureMode:&lt;span class=&quot;built_in&quot;&gt;AVCaptureExposureModeAutoExpose&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     [device unlockForConfiguration];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;上述代码实现自动调节曝光。&lt;/p&gt;
&lt;p&gt;下面列出相关曝光设置类型：&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureExposureModeLocked&lt;/span&gt;                            = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;comment&quot;&gt;//锁定&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureExposureModeAutoExpose&lt;/span&gt;                        = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;comment&quot;&gt;//自动对焦&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureExposureModeContinuousAutoExposure&lt;/span&gt;            = &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;span class=&quot;comment&quot;&gt;//实现连续自动对焦&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureExposureModeCustom&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;NS_ENUM_AVAILABLE_IOS&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;_0) = &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;,&lt;span class=&quot;comment&quot;&gt;//通过 ISO 和 曝光时间实现&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;AVCaptureDeviceWhiteBalance-白平衡&quot;&gt;&lt;a href=&quot;#AVCaptureDeviceWhiteBalance-白平衡&quot; class=&quot;headerlink&quot; title=&quot;AVCaptureDeviceWhiteBalance(白平衡)&quot;&gt;&lt;/a&gt;AVCaptureDeviceWhiteBalance(白平衡)&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;类型设置(AVCaptureWhiteBalanceMode)&lt;/li&gt;
&lt;li&gt;RGB具体值(AVCaptureWhiteBalanceGains)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;1）类型设置白平衡&lt;br&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureDevice&lt;/span&gt; *device = &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;built_in&quot;&gt;NSArray&lt;/span&gt; *inputs = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.session.inputs;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;built_in&quot;&gt;AVCaptureDeviceInput&lt;/span&gt; *input &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; inputs) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([device.deviceType isEqual:&lt;span class=&quot;built_in&quot;&gt;AVMediaTypeVideo&lt;/span&gt;]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         device = input.device;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([device isWhiteBalanceModeSupported:&lt;span class=&quot;built_in&quot;&gt;AVCaptureWhiteBalanceModeAutoWhiteBalance&lt;/span&gt;]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;built_in&quot;&gt;NSError&lt;/span&gt; *error;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([device lockForConfiguration:&amp;amp;error]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         [device setWhiteBalanceMode:&lt;span class=&quot;built_in&quot;&gt;AVCaptureWhiteBalanceModeAutoWhiteBalance&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     [device unlockForConfiguration];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;上述实现白平衡自动调整设置，下面👇列出白平衡类型：&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureWhiteBalanceModeLocked&lt;/span&gt;                     = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureWhiteBalanceModeAutoWhiteBalance&lt;/span&gt;           = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureWhiteBalanceModeContinuousAutoWhiteBalance&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;2）RGB 值设置白平衡&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureDevice&lt;/span&gt; *device = &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;built_in&quot;&gt;NSArray&lt;/span&gt; *inputs = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.session.inputs;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;built_in&quot;&gt;AVCaptureDeviceInput&lt;/span&gt; *input &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; inputs) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([device.deviceType isEqual:&lt;span class=&quot;built_in&quot;&gt;AVMediaTypeVideo&lt;/span&gt;]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         device = input.device;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;float&lt;/span&gt; maxWhiteBalance = device.maxWhiteBalanceGain;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;float&lt;/span&gt; redGain =  MIN(&lt;span class=&quot;number&quot;&gt;2.0&lt;/span&gt;, maxWhiteBalance);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;float&lt;/span&gt; greenGain = MIN(&lt;span class=&quot;number&quot;&gt;2.0&lt;/span&gt;, maxWhiteBalance);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;float&lt;/span&gt; blueGain = MIN(&lt;span class=&quot;number&quot;&gt;2.0&lt;/span&gt;, maxWhiteBalance);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;built_in&quot;&gt;AVCaptureWhiteBalanceGains&lt;/span&gt; whiteBalanceGains = &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     redGain,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     greenGain,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     blueGain&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; [device setWhiteBalanceModeLockedWithDeviceWhiteBalanceGains:whiteBalanceGains completionHandler:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;额外附加功能&quot;&gt;&lt;a href=&quot;#额外附加功能&quot; class=&quot;headerlink&quot; title=&quot;额外附加功能&quot;&gt;&lt;/a&gt;额外附加功能&lt;/h4&gt;&lt;p&gt;附加功能：可以获取 &lt;code&gt;AVCaptureDevice&lt;/code&gt; 一些相关的参数。&lt;/p&gt;
&lt;p&gt;例如：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;视频录制过程中 &lt;code&gt;min&lt;/code&gt; 和 &lt;code&gt;max&lt;/code&gt; 的帧率和帧时间间隔。 &lt;/li&gt;
&lt;li&gt;曝光 &lt;code&gt;ISO&lt;/code&gt; 的 &lt;code&gt;min&lt;/code&gt; 和 &lt;code&gt;max&lt;/code&gt; 值和曝光时间的 &lt;code&gt;min&lt;/code&gt; 和 &lt;code&gt;max&lt;/code&gt; 值等。&lt;/li&gt;
&lt;li&gt;输入的独一的 &lt;code&gt;ID&lt;/code&gt; 和输入源的设备 名字（&lt;code&gt;localizedName&lt;/code&gt;）。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;参考资料：&lt;br&gt;&lt;a href=&quot;https://developer.apple.com/documentation/avfoundation/avcapturedevice?changes=latest_minor&amp;amp;language=objc&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;AVCaptureDevice&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://developer.apple.com/documentation/avfoundation/avcapturedeviceposition&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;AVCaptureDevicePosition&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://developer.apple.com/documentation/avfoundation/avcapturetorchmode?language=objc&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;AVCaptureTorchMode&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://developer.apple.com/documentation/avfoundation/avcaptureflashmode?language=objc&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;AVCaptureFlashMode&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://developer.apple.com/documentation/avfoundation/avcapturefocusmode?language=objc&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;AVCaptureFocusMode&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://developer.apple.com/documentation/avfoundation/avcaptureexposuremode?language=objc&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;AVCaptureExposureMode&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://developer.apple.com/documentation/avfoundation/avcapturewhitebalancemode?language=objc&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;AVCaptureWhiteBalanceMode&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://support.vsco.co/hc/en-us/articles/203226980-Advanced-Camera-Controls-for-iOS-Setting-Manual-White-Balance&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Advanced Camera Controls for iOS: Setting Manual White Balance&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;第一次发布：2017/8/15 23:16:32 星期二&lt;br&gt;第二次发布：2017/8/16 00:17:59 星期三&lt;br&gt;第三次发布：2017/8/16 20:53:56 星期三&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;承接上一篇博文小编讲述在镜头采集过程所需知识点和 &lt;code&gt;AVCaptureSession&lt;/code&gt; 基本使用方法，本篇博文将要讲述 &lt;code&gt;AVCaptureDevice&lt;/code&gt; 相关使用方法。&lt;/p&gt;
&lt;p&gt;下图为本博文写作思路：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1877765-02f3ce2f37fba73c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;AVCaptureDevice博文写作思维导图.png&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://yoursite.com/categories/iOS/"/>
    
    
      <category term="iOS" scheme="http://yoursite.com/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>iOS-镜头采集(Camera capture &amp; AVCaptureSession)</title>
    <link href="http://yoursite.com/2017/08/11/iOS-Camera%20Capture%20(iOS%20%E9%95%9C%E5%A4%B4%E9%87%87%E9%9B%86)/"/>
    <id>http://yoursite.com/2017/08/11/iOS-Camera Capture (iOS 镜头采集)/</id>
    <published>2017-08-10T16:07:15.000Z</published>
    <updated>2017-08-25T09:26:48.000Z</updated>
    
    <content type="html">&lt;p&gt;iPhone 手机在图片拍照和视频录制方面有很强大的功能，小编认为如果很好使用 iPhone 拍摄出很好照片 &amp;amp; 录制很有趣的视频。本章将详细讲解 &lt;code&gt;AVCaptureSession&lt;/code&gt; ，并最后给出 &lt;code&gt;FYCameraKit&lt;/code&gt; 项目Demo。&lt;br&gt;下面小编为大家讲解 iOS 拍照和视频录制功能实现，下图是镜头采集需要的类：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1877765-b727b7f54b3df9bf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;iOS-Camera Capture (iOS 镜头采集).png&quot;&gt;&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;总体介绍&quot;&gt;&lt;a href=&quot;#总体介绍&quot; class=&quot;headerlink&quot; title=&quot;总体介绍&quot;&gt;&lt;/a&gt;总体介绍&lt;/h2&gt;&lt;p&gt;在整个镜头采集过程小编把整个过程比作我们常见发电过程：均是通过特定的步骤实现得到最后的产物。下面👇做详细解释：&lt;/p&gt;
&lt;h3 id=&quot;AVCaptureSession-发电机&quot;&gt;&lt;a href=&quot;#AVCaptureSession-发电机&quot; class=&quot;headerlink&quot; title=&quot;AVCaptureSession (发电机)&quot;&gt;&lt;/a&gt;AVCaptureSession (发电机)&lt;/h3&gt;&lt;p&gt;&lt;code&gt;AVCaptureSession&lt;/code&gt; ：作为音视频捕捉会话，把镜头和麦克风捕捉到的音视频源输出到设备中。&lt;br&gt;提示：可以有多个输入和输出。&lt;/p&gt;
&lt;h3 id=&quot;AVCaptureDevice-发电设备&quot;&gt;&lt;a href=&quot;#AVCaptureDevice-发电设备&quot; class=&quot;headerlink&quot; title=&quot;AVCaptureDevice (发电设备)&quot;&gt;&lt;/a&gt;AVCaptureDevice (发电设备)&lt;/h3&gt;&lt;p&gt;&lt;code&gt;AVCaptureDevice&lt;/code&gt;：输入设备，包括：摄像头和麦克风。可以通过设置一些参数来调节设备采集效果（例如：曝光，白平衡和聚焦等）。&lt;/p&gt;
&lt;h3 id=&quot;AVCaptureInput-水风能源&quot;&gt;&lt;a href=&quot;#AVCaptureInput-水风能源&quot; class=&quot;headerlink&quot; title=&quot;AVCaptureInput (水风能源)&quot;&gt;&lt;/a&gt;AVCaptureInput (水风能源)&lt;/h3&gt;&lt;p&gt;&lt;code&gt;AVCaptureInput&lt;/code&gt;：输入数据管理对象，经过 AVCaptureDevice 实现初始化，然后添加到 AVCaptureSession (发电机) 中进行相应的输出。&lt;br&gt;子类：&lt;code&gt;AVCaptureDeviceInput&lt;/code&gt;、&lt;code&gt;AVCaptureScreenInput&lt;/code&gt;和&lt;code&gt;AVCaptureMetadataInput&lt;/code&gt;。&lt;/p&gt;
&lt;h3 id=&quot;AVCaptureOutput-电力&quot;&gt;&lt;a href=&quot;#AVCaptureOutput-电力&quot; class=&quot;headerlink&quot; title=&quot;AVCaptureOutput (电力)&quot;&gt;&lt;/a&gt;AVCaptureOutput (电力)&lt;/h3&gt;&lt;p&gt;&lt;code&gt;AVCaptureOut&lt;/code&gt;：数据输出管理，通过 AVCaptureSession 中输出。可以通过相关的协议实对应的数据输出。&lt;br&gt;子类：&lt;code&gt;AVCaptureFileOutput&lt;/code&gt;、&lt;code&gt;AVCapturePhotoOutput&lt;/code&gt;、&lt;code&gt;AVCaptureStillImageOutput&lt;/code&gt;、&lt;code&gt;AVCaptureVideoDataOutput&lt;/code&gt;、&lt;code&gt;AVCaptureAudioDataOutput&lt;/code&gt;、&lt;code&gt;AVCaptureAudioPreviewOutput&lt;/code&gt;、&lt;code&gt;AVCaptureDepthDataOutput&lt;/code&gt;和&lt;code&gt;AVCaptureMetadataOutput&lt;/code&gt;。&lt;/p&gt;
&lt;h3 id=&quot;AVCaptureVideoPreviewLayer-发电预览&quot;&gt;&lt;a href=&quot;#AVCaptureVideoPreviewLayer-发电预览&quot; class=&quot;headerlink&quot; title=&quot;AVCaptureVideoPreviewLayer (发电预览)&quot;&gt;&lt;/a&gt;AVCaptureVideoPreviewLayer (发电预览)&lt;/h3&gt;&lt;p&gt;&lt;code&gt;AVCaptureVideoPreviewLayer&lt;/code&gt;：可以支持在拍摄过程中进行相关的预览，只需要在初始时实现对应的 AVCaptureSession 即可。&lt;/p&gt;
&lt;h2 id=&quot;视频录制&quot;&gt;&lt;a href=&quot;#视频录制&quot; class=&quot;headerlink&quot; title=&quot;视频录制&quot;&gt;&lt;/a&gt;视频录制&lt;/h2&gt;&lt;p&gt;下面展示在苹果官方开发文档给出的图：&lt;br&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1877765-4cbf9ba736afdb69.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;iOS-Video Capture(iOS 视频录制).png&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;视频录制总概&quot;&gt;&lt;a href=&quot;#视频录制总概&quot; class=&quot;headerlink&quot; title=&quot;视频录制总概&quot;&gt;&lt;/a&gt;视频录制总概&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;创建 &lt;code&gt;AVCaptureSession&lt;/code&gt; 对象&lt;/li&gt;
&lt;li&gt;使用 &lt;code&gt;AVCaptureDevice&lt;/code&gt; 静态方法获取设备常使用设备，例如：拍照和录像需要的摄像头，录音所需的麦克风&lt;/li&gt;
&lt;li&gt;利用输入设备 &lt;code&gt;AVCaptureDevice&lt;/code&gt; 初始化 &lt;code&gt;AVCaptureDeviceInput&lt;/code&gt; 对象&lt;/li&gt;
&lt;li&gt;初始化输出数据管理对象，拍照进行初始化 &lt;code&gt;AVCaptureStillImageOutput&lt;/code&gt; 对象，拍照初始化 &lt;code&gt;AVCaptureMovieFileOutput&lt;/code&gt; 对象&lt;/li&gt;
&lt;li&gt;将数据输入对象 &lt;code&gt;AVCaptureDeviceInput&lt;/code&gt;  和数据输出对象   &lt;code&gt;AVCaptureDeviceOutput&lt;/code&gt;  添加到媒体会话管理对象   &lt;code&gt;AVCaptureSession&lt;/code&gt; 中&lt;/li&gt;
&lt;li&gt;创建预览的图层   &lt;code&gt;AVCaptureVideoPreviewLayer&lt;/code&gt;   指定媒体会话，添加图层到容器，调用  &lt;code&gt;AVCaptureSession&lt;/code&gt;  中的 &lt;code&gt;StartRunning&lt;/code&gt;  方法开始捕捉&lt;/li&gt;
&lt;li&gt;将捕捉到内容保存到指定文件中&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;详解镜头采集类&quot;&gt;&lt;a href=&quot;#详解镜头采集类&quot; class=&quot;headerlink&quot; title=&quot;详解镜头采集类&quot;&gt;&lt;/a&gt;详解镜头采集类&lt;/h2&gt;&lt;h3 id=&quot;AVCaptureSession&quot;&gt;&lt;a href=&quot;#AVCaptureSession&quot; class=&quot;headerlink&quot; title=&quot;AVCaptureSession&quot;&gt;&lt;/a&gt;AVCaptureSession&lt;/h3&gt;&lt;p&gt;小编查看 &lt;code&gt;AVCaptureSession.h&lt;/code&gt;文件看到，在镜头采集的过程中有两种实现方式。&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;使用系统 &lt;code&gt;AVCaptureSession&lt;/code&gt;自动配置输入和输出&lt;/li&gt;
&lt;li&gt;手动配置输入和输出之间的对应关系&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;（1） AVCaptureSession 初始化&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;使用&lt;code&gt;AVCaptureSession&lt;/code&gt; 自动配置输入和输出之间对应关系&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureSession&lt;/span&gt; *captureSession = [[&lt;span class=&quot;built_in&quot;&gt;AVCaptureSession&lt;/span&gt; alloc] init];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureDevice&lt;/span&gt; *audioCaptureDevice = [&lt;span class=&quot;built_in&quot;&gt;AVCaptureDevice&lt;/span&gt; defaultDeviceWithMediaType:&lt;span class=&quot;built_in&quot;&gt;AVMediaTypeAudio&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSError&lt;/span&gt; *error = &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureDeviceInput&lt;/span&gt; *audioInput = [&lt;span class=&quot;built_in&quot;&gt;AVCaptureDeviceInput&lt;/span&gt; deviceInputWithDevice:audioCaptureDevice error:&amp;amp;error];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[captureSession beginConfiguration];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (audioInput) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//// Handle the failure.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [captureSession commitConfiguration];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([captureSession canAddInput:audioInput]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [captureSession addInput:audioInput];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// Handle the failure.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [captureSession commitConfiguration];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;上面代码是 &lt;code&gt;AVCaptureSession&lt;/code&gt; 进行初始化并且实现初始化麦克风进行相关音频录制，并添加到 &lt;code&gt;AVCaptureSession&lt;/code&gt;中。&lt;br&gt;&lt;code&gt;beginConfiguration&lt;/code&gt; &amp;amp; &lt;code&gt;commitConfiguration&lt;/code&gt; 在进行配置 &lt;code&gt;AVCaptureSession&lt;/code&gt; 的相关属性值时需要对这两个函数调用，并且这两个函数是成对出现。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;手动配置 &lt;code&gt;AVCaptureSession&lt;/code&gt; 输入和输出之间对应关系&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureSession&lt;/span&gt; *session = [[&lt;span class=&quot;built_in&quot;&gt;AVCaptureSession&lt;/span&gt; alloc] init];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [session beginConfiguration];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSError&lt;/span&gt; *error = &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;AVCaptureDevice&lt;/span&gt; *videoDevice = [&lt;span class=&quot;built_in&quot;&gt;AVCaptureDevice&lt;/span&gt; defaultDeviceWithMediaType:&lt;span class=&quot;built_in&quot;&gt;AVMediaTypeVideo&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;AVCaptureDeviceInput&lt;/span&gt; *videoInput = [&lt;span class=&quot;built_in&quot;&gt;AVCaptureDeviceInput&lt;/span&gt; deviceInputWithDevice:videoDevice error:&amp;amp;error];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!videoInput) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//handle configuration video device&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;AVCaptureInputPort&lt;/span&gt; *videoPort = videoInput.ports[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    error = &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;AVCaptureDevice&lt;/span&gt; *audioDevice = [&lt;span class=&quot;built_in&quot;&gt;AVCaptureDevice&lt;/span&gt; defaultDeviceWithMediaType:&lt;span class=&quot;built_in&quot;&gt;AVMediaTypeAudio&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;AVCaptureDeviceInput&lt;/span&gt; *audioInput = [&lt;span class=&quot;built_in&quot;&gt;AVCaptureDeviceInput&lt;/span&gt; deviceInputWithDevice:audioDevice error:&amp;amp;error];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!videoInput) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//handle configuration audio device&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;AVCaptureInputPort&lt;/span&gt; *audioPort = audioInput.ports[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSArray&lt;/span&gt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureInputPort&lt;/span&gt; *&amp;gt; *inputPorts = @[videoPort, audioPort];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;AVCaptureVideoDataOutput&lt;/span&gt; *videoDataOutput = [[&lt;span class=&quot;built_in&quot;&gt;AVCaptureVideoDataOutput&lt;/span&gt; alloc] init];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;AVCaptureConnection&lt;/span&gt; *connection = [&lt;span class=&quot;built_in&quot;&gt;AVCaptureConnection&lt;/span&gt; connectionWithInputPorts:inputPorts output:videoDataOutput];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([session canAddConnection:connection]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [session addConnection:connection];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//handle session can not add AVCaptureConnection&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [session commitConfiguration];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [session commitConfiguration];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;上面👆代码是使用 &lt;code&gt;AVCaptureConnection&lt;/code&gt;实现在 &lt;code&gt;AVCaptureSession&lt;/code&gt; 使输入和输出进行自己配置。&lt;br&gt;详细的细节会在 &lt;code&gt;FYCameraKit&lt;/code&gt; 进行详细的讲解。 &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;注释：&lt;br&gt;1）只有在调用 &lt;code&gt;beginConfiguration&lt;/code&gt; 时我们对 &lt;code&gt;AVCaptureSession&lt;/code&gt; 配置才会被真正开始修改。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;（2） AVCaptureSession 中断&lt;/p&gt;
&lt;p&gt;在音视频录制过程中可能对因为电话导致中断，开发过程中提供中断结束后获取中断产生的原因。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;注册中断监听 &amp;amp; 删除监听&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//监听注册&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[[&lt;span class=&quot;built_in&quot;&gt;NSNotificationCenter&lt;/span&gt; defaultCenter] addObserver:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; selector:&lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(handleCaptureSession:) name:&lt;span class=&quot;built_in&quot;&gt;AVCaptureSessionInterruptionEndedNotification&lt;/span&gt; object:_session];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//监听清除   &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[[&lt;span class=&quot;built_in&quot;&gt;NSNotificationCenter&lt;/span&gt; defaultCenter] removeObserver:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; name:&lt;span class=&quot;built_in&quot;&gt;AVCaptureSessionInterruptionEndedNotification&lt;/span&gt; object:_session];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;从传递的 &lt;code&gt;userInfo&lt;/code&gt; 通过关键 &lt;code&gt;key&lt;/code&gt; 获取原因：&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;AVCaptureSessionInterruptionReasonKey&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;获取具体的中断原因：&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;typedef&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;NS_ENUM&lt;/span&gt;(&lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;AVCaptureSessionInterruptionReason&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;AVCaptureSessionInterruptionReasonVideoDeviceNotAvailableInBackground&lt;/span&gt;               = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;comment&quot;&gt;//从后台运行开启 camera，不够 iOS 9.0 之后不提供中断 &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;AVCaptureSessionInterruptionReasonAudioDeviceInUseByAnotherClient&lt;/span&gt;                   = &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;span class=&quot;comment&quot;&gt;//音频软软件被占用&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;AVCaptureSessionInterruptionReasonVideoDeviceInUseByAnotherClient&lt;/span&gt;                   = &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;,&lt;span class=&quot;comment&quot;&gt;//视频软件被占用&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;AVCaptureSessionInterruptionReasonVideoDeviceNotAvailableWithMultipleForegroundApps&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;,&lt;span class=&quot;comment&quot;&gt;//全屏或者是录制屏幕变化&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;监听事件的处理&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)handleCaptureSession:(&lt;span class=&quot;built_in&quot;&gt;NSNotification&lt;/span&gt; *)notification &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;AVCaptureSessionInterruptionReason&lt;/span&gt; reason = [[notification.userInfo objectForKey:&lt;span class=&quot;built_in&quot;&gt;AVCaptureSessionInterruptionReasonKey&lt;/span&gt;] unsignedIntegerValue];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;switch&lt;/span&gt; (reason) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;AVCaptureSessionInterruptionReasonVideoDeviceNotAvailableInBackground&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           &lt;span class=&quot;comment&quot;&gt;//handle device not available background&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;AVCaptureSessionInterruptionReasonAudioDeviceInUseByAnotherClient&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           &lt;span class=&quot;comment&quot;&gt;//handle that audio was occupied  &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;AVCaptureSessionInterruptionReasonVideoDeviceInUseByAnotherClient&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#123;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           &lt;span class=&quot;comment&quot;&gt;//handle that video was occupied  &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;AVCaptureSessionInterruptionReasonVideoDeviceNotAvailableWithMultipleForegroundApps&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           &lt;span class=&quot;comment&quot;&gt;//handle that UI was multiple&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;实现拍照和视频录制的 &lt;code&gt;FYCameraKit&lt;/code&gt; 的下载地址： &lt;a href=&quot;https://github.com/boilWater/FYCameraKit&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;FYCameraKit&lt;/a&gt; &lt;/p&gt;
&lt;p&gt;参考资料：&lt;br&gt;&lt;a href=&quot;https://developer.apple.com/documentation/avfoundation/avcapturesession?changes=latest_minor&amp;amp;language=objc&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;AVCaptureSession&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://developer.apple.com/documentation/avfoundation/avcapturedevice&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;AVCaptureDevice&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://developer.apple.com/documentation/avfoundation/avcaptureconnection?changes=latest_minor&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;AVCaptureConnection&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;第一次发布：2017/8/10 20:49:21 星期四&lt;br&gt;第二次发布：2017/8/10 23:36:34 星期四&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;iPhone 手机在图片拍照和视频录制方面有很强大的功能，小编认为如果很好使用 iPhone 拍摄出很好照片 &amp;amp; 录制很有趣的视频。本章将详细讲解 &lt;code&gt;AVCaptureSession&lt;/code&gt; ，并最后给出 &lt;code&gt;FYCameraKit&lt;/code&gt; 项目Demo。&lt;br&gt;下面小编为大家讲解 iOS 拍照和视频录制功能实现，下图是镜头采集需要的类：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1877765-b727b7f54b3df9bf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;iOS-Camera Capture (iOS 镜头采集).png&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://yoursite.com/categories/iOS/"/>
    
    
      <category term="iOS" scheme="http://yoursite.com/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>iOS-视频大纲总结</title>
    <link href="http://yoursite.com/2017/06/09/iOS-%E8%A7%86%E9%A2%91%E5%A4%A7%E7%BA%B2%E6%80%BB%E7%BB%93/"/>
    <id>http://yoursite.com/2017/06/09/iOS-视频大纲总结/</id>
    <published>2017-06-08T16:31:48.000Z</published>
    <updated>2017-06-13T15:30:57.000Z</updated>
    
    <content type="html">&lt;p&gt;本次博客思路来自与公司的一次技术分享。前段时间被公司委派做视频相关的开发，就把视频总体内容梳理一下当做备忘。&lt;/p&gt;
&lt;p&gt;下面是本博文的写作思路：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1877765-bbdb773a30fc44a2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;iOS-视频大纲总结.png&quot;&gt;&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;流媒体数据接收到播放&quot;&gt;&lt;a href=&quot;#流媒体数据接收到播放&quot; class=&quot;headerlink&quot; title=&quot;流媒体数据接收到播放&quot;&gt;&lt;/a&gt;流媒体数据接收到播放&lt;/h2&gt;&lt;p&gt;在网络传输过程中我们接收到相关媒体数据要经过一些列的处理来实现对媒体数据的播放，具体过程如下图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1877765-aab07b57fde17c34.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;iOS 视频播放流程图.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;可以看出我们在获取流媒体协议需要经过一下处理方式：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;解协议 —&amp;gt; 解封装  —&amp;gt; 音视频的解码 （实现音视频同步 &amp;amp; 播放）&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;流媒体数据解析&quot;&gt;&lt;a href=&quot;#流媒体数据解析&quot; class=&quot;headerlink&quot; title=&quot;流媒体数据解析&quot;&gt;&lt;/a&gt;流媒体数据解析&lt;/h3&gt;&lt;p&gt;在获取流媒体数据后，要对其进行协议的解析来获取封装的媒体数据进行播放。我们常见的协议：&lt;code&gt;HTTP&lt;/code&gt;、&lt;code&gt;RTMP&lt;/code&gt;和&lt;code&gt;MMS&lt;/code&gt;媒体协议&lt;/p&gt;
&lt;h4 id=&quot;协议简介&quot;&gt;&lt;a href=&quot;#协议简介&quot; class=&quot;headerlink&quot; title=&quot;协议简介&quot;&gt;&lt;/a&gt;协议简介&lt;/h4&gt;&lt;ul&gt;&lt;br&gt;&lt;li&gt;HTTP：超文本传输协议（HyperText Transfer Protocol）是一个客户端（用户）和服务端（网站）请求和应答的标准。&lt;br&gt;&lt;a href=&quot;https://zh.wikipedia.org/wiki/超文本传输协议&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;参考地址：&lt;/a&gt;&lt;br&gt;&lt;/li&gt;&lt;br&gt;&lt;br&gt;&lt;li&gt;RTMP：实时信息传输协议（Real Time Message Protocol）基于TCP实现持久链接和低延迟通信。流分解成片，客户端和服务端可设置大小（音：64，视频：128）。&lt;br&gt;&lt;a href=&quot;http://mingyangshang.github.io/2016/03/06/RTMP协议/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;参考地址1：&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://translate.google.co.jp/translate?hl=zh-CN&amp;amp;sl=en&amp;amp;u=https://en.wikipedia.org/wiki/Real-Time_Messaging_Protocol&amp;amp;prev=search&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;参考地址2：&lt;/a&gt;&lt;/li&gt;&lt;br&gt;&lt;br&gt;&lt;li&gt;MMS：串流媒体传送协议（Microsoft Media Server）用来访问并流式接受 Windows Media 服务器中 .asf 文件协议。&lt;br&gt;&lt;a href=&quot;https://zh.wikipedia.org/wiki/MMS_(协议&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;参考地址：&lt;/a&gt;)&lt;/li&gt;&lt;br&gt;&lt;br&gt;&lt;li&gt;HLS：流媒体网络传输协议（HTTP Live Streaming）把数据源分解为基于 HTTP 的片段，每次下载一些。下载数据之前需要一个包含数据的 m3u8 playlist文件来查找可用的媒体流。&lt;br&gt;&lt;a href=&quot;https://zh.wikipedia.org/wiki/HTTP_Live_Streaming&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;参考地址：&lt;/a&gt;&lt;br&gt;&lt;/li&gt;&lt;br&gt;&lt;br&gt;&lt;li&gt;RTP：实时传输协议（Real-time Transport Protocol）被设置为多播协议，和 RTP 协议、RTP 控制协议一起使用。&lt;br&gt;&lt;a href=&quot;https://zh.wikipedia.org/wiki/实时传输协议&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;参考地址：&lt;/a&gt;&lt;/li&gt;&lt;br&gt;&lt;br&gt;&lt;li&gt;RTCP：实时传输控制协议（Real-time Transport Protocol）搜集媒体链接统计信息，为 RTP 提供服务质量反馈。&lt;br&gt;&lt;a href=&quot;https://zh.wikipedia.org/wiki/实时传输控制协议&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;参考地址：&lt;/a&gt;&lt;br&gt;&lt;/li&gt;&lt;br&gt;&lt;br&gt;&lt;li&gt;RTSP：实时流协议，用于建立和控制终端之间的媒体会话，和 RTP 、RTCP 结合的，媒体流传输。&lt;br&gt;&lt;a href=&quot;https://translate.google.co.jp/translate?hl=zh-CN&amp;amp;sl=en&amp;amp;u=https://en.wikipedia.org/wiki/Real_Time_Streaming_Protocol&amp;amp;prev=search&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;参考地址：&lt;/a&gt;&lt;/li&gt;&lt;br&gt;&lt;/ul&gt;

&lt;h3 id=&quot;媒体封装格式&quot;&gt;&lt;a href=&quot;#媒体封装格式&quot; class=&quot;headerlink&quot; title=&quot;媒体封装格式&quot;&gt;&lt;/a&gt;媒体封装格式&lt;/h3&gt;&lt;p&gt;媒体封装就是把视频数据和音频数据进行按照一定的格式进行封装。我们常见的封装格式：&lt;code&gt;AVI&lt;/code&gt;、&lt;code&gt;MP4&lt;/code&gt;、&lt;code&gt;TS&lt;/code&gt;、&lt;code&gt;FLV&lt;/code&gt;、&lt;code&gt;MKV&lt;/code&gt;和&lt;code&gt;RMVB&lt;/code&gt;。&lt;/p&gt;
&lt;h4 id=&quot;媒体封装格式简介&quot;&gt;&lt;a href=&quot;#媒体封装格式简介&quot; class=&quot;headerlink&quot; title=&quot;媒体封装格式简介&quot;&gt;&lt;/a&gt;媒体封装格式简介&lt;/h4&gt;&lt;p&gt;下面是对媒体封装格式的整理和简介：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1877765-0491caa322fa42c8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;媒体封装格式整理.png&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;音视频编码格式&quot;&gt;&lt;a href=&quot;#音视频编码格式&quot; class=&quot;headerlink&quot; title=&quot;音视频编码格式&quot;&gt;&lt;/a&gt;音视频编码格式&lt;/h3&gt;&lt;p&gt;在音视频录制完成后为方便传输需要对其进行编码压缩处理，我们常见的音视频编码格式：&lt;/p&gt;
&lt;p&gt;视频编码格式：&lt;code&gt;H.264&lt;/code&gt;、&lt;code&gt;H.265(HEVC)&lt;/code&gt;、&lt;code&gt;MPEG4&lt;/code&gt;、&lt;code&gt;MPEG2&lt;/code&gt;、&lt;code&gt;VP9&lt;/code&gt;、&lt;code&gt;VP8&lt;/code&gt;和&lt;code&gt;VC-1&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;音频编码格式：&lt;code&gt;AAC&lt;/code&gt;、&lt;code&gt;AC-3&lt;/code&gt;、&lt;code&gt;MP3&lt;/code&gt;和&lt;code&gt;WMP&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;视音频编码格式&quot;&gt;&lt;a href=&quot;#视音频编码格式&quot; class=&quot;headerlink&quot; title=&quot;视音频编码格式&quot;&gt;&lt;/a&gt;视音频编码格式&lt;/h4&gt;&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1877765-1e3ce321225f5706.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;视音频编码格式.png&quot;&gt;&lt;/p&gt;
&lt;h4 id=&quot;编码格式地址&quot;&gt;&lt;a href=&quot;#编码格式地址&quot; class=&quot;headerlink&quot; title=&quot;编码格式地址&quot;&gt;&lt;/a&gt;编码格式地址&lt;/h4&gt;&lt;p&gt;下面是编码格式地址：&lt;/p&gt;
&lt;p&gt;H.264 :&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;地址&lt;/th&gt;
&lt;th style=&quot;text-align:center&quot;&gt;链接        &lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;地址1&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;&lt;a href=&quot;https://zh.wikipedia.org/wiki/H.264/MPEG-4_AVC&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://zh.wikipedia.org/wiki/H.264/MPEG-4_AVC&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;地址2&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;&lt;a href=&quot;https://abson.github.io/2016/11/15/深入浅出理解视频编码H264结构/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://abson.github.io/2016/11/15/深入浅出理解视频编码H264结构/&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;H.265 :&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;地址&lt;/th&gt;
&lt;th style=&quot;text-align:left&quot;&gt;链接        &lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;地址1&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;www.4k123.com/thread-6369-1-1.html&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;AAC：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;地址&lt;/th&gt;
&lt;th style=&quot;text-align:left&quot;&gt;链接        &lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;地址1&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;www.4k123.com/thread-6369-1-1.html&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;AC-3：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;地址&lt;/th&gt;
&lt;th style=&quot;text-align:left&quot;&gt;链接        &lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;地址1&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;blog.csdn.net/leixiaohua1020/article/details/11822737&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;MP3：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;地址&lt;/th&gt;
&lt;th style=&quot;text-align:left&quot;&gt;链接        &lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;地址1&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;&lt;a href=&quot;https://zh.wikipedia.org/zh-hans/MP3&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://zh.wikipedia.org/zh-hans/MP3&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&quot;解码简介&quot;&gt;&lt;a href=&quot;#解码简介&quot; class=&quot;headerlink&quot; title=&quot;解码简介&quot;&gt;&lt;/a&gt;解码简介&lt;/h3&gt;&lt;p&gt;在视频播放过程中我们需要对视频进行解码处理，常见的解码方式：硬解码和软解码。&lt;/p&gt;
&lt;h4 id=&quot;解码方式简介&quot;&gt;&lt;a href=&quot;#解码方式简介&quot; class=&quot;headerlink&quot; title=&quot;解码方式简介&quot;&gt;&lt;/a&gt;解码方式简介&lt;/h4&gt;&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1877765-b70e26b3769a95c7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;软解码&amp;amp;硬解码对比.png&quot;&gt;&lt;/p&gt;
&lt;h4 id=&quot;编码资料地址&quot;&gt;&lt;a href=&quot;#编码资料地址&quot; class=&quot;headerlink&quot; title=&quot;编码资料地址&quot;&gt;&lt;/a&gt;编码资料地址&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;框架名称&lt;/th&gt;
&lt;th style=&quot;text-align:left&quot;&gt;资料地址-1&lt;/th&gt;
&lt;th&gt;资料地址-2&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;AVFoundation&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;&lt;a href=&quot;http://yoferzhang.com/post/20160803AVFoundation01Introduction/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://yoferzhang.com/post/20160803AVFoundation01Introduction/&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&quot;http://www.superqq.com/blog/2015/08/24/avfoundation-gpuimage-find/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.superqq.com/blog/2015/08/24/avfoundation-gpuimage-find/&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;VideoToolBox&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;&lt;a href=&quot;http://www.4k123.com/thread-6369-1-1.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.4k123.com/thread-6369-1-1.html&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;FFMpeg&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;blog.csdn.net/leixiaohua1020/article/category/1360795&lt;/td&gt;
&lt;td&gt;www.tuicool.com/articles/22A7na3&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;code&gt;CPU&lt;/code&gt; &amp;amp; &lt;code&gt;GPU&lt;/code&gt; 的参考：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;框架名称&lt;/th&gt;
&lt;th style=&quot;text-align:left&quot;&gt;资料地址-1&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;CPU&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;&lt;a href=&quot;https://zh.wikipedia.org/wiki/中央处理器&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://zh.wikipedia.org/wiki/中央处理器&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;GPU&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;&lt;a href=&quot;https://zh.wikipedia.org/zh/圖形處理器&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://zh.wikipedia.org/zh/圖形處理器&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&quot;AVFoundation-框架介绍&quot;&gt;&lt;a href=&quot;#AVFoundation-框架介绍&quot; class=&quot;headerlink&quot; title=&quot;AVFoundation 框架介绍&quot;&gt;&lt;/a&gt;AVFoundation 框架介绍&lt;/h3&gt;&lt;p&gt;AVFoundation 可以用来播放和创建基于时间视听媒体的框架之一，提供基于时间的视听数据详细的 Objective-C上的接口。&lt;/p&gt;
&lt;h4 id=&quot;AVFoundation-功能介绍&quot;&gt;&lt;a href=&quot;#AVFoundation-功能介绍&quot; class=&quot;headerlink&quot; title=&quot;AVFoundation 功能介绍&quot;&gt;&lt;/a&gt;AVFoundation 功能介绍&lt;/h4&gt;&lt;p&gt;使用 &lt;code&gt;AVFoundation&lt;/code&gt; 可以实现视频的播放、编辑、静态媒体的捕捉、输出和时间媒体的表现等功能，如果仅仅是播放电影的话可以使用 &lt;code&gt;AVKit&lt;/code&gt;框架。 &lt;/p&gt;
&lt;h4 id=&quot;AVFoundation-接口介绍&quot;&gt;&lt;a href=&quot;#AVFoundation-接口介绍&quot; class=&quot;headerlink&quot; title=&quot;AVFoundation 接口介绍&quot;&gt;&lt;/a&gt;AVFoundation 接口介绍&lt;/h4&gt;&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1877765-c3069ae787712d75.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;iOS-AVFoundation-AVMutableComposition-AVAssetTrack.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1877765-ed13785f38e3a77c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;iOS-AVFoundation-AVMutableComposition-AVMutableAudioMix.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1877765-1ee84500bda738b3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;iOS-AVFoundation-AVMutableComposition-AVMutableVideoComposition.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1877765-9993bccb095d6642.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;iOS-AVFoundation-AVMutableComposition-AVAssetExportSession.png&quot;&gt;&lt;/p&gt;
&lt;h4 id=&quot;AVFoundation-类继承关系&quot;&gt;&lt;a href=&quot;#AVFoundation-类继承关系&quot; class=&quot;headerlink&quot; title=&quot;AVFoundation 类继承关系&quot;&gt;&lt;/a&gt;AVFoundation 类继承关系&lt;/h4&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/boilWater/boilWater.github.io/tree/master/Images/PPT&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;公司分享 PPT 下载地址&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;本次博客思路来自与公司的一次技术分享。前段时间被公司委派做视频相关的开发，就把视频总体内容梳理一下当做备忘。&lt;/p&gt;
&lt;p&gt;下面是本博文的写作思路：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1877765-bbdb773a30fc44a2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;iOS-视频大纲总结.png&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://yoursite.com/categories/iOS/"/>
    
    
      <category term="iOS" scheme="http://yoursite.com/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>iOS-开发过程中的错误处理</title>
    <link href="http://yoursite.com/2017/05/31/NSError(%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF)/"/>
    <id>http://yoursite.com/2017/05/31/NSError(错误信息)/</id>
    <published>2017-05-31T06:35:13.000Z</published>
    <updated>2017-06-01T09:51:07.000Z</updated>
    
    <content type="html">&lt;p&gt;开发过过程中我们经常会遇到异常问题&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1877765-ebec37c09e21ba91.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;iOS异常.png&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;iOS-开发过程中的错误处理&quot;&gt;&lt;a href=&quot;#iOS-开发过程中的错误处理&quot; class=&quot;headerlink&quot; title=&quot;iOS-开发过程中的错误处理&quot;&gt;&lt;/a&gt;iOS-开发过程中的错误处理&lt;/h1&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;我们在程序开发过程中经常会遇到异常，对异常的处理一般采用打印或者直接抛出。这样也可以很方便我们调试过程有所参考，而且方便我们查看异常产生的位置信息&lt;/p&gt;
&lt;h3 id=&quot;NSError-错误信息&quot;&gt;&lt;a href=&quot;#NSError-错误信息&quot; class=&quot;headerlink&quot; title=&quot;NSError(错误信息)&quot;&gt;&lt;/a&gt;NSError(错误信息)&lt;/h3&gt;&lt;h4 id=&quot;采用NSError的情况&quot;&gt;&lt;a href=&quot;#采用NSError的情况&quot; class=&quot;headerlink&quot; title=&quot;采用NSError的情况&quot;&gt;&lt;/a&gt;采用NSError的情况&lt;/h4&gt;&lt;p&gt;  使用 &lt;code&gt;NSError&lt;/code&gt; 的形式可以把程序中导致错误原因回报给调用者，而且使程序正常运行不会造成奔溃的后果&lt;/p&gt;
&lt;h4 id=&quot;NSError包含的内容&quot;&gt;&lt;a href=&quot;#NSError包含的内容&quot; class=&quot;headerlink&quot; title=&quot;NSError包含的内容&quot;&gt;&lt;/a&gt;NSError包含的内容&lt;/h4&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@interface&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;NSError&lt;/span&gt; : &lt;span class=&quot;title&quot;&gt;NSObject&lt;/span&gt; &amp;lt;&lt;span class=&quot;title&quot;&gt;NSCopying&lt;/span&gt;, &lt;span class=&quot;title&quot;&gt;NSSecureCoding&lt;/span&gt;&amp;gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;@private&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; *_reserved;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt; _code;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *_domain;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSDictionary&lt;/span&gt; *_userInfo;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;NSError _code&lt;/code&gt;（错误码， 类型 &lt;code&gt;NSInteger&lt;/code&gt;)  ： 独有的错误代码，指明在某个范围内具体发生的错误。可能是一系列的错误的集合，所以可以使用 Enum 来定义。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;NSError *_domain&lt;/code&gt; (错误范围，类型 &lt;code&gt;NSString&lt;/code&gt;) ：错误发生范围，通常使用一个特有的全局变量来定义。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;NSError *_userInfo&lt;/code&gt; (用户信息，类型 &lt;code&gt;NSDictionary&lt;/code&gt;) ：有关错误的额外信息，其中包含一段“本地化的描述”，还可能包含导致此错误发生的另一个错误。userInfo 可以描述为一条错误的链条&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&quot;NSError使用的两种情况&quot;&gt;&lt;a href=&quot;#NSError使用的两种情况&quot; class=&quot;headerlink&quot; title=&quot;NSError使用的两种情况&quot;&gt;&lt;/a&gt;NSError使用的两种情况&lt;/h4&gt;&lt;p&gt;   在方法实现或者是 API 设计时，我们对 &lt;code&gt;NSError&lt;/code&gt; 的使用情形有两种：在协议中传递和“输出参数”返回给调用者&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;通过委托协议来传递错误&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)connection:(&lt;span class=&quot;built_in&quot;&gt;NSURLConnection&lt;/span&gt; *)connection withError:(&lt;span class=&quot;built_in&quot;&gt;NSError&lt;/span&gt; *)error;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;通过代理协议的方式可以把错误报告信息传递&lt;/p&gt;
&lt;p&gt;  2.“输出参数”返回给调用者&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)doSomething:(&lt;span class=&quot;built_in&quot;&gt;NSError&lt;/span&gt; **)error;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;错误的信息作为一个指向指针的指针（也就是说一个指针指向错误的对象）&lt;/p&gt;
&lt;h3 id=&quot;throw-NSException-异常抛出&quot;&gt;&lt;a href=&quot;#throw-NSException-异常抛出&quot; class=&quot;headerlink&quot; title=&quot;@throw NSException (异常抛出)&quot;&gt;&lt;/a&gt;@throw NSException (异常抛出)&lt;/h3&gt;&lt;h4 id=&quot;采用-throw-情况&quot;&gt;&lt;a href=&quot;#采用-throw-情况&quot; class=&quot;headerlink&quot; title=&quot;采用 @throw 情况&quot;&gt;&lt;/a&gt;采用 @throw 情况&lt;/h4&gt;&lt;p&gt;在 APP 运行期间遇到问题，需要对问题进行操作终止程序抛出异常，可以使用 &lt;code&gt;@throw&lt;/code&gt; 来进行&lt;/p&gt;
&lt;h4 id=&quot;采用-throw-可能产生问题&quot;&gt;&lt;a href=&quot;#采用-throw-可能产生问题&quot; class=&quot;headerlink&quot; title=&quot;采用 @throw 可能产生问题&quot;&gt;&lt;/a&gt;采用 @throw 可能产生问题&lt;/h4&gt;&lt;p&gt;在异常抛出实例中，如果抛出异常。在实现抛出异常的代码后面的执行释放资源就不会执行，这样末尾的对象就不会被释放。如果想要生成“异常安全”的代码，可以设置编译器的标志 &lt;code&gt;-fobjc-arc-exceptions&lt;/code&gt; 来进行实现。不过将要一如加一些额外的代码，在不抛出异常时也会执行代码。&lt;br&gt;在不使用 ARC 时也很难实现异常抛出情况下对内存进行释放。&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSError&lt;/span&gt; * error = &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; success = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; doSomething:&amp;amp;error];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(error &amp;amp;&amp;amp; success) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;keyword&quot;&gt;@throw&lt;/span&gt;[&lt;span class=&quot;built_in&quot;&gt;NSException&lt;/span&gt; …];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[success release];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;按照上面👆实现当在异常抛出的过程时，success 还来不及释放。所以要解决上面的问题可以在异常抛出之前对 success 进行释放，但是当需要释放的资源有很多的情况下，这样操作起来就比较复杂。&lt;/p&gt;
&lt;p&gt;在开发过程中异常抛出可以使用在 抽象的基类 实例方法中进行调用。如果基类中的方法不被 &lt;code&gt;override&lt;/code&gt; 就设置抛出异常，这样可以保证实例方法被重写。&lt;/p&gt;
&lt;h3 id=&quot;try-catch-finally-异常捕捉&quot;&gt;&lt;a href=&quot;#try-catch-finally-异常捕捉&quot; class=&quot;headerlink&quot; title=&quot;@try @catch @finally (异常捕捉)&quot;&gt;&lt;/a&gt;@try @catch @finally (异常捕捉)&lt;/h3&gt;&lt;h4 id=&quot;采用-try-catch-finally-情况&quot;&gt;&lt;a href=&quot;#采用-try-catch-finally-情况&quot; class=&quot;headerlink&quot; title=&quot;采用 @try @catch @finally 情况&quot;&gt;&lt;/a&gt;采用 @try @catch @finally 情况&lt;/h4&gt;&lt;p&gt;个人感觉 @try @catch @finally 是 @throw NSException 的加强版。前者可以实现对异常的捕捉，相关异常的输出，和异常输出后执行的 @finally 相关的具体操作。后者是对具体整理 NSExpection 抛出，并没有前者比较完善的流程化操作步骤。&lt;/p&gt;
&lt;p&gt;如果在基类中实现 @throw 进行设置 必须 override 基类中的实例方法，那么捕获异常的方法中使用 @try @catch @finally。例如：NSArray，NSDictionary 初始变量使用字面量来获取值时，需要判断返回数据是否为 nil 来防止 APP Crash。 &lt;/p&gt;
&lt;h4 id=&quot;产生问题和解决方式&quot;&gt;&lt;a href=&quot;#产生问题和解决方式&quot; class=&quot;headerlink&quot; title=&quot;产生问题和解决方式&quot;&gt;&lt;/a&gt;产生问题和解决方式&lt;/h4&gt;&lt;p&gt;当使用 &lt;code&gt;@try @catch @finally&lt;/code&gt; 时，有两种情况 &lt;code&gt;MRC&lt;/code&gt; 和 &lt;code&gt;ARC&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;MRC&lt;/code&gt;（iOS 5 之前） 的环境中，上面的代码可以展示为：&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;SomeClass *someClass = &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       someClass = [[SomeClass alloc] init];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       [someClass doSomeThingsThatMayThrow];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@catch&lt;/span&gt;() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(… …);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@finally&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     [someClass release];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;在 ARC 的环境中，上面的代码展示为：&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;SomeClass *someClass = &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       someClass = [[SomeClass alloc] init];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       [someClass doSomeThingsThatMayThrow];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@catch&lt;/span&gt;( … ) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(… …);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@finally&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;可以看出在 MRC 的情形下可以实现对于内存的释放，在 ARC 的情形下会系统会实现对内存的释放? 这样向正确吗？&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;答案是：ARC 不会自动处理，因为如果要实现自动处理可能要加入大量的代码，才可以清楚对象实现抛出异常时将其清理。但是如果加入代码就会影响运行时的性能，在正常运行时也会如此。&lt;br&gt;如果在当前实现中开启 &lt;code&gt;-fobjc-arc-exception&lt;/code&gt; 的模式可以实现在 &lt;code&gt;@try @catch @finally&lt;/code&gt; 在异常情况下实现对未释放的对象进行内存的释放管理&lt;/p&gt;
&lt;h4 id=&quot;try-catch-finally-的-C-源码&quot;&gt;&lt;a href=&quot;#try-catch-finally-的-C-源码&quot; class=&quot;headerlink&quot; title=&quot;@try@catch@finally 的 C++ 源码&quot;&gt;&lt;/a&gt;@try@catch@finally 的 C++ 源码&lt;/h4&gt;&lt;p&gt;查看异常抛出的源码：&lt;br&gt;建立项目在 &lt;code&gt;main.m&lt;/code&gt; 文件中实现下面代码：&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; main(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; argc, &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; * argv[]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;@try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;@catch&lt;/span&gt; (&lt;span class=&quot;built_in&quot;&gt;NSException&lt;/span&gt; *exception) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;@finally&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;打开终端在 &lt;code&gt;main.m&lt;/code&gt; 终端的文件夹路径执行下面的语句&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;clang -x objective-c -rewrite-objc -isysroot /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator.sdk main.m&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;会生成文件 &lt;code&gt;main.cpp&lt;/code&gt; 的文件，可以打开查看文 &lt;code&gt;@try @catch @fianlly&lt;/code&gt;&lt;/p&gt;
&lt;h5 id=&quot;NSExpection-属性内容&quot;&gt;&lt;a href=&quot;#NSExpection-属性内容&quot; class=&quot;headerlink&quot; title=&quot;NSExpection 属性内容&quot;&gt;&lt;/a&gt;NSExpection 属性内容&lt;/h5&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;__attribute__((__objc_exception__))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#ifndef _REWRITER_typedef_NSException&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#define _REWRITER_typedef_NSException&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;typedef&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; objc_object &lt;span class=&quot;built_in&quot;&gt;NSException&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;typedef&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; &amp;#123;&amp;#125; _objc_exc_NSException;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#endif&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;NSException_IMPL&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;NSObject_IMPL&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;NSObject_IVARS&lt;/span&gt;; &lt;span class=&quot;comment&quot;&gt;//实例变量&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *name;                      &lt;span class=&quot;comment&quot;&gt;//exception 的名字&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *reason;                    &lt;span class=&quot;comment&quot;&gt;//exception 产生的原因&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;built_in&quot;&gt;NSDictionary&lt;/span&gt; *userInfo;              &lt;span class=&quot;comment&quot;&gt;//exception 展示使用详细的信息&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; reserved;                         &lt;span class=&quot;comment&quot;&gt;//&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&quot;NSError-属性内容&quot;&gt;&lt;a href=&quot;#NSError-属性内容&quot; class=&quot;headerlink&quot; title=&quot;NSError 属性内容&quot;&gt;&lt;/a&gt;NSError 属性内容&lt;/h5&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#ifndef _REWRITER_typedef_NSError&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#define _REWRITER_typedef_NSError&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;typedef&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; objc_object &lt;span class=&quot;built_in&quot;&gt;NSError&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;typedef&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; &amp;#123;&amp;#125; _objc_exc_NSError;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#endif&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;NSError_IMPL&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;NSObject_IMPL&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;NSObject_IVARS&lt;/span&gt;; &lt;span class=&quot;comment&quot;&gt;//实例变量&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; *_reserved;                     &lt;span class=&quot;comment&quot;&gt;//实例调用的方法&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt; _code;                     &lt;span class=&quot;comment&quot;&gt;//error 错误码&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *_domain;                   &lt;span class=&quot;comment&quot;&gt;//error 错误发生范围&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;built_in&quot;&gt;NSDictionary&lt;/span&gt; *_userInfo;             &lt;span class=&quot;comment&quot;&gt;//error 错误描述的具体信息&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;下面在 &lt;code&gt;main.m&lt;/code&gt; 中使用 &lt;code&gt;Clang&lt;/code&gt; 解析 &lt;code&gt;@try @catch @finally&lt;/code&gt; 在 C++ 环境中解析&lt;/p&gt;
&lt;ul&gt;&lt;br&gt;&lt;li&gt;没有参数&lt;br&gt;&lt;/li&gt;&lt;br&gt;&lt;br&gt;&lt;li&gt;有参数&lt;br&gt;&lt;/li&gt;&lt;br&gt;&lt;/ul&gt;

&lt;h5 id=&quot;没有参数&quot;&gt;&lt;a href=&quot;#没有参数&quot; class=&quot;headerlink&quot; title=&quot;没有参数&quot;&gt;&lt;/a&gt;没有参数&lt;/h5&gt;&lt;p&gt;在没有参数的情况下&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; main() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;@try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;@catch&lt;/span&gt; (&lt;span class=&quot;built_in&quot;&gt;NSException&lt;/span&gt; *exception) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;@finally&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;经过 Clang 解析后源码如下：&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; main() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123; &lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;volatile&lt;/span&gt; _rethrow = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	try &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		try &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		         &lt;span class=&quot;comment&quot;&gt;//异常捕获&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		    &amp;#125; catch (_objc_exc_NSException *_exception) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		         &lt;span class=&quot;built_in&quot;&gt;NSException&lt;/span&gt; *exception = (&lt;span class=&quot;built_in&quot;&gt;NSException&lt;/span&gt;*)_exception; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		         &lt;span class=&quot;comment&quot;&gt;//捕获异常，并进行抛出&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	catch (&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	     _rethrow = e;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#123;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; _FIN &amp;#123; _FIN(&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; reth) : rethrow(reth) &amp;#123;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		~_FIN() &amp;#123; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (rethrow) objc_exception_throw(rethrow); &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; rethrow;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125; _fin_force_rethow(_rethrow);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		   &lt;span class=&quot;comment&quot;&gt;//异常抛出后执行的 finally 的内容&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; IMAGE_INFO &amp;#123; &lt;span class=&quot;keyword&quot;&gt;unsigned&lt;/span&gt; version; &lt;span class=&quot;keyword&quot;&gt;unsigned&lt;/span&gt; flag; &amp;#125; _OBJC_IMAGE_INFO = &amp;#123; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt; &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&quot;有参数&quot;&gt;&lt;a href=&quot;#有参数&quot; class=&quot;headerlink&quot; title=&quot;有参数&quot;&gt;&lt;/a&gt;有参数&lt;/h5&gt;&lt;p&gt;在有参数的情况下&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; main() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSDictionary&lt;/span&gt; *dic = @&amp;#123;&lt;span class=&quot;string&quot;&gt;@&quot;name&quot;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;@&quot;liang&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                          &lt;span class=&quot;string&quot;&gt;@&quot;last name&quot;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;@&quot;bai&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                          &lt;span class=&quot;string&quot;&gt;@&quot;dream&quot;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;@&quot;to be a bussinessman&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                          &lt;span class=&quot;string&quot;&gt;@&quot;work&quot;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;@&quot;IT&quot;&lt;/span&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *salaryLiterals = &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *salaryAtIndex = &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;@try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        salaryAtIndex = [dic objectForKey:&lt;span class=&quot;string&quot;&gt;@&quot;salary&quot;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        salaryLiterals = dic[&lt;span class=&quot;string&quot;&gt;@&quot;salary&quot;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;@catch&lt;/span&gt; (&lt;span class=&quot;built_in&quot;&gt;NSException&lt;/span&gt; *exception) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;error name is %@, reason : %@, userInfo : %@&quot;&lt;/span&gt;, exception.name, exception.reason, exception.userInfo);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;@finally&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;经过 Clang 解析后源码如下：&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; main() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSDictionary&lt;/span&gt; *dic = ((&lt;span class=&quot;built_in&quot;&gt;NSDictionary&lt;/span&gt; *(*)(Class, SEL, &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; ObjectType *, &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; *, &lt;span class=&quot;built_in&quot;&gt;NSUInteger&lt;/span&gt;))(&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; *)objc_msgSend)(objc_getClass(&lt;span class=&quot;string&quot;&gt;&quot;NSDictionary&quot;&lt;/span&gt;), &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sel_registerName(&lt;span class=&quot;string&quot;&gt;&quot;dictionaryWithObjects:forKeys:count:&quot;&lt;/span&gt;), &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; *)__NSContainer_literal(&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;U, (&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)&amp;amp;__NSConstantStringImpl__var_folders_tv_4c43vcqx24vcxx6d51n4ntc00000gn_T_main_753a25_mi_1,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)&amp;amp;__NSConstantStringImpl__var_folders_tv_4c43vcqx24vcxx6d51n4ntc00000gn_T_main_753a25_mi_3, &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)&amp;amp;__NSConstantStringImpl__var_folders_tv_4c43vcqx24vcxx6d51n4ntc00000gn_T_main_753a25_mi_5, &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)&amp;amp;__NSConstantStringImpl__var_folders_tv_4c43vcqx24vcxx6d51n4ntc00000gn_T_main_753a25_mi_7).arr,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; *)__NSContainer_literal(&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;U, (&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)&amp;amp;__NSConstantStringImpl__var_folders_tv_4c43vcqx24vcxx6d51n4ntc00000gn_T_main_753a25_mi_0, &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)&amp;amp;__NSConstantStringImpl__var_folders_tv_4c43vcqx24vcxx6d51n4ntc00000gn_T_main_753a25_mi_2,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)&amp;amp;__NSConstantStringImpl__var_folders_tv_4c43vcqx24vcxx6d51n4ntc00000gn_T_main_753a25_mi_4,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)&amp;amp;__NSConstantStringImpl__var_folders_tv_4c43vcqx24vcxx6d51n4ntc00000gn_T_main_753a25_mi_6).arr, &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;U);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *salary = __null;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#123; &lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;volatile&lt;/span&gt; _rethrow = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; &lt;span class=&quot;comment&quot;&gt;//使用 volatile 修饰的 _rethrow 记录异常的局部变量 &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		try &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			try &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			        salary = ((&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;  _Nullable (*)(&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;, SEL, KeyType))(&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; *)objc_msgSend)((&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;)dic, sel_registerName(&lt;span class=&quot;string&quot;&gt;&quot;objectForKeyedSubscript:&quot;&lt;/span&gt;), &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			  (&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;)(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)&amp;amp;__NSConstantStringImpl__var_folders_tv_4c43vcqx24vcxx6d51n4ntc00000gn_T_main_753a25_mi_8);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		    catch (_objc_exc_NSException *_exception) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		     &lt;span class=&quot;built_in&quot;&gt;NSException&lt;/span&gt; *exception = (&lt;span class=&quot;built_in&quot;&gt;NSException&lt;/span&gt;*)_exception; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		     &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;((&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)&amp;amp;__NSConstantStringImpl__var_folders_tv_4c43vcqx24vcxx6d51n4ntc00000gn_T_main_753a25_mi_9,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		            ((&lt;span class=&quot;built_in&quot;&gt;NSExceptionName&lt;/span&gt; (*)(&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;, SEL))(&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; *)objc_msgSend)((&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;)exception, sel_registerName(&lt;span class=&quot;string&quot;&gt;&quot;name&quot;&lt;/span&gt;)), &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		            ((&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; * _Nullable (*)(&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;, SEL))(&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; *)objc_msgSend)((&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;)exception, sel_registerName(&lt;span class=&quot;string&quot;&gt;&quot;reason&quot;&lt;/span&gt;)), &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		            ((&lt;span class=&quot;built_in&quot;&gt;NSDictionary&lt;/span&gt; * _Nullable (*)(&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;, SEL))(&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; *)objc_msgSend)((&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;)exception, sel_registerName(&lt;span class=&quot;string&quot;&gt;&quot;userInfo&quot;&lt;/span&gt;)));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		catch (&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		    _rethrow = e;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		 &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			 &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; _FIN &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			    _FIN(&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; reth) : rethrow(reth) &amp;#123;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				~_FIN() &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				  &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (rethrow) objc_exception_throw(rethrow); &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; rethrow;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			 &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			 _fin_force_rethow(_rethrow);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			    salary = __null;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		 &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; IMAGE_INFO &amp;#123; &lt;span class=&quot;keyword&quot;&gt;unsigned&lt;/span&gt; version; &lt;span class=&quot;keyword&quot;&gt;unsigned&lt;/span&gt; flag; &amp;#125; _OBJC_IMAGE_INFO = &amp;#123; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt; &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;总结：&quot;&gt;&lt;a href=&quot;#总结：&quot; class=&quot;headerlink&quot; title=&quot;总结：&quot;&gt;&lt;/a&gt;总结：&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;（1）遇到奔溃问题或者是错误问题，优先使用 &lt;code&gt;NSError&lt;/code&gt; 来对奔溃和错误进行封装，然后使用 &lt;code&gt;NSLog&lt;/code&gt; 对其进行打印&lt;/p&gt;
&lt;p&gt;（2）&lt;code&gt;@try @catch @finally&lt;/code&gt; 在使用的过程中很方便，但是 &lt;code&gt;MRC&lt;/code&gt; 中如果变量较多可能会漏掉局部变量内存释放问题和 &lt;code&gt;ARC&lt;/code&gt; 中如果抛出问题，不会自动对局部变量释放（开启 &lt;code&gt;-fobjc-arc-expections&lt;/code&gt; 模式会进行释放，但是引入代码对性能有所影响）&lt;/p&gt;
&lt;/blockquote&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;开发过过程中我们经常会遇到异常问题&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1877765-ebec37c09e21ba91.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;iOS异常.png&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;iOS-开发过程中的错误处理&quot;&gt;&lt;a href=&quot;#iOS-开发过程中的错误处理&quot; class=&quot;headerlink&quot; title=&quot;iOS-开发过程中的错误处理&quot;&gt;&lt;/a&gt;iOS-开发过程中的错误处理&lt;/h1&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://yoursite.com/categories/iOS/"/>
    
    
      <category term="iOS" scheme="http://yoursite.com/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>iOS-Responder Chain (响应链)</title>
    <link href="http://yoursite.com/2017/05/15/iOS-Responder%20Chain/"/>
    <id>http://yoursite.com/2017/05/15/iOS-Responder Chain/</id>
    <published>2017-05-14T16:12:14.000Z</published>
    <updated>2017-06-01T07:48:51.000Z</updated>
    
    <content type="html">&lt;p&gt;工作接近一年，很久没有更新博客。工作中学到很多知识点后面将花时间整理，作为对一年知识学习的总结：&lt;/p&gt;
&lt;p&gt;下面是本篇博客的写作思路：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1877765-56a34538a5ab0e6b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;iOS-Responder Chain.png&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;iOS-Responder-Chain-响应链&quot;&gt;&lt;a href=&quot;#iOS-Responder-Chain-响应链&quot; class=&quot;headerlink&quot; title=&quot;iOS-Responder Chain (响应链)&quot;&gt;&lt;/a&gt;iOS-Responder Chain (响应链)&lt;/h1&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;人与计算机交互&quot;&gt;&lt;a href=&quot;#人与计算机交互&quot; class=&quot;headerlink&quot; title=&quot;人与计算机交互&quot;&gt;&lt;/a&gt;人与计算机交互&lt;/h2&gt;&lt;p&gt;目前计算机在我们生活中扮演很重要的角色，我们与计算机之间的交互也很普遍。多数情况使用最多的是 PC 和 移动端，而两种交互方式有很大的不同&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;PC 与人的交互&lt;/li&gt;
&lt;li&gt;移动端与人的交互&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;a)  在 PC 端我们通过键盘、鼠标等来对界面的内容进行操作和完成相关的任务&lt;/p&gt;
&lt;p&gt;b）在移动端我们可以通过手指对界面内容进行点击控件和实现相应的操作&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;这里提出一个疑问，PC 端我们通过点击可以实现控件的相关操作。但是移动端我们手指点击控件是怎么被检测点击的位置、传递信息和做出相应的操作呢？&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这里引入一个概念：Responder Chain (响应者链)&lt;/p&gt;
&lt;h2 id=&quot;Responder-Chain-响应者链&quot;&gt;&lt;a href=&quot;#Responder-Chain-响应者链&quot; class=&quot;headerlink&quot; title=&quot;Responder Chain (响应者链)&quot;&gt;&lt;/a&gt;Responder Chain (响应者链)&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;NSResponder.h 头文件的源码&lt;/li&gt;
&lt;li&gt;UIKit 控件之间的继承关系&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&quot;NSResponder-h-头文件的源码&quot;&gt;&lt;a href=&quot;#NSResponder-h-头文件的源码&quot; class=&quot;headerlink&quot; title=&quot;NSResponder.h 头文件的源码&quot;&gt;&lt;/a&gt;NSResponder.h 头文件的源码&lt;/h5&gt;&lt;p&gt;在我们点击手机屏幕的一个控件时，与 Responder Chain (响应者链)之间联系紧密。下面是小编在 &lt;code&gt;UIKit&lt;/code&gt; 框架中找到相应相关的代码，如下：&lt;br&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@interface&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;UIResponder&lt;/span&gt; : &lt;span class=&quot;title&quot;&gt;NSObject&lt;/span&gt; &amp;lt;&lt;span class=&quot;title&quot;&gt;UIResponderStandardEditActions&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;readonly&lt;/span&gt;, nullable) &lt;span class=&quot;built_in&quot;&gt;UIResponder&lt;/span&gt; *nextResponder;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (nullable &lt;span class=&quot;built_in&quot;&gt;UIResponder&lt;/span&gt;*)nextResponder;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;readonly&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; canBecomeFirstResponder;    &lt;span class=&quot;comment&quot;&gt;// default is NO&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)canBecomeFirstResponder;    &lt;span class=&quot;comment&quot;&gt;// default is NO&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)becomeFirstResponder;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;readonly&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; canResignFirstResponder;   &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)canResignFirstResponder;    &lt;span class=&quot;comment&quot;&gt;// default is YES&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)resignFirstResponder;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;readonly&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; isFirstResponder;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)isFirstResponder;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)touchesBegan:(&lt;span class=&quot;built_in&quot;&gt;NSSet&lt;/span&gt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;UITouch&lt;/span&gt; *&amp;gt; *)touches withEvent:(nullable &lt;span class=&quot;built_in&quot;&gt;UIEvent&lt;/span&gt; *)event;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)touchesMoved:(&lt;span class=&quot;built_in&quot;&gt;NSSet&lt;/span&gt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;UITouch&lt;/span&gt; *&amp;gt; *)touches withEvent:(nullable &lt;span class=&quot;built_in&quot;&gt;UIEvent&lt;/span&gt; *)event;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)touchesEnded:(&lt;span class=&quot;built_in&quot;&gt;NSSet&lt;/span&gt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;UITouch&lt;/span&gt; *&amp;gt; *)touches withEvent:(nullable &lt;span class=&quot;built_in&quot;&gt;UIEvent&lt;/span&gt; *)event;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)touchesCancelled:(&lt;span class=&quot;built_in&quot;&gt;NSSet&lt;/span&gt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;UITouch&lt;/span&gt; *&amp;gt; *)touches withEvent:(nullable &lt;span class=&quot;built_in&quot;&gt;UIEvent&lt;/span&gt; *)event;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)touchesEstimatedPropertiesUpdated:(&lt;span class=&quot;built_in&quot;&gt;NSSet&lt;/span&gt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;UITouch&lt;/span&gt; *&amp;gt; *)touches &lt;span class=&quot;built_in&quot;&gt;NS_AVAILABLE_IOS&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;9&lt;/span&gt;_1);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)pressesBegan:(&lt;span class=&quot;built_in&quot;&gt;NSSet&lt;/span&gt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;UIPress&lt;/span&gt; *&amp;gt; *)presses withEvent:(nullable &lt;span class=&quot;built_in&quot;&gt;UIPressesEvent&lt;/span&gt; *)event &lt;span class=&quot;built_in&quot;&gt;NS_AVAILABLE_IOS&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;9&lt;/span&gt;_0);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)pressesChanged:(&lt;span class=&quot;built_in&quot;&gt;NSSet&lt;/span&gt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;UIPress&lt;/span&gt; *&amp;gt; *)presses withEvent:(nullable &lt;span class=&quot;built_in&quot;&gt;UIPressesEvent&lt;/span&gt; *)event &lt;span class=&quot;built_in&quot;&gt;NS_AVAILABLE_IOS&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;9&lt;/span&gt;_0);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)pressesEnded:(&lt;span class=&quot;built_in&quot;&gt;NSSet&lt;/span&gt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;UIPress&lt;/span&gt; *&amp;gt; *)presses withEvent:(nullable &lt;span class=&quot;built_in&quot;&gt;UIPressesEvent&lt;/span&gt; *)event &lt;span class=&quot;built_in&quot;&gt;NS_AVAILABLE_IOS&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;9&lt;/span&gt;_0);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)pressesCancelled:(&lt;span class=&quot;built_in&quot;&gt;NSSet&lt;/span&gt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;UIPress&lt;/span&gt; *&amp;gt; *)presses withEvent:(nullable &lt;span class=&quot;built_in&quot;&gt;UIPressesEvent&lt;/span&gt; *)event &lt;span class=&quot;built_in&quot;&gt;NS_AVAILABLE_IOS&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;9&lt;/span&gt;_0);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;在上面 &lt;code&gt;&amp;lt;UIKit/UIResponder.h&amp;gt;&lt;/code&gt; 的文件中我们可以看出 &lt;code&gt;UIResponder&lt;/code&gt; 的类可以实现 &lt;code&gt;Touch&lt;/code&gt; 和 &lt;code&gt;Press&lt;/code&gt; 相关操作的做出监听&lt;/p&gt;
&lt;h5 id=&quot;UIKit-控件之间的继承关系&quot;&gt;&lt;a href=&quot;#UIKit-控件之间的继承关系&quot; class=&quot;headerlink&quot; title=&quot;UIKit 控件之间的继承关系&quot;&gt;&lt;/a&gt;UIKit 控件之间的继承关系&lt;/h5&gt;&lt;p&gt;下面是小编对 &lt;code&gt;UIKit&lt;/code&gt; 框架中点击相应控件有关 &lt;code&gt;Class&lt;/code&gt; (类)继承关系整理，如下图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1877765-faaebfb7fe3a7067.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;iOS-Responder Chain-UIKit.png&quot;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;由上面我们可以看出，在界面上我们平时使用控件时通过继承 &lt;code&gt;UIResponder&lt;/code&gt; 来实现对界面 &lt;code&gt;Touch&lt;/code&gt; 和 &lt;code&gt;Press&lt;/code&gt; 相关操作的做出监听&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;响应链的创建&quot;&gt;&lt;a href=&quot;#响应链的创建&quot; class=&quot;headerlink&quot; title=&quot;响应链的创建&quot;&gt;&lt;/a&gt;响应链的创建&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;控制器中的 &lt;code&gt;View&lt;/code&gt; 树状结构&lt;/li&gt;
&lt;li&gt;点击相应的测试&amp;amp;打印&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&quot;控制器中的-View-树状结构&quot;&gt;&lt;a href=&quot;#控制器中的-View-树状结构&quot; class=&quot;headerlink&quot; title=&quot;控制器中的 View 树状结构&quot;&gt;&lt;/a&gt;控制器中的 &lt;code&gt;View&lt;/code&gt; 树状结构&lt;/h5&gt;&lt;p&gt;在手机的 GUI 中我们多数情况下使用 &lt;code&gt;UIViewController&lt;/code&gt; 和 &lt;code&gt;UINavigationViewController&lt;/code&gt; 控制器来实现界面控件的管理，其中以控制器的 &lt;code&gt;View&lt;/code&gt; 为界面显示创建和添加控件，最后形成 &lt;code&gt;View&lt;/code&gt; 的控件树状结构&lt;/p&gt;
&lt;p&gt;GUI 手机界面中，我们知道 &lt;code&gt;UIView&lt;/code&gt; 中用 &lt;code&gt;property&lt;/code&gt; (属性) &lt;code&gt;superView&lt;/code&gt; 可以用来添加新的 &lt;code&gt;UIView&lt;/code&gt; 到当前的 &lt;code&gt;View&lt;/code&gt; 中，添加的子类 &lt;code&gt;View&lt;/code&gt; 中 &lt;code&gt;property&lt;/code&gt; (属性) &lt;code&gt;nextResponder&lt;/code&gt; 可以指向父类 &lt;code&gt;View&lt;/code&gt; 的 &lt;code&gt;property&lt;/code&gt; (属性) &lt;code&gt;superView&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;每一个  &lt;code&gt;ViewController&lt;/code&gt; 中有 &lt;code&gt;property&lt;/code&gt;(属性) &lt;code&gt;view&lt;/code&gt; -&amp;gt; 既&lt;code&gt;self.view&lt;/code&gt; 来进行添加子类 &lt;code&gt;View&lt;/code&gt;，同样：&lt;code&gt;view&lt;/code&gt; 的 &lt;code&gt;property&lt;/code&gt; (属性) 通过   &lt;code&gt;property&lt;/code&gt; (属性) &lt;code&gt;nextResponder&lt;/code&gt; 来指向   &lt;code&gt;ViewController&lt;/code&gt; &lt;/p&gt;
&lt;p&gt;下图是 &lt;code&gt;View&lt;/code&gt; 初始化布局：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1877765-ff79d6261a13c062.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;iOS-Responder Chain-View-Front.png&quot;&gt;&lt;br&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1877765-bbfe167edcd04fed.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;iOS-Responder Chain-View-Hierarchy.png&quot;&gt;&lt;/p&gt;
&lt;h5 id=&quot;点击相应的测试-amp-打印&quot;&gt;&lt;a href=&quot;#点击相应的测试-amp-打印&quot; class=&quot;headerlink&quot; title=&quot;点击相应的测试&amp;amp;打印&quot;&gt;&lt;/a&gt;点击相应的测试&amp;amp;打印&lt;/h5&gt;&lt;p&gt;在定义的 ViewA1 中重写&lt;code&gt;touch&lt;/code&gt;方法：&lt;br&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)touchesBegan:(&lt;span class=&quot;built_in&quot;&gt;NSSet&lt;/span&gt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;UITouch&lt;/span&gt; *&amp;gt; *)touches withEvent:(&lt;span class=&quot;built_in&quot;&gt;UIEvent&lt;/span&gt; *)event &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;UIResponder&lt;/span&gt; *next = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; nextResponder];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSMutableString&lt;/span&gt; *prefix  = &lt;span class=&quot;string&quot;&gt;@&quot;&quot;&lt;/span&gt;.mutableCopy;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; (&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt; != next) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;%@%@&quot;&lt;/span&gt;, prefix, [next class]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [prefix appendString:&lt;span class=&quot;string&quot;&gt;@&quot;--&quot;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        next = [next nextResponder];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;点击 &lt;code&gt;ViewA1&lt;/code&gt; 得到的打印结果：&lt;br&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2017&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-05&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-08&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;23&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;55&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;12.278&lt;/span&gt; DesignPattern-Create[&lt;span class=&quot;number&quot;&gt;19441&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;727956&lt;/span&gt;] ViewA0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2017&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-05&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-08&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;23&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;55&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;12.278&lt;/span&gt; DesignPattern-Create[&lt;span class=&quot;number&quot;&gt;19441&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;727956&lt;/span&gt;] --ViewA&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2017&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-05&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-08&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;23&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;55&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;12.278&lt;/span&gt; DesignPattern-Create[&lt;span class=&quot;number&quot;&gt;19441&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;727956&lt;/span&gt;] ----&lt;span class=&quot;built_in&quot;&gt;UIView&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2017&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-05&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-08&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;23&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;55&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;12.279&lt;/span&gt; DesignPattern-Create[&lt;span class=&quot;number&quot;&gt;19441&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;727956&lt;/span&gt;] ------ViewController&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2017&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-05&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-08&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;23&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;55&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;12.279&lt;/span&gt; DesignPattern-Create[&lt;span class=&quot;number&quot;&gt;19441&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;727956&lt;/span&gt;] --------&lt;span class=&quot;built_in&quot;&gt;UIWindow&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2017&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-05&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-08&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;23&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;55&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;12.279&lt;/span&gt; DesignPattern-Create[&lt;span class=&quot;number&quot;&gt;19441&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;727956&lt;/span&gt;] ----------&lt;span class=&quot;built_in&quot;&gt;UIApplication&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2017&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-05&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-08&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;23&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;55&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;12.280&lt;/span&gt; DesignPattern-Create[&lt;span class=&quot;number&quot;&gt;19441&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;727956&lt;/span&gt;] ------------AppDelegate&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;基于上面：小编从上面代码打印的结果可以验证，子 View 的 property(属性) &lt;code&gt;nextResponder&lt;/code&gt; 指向父 View，父类的 View 的property(属性) &lt;code&gt;nextResponder&lt;/code&gt; 最后指向 ViewController &lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;如何找打第一响应者&quot;&gt;&lt;a href=&quot;#如何找打第一响应者&quot; class=&quot;headerlink&quot; title=&quot;如何找打第一响应者&quot;&gt;&lt;/a&gt;如何找打第一响应者&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;探测器 &lt;code&gt;Hit - Test&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;寻找第一相应的探测猜想&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&quot;探测器-Hit-Test&quot;&gt;&lt;a href=&quot;#探测器-Hit-Test&quot; class=&quot;headerlink&quot; title=&quot;探测器 Hit - Test&quot;&gt;&lt;/a&gt;探测器 &lt;code&gt;Hit - Test&lt;/code&gt;&lt;/h5&gt;&lt;p&gt;在响应链查找过程中，有两个函数起到很重要的作用&lt;br&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;UIView&lt;/span&gt; *)hitTest:(&lt;span class=&quot;built_in&quot;&gt;CGPoint&lt;/span&gt;)point withEvent:(&lt;span class=&quot;built_in&quot;&gt;UIEvent&lt;/span&gt; *)event;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)pointInside:(&lt;span class=&quot;built_in&quot;&gt;CGPoint&lt;/span&gt;)point withEvent:(&lt;span class=&quot;built_in&quot;&gt;UIEvent&lt;/span&gt; *)event;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;在响应链创建的情况下，我们在把寻找响应者的过程称为：&lt;code&gt;Hit - Testing View&lt;/code&gt; 在寻找相应 View 的过程称为：&lt;code&gt;Hit - Test&lt;/code&gt;&lt;br&gt;我们把 &lt;code&gt;Hit - Test&lt;/code&gt; 可以比作一个探测器，通过这个探测器来检测手指点击在哪个 &lt;code&gt;UIView&lt;/code&gt; 上面 &lt;/p&gt;
&lt;p&gt;通过上面的继承关系和点击后打印出的结果可以看到，当我们点击界面 &lt;code&gt;UIApplication&lt;/code&gt; 就会调用 &lt;code&gt;hitTest: withEvent&lt;/code&gt; 查看点击是否在 &lt;code&gt;UIWindow&lt;/code&gt; 中如果不在就返回 &lt;code&gt;nil&lt;/code&gt; , 如果在 &lt;code&gt;UIWindow&lt;/code&gt; 也会调用 &lt;code&gt;hitTest: withEvent&lt;/code&gt; 对&lt;code&gt;UIWindow&lt;/code&gt; 中 &lt;code&gt;subViews&lt;/code&gt; 进行探测&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;hitTest: withEvent&lt;/code&gt; 在探测过程中采用我们比较常见 递归的方式来查找点击 &lt;code&gt;UIView&lt;/code&gt;， 通过我们在初始化过程中最后被初始化的放在最上面&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;在点击 &lt;code&gt;ViewA1&lt;/code&gt; 来进行验证下一个 &lt;code&gt;nextResponder&lt;/code&gt; 过程中在每一个 &lt;code&gt;View&lt;/code&gt;重写 &lt;code&gt;hitTest&lt;/code&gt; 如下：&lt;br&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;UIView&lt;/span&gt; *)hitTest:(&lt;span class=&quot;built_in&quot;&gt;CGPoint&lt;/span&gt;)point withEvent:(&lt;span class=&quot;built_in&quot;&gt;UIEvent&lt;/span&gt; *)event &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.isUserInteractionEnabled || &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.hidden || &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.alpha &amp;lt;= &lt;span class=&quot;number&quot;&gt;0.01&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;ResponderChain : %@&quot;&lt;/span&gt;, [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; class]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; pointInside:point withEvent:event]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;built_in&quot;&gt;UIView&lt;/span&gt; *subView &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.subviews reverseObjectEnumerator]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;CGPoint&lt;/span&gt; converPoin = [subView convertPoint:point fromView:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;UIView&lt;/span&gt; *hitTestView = [subView hitTest:converPoin withEvent:event];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (hitTestView) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;ViewA : hitTestView -&amp;gt; %@&quot;&lt;/span&gt;, [hitTestView class]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; hitTestView;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;点击 &lt;code&gt;ViewA1&lt;/code&gt; 得到打印的结果如下：&lt;br&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2017&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-05&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-09&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;07&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;42&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;05.968&lt;/span&gt; DesignPattern-Create[&lt;span class=&quot;number&quot;&gt;1197&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;22554&lt;/span&gt;] ResponderChain : ViewB&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2017&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-05&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-09&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;07&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;42&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;05.969&lt;/span&gt; DesignPattern-Create[&lt;span class=&quot;number&quot;&gt;1197&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;22554&lt;/span&gt;] ResponderChain : ViewA&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2017&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-05&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-09&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;07&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;42&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;05.969&lt;/span&gt; DesignPattern-Create[&lt;span class=&quot;number&quot;&gt;1197&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;22554&lt;/span&gt;] ResponderChain : ViewA0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2017&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-05&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-09&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;07&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;42&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;05.969&lt;/span&gt; DesignPattern-Create[&lt;span class=&quot;number&quot;&gt;1197&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;22554&lt;/span&gt;] ResponderChain : ViewA1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h5 id=&quot;寻找第一相应的探测猜想&quot;&gt;&lt;a href=&quot;#寻找第一相应的探测猜想&quot; class=&quot;headerlink&quot; title=&quot;寻找第一相应的探测猜想&quot;&gt;&lt;/a&gt;寻找第一相应的探测猜想&lt;/h5&gt;&lt;p&gt;根据打印的结果，我们可以验证点击具体查找的流程如下图所示：（实例是点击 viewA1）&lt;br&gt;UIApplication —&amp;gt; UIWindow  —&amp;gt; viewB —&amp;gt; viewA —&amp;gt; viewA0 —&amp;gt; viewA1&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1877765-4b1f59d1c65500ba.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;iOS-Responder Chain-Hit-Testing-View.png&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;利用响应者在应用中的体现&quot;&gt;&lt;a href=&quot;#利用响应者在应用中的体现&quot; class=&quot;headerlink&quot; title=&quot;利用响应者在应用中的体现&quot;&gt;&lt;/a&gt;利用响应者在应用中的体现&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;改变控件的相应范围&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&quot;改变控件的相应范围&quot;&gt;&lt;a href=&quot;#改变控件的相应范围&quot; class=&quot;headerlink&quot; title=&quot;改变控件的相应范围&quot;&gt;&lt;/a&gt;改变控件的相应范围&lt;/h5&gt;&lt;p&gt;我们可以利用 &lt;code&gt;hitTest&lt;/code&gt; 根据 &lt;code&gt;point&lt;/code&gt; 方式来重新设置 &lt;code&gt;ponit&lt;/code&gt; 的点击相应的范围大小&lt;br&gt;在 ViewB1 中实现点击相应范围在布局显示基础上下左右拓展 10 px，实现代码如下：&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;UIView&lt;/span&gt; *)hitTest:(&lt;span class=&quot;built_in&quot;&gt;CGPoint&lt;/span&gt;)point withEvent:(&lt;span class=&quot;built_in&quot;&gt;UIEvent&lt;/span&gt; *)event &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.isUserInteractionEnabled || &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.isHidden || &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.alpha &amp;lt;= &lt;span class=&quot;number&quot;&gt;0.01&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;ResponderChain : %@&quot;&lt;/span&gt;, [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; class]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;CGRect&lt;/span&gt; touchRect = &lt;span class=&quot;built_in&quot;&gt;CGRectInset&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.bounds, &lt;span class=&quot;number&quot;&gt;-10&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;-10&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;built_in&quot;&gt;CGRectContainsPoint&lt;/span&gt;(touchRect, point)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;built_in&quot;&gt;UIView&lt;/span&gt; *subView &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.subviews reverseObjectEnumerator]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;CGPoint&lt;/span&gt; converPoint = [subView convertPoint:point fromView:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;UIView&lt;/span&gt; *hitTestView = [subView hitTest:converPoint withEvent:event];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (hitTestView) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;ViewB1 : hitTestView -&amp;gt; %@&quot;&lt;/span&gt;, [hitTestView class]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; hitTestView;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;ViewB1&lt;/code&gt; 界面中实际范围，和点击相应的 &lt;code&gt;viewB1&lt;/code&gt; 外的虚框的范围也会做出相应的相应。如下图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1877765-f4e683de8d0ab2cb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;iOS-Responder Chain-Apply.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;打印的结果：&lt;br&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2017&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-05&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-09&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;34&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;00.437&lt;/span&gt; DesignPattern-Create[&lt;span class=&quot;number&quot;&gt;1197&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;22554&lt;/span&gt;] ResponderChain : ViewB&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2017&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-05&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-09&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;34&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;00.437&lt;/span&gt; DesignPattern-Create[&lt;span class=&quot;number&quot;&gt;1197&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;22554&lt;/span&gt;] ResponderChain : ViewB1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2017&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-05&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-09&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;34&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;00.437&lt;/span&gt; DesignPattern-Create[&lt;span class=&quot;number&quot;&gt;1197&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;22554&lt;/span&gt;] ViewB : hitTestView -&amp;gt; ViewB1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;相关的测试的&lt;a href=&quot;https://github.com/boilWater/DesignPattern-Create.git&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Dome&lt;/a&gt;下载地址&lt;/p&gt;
&lt;p&gt;时间：2017/5/8 23:58:44 (后面会继承写作)&lt;br&gt;修改时间： 2017/5/9 22:30:45&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;工作接近一年，很久没有更新博客。工作中学到很多知识点后面将花时间整理，作为对一年知识学习的总结：&lt;/p&gt;
&lt;p&gt;下面是本篇博客的写作思路：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1877765-56a34538a5ab0e6b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;iOS-Responder Chain.png&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;iOS-Responder-Chain-响应链&quot;&gt;&lt;a href=&quot;#iOS-Responder-Chain-响应链&quot; class=&quot;headerlink&quot; title=&quot;iOS-Responder Chain (响应链)&quot;&gt;&lt;/a&gt;iOS-Responder Chain (响应链)&lt;/h1&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://yoursite.com/categories/iOS/"/>
    
    
      <category term="iOS" scheme="http://yoursite.com/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>iOS Runtime-替换方法 &amp; 消息发送转发</title>
    <link href="http://yoursite.com/2017/02/01/iOS%20Runtime-%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81%E5%92%8C%E8%BD%AC%E5%8F%91/"/>
    <id>http://yoursite.com/2017/02/01/iOS Runtime-消息发送和转发/</id>
    <published>2017-02-01T09:42:32.000Z</published>
    <updated>2017-08-25T09:21:06.000Z</updated>
    
    <content type="html">&lt;h2 id=&quot;总概&quot;&gt;&lt;a href=&quot;#总概&quot; class=&quot;headerlink&quot; title=&quot;总概&quot;&gt;&lt;/a&gt;总概&lt;/h2&gt;&lt;p&gt;在做公司项目过程中遇到一些需要进行替换原来方法情况。小编对 &lt;code&gt;Objc&lt;/code&gt; 在消息发送和转发过程整理，针对在消息发送和转发在 &lt;code&gt;runtime&lt;/code&gt; 层实现和提出的方法替换方案原理做出详细说明和记录。&lt;/p&gt;
&lt;p&gt;下面是小编本博文的写作思路：&lt;br&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1877765-a56ae4460c575f24.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;iOS 消息发送和转发过程流程图.png&quot;&gt;&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;iOS-消息发送和转发过程&quot;&gt;&lt;a href=&quot;#iOS-消息发送和转发过程&quot; class=&quot;headerlink&quot; title=&quot;iOS 消息发送和转发过程&quot;&gt;&lt;/a&gt;iOS 消息发送和转发过程&lt;/h2&gt;&lt;p&gt;想要对现有的 &lt;code&gt;Method&lt;/code&gt; 进行替换找到比较可行的方案，其一可以从方法在执行过程中考虑。下面小编将整理的消息发送和转发的详细步骤进行整理。&lt;/p&gt;
&lt;h3 id=&quot;Objc-的动态特性&quot;&gt;&lt;a href=&quot;#Objc-的动态特性&quot; class=&quot;headerlink&quot; title=&quot;Objc 的动态特性&quot;&gt;&lt;/a&gt;Objc 的动态特性&lt;/h3&gt;&lt;p&gt;&lt;code&gt;Objc&lt;/code&gt; 是基于 &lt;code&gt;C&lt;/code&gt; 和 &lt;code&gt;Smalltalk&lt;/code&gt; 为基础实现面向对象开发的动态语言，&lt;code&gt;Objc&lt;/code&gt;具有特色一点就是采纳了 &lt;code&gt;Smalltalk&lt;/code&gt; 语言消息的特性，所以我们在 &lt;code&gt;Objc&lt;/code&gt; 中经常使用 &lt;code&gt;[receiver message]&lt;/code&gt; 来进行消息传递。&lt;code&gt;Objc&lt;/code&gt; 的动态语言的特性可以根据 &lt;code&gt;NSObject&lt;/code&gt;方式之一来实现交互，下面看相关 &lt;code&gt;API&lt;/code&gt; （下面均可进行动态判断）：&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;+ (&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)description;&lt;span class=&quot;comment&quot;&gt;//需要重载并为定义的类进行描述&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)isKindOfClass:(Class)aClass;&lt;span class=&quot;comment&quot;&gt;//判断是否是同种类型&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)isMemberOfClass:(Class)aClass;&lt;span class=&quot;comment&quot;&gt;//判断是否是一样成员&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)respondsToSelector:(SEL)aSelector;&lt;span class=&quot;comment&quot;&gt;//检查对象能否向相应指定的消息&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)conformsToProtocol:(Protocol *)aProtocol;&lt;span class=&quot;comment&quot;&gt;//检查对象是否实现了指定协议类的方发&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (IMP)methodForSelector:(SEL)aSelector;&lt;span class=&quot;comment&quot;&gt;//返回指定方法实现的地址&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//消息发送和转发过程调用的 API&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)resolveClassMethod:(SEL)sel;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)resolveInstanceMethod:(SEL)sel;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;)forwardingTargetForSelector:(SEL)aSelector;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;NSMethodSignature&lt;/span&gt; *)methodSignatureForSelector:(SEL)aSelector;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)forwardInvocation:(&lt;span class=&quot;built_in&quot;&gt;NSInvocation&lt;/span&gt; *)anInvocation;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;iOS-消息发送转发机制&quot;&gt;&lt;a href=&quot;#iOS-消息发送转发机制&quot; class=&quot;headerlink&quot; title=&quot;iOS 消息发送转发机制&quot;&gt;&lt;/a&gt;iOS 消息发送转发机制&lt;/h3&gt;&lt;p&gt;在 &lt;code&gt;Objc&lt;/code&gt; 使用 Foundation 中 &lt;code&gt;NSObject&lt;/code&gt; 中实现动态特性中，上述列出消息发送和转发过程的调用的 &lt;code&gt;API&lt;/code&gt;。在整体消息从发送转发可以分为以下三个时段：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;动态解析&lt;/li&gt;
&lt;li&gt;快速转发&lt;/li&gt;
&lt;li&gt;慢速转发&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;下图是消息发送和转发过程三个时段流程，后面给出详细说明：&lt;br&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1877765-1dbe544a1221fb36.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;iOS 消息发送和转发过程流程图.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;下面是在 iOS 方法调用实现：&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//未实现方法调用&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; performSelector:&lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(finishMessage)];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//消息发送和转发&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)resolveClassMethod:(SEL)sel &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;do method : %@&quot;&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;NSStringFromSelector&lt;/span&gt;(_cmd));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; [&lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; resolveClassMethod:sel];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)resolveInstanceMethod:(SEL)sel &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;do method : %@&quot;&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;NSStringFromSelector&lt;/span&gt;(_cmd));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; [&lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; resolveInstanceMethod:sel];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;)forwardingTargetForSelector:(SEL)aSelector &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;do method : %@&quot;&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;NSStringFromSelector&lt;/span&gt;(_cmd));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; [&lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; forwardingTargetForSelector:aSelector];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;NSMethodSignature&lt;/span&gt; *)methodSignatureForSelector:(SEL)aSelector &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;do method : %@&quot;&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;NSStringFromSelector&lt;/span&gt;(_cmd));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSMethodSignature&lt;/span&gt; *methodSignature = [&lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; methodSignatureForSelector:aSelector];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; methodSignature;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)forwardInvocation:(&lt;span class=&quot;built_in&quot;&gt;NSInvocation&lt;/span&gt; *)anInvocation &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;do method : %@&quot;&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;NSStringFromSelector&lt;/span&gt;(_cmd));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//打印结果：&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//RuntimeDemo[13659:1331712] do method : resolveInstanceMethod:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//RuntimeDemo[13659:1331712] do method : resolveInstanceMethod:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//RuntimeDemo[13659:1331712] do method : forwardingTargetForSelector:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//RuntimeDemo[13659:1331712] do method : methodSignatureForSelector:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;动态解析&quot;&gt;&lt;a href=&quot;#动态解析&quot; class=&quot;headerlink&quot; title=&quot;动态解析&quot;&gt;&lt;/a&gt;动态解析&lt;/h4&gt;&lt;p&gt;如果要实现动态解析就要使用下面的方法：&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;+ (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)resolveClassMethod:(SEL)sel;&lt;span class=&quot;comment&quot;&gt;//解析类方法选择子&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)resolveInstanceMethod:(SEL)sel;&lt;span class=&quot;comment&quot;&gt;//解析实例方法选择子&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;当我们在实现 &lt;code&gt;[receiver message]&lt;/code&gt; 在没有相关实现的情况下，系统就会沿着 &lt;code&gt;resolveInstanceMethod:&lt;/code&gt; 顺着继承向上查找相关 &lt;code&gt;message&lt;/code&gt; 实现方法，如果没有找到相关实现就会返回 &lt;code&gt;NO&lt;/code&gt; 进行下一步操作。在这个过程中我们可以通过动态加载的方式，实现我们预先实现的方法。&lt;/p&gt;
&lt;p&gt;动态加载实现代码如下：&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;+ (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)resolveInstanceMethod:(SEL)sel &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (sel_isEqual(sel, &lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(finishMessage))) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        class_addMethod([&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; class], &lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(finishMessage), (IMP)secondMessage, &lt;span class=&quot;string&quot;&gt;&quot;v@:&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; [&lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; resolveInstanceMethod:sel];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; secondMessage(&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;, SEL _cmd) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;do method : %@&quot;&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;NSStringFromSelector&lt;/span&gt;(_cmd));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//打印的结果&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;RuntimeDemo[&lt;span class=&quot;number&quot;&gt;14426&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;1422075&lt;/span&gt;] &lt;span class=&quot;keyword&quot;&gt;do&lt;/span&gt; method : finishMessage&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;从打印的结果来看：我们通过动态加载的方式实现预先方法的调用。但是在打印中 &lt;code&gt;SEL&lt;/code&gt; 还是原来的选择子，后面会讲解。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;从上面的解决方式实现来看，严格意义上来说动态解析不是消息的转发。因为在指向过程中消息的接受的对象还是 &lt;code&gt;receiver&lt;/code&gt;， 只是把指向 &lt;code&gt;message&lt;/code&gt; 的 &lt;code&gt;IMP&lt;/code&gt; 的指针加入到 &lt;code&gt;receiver&lt;/code&gt; 的方法列表。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&quot;快速转发&quot;&gt;&lt;a href=&quot;#快速转发&quot; class=&quot;headerlink&quot; title=&quot;快速转发&quot;&gt;&lt;/a&gt;快速转发&lt;/h4&gt;&lt;p&gt;快速转发相当于我们在请求网页是重新定向。&lt;code&gt;receiver&lt;/code&gt; 对象和其继承父类没有找到相应的实现方法，而把实现的转向其他的对象。&lt;/p&gt;
&lt;p&gt;快速转发实现代码如下：&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//重定向的实现类&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@interface&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;FarwardTarget&lt;/span&gt; : &lt;span class=&quot;title&quot;&gt;NSObject&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)finishMessage;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@end&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@implementation&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;FarwardTarget&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)finishMessage &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;do method : %@&quot;&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;NSStringFromSelector&lt;/span&gt;(_cmd));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@end&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//快速转发&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;)forwardingTargetForSelector:(SEL)aSelector &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;do method : %@&quot;&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;NSStringFromSelector&lt;/span&gt;(_cmd));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//    return [[FarwardTarget alloc] init];&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Class class = &lt;span class=&quot;built_in&quot;&gt;NSClassFromString&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;FarwardTarget&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSObject&lt;/span&gt; *object = class.new;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (sel_isEqual(aSelector, &lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(finishMessage))) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; object;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//打印结果&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//RuntimeDemo[15791:1601823] do method : forwardingTargetForSelector:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//RuntimeDemo[15791:1601823] do method : finishMessage&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;更具上面打印的结果：看出快速转发可以实现当前 &lt;code&gt;receiver&lt;/code&gt; 方法列表找不到相关的 &lt;code&gt;message&lt;/code&gt; 的 &lt;code&gt;IMP&lt;/code&gt;，可以通过制定其他的对象来进行实现。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&quot;慢速转发&quot;&gt;&lt;a href=&quot;#慢速转发&quot; class=&quot;headerlink&quot; title=&quot;慢速转发&quot;&gt;&lt;/a&gt;慢速转发&lt;/h4&gt;&lt;p&gt;慢速转发过程中使用两个对象：&lt;code&gt;NSMethodSignature&lt;/code&gt; 和 &lt;code&gt;NSInvocation&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;NSMethodSignature&lt;/code&gt;: 对象定义了方法的签名，签名中包含：方法的参数和返回值。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;NSInvocation&lt;/code&gt;: 保存了目标、选着子和参数等消息调用的必须的全部元素。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在转发过程中要是到到下面 &lt;code&gt;API&lt;/code&gt;:&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;NSMethodSignature&lt;/span&gt; *)methodSignatureForSelector:(SEL)aSelector;&lt;span class=&quot;comment&quot;&gt;//在协议中实现，返回相关的方法签名&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)forwardInvocation:(&lt;span class=&quot;built_in&quot;&gt;NSInvocation&lt;/span&gt; *)anInvocation;&lt;span class=&quot;comment&quot;&gt;//进行消息的委派&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)invokeWithTarget:(&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;)anObject;&lt;span class=&quot;comment&quot;&gt;//唤醒接受者的同名方法&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)doesNotRecognizeSelector:(SEL)aSelector;&lt;span class=&quot;comment&quot;&gt;//不能识别方法&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;下面先直接把慢速转发的代码列出来：&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//重定向的实现类&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@interface&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;FarwardTarget&lt;/span&gt; : &lt;span class=&quot;title&quot;&gt;NSObject&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)finishMessage;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@end&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@implementation&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;FarwardTarget&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)finishMessage &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;do method : %@&quot;&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;NSStringFromSelector&lt;/span&gt;(_cmd));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@end&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//慢速转发实现&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;NSMethodSignature&lt;/span&gt; *)methodSignatureForSelector:(SEL)aSelector &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (sel_isEqual(aSelector, &lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(finishMessage))) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;comment&quot;&gt;//创建新的方法签名&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSMethodSignature&lt;/span&gt; *methodSignature = [&lt;span class=&quot;built_in&quot;&gt;NSMethodSignature&lt;/span&gt; signatureWithObjCTypes:&lt;span class=&quot;string&quot;&gt;&quot;v@:&quot;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; methodSignature;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; [&lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; methodSignatureForSelector:aSelector];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)forwardInvocation:(&lt;span class=&quot;built_in&quot;&gt;NSInvocation&lt;/span&gt; *)anInvocation &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;do method : %@&quot;&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;NSStringFromSelector&lt;/span&gt;(_cmd));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    FarwardTarget *target = [[FarwardTarget alloc] init];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([target respondsToSelector:anInvocation.selector]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//唤醒接受者的同名方法&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [anInvocation invokeWithTarget:target];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; doesNotRecognizeSelector:anInvocation.selector];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//打印结果：&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//RuntimeDemo[16564:1706397] do method : forwardInvocation:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//RuntimeDemo[16564:1706397] do method : finishMessage&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;快速转发失败后，运行时系统先调用 &lt;code&gt;methodSignatureForSelector:&lt;/code&gt; 返回一个方法签名用于创建 &lt;code&gt;NSInvocation&lt;/code&gt; 对象，创建好后调用 &lt;code&gt;forwardInvocation:&lt;/code&gt; 方法，在改方法中 &lt;code&gt;NSInvocation&lt;/code&gt; 对象将调用 &lt;code&gt;invokeWithTarget:&lt;/code&gt; 方法唤醒新接受者中的同名方法。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;iOS-发送和转发小结&quot;&gt;&lt;a href=&quot;#iOS-发送和转发小结&quot; class=&quot;headerlink&quot; title=&quot;iOS 发送和转发小结&quot;&gt;&lt;/a&gt;iOS 发送和转发小结&lt;/h3&gt;&lt;p&gt;在消息发送和转发过程中没有发现实现 &lt;code&gt;message&lt;/code&gt; 的 &lt;code&gt;IMP&lt;/code&gt; 过程中三步骤中均可以实现相关的消息添加，也可以在三者中进行相关的方法替换。&lt;/p&gt;
&lt;p&gt;但是三者之间还是有各自的特点：&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;动态解析 : 适用于将原来的类中的方法替换掉或者延迟加载。&lt;/li&gt;
&lt;li&gt;快速转发 : 可以将消息处理转发给其他对象，使用范围更广，不只是限于原来的对象。&lt;/li&gt;
&lt;li&gt;慢速转发 : 跟快转发一样可以消息转发，但它能通过NSInvocation对象获取更多消息发送的信息，例如：target、selector、arguments和返回值等信息。&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;iOS-消息-runtime-层实现过程&quot;&gt;&lt;a href=&quot;#iOS-消息-runtime-层实现过程&quot; class=&quot;headerlink&quot; title=&quot;iOS 消息 runtime 层实现过程&quot;&gt;&lt;/a&gt;iOS 消息 runtime 层实现过程&lt;/h2&gt;&lt;p&gt;小编在 iOS 消息发送和转发根据 &lt;code&gt;NSObject&lt;/code&gt; 方面讲述 &lt;code&gt;[receiver message]&lt;/code&gt; 消息调用处理，但是在 &lt;code&gt;runtime&lt;/code&gt; 层在怎样情形呢？&lt;/p&gt;
&lt;p&gt;&lt;code&gt;[receiver message]&lt;/code&gt; 这句的含义是：向 &lt;code&gt;receiver&lt;/code&gt; 发送名为 &lt;code&gt;message&lt;/code&gt; 的消息。&lt;/p&gt;
&lt;p&gt;打开&lt;a href=&quot;https://developer.apple.com/library/mac/documentation/Cocoa/Reference/ObjCRuntimeRef/Reference/reference.html#//apple_ref/c/func/objc_msgSend&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;开发文档&lt;/a&gt;(在 &lt;code&gt;objc/message.h&lt;/code&gt; 中)&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[receiver message];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;是下面的表示方式：&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//objc_msgSend(self, Selector);//基本表示方法&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;objc_msgSend(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;, message);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;其中 &lt;code&gt;objc_msgSend&lt;/code&gt; 的真正实现代码如下：&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;objc_msgSend(&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; _Nullable &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;, SEL _Nonnull op, ...);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;小编下面简单的介绍下 &lt;code&gt;objc_msgSend&lt;/code&gt; 中的参数和如何使用 &lt;code&gt;runtime&lt;/code&gt; 实现方法替换。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;id&quot;&gt;&lt;a href=&quot;#id&quot; class=&quot;headerlink&quot; title=&quot;id&quot;&gt;&lt;/a&gt;id&lt;/h3&gt;&lt;p&gt;上面在 &lt;code&gt;objc_msgSend&lt;/code&gt; 中的第一参数 &lt;code&gt;id&lt;/code&gt;。 小编认为对于 &lt;code&gt;id&lt;/code&gt; 用该不会陌生，&lt;code&gt;id&lt;/code&gt; 是指向类实例一个指针。&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;typedef&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; objc_object *&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;``` &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;`Objc_object` 会是什么样类型呢？ [文档](https:&lt;span class=&quot;comment&quot;&gt;//opensource.apple.com/source/objc4/objc4-709/runtime/objc-private.h.auto.html)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;```objc&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; objc_object &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;private:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    isa_t isa;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;public:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// ISA() assumes this is NOT a tagged pointer object&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Class ISA();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// getIsa() allows this to be a tagged pointer object&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Class getIsa();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//省略 ...&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;Objc_object&lt;/code&gt;中包含一个 &lt;code&gt;isa&lt;/code&gt; 的指针， &lt;code&gt;isa&lt;/code&gt; 是 &lt;code&gt;isa_t&lt;/code&gt; 的联合体。根据 &lt;code&gt;isa&lt;/code&gt; 指针可以获取对象所属的类。&lt;/p&gt;
&lt;h3 id=&quot;SEL&quot;&gt;&lt;a href=&quot;#SEL&quot; class=&quot;headerlink&quot; title=&quot;SEL&quot;&gt;&lt;/a&gt;SEL&lt;/h3&gt;&lt;p&gt;&lt;code&gt;objc_msgSend&lt;/code&gt; 中的第二个参数 &lt;code&gt;SEL&lt;/code&gt;，在 &lt;code&gt;Objc&lt;/code&gt; 中变现为 &lt;code&gt;selector&lt;/code&gt;。&lt;code&gt;selector&lt;/code&gt;是方法的选择器，可以视作系统用来区分方法的 &lt;code&gt;ID&lt;/code&gt;，而此 &lt;code&gt;ID&lt;/code&gt; 的类型为 &lt;code&gt;SEL&lt;/code&gt;结构。&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;typedef&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; objc_selector *SEL;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;最本质的就是 &lt;code&gt;SEL&lt;/code&gt; 就是映射方法的字符串，小编记得可以在 &lt;code&gt;objc&lt;/code&gt; 中 &lt;code&gt;@selector()&lt;/code&gt; 和 &lt;code&gt;runtime&lt;/code&gt; 中的 &lt;code&gt;objc_registerName&lt;/code&gt; 来获取方法选着器。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;注：在不同类中方法名相同的 &lt;code&gt;SEL&lt;/code&gt; 相同，在同一个类中的方法名相同参数不同的 &lt;code&gt;SEL&lt;/code&gt; 相同。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;动态实现方法替换&quot;&gt;&lt;a href=&quot;#动态实现方法替换&quot; class=&quot;headerlink&quot; title=&quot;动态实现方法替换&quot;&gt;&lt;/a&gt;动态实现方法替换&lt;/h3&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)swapMethods &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//获取要替换的方法&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Method oldMethod = class_getInstanceMethod([&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; class], &lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(finishMessage));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!oldMethod) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;NO&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//获取用来替换的方法&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Method newMethod = class_getInstanceMethod([&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; class], &lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(secondMessage));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!newMethod) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;NO&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//把两者方法进行替换&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    method_exchangeImplementations(oldMethod, newMethod);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;上面是使用 &lt;code&gt;runtime&lt;/code&gt; 的形式用新的方法替换掉原来的方法，其中使用到的知识会在 &lt;code&gt;runtime&lt;/code&gt; 详解中解析讲解。&lt;/p&gt;
&lt;h2 id=&quot;提出替换方案&quot;&gt;&lt;a href=&quot;#提出替换方案&quot; class=&quot;headerlink&quot; title=&quot;提出替换方案&quot;&gt;&lt;/a&gt;提出替换方案&lt;/h2&gt;&lt;p&gt;在替换方法方案中，目前有 4 种：    &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;在消息动态解析中替换方式 ：动态解析替换的基础是没有找到实现文件，需要对实现进行屏蔽&lt;/li&gt;
&lt;li&gt;使用 &lt;code&gt;runtime&lt;/code&gt; 实现动态加载替换方式 ：需要修改原来方法的名字或者修改参数&lt;/li&gt;
&lt;li&gt;使用子类继承的方式 ：不需要修改任何信息，但是如果在有子类情况下改动比较麻烦&lt;/li&gt;
&lt;li&gt;使用 &lt;code&gt;Category&lt;/code&gt; 方式 ：不需要改动名字和参数，但是会引入新的文件数目&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;小结&quot;&gt;&lt;a href=&quot;#小结&quot; class=&quot;headerlink&quot; title=&quot;小结&quot;&gt;&lt;/a&gt;小结&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;在替换方法过程中要根据具体的情景来进行选择合适的替换方式。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;参考资料：&lt;br&gt;&lt;a href=&quot;https://mikeash.com/pyblog/friday-qa-2009-03-27-objective-c-message-forwarding.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Message forwarding&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://www.mikeash.com/pyblog/friday-qa-2009-03-20-objective-c-messaging.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Objective-c-messaging&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://www.mulle-kybernetik.com/artikel/Optimization/opti-9.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;The faster objc_msgSend&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://cocoasamurai.blogspot.com/2010/01/understanding-objective-c-runtime.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Understanding objective-c runtime&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://opensource.apple.com/source/objc4/objc4-709/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;objc4/objc4-709&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://opensource.apple.com/source/objc4/objc4-709/runtime/objc-private.h.auto.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;objc-private.h&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;总概&quot;&gt;&lt;a href=&quot;#总概&quot; class=&quot;headerlink&quot; title=&quot;总概&quot;&gt;&lt;/a&gt;总概&lt;/h2&gt;&lt;p&gt;在做公司项目过程中遇到一些需要进行替换原来方法情况。小编对 &lt;code&gt;Objc&lt;/code&gt; 在消息发送和转发过程整理，针对在消息发送和转发在 &lt;code&gt;runtime&lt;/code&gt; 层实现和提出的方法替换方案原理做出详细说明和记录。&lt;/p&gt;
&lt;p&gt;下面是小编本博文的写作思路：&lt;br&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1877765-a56ae4460c575f24.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;iOS 消息发送和转发过程流程图.png&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://yoursite.com/categories/iOS/"/>
    
    
      <category term="iOS" scheme="http://yoursite.com/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>iOS Catergory &amp; Extension(类目和类拓展)</title>
    <link href="http://yoursite.com/2017/01/25/iOS%20Categroy%20%20&%20Extension(%E7%B1%BB%E7%9B%AE%E5%92%8C%E7%B1%BB%E6%8B%93%E5%B1%95)/"/>
    <id>http://yoursite.com/2017/01/25/iOS Categroy  & Extension(类目和类拓展)/</id>
    <published>2017-01-25T09:42:32.000Z</published>
    <updated>2017-08-23T16:09:59.000Z</updated>
    
    <content type="html">&lt;p&gt;小编在做 iOS 开发过程中有时会遇到想要对现有的类添加新的方法，或者是覆盖替换原来方法情况。也在有的情况我们在类实现过程中想要隐藏一些方法和属性情况。&lt;br&gt;所以就对实现一些注意做下整理：&lt;/p&gt;
&lt;p&gt;Category : 运行期决议&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;可以把类实现分在不同类中实现。这样做有几个优点：1）可以减少单个类的体积 2）可以把不同的功能放在不同的 &lt;code&gt;Category&lt;/code&gt; 进行实现 3）可以多人同时开发一个类 4）可以更具具体的需要实现 &lt;code&gt;Category&lt;/code&gt; 加载等&lt;/li&gt;
&lt;li&gt;可以添加私有方法&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Extension : 编译器决议&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;可以添加不想要暴露的类私有方法&lt;/li&gt;
&lt;li&gt;可以添加类属性和类实例变量&lt;/li&gt;
&lt;/ul&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;Category-和-Extension-对比&quot;&gt;&lt;a href=&quot;#Category-和-Extension-对比&quot; class=&quot;headerlink&quot; title=&quot;Category 和 Extension 对比&quot;&gt;&lt;/a&gt;Category 和 Extension 对比&lt;/h2&gt;&lt;h3 id=&quot;Category-和-Extension-区别&quot;&gt;&lt;a href=&quot;#Category-和-Extension-区别&quot; class=&quot;headerlink&quot; title=&quot;Category 和 Extension 区别&quot;&gt;&lt;/a&gt;&lt;code&gt;Category&lt;/code&gt; 和 &lt;code&gt;Extension&lt;/code&gt; 区别&lt;/h3&gt;&lt;p&gt;Category(类目)和Extension(类拓展)有很大的区别。 &lt;/p&gt;
&lt;p&gt;&lt;code&gt;Category&lt;/code&gt; 在运行期决定，不能对其进行添加实例变量(因为在编译器已经决定当前内存结构，如果可以添加实例变量就会造成当前类布局改变)。但是可以对现有的类进行添加类目。&lt;code&gt;SDWebImage&lt;/code&gt; 中就有大量的使用。&lt;br&gt;&lt;code&gt;Extension&lt;/code&gt; 可以看作是没有名字的 &lt;code&gt;Category&lt;/code&gt;，但是两者还是由本质的区别。&lt;code&gt;Extension&lt;/code&gt; 是在编译器就已经决定的，而且和 &lt;code&gt;interface&lt;/code&gt; 、 &lt;code&gt;implement&lt;/code&gt; 共同组成类的一部分，三者同时在编译器决定并且一起消亡。所以对 &lt;code&gt;iOS&lt;/code&gt; 中已经存在的实现类不能进行添加 &lt;code&gt;Estension&lt;/code&gt; 的拓展。注：主要作用是隐藏类的一些相关信息。&lt;a href=&quot;https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/ProgrammingWithObjectiveC/CustomizingExistingClasses/CustomizingExistingClasses.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;参考&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;Category-和-Extension-具体实现&quot;&gt;&lt;a href=&quot;#Category-和-Extension-具体实现&quot; class=&quot;headerlink&quot; title=&quot;Category 和 Extension 具体实现&quot;&gt;&lt;/a&gt;&lt;code&gt;Category&lt;/code&gt; 和 &lt;code&gt;Extension&lt;/code&gt; 具体实现&lt;/h3&gt;&lt;p&gt;1）&lt;code&gt;Category&lt;/code&gt; 的实现&lt;/p&gt;
&lt;p&gt;下面是对 &lt;code&gt;NSString&lt;/code&gt; 添加类目，下面以 &lt;code&gt;NSString+Configuration&lt;/code&gt; 类目展示:&lt;/p&gt;
&lt;p&gt; &lt;code&gt;NSString+Configuration.h&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#import &lt;span class=&quot;meta-string&quot;&gt;&amp;lt;Foundation/Foundation.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@interface&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;NSString&lt;/span&gt; (&lt;span class=&quot;title&quot;&gt;Configuration&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;strong&lt;/span&gt; ,&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *name;&lt;span class=&quot;comment&quot;&gt;//添加属性&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)configuration;&lt;span class=&quot;comment&quot;&gt;//添加类方法&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)configurationWithName:(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)name;&lt;span class=&quot;comment&quot;&gt;//添加实例方法&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@end&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;NSString+Configuration.m&lt;/code&gt;实现文件&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#import &lt;span class=&quot;meta-string&quot;&gt;&quot;NSString+Configuration.h&quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@implementation&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;NSString&lt;/span&gt; (&lt;span class=&quot;title&quot;&gt;Configuration&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@dynamic&lt;/span&gt; name;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)configuration &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)configurationWithName:(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)name &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@end&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;2）&lt;code&gt;Extension&lt;/code&gt; 的具体实现，下面以 &lt;code&gt;Person&lt;/code&gt;类： &lt;/p&gt;
&lt;p&gt;&lt;code&gt;Person.h&lt;/code&gt; 文件&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#import &lt;span class=&quot;meta-string&quot;&gt;&amp;lt;Foundation/Foundation.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@interface&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Person&lt;/span&gt; : &lt;span class=&quot;title&quot;&gt;NSObject&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@end&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;Person.m&lt;/code&gt;文件&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@interface&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Person&lt;/span&gt; ()&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//在这里可以添加隐藏：实例变量、实例方法、属性和类方法&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@end&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@implementation&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Person&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@end&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;Category-真面目&quot;&gt;&lt;a href=&quot;#Category-真面目&quot; class=&quot;headerlink&quot; title=&quot;Category 真面目&quot;&gt;&lt;/a&gt;Category 真面目&lt;/h2&gt;&lt;p&gt;如果对 &lt;code&gt;runtime&lt;/code&gt; 有所了解，可以知道 OC 的很多是在 &lt;code&gt;struct&lt;/code&gt; 的基础上完成的。 &lt;code&gt;Category_t&lt;/code&gt; 在 &lt;code&gt;struct&lt;/code&gt; 的结构上如下(在&lt;a href=&quot;https://opensource.apple.com/source/objc4/objc4-709/runtime/objc-runtime-new.h.auto.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;&lt;code&gt;objc_runtime_new.h&lt;/code&gt;&lt;/a&gt;中)：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;struct category_t &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    const char *name;//Category 名字&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    classref_t cls;//类&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    struct method_list_t *instanceMethods;//实例方法&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    struct method_list_t *classMethods;//类方法&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    struct protocol_list_t *protocols;//协议&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    struct property_list_t *instanceProperties;//类属性&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    // Fields below this point are not always present on disk.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    struct property_list_t *_classProperties;//&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    method_list_t *methodsForMeta(bool isMeta) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        if (isMeta) return classMethods;//返回类方法&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        else return instanceMethods;//返回实例方法&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    property_list_t *propertiesForMeta(bool isMeta, struct header_info *hi);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;由上面可以看出：&lt;code&gt;Category&lt;/code&gt; 里面可以添加实例方法、类方法、协议和类属性。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;注释：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;在 &lt;code&gt;Category&lt;/code&gt; 中添加的方法会放在原来类方法的前面，在调用方法过程中会调用前面方法，就会形成被类被&lt;code&gt;覆盖&lt;/code&gt;的现象。原因是在调用类的过程中寻找调用方法是从上到下类进行查找的。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;调用-Category-覆盖的方法&quot;&gt;&lt;a href=&quot;#调用-Category-覆盖的方法&quot; class=&quot;headerlink&quot; title=&quot;调用 Category 覆盖的方法&quot;&gt;&lt;/a&gt;调用 &lt;code&gt;Category&lt;/code&gt; 覆盖的方法&lt;/h3&gt;&lt;p&gt;在 &lt;code&gt;Category&lt;/code&gt; 覆盖的方法，是在查找过程中由于调用前面的方法而造成相关方法的覆盖。我们可以在调用前把 &lt;code&gt;Category&lt;/code&gt; 的方法跳过。&lt;/p&gt;
&lt;p&gt;具体实现如下：&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Class currentClass = [Person class];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;MyClass *my = [[Person alloc] init];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (currentClass) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; methodCount;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Method *methodList = class_copyMethodList(currentClass, &amp;amp;methodCount);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    IMP lastImp = &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    SEL lastSel = &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; methodCount; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Method method = methodList[i];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *methodName = [&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; stringWithCString:sel_getName(method_getName(method)) &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                        encoding:&lt;span class=&quot;built_in&quot;&gt;NSUTF8StringEncoding&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([&lt;span class=&quot;string&quot;&gt;@&quot;printName&quot;&lt;/span&gt; isEqualToString:methodName]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            lastImp = method_getImplementation(method);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            lastSel = method_getName(method);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;typedef&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; (*fn)(&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;,SEL);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (lastImp != &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        fn f = (fn)lastImp;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        f(my,lastSel);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    free(methodList);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;Category-添加关联对象&quot;&gt;&lt;a href=&quot;#Category-添加关联对象&quot; class=&quot;headerlink&quot; title=&quot;Category 添加关联对象&quot;&gt;&lt;/a&gt;&lt;code&gt;Category&lt;/code&gt; 添加关联对象&lt;/h3&gt;&lt;p&gt;&lt;code&gt;Category&lt;/code&gt; 中不能添加类的变量。但我们通常需要添加关联对象的值，可以实现关联对象来进行实现。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Person+Habit.h&lt;/code&gt;文件：&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@interface&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Person&lt;/span&gt; (&lt;span class=&quot;title&quot;&gt;Habit&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;copy&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *dance;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@end&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;Person+Habit.m&lt;/code&gt;文件：&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#import &lt;span class=&quot;meta-string&quot;&gt;&quot;Person+Habit.h&quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#import &lt;span class=&quot;meta-string&quot;&gt;&amp;lt;objc/runtime.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@implementation&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Person&lt;/span&gt; (&lt;span class=&quot;title&quot;&gt;Habit&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)setDance:(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)dance &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    objc_setAssociatedObject(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;@&quot;dance&quot;&lt;/span&gt;, dance, OBJC_ASSOCIATION_COPY);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)dance &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *danceObject = objc_getAssociatedObject(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;@&quot;dance&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; danceObject;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@end&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;参考资料：&lt;br&gt;&lt;a href=&quot;https://opensource.apple.com/source/objc4/objc4-709/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;runtime&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://developer.apple.com/library/content/documentation/General/Conceptual/DevPedia-CocoaCore/Category.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Category&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/ProgrammingWithObjectiveC/CustomizingExistingClasses/CustomizingExistingClasses.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Customizing Existing Classes&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://tech.meituan.com/DiveIntoCategory.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;深入理解Objective-C&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://www.cocoachina.com/ios/20161018/17784.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;深入浅出理解分类(category）和类扩展(extension)&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;小编在做 iOS 开发过程中有时会遇到想要对现有的类添加新的方法，或者是覆盖替换原来方法情况。也在有的情况我们在类实现过程中想要隐藏一些方法和属性情况。&lt;br&gt;所以就对实现一些注意做下整理：&lt;/p&gt;
&lt;p&gt;Category : 运行期决议&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;可以把类实现分在不同类中实现。这样做有几个优点：1）可以减少单个类的体积 2）可以把不同的功能放在不同的 &lt;code&gt;Category&lt;/code&gt; 进行实现 3）可以多人同时开发一个类 4）可以更具具体的需要实现 &lt;code&gt;Category&lt;/code&gt; 加载等&lt;/li&gt;
&lt;li&gt;可以添加私有方法&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Extension : 编译器决议&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;可以添加不想要暴露的类私有方法&lt;/li&gt;
&lt;li&gt;可以添加类属性和类实例变量&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://yoursite.com/categories/iOS/"/>
    
    
      <category term="iOS" scheme="http://yoursite.com/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>iOS Deep Copy &amp; Shallow Copy(深层和浅层复制)</title>
    <link href="http://yoursite.com/2017/01/20/iOS%20%E5%A4%8D%E5%88%B6%E7%90%86%E8%A7%A3/"/>
    <id>http://yoursite.com/2017/01/20/iOS 复制理解/</id>
    <published>2017-01-20T09:42:32.000Z</published>
    <updated>2017-08-23T16:10:06.000Z</updated>
    
    <content type="html">&lt;p&gt;总概：在复制过程中有浅层 Copy和深层 Copy。从字面意思上理解：浅层 Copy 是仅仅复制指向内存对象，深层 Copy 是复制对象和对象指向的内存。&lt;/p&gt;
&lt;p&gt;下面展示浅层 Copy 和 深层 Copy 展示：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1877765-66733ce3e4c7d54d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;iOS 深层复制和浅层复制.png&quot;&gt;&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;blockquote&gt;
&lt;p&gt;简言之：浅层 Copy 只复制对象内存地址不变，深层 Copy 既复制对象又复制指向的内存 &amp;amp; 内存地址发生改变。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;更具复制的对象不同可以分为两种情况：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;集合类对象复制&lt;/li&gt;
&lt;li&gt;非集合类对象&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;集合类复制&quot;&gt;&lt;a href=&quot;#集合类复制&quot; class=&quot;headerlink&quot; title=&quot;集合类复制&quot;&gt;&lt;/a&gt;集合类复制&lt;/h2&gt;&lt;h3 id=&quot;集合类的浅复制-Shallow-Copy&quot;&gt;&lt;a href=&quot;#集合类的浅复制-Shallow-Copy&quot; class=&quot;headerlink&quot; title=&quot;集合类的浅复制(Shallow Copy)&quot;&gt;&lt;/a&gt;集合类的浅复制(Shallow Copy)&lt;/h3&gt;&lt;p&gt;集合类在浅层复制即时 retain 计数进行 + 1，而且指向内存对象复制添加到新的集合之中。&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSArray&lt;/span&gt; *person = [&lt;span class=&quot;built_in&quot;&gt;NSArray&lt;/span&gt; arrayWithObjects:&lt;span class=&quot;string&quot;&gt;@&quot;name&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;@&quot;age&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;@&quot;school&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;@&quot;company&quot;&lt;/span&gt;, &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSArray&lt;/span&gt; *personShallowCopy = [person copyWithZone:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;person : %p, personCopy : %p&quot;&lt;/span&gt;, person, personShallowCopy);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//打印的结果：&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//DeepShallowCopyDemo[31046:7675704] person : 0x604000443d20, personCopy : 0x604000443d20&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;集合类的深复制-Deep-Copy&quot;&gt;&lt;a href=&quot;#集合类的深复制-Deep-Copy&quot; class=&quot;headerlink&quot; title=&quot;集合类的深复制(Deep Copy)&quot;&gt;&lt;/a&gt;集合类的深复制(Deep Copy)&lt;/h3&gt;&lt;p&gt;集合类深层复制有两种方法可以实现：&lt;/p&gt;
&lt;p&gt;1）使用 iOS 提供的 API 的接口&lt;/p&gt;
&lt;p&gt;2）使用归档(archive)和解档(unarchive)形式进行&lt;/p&gt;
&lt;p&gt;3) 使用系统的 &lt;code&gt;Copy&lt;/code&gt; 和 &lt;code&gt;MutableCopy&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;iOS-给定-API&quot;&gt;&lt;a href=&quot;#iOS-给定-API&quot; class=&quot;headerlink&quot; title=&quot;iOS 给定 API&quot;&gt;&lt;/a&gt;iOS 给定 API&lt;/h4&gt;&lt;p&gt;集合类的深层复制，只需要把 &lt;code&gt;initWithArray:copyItems:&lt;/code&gt; 的函数值设置为 &lt;code&gt;YES&lt;/code&gt; 就可以实现当前集合类实现深层复制。&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSArray&lt;/span&gt; *person = [&lt;span class=&quot;built_in&quot;&gt;NSArray&lt;/span&gt; arrayWithObjects:&lt;span class=&quot;string&quot;&gt;@&quot;name&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;@&quot;age&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;@&quot;school&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;@&quot;company&quot;&lt;/span&gt;, &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSArray&lt;/span&gt; *personDeepCopy = [[&lt;span class=&quot;built_in&quot;&gt;NSArray&lt;/span&gt; alloc] initWithArray:person copyItems:&lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;person : %p, personCopy : %p&quot;&lt;/span&gt;, person, personDeepCopy);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//打印的结果：&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//DeepShallowCopyDemo[31046:7675704] person : 0x604000443d20, personCopy : 0x604000444080&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;归档-archive-和解档-unarchive&quot;&gt;&lt;a href=&quot;#归档-archive-和解档-unarchive&quot; class=&quot;headerlink&quot; title=&quot;归档(archive)和解档(unarchive)&quot;&gt;&lt;/a&gt;归档(archive)和解档(unarchive)&lt;/h4&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSArray&lt;/span&gt; *person = [&lt;span class=&quot;built_in&quot;&gt;NSArray&lt;/span&gt; arrayWithObjects:&lt;span class=&quot;string&quot;&gt;@&quot;name&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;@&quot;age&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;@&quot;school&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;@&quot;company&quot;&lt;/span&gt;, &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSArray&lt;/span&gt; *persionArchiveCopy = [&lt;span class=&quot;built_in&quot;&gt;NSKeyedUnarchiver&lt;/span&gt; unarchiveObjectWithData:[&lt;span class=&quot;built_in&quot;&gt;NSKeyedArchiver&lt;/span&gt; archivedDataWithRootObject:person]];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;person : %p, personCopy : %p&quot;&lt;/span&gt;, person, persionArchiveCopy);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//打印的结果：&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//DeepShallowCopyDemo[31900:7726351] person : 0x6000004529f0, personCopy : 0x604000255a50&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;注意：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;（1）在集合类的深层复制过程中，需要满足一个前提条件：当前集合类需要实现 &lt;code&gt;NSCoping&lt;/code&gt; 或者 &lt;code&gt;NSMutableCopying&lt;/code&gt; 协议。否则会抛出异常。&lt;br&gt;（2）在使用 iOS 提供的 API 中完成的 &lt;code&gt;Copy&lt;/code&gt; 是 &lt;code&gt;one-level-deep copy&lt;/code&gt;，使用 &lt;code&gt;归档(archive)和解档(unarchive)&lt;/code&gt; 完成是真正的深层 &lt;code&gt;Copy&lt;/code&gt;。&lt;a href=&quot;https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/Collections/Articles/Copying.html#//apple_ref/doc/uid/TP40010162-SW3&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;苹果开发文档&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&quot;使用系统的-Copy-和-MutableCopy&quot;&gt;&lt;a href=&quot;#使用系统的-Copy-和-MutableCopy&quot; class=&quot;headerlink&quot; title=&quot;使用系统的 Copy 和 MutableCopy&quot;&gt;&lt;/a&gt;使用系统的 &lt;code&gt;Copy&lt;/code&gt; 和 &lt;code&gt;MutableCopy&lt;/code&gt;&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;不可变对象的复制&lt;/li&gt;
&lt;li&gt;可变对象的复制&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;1)不可变对象的复制&lt;/p&gt;
&lt;p&gt;下面👇代码实现不可变对象：&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSArray&lt;/span&gt; *personCopy = [person &lt;span class=&quot;keyword&quot;&gt;copy&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSMutableArray&lt;/span&gt; *personMutableCopy = [person mutableCopy];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;person:%p, personCopy:%p, personMutableCopy:%p&quot;&lt;/span&gt;, person, personCopy, personMutableCopy);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//打印的结果:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//DeepShallowCopyDemo[33871:7842173] person:0x60000025a760, personCopy:0x60000025a760, personMutableCopy:0x60000025ab80&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;2)可变对象复制&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSMutableArray&lt;/span&gt; *family = [&lt;span class=&quot;built_in&quot;&gt;NSMutableArray&lt;/span&gt; arrayWithObjects:&lt;span class=&quot;string&quot;&gt;@&quot;father&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;@&quot;mother&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;@&quot;sister&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;@&quot;brother&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;@&quot;son&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;@&quot;daughter&quot;&lt;/span&gt;, &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSArray&lt;/span&gt; *familyCopy = [family &lt;span class=&quot;keyword&quot;&gt;copy&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSMutableArray&lt;/span&gt; *familyMutableCopy = [family mutableCopy];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;family:%p, familyCopy:%p, familyMutableCopy:%p&quot;&lt;/span&gt;, family, familyCopy, familyMutableCopy);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//打印的结果:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//DeepShallowCopyDemo[33871:7842173] family:0x60000025a9d0, familyCopy:0x60000025aca0, familyMutableCopy:0x60000025abe0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;根据上面：&lt;br&gt;(1)不可变 copy 浅复制&lt;br&gt;(2)可变 copy 单层深复制&lt;br&gt;(3)不可变 mutableCopy 单层深复制&lt;br&gt;(4)可变 mutableCopy 单层深复制 &lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;非集合类复制&quot;&gt;&lt;a href=&quot;#非集合类复制&quot; class=&quot;headerlink&quot; title=&quot;非集合类复制&quot;&gt;&lt;/a&gt;非集合类复制&lt;/h2&gt;&lt;p&gt;在非集合类实现复制通常使用系统提供的方法：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;不可变对象的复制&lt;/li&gt;
&lt;li&gt;可变对象的复制&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;不可变对象复制&quot;&gt;&lt;a href=&quot;#不可变对象复制&quot; class=&quot;headerlink&quot; title=&quot;不可变对象复制&quot;&gt;&lt;/a&gt;不可变对象复制&lt;/h3&gt;&lt;p&gt;下面👇代码实现不可变对象：&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *nameCopy = [name &lt;span class=&quot;keyword&quot;&gt;copy&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSMutableString&lt;/span&gt; *nameMutableCopy = [name mutableCopy];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;name:%p, nameCopy:%p, nameMutableCopy:%p&quot;&lt;/span&gt;, name, nameCopy, nameMutableCopy);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//打印的结果:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//DeepShallowCopyDemo[32820:7780776] name:0x107356108, nameCopy:0x107356108, nameMutableCopy:0x604000247620&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;可变对象复制&quot;&gt;&lt;a href=&quot;#可变对象复制&quot; class=&quot;headerlink&quot; title=&quot;可变对象复制&quot;&gt;&lt;/a&gt;可变对象复制&lt;/h3&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSMutableString&lt;/span&gt; *mutableName = [&lt;span class=&quot;built_in&quot;&gt;NSMutableString&lt;/span&gt; stringWithString:&lt;span class=&quot;string&quot;&gt;@&quot;Jack Jin&quot;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *mutableNameCopy = [mutableName &lt;span class=&quot;keyword&quot;&gt;copy&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSMutableString&lt;/span&gt; *mutableNameMutableCopy = [mutableName mutableCopy];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[mutableNameCopy stringByAppendingString:&lt;span class=&quot;string&quot;&gt;@&quot;Bai&quot;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[mutableNameMutableCopy appendString:&lt;span class=&quot;string&quot;&gt;@&quot;Bai&quot;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;mutableName:%p, mutableNameCopy:%p, mutableNameMutableCopy:%p&quot;&lt;/span&gt;, mutableName, mutableNameCopy, mutableNameMutableCopy);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//打印的结果：&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//DeepShallowCopyDemo[33102:7797073] mutableName:0x600000445dc0, mutableNameCopy:0xa00ec83923fb04b8, mutableNameMutableCopy:0x600000445fa0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;根据上面：&lt;br&gt;(1)不可变 copy 浅复制&lt;br&gt;(2)可变 copy 深复制&lt;br&gt;(3)不可变 mutableCopy 深复制&lt;br&gt;(4)可变 mutableCopy 深复制&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;p&gt;参考资料：&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/Collections/Articles/Copying.html#//apple_ref/doc/uid/TP40010162-SW3&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Copying Collections&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://www.jianshu.com/p/f84803356cbb&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;NSCopying和NSMutableCopying协议&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Object_copying&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Object copying&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://stackoverflow.com/questions/184710/what-is-the-difference-between-a-deep-copy-and-a-shallow-copy&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;What is the difference between a deep copy and a shallow copy?
&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;总概：在复制过程中有浅层 Copy和深层 Copy。从字面意思上理解：浅层 Copy 是仅仅复制指向内存对象，深层 Copy 是复制对象和对象指向的内存。&lt;/p&gt;
&lt;p&gt;下面展示浅层 Copy 和 深层 Copy 展示：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1877765-66733ce3e4c7d54d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;iOS 深层复制和浅层复制.png&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://yoursite.com/categories/iOS/"/>
    
    
      <category term="iOS" scheme="http://yoursite.com/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>iOS 控件在屏幕上显示</title>
    <link href="http://yoursite.com/2017/01/13/APP%E6%8E%A7%E4%BB%B6%E5%9C%A8%E5%B1%8F%E5%B9%95%E4%B8%8A%E6%98%BE%E7%A4%BA/"/>
    <id>http://yoursite.com/2017/01/13/APP控件在屏幕上显示/</id>
    <published>2017-01-13T13:57:36.000Z</published>
    <updated>2017-08-25T17:21:55.000Z</updated>
    
    <content type="html">&lt;p&gt;在每个 APP 中如果想要实现界面的精美，多数情况下我们需要对相关控件进行分装，采用CocoaPods进行插件化管理。&lt;br&gt;但是我们在程序里的空间是怎么显示在屏幕上的，下面将初略的讲述屏幕上显示控件的过程。&lt;/p&gt;
&lt;p&gt;使用 Xmind 来展示博客讲述 APP 控件在屏幕上显示的思路和相关知识点的整理思路，具体思路看下图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1877765-420d6100d6bc6ea1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;iOS 控件在屏幕上显示思维导图.png&quot;&gt;&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;屏幕显示图像的原理&quot;&gt;&lt;a href=&quot;#屏幕显示图像的原理&quot; class=&quot;headerlink&quot; title=&quot;屏幕显示图像的原理&quot;&gt;&lt;/a&gt;屏幕显示图像的原理&lt;/h2&gt;&lt;p&gt;记得第一台电视机是最老式的黑白电视机，上面具备天线、需要手动转动旋转调台那种，目前这种电视📺很少出现额。&lt;br&gt;上面那种老式的电视机画面的显示就是采用 CRT 显示，显示的原理如下图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1877765-94ee3d3de417be2c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;CRT.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;其原理：CRT 按照上面图片展示的那样，从上到下进行逐行扫描，当扫描完成就会显示一整张图像，随后电子枪回到原来的位置从头开始进行图像素材的扫描。具体的过程当显示器扫完一行换到新的一行，显示器就会发出一个水平信号：&lt;strong&gt;HSync&lt;/strong&gt;，当显示器扫完整张的图片后电子进行复位，开始下一次的重新扫描，显示器也会发出一个新的垂直信号：&lt;strong&gt;VSync&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;我们 APP 在屏幕上的刷新的频率就是 VSync 信号产生的频率，所以我们在解决界面卡顿的过程就要根据 VSync 的基础上进行相关的完善和优化&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;👈&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;目前我们一般是采取双缓冲的机制， GPU会预先缓冲好一帧存放在缓冲中，让视频控制器读取，当下一阵渲染好，就直接把视频控制器的指针指向第二个缓冲器 ： 这样做的好处就是可以大大提高缓冲的效率问题&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;👉🏿&lt;/p&gt;
&lt;p&gt;采用双缓存可能会引入一个问题就是屏幕内容显示一半， GPU 将新的内容提交到缓存区对其进行交换，视频控制器把新的下半段的显示在屏幕上&lt;br&gt;可能形成画面撕裂，&lt;br&gt;解决方式：GPU 引入垂直同步（V-Sync）当开启垂直同步后， GPU会等待 VSync 信号发出，才会对缓存的内容进行更新，这样就可以是画面更加流畅，减少延迟&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;iOS 设备采用双缓存 + 垂直同步； Android采用的三缓存 + 垂直同步&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;在一些游戏中我们经常会见到一些场景如下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1877765-57d7c6a78203fe32.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;屏幕错位.png&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;CPU和GPU的工作原理&quot;&gt;&lt;a href=&quot;#CPU和GPU的工作原理&quot; class=&quot;headerlink&quot; title=&quot;CPU和GPU的工作原理&quot;&gt;&lt;/a&gt;CPU和GPU的工作原理&lt;/h2&gt;&lt;h3 id=&quot;CPU工作原理&quot;&gt;&lt;a href=&quot;#CPU工作原理&quot; class=&quot;headerlink&quot; title=&quot;CPU工作原理&quot;&gt;&lt;/a&gt;CPU工作原理&lt;/h3&gt;&lt;p&gt;CPU（中央处理器，Central Processing Unit）主要是解释计算机中的指令，处理计算机软件中的数据。CPU、内部存储器和输入/输出设备是计算机的三大核心组件。&lt;/p&gt;
&lt;p&gt;CPU目前很大一部分是采用 冯·诺依曼结构，在工作的过程之中其过程一般可以分为四个阶段：提取、解码、执行和调回&lt;/p&gt;
&lt;p&gt;提取：&lt;br&gt;解码：&lt;br&gt;执行：&lt;br&gt;调回：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1877765-080f3f114f51b563.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;CPU.png&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;GPU工作原理&quot;&gt;&lt;a href=&quot;#GPU工作原理&quot; class=&quot;headerlink&quot; title=&quot;GPU工作原理&quot;&gt;&lt;/a&gt;GPU工作原理&lt;/h3&gt;&lt;p&gt;GPU（图形处理器，Graphics Processing Unit）主要是进行绘图运算的微处理器，对图像进行处理和相关显示绘制工作&lt;br&gt;后面随着 OpenGL APL 和 DirectX 功能的出现，图形处理器可以增加可编程着色的能力，目前我们处理在屏幕上显示的任何像素，也可以在纹理在屏幕上显示前和每一个几何顶点在投射到屏幕前都可以进行相关的处理工作&lt;/p&gt;
&lt;h2 id=&quot;iOS-绘制像素在屏幕上&quot;&gt;&lt;a href=&quot;#iOS-绘制像素在屏幕上&quot; class=&quot;headerlink&quot; title=&quot;iOS 绘制像素在屏幕上&quot;&gt;&lt;/a&gt;iOS 绘制像素在屏幕上&lt;/h2&gt;&lt;h3 id=&quot;APP绘制像素过程分析&quot;&gt;&lt;a href=&quot;#APP绘制像素过程分析&quot; class=&quot;headerlink&quot; title=&quot;APP绘制像素过程分析&quot;&gt;&lt;/a&gt;APP绘制像素过程分析&lt;/h3&gt;&lt;p&gt;下面绘制像素在屏幕上的原理图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1877765-de4eaec88c23be92.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;GPU显示.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;iOS 界面上的内容大多是通过 Core Animation 来完成绘制&lt;br&gt;在 Mac OS 大多是绕过 Core Animation 使用 Core Graphics 来进行绘制&lt;br&gt;手游行业中直接使用 OpenGL/OpenGL ES 来进行相关材质的内容绘制&lt;/p&gt;
&lt;p&gt;Core Animation 大多使用 Core Graphics 来进行内容的渲染&lt;/p&gt;
&lt;p&gt;GPU Driver 是直接和 GPU 进行相关交互的代码块，可以对对 GPU 直接操作&lt;/p&gt;
&lt;p&gt;GPU 是专门为图形高并发计算量身定制的处理单元，优点：短时间可以实现图像浮点运算，耗电少，高效&lt;/p&gt;
&lt;h3 id=&quot;APP绘制像素硬件分析&quot;&gt;&lt;a href=&quot;#APP绘制像素硬件分析&quot; class=&quot;headerlink&quot; title=&quot;APP绘制像素硬件分析&quot;&gt;&lt;/a&gt;APP绘制像素硬件分析&lt;/h3&gt;&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1877765-618b4dfde6e991a7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;GPU缓存.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;在图片显示的过程中，我们需要相关的 GPU 对图片生成 frame 的纹理，&lt;br&gt;我们在生成纹理的过程中会使用 VRAM 的空间，所以在生成过程是有限制的&lt;br&gt;把相关的数据从 CPU 上传输到 GPU 上 ——&amp;gt; 既是把内容从 RAM 上传到 VRAM 上， 如果上传的纹理太大就会对性能有所影响&lt;/p&gt;
&lt;p&gt;在文本显示的过程中，我们使用 GPU 进行文本的绘制比较复杂，这会促使 Core Text 和 Core Graphics 来合成生成一个文本，然后上传到 GPU。&lt;br&gt;但我们在界面滑动过程中， CPU 只需要把相关的文本坐标发送到 GPU 就行， GPU会根据相关的信息进行绘制&lt;/p&gt;
&lt;h2 id=&quot;APP绘制过程方式和细节讲解&quot;&gt;&lt;a href=&quot;#APP绘制过程方式和细节讲解&quot; class=&quot;headerlink&quot; title=&quot;APP绘制过程方式和细节讲解&quot;&gt;&lt;/a&gt;APP绘制过程方式和细节讲解&lt;/h2&gt;&lt;h3 id=&quot;合成：&quot;&gt;&lt;a href=&quot;#合成：&quot; class=&quot;headerlink&quot; title=&quot;合成：&quot;&gt;&lt;/a&gt;合成：&lt;/h3&gt;&lt;p&gt;在我们看到的所有的视图都是基于不同图片进行相关的合成而来&lt;br&gt;这里我么准守一切的图像皆纹理的概念，当把第二个纹理遮在第一个纹理上时， GPU 就会把第二个纹理合成到第一个纹理中&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;合成方法很多种：&lt;/li&gt;
&lt;li&gt;如果两个纹理对其时：采用公式    ——&amp;gt;    R(最终显示的色彩的值) = S(上层纹理的相关的参数) +D(下层纹理相关参数) * (1 - Sa(上层纹理的透明度))&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;透明-VS-不透明：&quot;&gt;&lt;a href=&quot;#透明-VS-不透明：&quot; class=&quot;headerlink&quot; title=&quot;透明 VS 不透明：&quot;&gt;&lt;/a&gt;透明 VS 不透明：&lt;/h3&gt;&lt;p&gt;当纹理完全不透明时目标像素就是纹理的值， GPU 就只会从目标像素直接取出纹理显示 不会做相关的操作&lt;br&gt;在加载一张没有  alpha 的图片进行显示，会被默认为 opaque 的属性是 YES ； 加载一张图片 alpha = 100%， Core Animation 会认为是不为 100% 对其进行解析&lt;/p&gt;
&lt;h3 id=&quot;像素对其-VS-不重合在一起：&quot;&gt;&lt;a href=&quot;#像素对其-VS-不重合在一起：&quot; class=&quot;headerlink&quot; title=&quot;像素对其 VS 不重合在一起：&quot;&gt;&lt;/a&gt;像素对其 VS 不重合在一起：&lt;/h3&gt;&lt;p&gt;当两个 layer 完全重合在一起，这时就需要我们对其进行相关的计算&lt;br&gt;layer 上所有的像素和屏幕上的像素完全对其，这就是 layer 像素对其； &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;像素对不齐主要原因：&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;缩放，在图像进行缩方时，layer 和屏幕的像素很难对其&lt;/li&gt;
&lt;li&gt;纹理的起点在在一个像素的边界 &lt;/li&gt;
&lt;li&gt;在像素不对其的情况下可能会要经过过多的运算， 在 Core Animation 和 模拟器中 color misaligned images 的选项可以进行相关的调节&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;离屏渲染：&quot;&gt;&lt;a href=&quot;#离屏渲染：&quot; class=&quot;headerlink&quot; title=&quot;离屏渲染：&quot;&gt;&lt;/a&gt;离屏渲染：&lt;/h3&gt;&lt;p&gt;离屏渲染会  合并/渲染 图层树一部分到一个新的缓存区，然后该缓冲区被渲染到屏幕上&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;离屏渲染也可能产生副作用。如果你正在直接或者间接的将mask应用到一个图层上，Core Animation 为了应用这个 mask，会强制进行屏幕外渲染。这会对 GPU 产生重负。通常情况下 mask 只能被直接渲染到帧的缓冲区中(在屏幕内)&lt;/li&gt;
&lt;li&gt;Instrument 的 Core Animation 工具有一个叫做 Color Offscreen-Rendered Yellow 的选项，它会将已经被渲染到屏幕外缓冲区的区域标注为黄色(这个选项在模拟器中也可以用)。同时记得检查 Color Hits Green and Misses Red 选项。绿色代表无论何时一个屏幕外缓冲区被复用，而红色代表当缓冲区被重新创建&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;rasterized layer 的缓冲区大小是有所限制的，大概是屏幕大小的两倍空间 屏幕外的缓冲区&lt;/p&gt;
&lt;h3 id=&quot;CALayer：&quot;&gt;&lt;a href=&quot;#CALayer：&quot; class=&quot;headerlink&quot; title=&quot;CALayer：&quot;&gt;&lt;/a&gt;CALayer：&lt;/h3&gt;&lt;p&gt;GPU 测试的步骤：&lt;br&gt;要告诉你，如果是 GPU 限制了你的性能，你可以使用 OpenGL ES Driver instrument。点击上面那个小的 i 按钮，配置一下，同时注意勾选 Device Utilization %。现在，当你运行你的 app 时，你可以看到你 GPU 的负荷。如果这个值靠近 100%，那么你就需要把你工作的重心放在GPU方面了。&lt;/p&gt;
&lt;h3 id=&quot;Core-Graphics-amp-Quartz-2D：&quot;&gt;&lt;a href=&quot;#Core-Graphics-amp-Quartz-2D：&quot; class=&quot;headerlink&quot; title=&quot;Core Graphics &amp;amp; Quartz 2D：&quot;&gt;&lt;/a&gt;Core Graphics &amp;amp; Quartz 2D：&lt;/h3&gt;&lt;p&gt;Core Graphics 是功能强大的绘图框架&lt;/p&gt;
&lt;p&gt;GPU加速下的图像处理：&lt;br&gt;好的图像处理的开源第三方框架：&lt;/p&gt;
&lt;p&gt;GPUImage ：&lt;a href=&quot;https://github.com/BradLarson/GPUImage&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/BradLarson/GPUImage&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ShaderToy :  &lt;a href=&quot;https://www.shadertoy.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://www.shadertoy.com&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Shaderific :  &lt;a href=&quot;http://www.shaderific.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.shaderific.com&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;着色器的调试 ：是测算帧渲染的时间，不是 1s 渲染多少帧&lt;br&gt;FPS是帧时间的倒数，帧渲染的时间：是帧开始处理到完全结束并且渲染到屏幕或者一张图片所花费的时间。&lt;/p&gt;
&lt;p&gt;👉🏿 在移动端的 GPU 中有很多是 把指令集中起来，最后统一做一次渲染  ——&amp;gt; 在测试时需要测试整个过程，而不是一个中间过程&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.sunsetlakesoftware.com/2013/10/21/optimizing-gaussian-blurs-mobile-gpu&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;测试大🐮的博客 ：&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://community.imgtec.com/developers/powervr/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;GPU 的测试框架：&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;如果想要保持高的帧速  就要保证着色器比较低的周期数  （如果是 60帧每秒， 那么在完成一个周期就需要仅仅 16.67 毫秒）&lt;/p&gt;
&lt;h2 id=&quot;降低着色器渲染周期方法：&quot;&gt;&lt;a href=&quot;#降低着色器渲染周期方法：&quot; class=&quot;headerlink&quot; title=&quot;降低着色器渲染周期方法：&quot;&gt;&lt;/a&gt;降低着色器渲染周期方法：&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;消除条件逻辑 ：条件逻辑有时是必须的，但有时可以做优化。着色器中使用 step（）函数变通避免逻辑的运用&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;减少依赖纹理的读取 ：在片段的着色器取样时，如果纹理坐标不是以 varying 的形式传入，而是在片段着色器中进行计算，就会发生纹理依赖。（👉🏿想从附近的像素取样，而不是计算和片段着色器中相邻像素的偏差，最好在顶点着色器中进行计算，然后把结果以 varying 的方式传入片段着色器👈）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;让计算更加简单 ： 在计算过程中如果使用简单的计算可以得到一个足够近似的值，就需要避免昂贵的计算方式（例如：sin()，cos()，tan() ）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;如果有可能的话，把相关计算使用到顶点着色器。    😁 😀😁 😀😁 😀 顶点着色器是每个顶点运行一次，片段着色器是每一个像素运行一次&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;参考资料：&lt;br&gt;&lt;a href=&quot;https://zh.wikipedia.org/wiki/中央处理器&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;中央处理器&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://zh.wikipedia.org/wiki/圖形處理器&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;圖形處理器&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://blog.ibireme.com/author/ibireme/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;不再安全的 OSSpinLock&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://objccn.io/issue-21-7/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;GPU 加速下的图像处理&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://objccn.io/issue-21-8/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;GPU 加速下的图像视觉&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://objccn.io/issue-3-1/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;objccn.io-issue-3-1&lt;/a&gt;  &lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;在每个 APP 中如果想要实现界面的精美，多数情况下我们需要对相关控件进行分装，采用CocoaPods进行插件化管理。&lt;br&gt;但是我们在程序里的空间是怎么显示在屏幕上的，下面将初略的讲述屏幕上显示控件的过程。&lt;/p&gt;
&lt;p&gt;使用 Xmind 来展示博客讲述 APP 控件在屏幕上显示的思路和相关知识点的整理思路，具体思路看下图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1877765-420d6100d6bc6ea1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;iOS 控件在屏幕上显示思维导图.png&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://yoursite.com/categories/iOS/"/>
    
    
      <category term="iOS" scheme="http://yoursite.com/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>广州~两周感悟</title>
    <link href="http://yoursite.com/2016/07/16/%E4%B8%A4%E5%91%A8%E6%84%9F%E6%82%9F~%E5%B9%BF%E5%B7%9E/"/>
    <id>http://yoursite.com/2016/07/16/两周感悟~广州/</id>
    <published>2016-07-15T16:27:32.000Z</published>
    <updated>2017-06-01T07:48:51.000Z</updated>
    
    <content type="html">&lt;p&gt;从汕大毕业来到广州&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;从汕大毕业来到广州，目前住在棠下村和一个师兄一起住，打算过段时间出去找房子~搬家😉&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;离开汕大本来有些感伤，但是来到这个自己心中有所期望的城市又倍感高兴，因为可以随时去看想看的&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;hr&gt;
&lt;p&gt;人😚。心之所向，就会有一种家的感觉，让自己感到放松！嗨，目前自己没有完全确定下来就不知道见&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;到怎么说😂，但是离你很近，打车20分钟多路程… … Miss you!&lt;/p&gt;
&lt;hr&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;从汕大毕业来到广州&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;从汕大毕业来到广州，目前住在棠下村和一个师兄一起住，打算过段时间出去找房子~搬家😉&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;离开汕大本来有些感伤，但是来到这个自己心中有所期望的城市又倍感高兴，因为可以随时去看想看的&lt;/p&gt;
    
    </summary>
    
      <category term="随笔" scheme="http://yoursite.com/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
      <category term="随笔" scheme="http://yoursite.com/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>UIView &amp; CALayer&amp; Core Animation ~ （UIView 和 CALayer）（1）</title>
    <link href="http://yoursite.com/2016/06/16/UIView&CALayer&Core%20Animation~1/"/>
    <id>http://yoursite.com/2016/06/16/UIView&CALayer&Core Animation~1/</id>
    <published>2016-06-16T06:41:28.000Z</published>
    <updated>2017-06-01T07:45:54.000Z</updated>
    
    <content type="html">&lt;p&gt;目前dome已经做好啦，但是感觉自己理解还不是很透彻。打算改下自己的博客从头开始对博客进行重新更新，更新时间6/12/2016。&lt;/p&gt;
&lt;div style=&quot;color:#008B8B&quot;&gt;&lt;br&gt;&lt;p&gt;今天也打算写关于图片、音频和视频在深层原理，以及图像在屏幕显示原理以及后面提出如何进行在此方面优化。&lt;br&gt;下面就讲述在IOS开发过程中经常使用的UIView和CALayer两者之间的关系和在动画使用过程的具体封装（网上也有许多关于这个话题的文章，也是站在巨人肩膀上）。&lt;/p&gt;&lt;br&gt;&lt;/div&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h3 id=&quot;UIView和CALayer之间的关系&quot;&gt;&lt;a href=&quot;#UIView和CALayer之间的关系&quot; class=&quot;headerlink&quot; title=&quot;UIView和CALayer之间的关系&quot;&gt;&lt;/a&gt;UIView和CALayer之间的关系&lt;/h3&gt;&lt;p&gt;打开UIView和CALyer中实际实现的代码，下面是UIView实现源码&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NS_CLASS_AVAILABLE_IOS&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;_0) &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@interface&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;UIView&lt;/span&gt; : &lt;span class=&quot;title&quot;&gt;UIResponder&lt;/span&gt; &amp;lt;&lt;span class=&quot;title&quot;&gt;NSCoding&lt;/span&gt;, &lt;span class=&quot;title&quot;&gt;UIAppearance&lt;/span&gt;, &lt;span class=&quot;title&quot;&gt;UIAppearanceContainer&lt;/span&gt;, &lt;span class=&quot;title&quot;&gt;UIDynamicItem&lt;/span&gt;, &lt;span class=&quot;title&quot;&gt;UITraitEnvironment&lt;/span&gt;, &lt;span class=&quot;title&quot;&gt;UICoordinateSpace&lt;/span&gt;, &lt;span class=&quot;title&quot;&gt;UIFocusEnvironment&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;readonly&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;strong&lt;/span&gt;)                 &lt;span class=&quot;built_in&quot;&gt;CALayer&lt;/span&gt;  *layer; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;CALayer实现源码：&lt;br&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@interface&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;CALayer&lt;/span&gt; : &lt;span class=&quot;title&quot;&gt;NSObject&lt;/span&gt; &amp;lt;&lt;span class=&quot;title&quot;&gt;NSCoding&lt;/span&gt;, &lt;span class=&quot;title&quot;&gt;CAMediaTiming&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@private&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; _CALayerIvars &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    int32_t refcount;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    uint32_t magic;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; *layer;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#if TARGET_OS_MAC &amp;amp;&amp;amp; !TARGET_RT_64_BIT&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; *unused1[&lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#endif&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125; _attr;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;br&gt;我们可以看出UIView是继承自UIResponder，而CALayer继承自NSObject。这也是UIView可以相应触摸事件，并实现响应链中最后一环所在后面我们会具体讲述。CALayer继承自NSObject，其中UIView中又包含自己所特有的layer。我们可以看做CALayer是UIView的具体内容细节的实现，两者具有平行关系。&lt;/p&gt;
&lt;div style=&quot;color:#008B8B&quot;&gt;&lt;p&gt;为什么不把两者何在一起进行实现呢，分开实现具体功能呢？&lt;br&gt;我想可能是为啦分层需要，把功能具体分隔开来。UIView实现触摸响应，CALayer实现具体的内容展示。&lt;br&gt;&lt;/p&gt;&lt;br&gt;&lt;/div&gt;

&lt;p&gt;参考资料：&lt;br&gt;&lt;br&gt;&lt;a href=&quot;https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/CoreAnimation_guide/CoreAnimationBasics/CoreAnimationBasics.html#//apple_ref/doc/uid/TP40004514-CH2-SW12&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;UIVie和CALayer关系源码&lt;/a&gt;;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;br&gt;下面我们将写关于UIView和CALayer的一些相关的知识：&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;列出在UIView实现不了的CALayer的功能：&lt;/p&gt;
&lt;ul&gt;&lt;br&gt;&lt;li&gt;阴影，圆角，带颜色的边框&lt;/li&gt;&lt;br&gt;&lt;li&gt;3D变换&lt;/li&gt;&lt;br&gt;&lt;li&gt;非矩形范围&lt;/li&gt;&lt;br&gt;&lt;li&gt;透明遮罩&lt;/li&gt;&lt;br&gt;&lt;li&gt;多级非线性动画&lt;/li&gt;&lt;br&gt;&lt;/ul&gt;

&lt;hr&gt;
&lt;p&gt;我们也都知道在Iphone手机内存是固定不能进行拓展，所以我们手机内存是很宝贵的。如果我们想要加载大容量的图片，会占用很大的内存。&lt;br&gt;&lt;br&gt;&lt;br&gt;为此，Apple采用了一种比较巧妙的策略。在低内存的情况下，系统会强制清除UIImage对象所指向的图片数据，以释放部分内存。注意，这种清除行为影响到的只是图片数据，而不会影响到UIImage对象本身。当我们需要绘制那些图片数据已经被清除的UIImage对象时，对象会自动从源文件中重新加载数据。当然，这是以时间换空间的一种策略，会导致一定的性能损耗。下面给出一些图片处理小技巧&lt;/p&gt;
&lt;h3 id=&quot;UIImage缓存&quot;&gt;&lt;a href=&quot;#UIImage缓存&quot; class=&quot;headerlink&quot; title=&quot;UIImage缓存&quot;&gt;&lt;/a&gt;UIImage缓存&lt;/h3&gt;&lt;p&gt;我们知道在使用imageNamed进行图片显示，图片会缓存。但具体缓存是怎么实现，其中解析和清除时间是什么时候呢？&lt;div style=&quot;color:#008B8B&quot;&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;&lt;/p&gt;&lt;p&gt;当我们使用imageNamed:时创建图片，系统会通过Bundle的文件中找到图片的文件名，然后把相关的名字放到UIImage返回，此时并没有解析图片。当图片在第一次显示时，图片才会调用内部解码方法，解码会放到一个全局变量中。图片在解码后，会在APP第一次进入后台或者内存警告时，该图片的缓存才会被清空，其他情况缓存会一直存在。&lt;br&gt;&lt;/p&gt;&lt;br&gt;&lt;p&gt;&lt;/p&gt;
&lt;h3 id=&quot;使用imageWithData可以避免缓存吗？&quot;&gt;&lt;a href=&quot;#使用imageWithData可以避免缓存吗？&quot; class=&quot;headerlink&quot; title=&quot;使用imageWithData可以避免缓存吗？&quot;&gt;&lt;/a&gt;使用imageWithData可以避免缓存吗？&lt;/h3&gt;&lt;p&gt;我们在创建UIImage时，UIImage的底层会调用ImageIO的CGImageSourceCreateWithData()，此方法有个参数 ShouldCache，在64位的处理器上是默认开启的。图片也会在第一次显示在屏幕上才会被解码，解码数据也会保存在CGimage的内部。&lt;/p&gt;
&lt;div style=&quot;color:#008B8B&quot;&gt;&lt;br&gt;&lt;p&gt;但是与上面使用imageName的情况不同，在UIImage被释放是其缓存也会进行释放。&lt;/p&gt;&lt;/div&gt;

&lt;h3 id=&quot;怎样避免缓存&quot;&gt;&lt;a href=&quot;#怎样避免缓存&quot; class=&quot;headerlink&quot; title=&quot;怎样避免缓存&quot;&gt;&lt;/a&gt;怎样避免缓存&lt;/h3&gt;&lt;ul&gt;&lt;br&gt;&lt;li&gt;上面我们可以看到如果直接使用CGImageSourceCreateWithData()，并且关闭ShouldCache 和 ShouldCacheImmediately，但是这样的话每次图片需要显示的话，都会进行图片解码，这样会占用较大CPU&lt;/li&gt;&lt;br&gt;&lt;li&gt;把图片用 CGContextDrawImage() 绘制到画布上，然后把画布的数据取出来当作图片。这也是常见的网络图片库的做法&lt;/li&gt;&lt;br&gt;&lt;/ul&gt;

&lt;p&gt;&lt;a href=&quot;http://blog.ibireme.com/2015/11/02/ios_image_tips/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;参考资料~iOS 处理图片的一些小 Tip&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;a href=&quot;http://bihongbo.com/2016/01/03/memoryGhostdrawRect/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;内存恶鬼drawRect&lt;/a&gt;&lt;br&gt;&lt;br&gt;总的参考资料地址&lt;br&gt;&lt;br&gt;&lt;a href=&quot;https://github.com/AttackOnDobby/iOS-Core-Animation-Advanced-Techniques/blob/master/1-图层树/图层树.md&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;图层的树状结构&lt;/a&gt;&lt;br&gt;&lt;br&gt;&lt;a href=&quot;https://github.com/AttackOnDobby/iOS-Core-Animation-Advanced-Techniques/blob/master/2-寄宿图/寄宿图.md#contents属性&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;寄宿图&lt;/a&gt;&lt;br&gt;&lt;br&gt;&lt;a href=&quot;https://github.com/AttackOnDobby/iOS-Core-Animation-Advanced-Techniques&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;UIView和CALayer总的参考地址&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;目前dome已经做好啦，但是感觉自己理解还不是很透彻。打算改下自己的博客从头开始对博客进行重新更新，更新时间6/12/2016。&lt;/p&gt;
&lt;div style=&quot;color:#008B8B&quot; &gt;&lt;br&gt;&lt;p&gt;今天也打算写关于图片、音频和视频在深层原理，以及图像在屏幕显示原理以及后面提出如何进行在此方面优化。&lt;br&gt;下面就讲述在IOS开发过程中经常使用的UIView和CALayer两者之间的关系和在动画使用过程的具体封装（网上也有许多关于这个话题的文章，也是站在巨人肩膀上）。&lt;/p&gt;&lt;br&gt;&lt;/div&gt;
    
    </summary>
    
      <category term="视图&图层&动画" scheme="http://yoursite.com/categories/%E8%A7%86%E5%9B%BE-%E5%9B%BE%E5%B1%82-%E5%8A%A8%E7%94%BB/"/>
    
    
      <category term="图片视频" scheme="http://yoursite.com/tags/%E5%9B%BE%E7%89%87%E8%A7%86%E9%A2%91/"/>
    
  </entry>
  
  <entry>
    <title>UIView&amp;CALayer&amp;Core Animation~开篇</title>
    <link href="http://yoursite.com/2016/06/16/UIView&CALayer&Core%20Animation-%E6%80%BB%E4%BD%93/"/>
    <id>http://yoursite.com/2016/06/16/UIView&CALayer&Core Animation-总体/</id>
    <published>2016-06-16T06:35:22.000Z</published>
    <updated>2017-06-01T07:48:51.000Z</updated>
    
    <content type="html">&lt;p&gt;一直想做个dome来实践自己所学的知识，看到网上有很多资料感觉压力比较大，所以决定站在巨人肩膀上对于UIView&amp;amp;CALayer&amp;amp;Core Animation 进行分装做出一个dome。&lt;/p&gt;
&lt;p&gt;下面给出整理的思维导图片：&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;&lt;img src=&quot;/images/UIView&amp;amp;CALayer动画.png&quot; alt=&quot;image&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/boilWater/boilWater.github.io/tree/master/Xmind&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;思维导图下载地址&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;一直想做个dome来实践自己所学的知识，看到网上有很多资料感觉压力比较大，所以决定站在巨人肩膀上对于UIView&amp;amp;CALayer&amp;amp;Core Animation 进行分装做出一个dome。&lt;/p&gt;
&lt;p&gt;下面给出整理的思维导图片：&lt;/p&gt;
    
    </summary>
    
      <category term="视图&图层&动画" scheme="http://yoursite.com/categories/%E8%A7%86%E5%9B%BE-%E5%9B%BE%E5%B1%82-%E5%8A%A8%E7%94%BB/"/>
    
    
      <category term="图片视频" scheme="http://yoursite.com/tags/%E5%9B%BE%E7%89%87%E8%A7%86%E9%A2%91/"/>
    
  </entry>
  
  <entry>
    <title>IOS 10.0</title>
    <link href="http://yoursite.com/2016/06/15/IOS%2010/"/>
    <id>http://yoursite.com/2016/06/15/IOS 10/</id>
    <published>2016-06-14T16:07:59.000Z</published>
    <updated>2017-06-01T07:48:51.000Z</updated>
    
    <content type="html">&lt;p&gt;今天有点悲剧，回到住的地方身体就开始不舒服，一觉睡到现在。看到11点多，赶紧找时间开始码IOS 10.0新的改变。&lt;br&gt;&lt;br&gt;昨天凌晨IOS 举行 WWDC全球发布者大会，watch OS、tv OS、OS X以及iOS 10系统的新特性。&lt;br&gt;&lt;br&gt;&lt;a href=&quot;http://www.apple.com/apple-events/june-2016/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;WWDC-13/6/2016~视频地址&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;展示会第一个是APPLE的掌舵人是库克，有点搞笑的是大家好像没有理解库克的第一个梗大家都没有欢呼。看完视频给我比较好的感觉就是在siri操作程序和Apple Pay的使用过程，付款使用起来感觉比支付宝更加便捷。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;下面我们列表IOS 10的新功能的体现，下面将给出相关知识的思维导图。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/Images/WWDC（2016）.png&quot; alt=&quot;image&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;Watch-OS&quot;&gt;&lt;a href=&quot;#Watch-OS&quot; class=&quot;headerlink&quot; title=&quot;Watch OS&quot;&gt;&lt;/a&gt;Watch OS&lt;/h2&gt;&lt;h3 id=&quot;寻找APPS&quot;&gt;&lt;a href=&quot;#寻找APPS&quot; class=&quot;headerlink&quot; title=&quot;寻找APPS&quot;&gt;&lt;/a&gt;寻找APPS&lt;/h3&gt;&lt;p&gt;我们通过Apple Watch傍边的旋转手柄可以快速寻找我们装在的APP以及设定首界面显示的具体内容&lt;/p&gt;
&lt;h3 id=&quot;表盘界面&quot;&gt;&lt;a href=&quot;#表盘界面&quot; class=&quot;headerlink&quot; title=&quot;表盘界面&quot;&gt;&lt;/a&gt;表盘界面&lt;/h3&gt;&lt;p&gt;Apple Watch提供多个表盘界面，其中一个竟然是米老鼠的显示时间真心醉啦，没有保持乔帮主时double做法&lt;/p&gt;
&lt;h3 id=&quot;活动&quot;&gt;&lt;a href=&quot;#活动&quot; class=&quot;headerlink&quot; title=&quot;活动&quot;&gt;&lt;/a&gt;活动&lt;/h3&gt;&lt;p&gt;活动方面Apple Watch为我们添加一些使用的功能。我们可以对活动任务进行分享、查看活动完成进度和与朋友活动进度进行比较&lt;/p&gt;
&lt;h3 id=&quot;Wheelchair-Use&quot;&gt;&lt;a href=&quot;#Wheelchair-Use&quot; class=&quot;headerlink&quot; title=&quot;Wheelchair Use&quot;&gt;&lt;/a&gt;Wheelchair Use&lt;/h3&gt;&lt;p&gt;为做轮椅的人提供可以帮助，可以提醒使用者休息、工作和显示旋转速度&lt;/p&gt;
&lt;h3 id=&quot;Workout&quot;&gt;&lt;a href=&quot;#Workout&quot; class=&quot;headerlink&quot; title=&quot;Workout&quot;&gt;&lt;/a&gt;Workout&lt;/h3&gt;&lt;p&gt;在工作之余我们可以使用Apple Watch来查看我们走的距离、watch的活跃内存空间、消耗卡路里、心率和运动时间，可以选择重要的运动项目，进行特别标注，在跑步过程会自动停止&lt;/p&gt;
&lt;h3 id=&quot;Breathe-App&quot;&gt;&lt;a href=&quot;#Breathe-App&quot; class=&quot;headerlink&quot; title=&quot;Breathe App&quot;&gt;&lt;/a&gt;Breathe App&lt;/h3&gt;&lt;p&gt;帮助你可以进行冥想，释放自己的压力，把语音信心转换为文字，进行回复&lt;/p&gt;
&lt;h3 id=&quot;Messages&quot;&gt;&lt;a href=&quot;#Messages&quot; class=&quot;headerlink&quot; title=&quot;Messages&quot;&gt;&lt;/a&gt;Messages&lt;/h3&gt;&lt;p&gt;把语音信心转换为文字，进行回复，重要的是支持汉字手写&lt;/p&gt;
&lt;h3 id=&quot;保留功能&quot;&gt;&lt;a href=&quot;#保留功能&quot; class=&quot;headerlink&quot; title=&quot;保留功能&quot;&gt;&lt;/a&gt;保留功能&lt;/h3&gt;&lt;ul&gt;&lt;br&gt;&lt;li&gt;Home：可以通过Apple Watch链接控制家中使用Home的所有硬件设备&lt;/li&gt;&lt;br&gt;&lt;li&gt;SOS：试下紧急呼叫的功能&lt;/li&gt;&lt;br&gt;&lt;li&gt;Apple Pay：可以在Mac上购买然后通过IPhone直接指纹识别进行付款&lt;/li&gt;&lt;br&gt;&lt;li&gt;Unlock Mac：解锁我们使用的Mac电脑&lt;/li&gt;&lt;br&gt;&lt;/ul&gt;


&lt;h2 id=&quot;IOS-10&quot;&gt;&lt;a href=&quot;#IOS-10&quot; class=&quot;headerlink&quot; title=&quot;IOS 10&quot;&gt;&lt;/a&gt;IOS 10&lt;/h2&gt;&lt;h3 id=&quot;全新界面功能设计&quot;&gt;&lt;a href=&quot;#全新界面功能设计&quot; class=&quot;headerlink&quot; title=&quot;全新界面功能设计&quot;&gt;&lt;/a&gt;全新界面功能设计&lt;/h3&gt;&lt;p&gt;首先是新的锁屏界面，互动性大幅增强，支持新的通知显示方式和手势功能，可以直接使用 3D Touch 进行预览与信息回复，或者重按全部清除通知，更快速的进入拍照界面等，界面看起来更加清晰直观。&lt;/p&gt;
&lt;p&gt;值得一提的是，iPhone 支持抬手唤醒屏幕功能了， 当你抬起 iPhone 的时候锁屏界面就会亮起，直接显示通知信息和相关内容，而不触碰任何按键和所动操作，有点类似于竞争对手的平台设计理念。&lt;/p&gt;
&lt;p&gt;通知中心和控制中心界面进行了新的设计，包括桌面亦是如此，很多操作操作利用 3D Touch 更加便捷，比如在 app 图标上预览更多相关信息，甚至是视频预览。&lt;/p&gt;
&lt;h3 id=&quot;Siri&quot;&gt;&lt;a href=&quot;#Siri&quot; class=&quot;headerlink&quot; title=&quot;Siri&quot;&gt;&lt;/a&gt;Siri&lt;/h3&gt;&lt;p&gt;Siri 果然每一年都会努力提升 Siri 的水平，苹果表示每周有 200 万个用户使用 Siri。新升级之后 Siri 可以搜索的内容更多了，比如图片搜索、应用搜索，同时 Siri 还能够查看日期、打开 app、发送短息。&lt;/p&gt;
&lt;p&gt;苹果宣布 Siri SDK 开放，之后开发者可以将第三方应用程序和服务与 Siri 集成，从而在自家的应用中利用 Siri 实现语音交互、人工智能等功能。苹果称 Whatsapp、微信和滴滴打车都会集成，用户可以通过 Siri 语音命令“WeChat xxx to 谁谁谁”，就能够完成微信的发送了，也可以用 Siri 来使用滴滴打车。&lt;/p&gt;
&lt;p&gt;另一为 iOS 10 上 Siri 增加的功能是 iCloud Voicemail，可以将语音信箱中的内容转换成文字，让用户能够快速浏览和阅读。&lt;/p&gt;
&lt;h3 id=&quot;Quick-type&quot;&gt;&lt;a href=&quot;#Quick-type&quot; class=&quot;headerlink&quot; title=&quot;Quick type&quot;&gt;&lt;/a&gt;Quick type&lt;/h3&gt;&lt;p&gt;Quick type 这部分更行重在 Siri 的全新升级的人工智能特征所带来的便利性，因为 Siri 支持深度学习你的一切信息，包括监测你的日程安排，所以不仅可以帮助更快速的组织语言一边快速回复，还能够根据信息提供相关建议，帮助自动填充地址信息等等。基本上，新升级之后能够为用户省去更多手动输入麻烦。&lt;/p&gt;
&lt;h3 id=&quot;照片应用&quot;&gt;&lt;a href=&quot;#照片应用&quot; class=&quot;headerlink&quot; title=&quot;照片应用&quot;&gt;&lt;/a&gt;照片应用&lt;/h3&gt;&lt;p&gt;iOS 10 中的照片应用拥有了更加强大的管理功能，苹果多次提到的就是支持“识别分类”功能，可以进行脸部、对象和场景的识别。比如通过任务的脸部头像进行分类，当智能搜索分类完成之后，用户还可以直接搜索图片上的事件内容，搜索骑马也能找到照片。&lt;/p&gt;
&lt;p&gt;总之，利用 iCloud 照片库就可以轻松根据地理位置信息、时间、任务、话题等等进行分类，每一个用户都可以很方便更满意的创建智能相册，并且这些新功能在 Mac上的 Photos 也将同样得到支持。&lt;/p&gt;
&lt;h3 id=&quot;地图应用&quot;&gt;&lt;a href=&quot;#地图应用&quot; class=&quot;headerlink&quot; title=&quot;地图应用&quot;&gt;&lt;/a&gt;地图应用&lt;/h3&gt;&lt;p&gt;苹果自家的地图应用在 iOS 10 中得到了较大改进，重新设计之后更简单、更直观也更人性化，无论是导航界面还是路线信息、交通信息等都与以往有所不同。周边智能化建议进一步增强，所在位置打开地图“好去处”的建议更加丰富，附件的加油站、餐馆和咖啡厅等一览无遗，用苹果的话来说简直就是“情报中心”。&lt;/p&gt;
&lt;p&gt;苹果地图也将开发 SDK 给开发者，苹果表示中国的大众点评和滴滴打车将全面整合苹果地图，达到与原生无缝斜街的体验，比如说直接在苹果地图上使用滴滴打车进行叫车。另外，苹果地图现在也支持 Carplay 了。&lt;/p&gt;
&lt;h3 id=&quot;Apple-Music&quot;&gt;&lt;a href=&quot;#Apple-Music&quot; class=&quot;headerlink&quot; title=&quot;Apple Music&quot;&gt;&lt;/a&gt;Apple Music&lt;/h3&gt;&lt;p&gt;对于 Apple Music 苹果表示，该服务推出至今已经获得了巨大的成功，目前付费订阅用户已经超过 1500 万。&lt;/p&gt;
&lt;p&gt;全新的 Apple Music 界面进行了重新设计，新的界面更加简洁、更加漂亮了，如传闻所述去掉了很多丰富的颜色元素，变得更加直观，突出黑白背景和文字。演示来看，新 Apple Music  进一步整合苹果公司自主开发的旧金山字体，菜单和标签的字体会是加粗的、更大的黑色的版本。&lt;/p&gt;
&lt;p&gt;另外，Apple Music 可以按照艺术家专辑等进行分类，还支持歌词自动加载显示。电台广播服务得到了改进，不只是分类更直观，用户可以很方便地寻找自己想听的电台，而且苹果表示将会有更多的主播参与当中。&lt;/p&gt;
&lt;h3 id=&quot;Apple-News&quot;&gt;&lt;a href=&quot;#Apple-News&quot; class=&quot;headerlink&quot; title=&quot;Apple News&quot;&gt;&lt;/a&gt;Apple News&lt;/h3&gt;&lt;p&gt;苹果表示，Apple News 有超过 600 万的读者，新的更新将拥有全新设计的界面，并可订阅更多频道。推荐功能变得更强大更智能，支持基于用户阅读习惯进行推荐，为每一位用户选择性的推送最需要的新闻信息。&lt;/p&gt;
&lt;h3 id=&quot;HomeKit&quot;&gt;&lt;a href=&quot;#HomeKit&quot; class=&quot;headerlink&quot; title=&quot;HomeKit&quot;&gt;&lt;/a&gt;HomeKit&lt;/h3&gt;&lt;p&gt;物联网是大势所趋，苹果为 iOS 10 带来了 HomeKit 的全新进展。首先，HomeKit 将以独立应用的形式出现在 iOS 10 上，命名为 Home，之前苹果可申请过“Home”的商标，并不意外。&lt;/p&gt;
&lt;p&gt;当 HomeKit 独立成一个应用之后，它将有能力将平台上所有的兼容设备置于同一个管理中心中。只需要打开 iOS 10 上的 Home  应用，就可以对所有兼容 HomeKit 的设备进行统一的匹配和控制管理，Home  应用中包含了非常全面的家电控制面板选项，支持 3D Touch 也支持 Siri 进行控制，iPad、Apple Watch 也会提供 Home 应用。&lt;/p&gt;
&lt;p&gt;苹果表示，今天有好多开发商都参与到了 HomeKit 开发其中，通过 HomeKit 用户可以控制家里所有智能电器，包括控制门锁、风扇、灯，打开房门和车空门等等，不仅可以查看门锁摄像头的实时视频，而且还能控制让浴缸的热水在没回家之前就给用户放好。&lt;/p&gt;
&lt;h3 id=&quot;电话&quot;&gt;&lt;a href=&quot;#电话&quot; class=&quot;headerlink&quot; title=&quot;电话&quot;&gt;&lt;/a&gt;电话&lt;/h3&gt;&lt;p&gt;默认电话 app  这部分的内容讲得比较少，一些比较突出的更新包括支持显示垃圾电话，支持 VoIP，支持语音信箱转文本显示等等。从现场图来看，联系人界面进行了全新的设计。&lt;/p&gt;
&lt;h3 id=&quot;信息&quot;&gt;&lt;a href=&quot;#信息&quot; class=&quot;headerlink&quot; title=&quot;信息&quot;&gt;&lt;/a&gt;信息&lt;/h3&gt;&lt;p&gt;苹果表示，信息是 iOS 中使用最为频繁的应用之一。所以，这一次信息应用苹果花了大量时间进行演示，不过很多功能都与国内的即时聊天应用类似。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;今天有点悲剧，回到住的地方身体就开始不舒服，一觉睡到现在。看到11点多，赶紧找时间开始码IOS 10.0新的改变。&lt;/br&gt;&lt;br&gt;昨天凌晨IOS 举行 WWDC全球发布者大会，watch OS、tv OS、OS X以及iOS 10系统的新特性。&lt;/br&gt;&lt;br&gt;&lt;a href=&quot;http://www.apple.com/apple-events/june-2016/&quot;&gt;WWDC-13/6/2016~视频地址&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;展示会第一个是APPLE的掌舵人是库克，有点搞笑的是大家好像没有理解库克的第一个梗大家都没有欢呼。看完视频给我比较好的感觉就是在siri操作程序和Apple Pay的使用过程，付款使用起来感觉比支付宝更加便捷。&lt;/p&gt;
    
    </summary>
    
      <category term="随笔" scheme="http://yoursite.com/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
      <category term="IOS" scheme="http://yoursite.com/tags/IOS/"/>
    
  </entry>
  
  <entry>
    <title>SDWebImage之图片缓存处理</title>
    <link href="http://yoursite.com/2016/06/04/SDWebImage%E4%B9%8B%E5%9B%BE%E7%89%87%E7%BC%93%E5%AD%98%E5%88%86%E6%9E%90/"/>
    <id>http://yoursite.com/2016/06/04/SDWebImage之图片缓存分析/</id>
    <published>2016-06-04T08:55:11.000Z</published>
    <updated>2017-06-01T07:48:51.000Z</updated>
    
    <content type="html">&lt;p&gt;这篇文章我将接着节讲述关于SDWebImage图片下载后处理方式，缓存进行讲解。&lt;br&gt;&lt;br&gt;&lt;br&gt;经过上面我们可以知道SDWebImage是可以从远程的服务器加载图片，然后在UIImageView上进行显示。但是你有想过SDWebImage到底是什么呢？&lt;/p&gt;
&lt;p&gt;在使用时我们知道需要导入包：UIImageView+WebCache.h我们可以根据这看出SDWebImage是一个UIImageView的分类，使用Category进行分装的类。下面列出SDWebImage可以实现的功能：&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;&lt;ul&gt;&lt;/ul&gt;&lt;/p&gt;
&lt;p&gt;&lt;li&gt;提供UIImageView的一个分类，可以对图片进行异步加载和缓存管理&lt;/li&gt;&lt;/p&gt;
&lt;p&gt;&lt;li&gt;一步内存 &amp;amp; 磁盘管理 &amp;amp; 自动对过期的缓存进行相关的处理&lt;/li&gt;&lt;/p&gt;
&lt;p&gt;&lt;li&gt;一个一步图片的加载器&lt;/li&gt;&lt;/p&gt;
&lt;p&gt;&lt;li&gt;支持GIF的图片加载&lt;/li&gt;&lt;/p&gt;
&lt;p&gt;&lt;li&gt;后台对图片进行解压处理&lt;/li&gt;&lt;/p&gt;
&lt;p&gt;&lt;li&gt;确保同意URL的图片不会被数次加载&lt;/li&gt;&lt;/p&gt;
&lt;p&gt;&lt;li&gt;确保虚假的URL不会被反复加载&lt;/li&gt;&lt;/p&gt;
&lt;p&gt;&lt;li&gt;确保下载和缓存时主线程不会被阻塞&lt;/li&gt;&lt;/p&gt;
&lt;p&gt;&lt;li&gt;优良使用性能&lt;/li&gt;&lt;/p&gt;
&lt;p&gt;&lt;li&gt;采用GCD可以采用并行处理，IOS 5.0的ARC自动计数原则&lt;/li&gt;&lt;/p&gt;
&lt;p&gt;&lt;li&gt;支持Arm64(64位CPU处理)&lt;/li&gt;&lt;br&gt;&lt;/p&gt;
&lt;div style=&quot;color:#008B8B&quot;&gt;&lt;p&gt;&lt;br&gt;本篇博客是在SDWebImage的图片加载基础之上进行探索，下面我们就来看下SDWebImage是如何实现对图片实行缓存处理。&lt;/p&gt;&lt;/div&gt;

&lt;h3 id=&quot;实例&quot;&gt;&lt;a href=&quot;#实例&quot; class=&quot;headerlink&quot; title=&quot;实例&quot;&gt;&lt;/a&gt;实例&lt;/h3&gt;&lt;p&gt;SDImageCache是图片下载后内存缓存管理和磁盘缓存管理的类，不过还是我们最常见的单例模式sharedImageCache来进行得到实例。默认的缓存空间上是default，如果自己看着不怎么好的话可以自己进行相关的空间申请。下面是SDWebCache的简介：&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;+ (SDImageCache *)sharedImageCache &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;dispatch_once_t&lt;/span&gt; once;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; instance;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;dispatch_once&lt;/span&gt;(&amp;amp;once, ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        instance = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; new];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; instance;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这里使用dispatch_once的形式每次开启一个线程，这样可以防止多个单例进行同时的初始化。&lt;a href=&quot;http://www.cocoachina.com/ios/20151117/14225.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;详情可以参考GCD相关的知识&lt;/a&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;)init &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; initWithNamespace:&lt;span class=&quot;string&quot;&gt;@&quot;default&quot;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;)initWithNamespace:(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)ns &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *path = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; makeDiskCachePath:ns];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; initWithNamespace:ns diskCacheDirectory:path];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;)initWithNamespace:(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)ns diskCacheDirectory:(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)directory &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ((&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; = [&lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; init])) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *fullNamespace = [&lt;span class=&quot;string&quot;&gt;@&quot;com.hackemist.SDWebImageCache.&quot;&lt;/span&gt; stringByAppendingString:ns];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;comment&quot;&gt;// initialise PNG signature data&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     kPNGSignatureData = [&lt;span class=&quot;built_in&quot;&gt;NSData&lt;/span&gt; dataWithBytes:kPNGSignatureBytes length:&lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;comment&quot;&gt;// Create IO serial queue&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     _ioQueue = dispatch_queue_create(&lt;span class=&quot;string&quot;&gt;&quot;com.hackemist.SDWebImageCache&quot;&lt;/span&gt;, DISPATCH_QUEUE_SERIAL);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;comment&quot;&gt;// Init default values&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     _maxCacheAge = kDefaultCacheMaxCacheAge;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;comment&quot;&gt;// Init the memory cache&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     _memCache = [[AutoPurgeCache alloc] init];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     _memCache.name = fullNamespace;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;comment&quot;&gt;// Init the disk cache&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (directory != &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         _diskCachePath = [directory stringByAppendingPathComponent:fullNamespace];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *path = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; makeDiskCachePath:ns];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         _diskCachePath = path;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;comment&quot;&gt;// Set decompression to YES&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     _shouldDecompressImages = &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;comment&quot;&gt;// memory cache enabled&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     _shouldCacheImagesInMemory = &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;comment&quot;&gt;// Disable iCloud&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     _shouldDisableiCloud = &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;built_in&quot;&gt;dispatch_sync&lt;/span&gt;(_ioQueue, ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         _fileManager = [&lt;span class=&quot;built_in&quot;&gt;NSFileManager&lt;/span&gt; new];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#if TARGET_OS_IPHONE&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;comment&quot;&gt;// Subscribe to app events&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     [[&lt;span class=&quot;built_in&quot;&gt;NSNotificationCenter&lt;/span&gt; defaultCenter] addObserver:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                              selector:&lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(clearMemory)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                  name:&lt;span class=&quot;built_in&quot;&gt;UIApplicationDidReceiveMemoryWarningNotification&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                object:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     [[&lt;span class=&quot;built_in&quot;&gt;NSNotificationCenter&lt;/span&gt; defaultCenter] addObserver:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                              selector:&lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(cleanDisk)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                  name:&lt;span class=&quot;built_in&quot;&gt;UIApplicationWillTerminateNotification&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                object:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     [[&lt;span class=&quot;built_in&quot;&gt;NSNotificationCenter&lt;/span&gt; defaultCenter] addObserver:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                              selector:&lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(backgroundCleanDisk)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                  name:&lt;span class=&quot;built_in&quot;&gt;UIApplicationDidEnterBackgroundNotification&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                object:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#endif&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;div style=&quot;color:#008B8B&quot;&gt;&lt;p&gt;&lt;br&gt;上面我们可以看出在我们使用init来进行初始化缓存空间，紧接着就调用initWithNamespace: &amp;amp; initWithNamespace: diskCacheDirectory:来进一步对磁盘进行缓存空间的初始化。&lt;br&gt;&lt;/p&gt;&lt;/div&gt;

&lt;h3 id=&quot;内存缓存类&quot;&gt;&lt;a href=&quot;#内存缓存类&quot; class=&quot;headerlink&quot; title=&quot;内存缓存类&quot;&gt;&lt;/a&gt;内存缓存类&lt;/h3&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@interface&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;AutoPurgeCache&lt;/span&gt; : &lt;span class=&quot;title&quot;&gt;NSCache&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@end&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@implementation&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;AutoPurgeCache&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;)init&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; = [&lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; init];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [[&lt;span class=&quot;built_in&quot;&gt;NSNotificationCenter&lt;/span&gt; defaultCenter] addObserver:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; selector:&lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(removeAllObjects) name:&lt;span class=&quot;built_in&quot;&gt;UIApplicationDidReceiveMemoryWarningNotification&lt;/span&gt; object:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)dealloc&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [[&lt;span class=&quot;built_in&quot;&gt;NSNotificationCenter&lt;/span&gt; defaultCenter] removeObserver:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; name:&lt;span class=&quot;built_in&quot;&gt;UIApplicationDidReceiveMemoryWarningNotification&lt;/span&gt; object:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@end&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;上面我们可以看出在缓存过程中我们采用的是NSCache的子类AutoPurgeCache进行线管的缓存处理，但是我们也可以直接使用NSdictionary来进行处理，为什么不使用呢？后面我将会讲出😸。返回上面，我们可以看出在缓存时我们采用注册和监听的模式对缓存的内存监听，一旦缓存数据达到临界点就要条用removeAllObjects。这里有关于方法在运行时编译情况下的过程&lt;br&gt;&lt;a href=&quot;http://boilwater.github.io/2016/05/29/runtime理解/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;runtime解析&lt;/a&gt;。&lt;/p&gt;
&lt;div style=&quot;color:#008B8B&quot;&gt;&lt;p&gt;&lt;br&gt;在缓存过程中我们使用的是NSCache而不是用NSDictionary呢，下面我们看下NSCache的优点：&lt;br&gt;&lt;ul&gt;&lt;br&gt;&lt;li&gt;自动删减功能&lt;/li&gt;&lt;br&gt;&lt;li&gt;线程安全&lt;/li&gt;&lt;br&gt;&lt;li&gt;不会拷贝健&lt;/li&gt;&lt;br&gt;&lt;/ul&gt;&lt;br&gt;基于上面NSCache的特点选着使用NSCache是更加易于对缓存的管理&lt;br&gt;&lt;/p&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;http://thenewself.blog.163.com/blog/static/198501330201251311025928/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;NSCache的参考资料&lt;/a&gt;&lt;br&gt;&lt;br&gt;&lt;/p&gt;
&lt;h2 id=&quot;缓存在APP周期的设置&quot;&gt;&lt;a href=&quot;#缓存在APP周期的设置&quot; class=&quot;headerlink&quot; title=&quot;缓存在APP周期的设置&quot;&gt;&lt;/a&gt;缓存在APP周期的设置&lt;/h2&gt;&lt;p&gt;在应用开发对内容缓存的过程我们也可以参考下面缓存的处理机制，这也对我们APP的性能会有比较大的提升。下面按照APP的分为：内存警告、程序终止和后台三种情况实现缓存策略。&lt;/p&gt;
&lt;h3 id=&quot;内存警告&quot;&gt;&lt;a href=&quot;#内存警告&quot; class=&quot;headerlink&quot; title=&quot;内存警告&quot;&gt;&lt;/a&gt;内存警告&lt;/h3&gt;&lt;p&gt;在我们使用SDWebImage过程时程序一直都会对我们访的图片进行相关缓存处理，但是当我们缓存较大时就会产生警告&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)clearMemory &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.memCache removeAllObjects];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;上面是我们注册发现内存过大需要调用的方法。&lt;/p&gt;
&lt;h3 id=&quot;程序终止&quot;&gt;&lt;a href=&quot;#程序终止&quot; class=&quot;headerlink&quot; title=&quot;程序终止&quot;&gt;&lt;/a&gt;程序终止&lt;/h3&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)cleanDisk &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; cleanDiskWithCompletionBlock:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)cleanDiskWithCompletionBlock:(SDWebImageNoParamsBlock)completionBlock &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;dispatch_async&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.ioQueue, ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSURL&lt;/span&gt; *diskCacheURL = [&lt;span class=&quot;built_in&quot;&gt;NSURL&lt;/span&gt; fileURLWithPath:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.diskCachePath isDirectory:&lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSArray&lt;/span&gt; *resourceKeys = @[&lt;span class=&quot;built_in&quot;&gt;NSURLIsDirectoryKey&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;NSURLContentModificationDateKey&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;NSURLTotalFileAllocatedSizeKey&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// This enumerator prefetches useful properties for our cache files.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;built_in&quot;&gt;NSDirectoryEnumerator&lt;/span&gt; *fileEnumerator = [_fileManager enumeratorAtURL:diskCacheURL&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                 includingPropertiesForKeys:resourceKeys&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                                    options:&lt;span class=&quot;built_in&quot;&gt;NSDirectoryEnumerationSkipsHiddenFiles&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                               errorHandler:&lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;built_in&quot;&gt;NSDate&lt;/span&gt; *expirationDate = [&lt;span class=&quot;built_in&quot;&gt;NSDate&lt;/span&gt; dateWithTimeIntervalSinceNow:-&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.maxCacheAge];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;built_in&quot;&gt;NSMutableDictionary&lt;/span&gt; *cacheFiles = [&lt;span class=&quot;built_in&quot;&gt;NSMutableDictionary&lt;/span&gt; dictionary];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;built_in&quot;&gt;NSUInteger&lt;/span&gt; currentCacheSize = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;// Enumerate all of the files in the cache directory.  This loop has two purposes:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;//&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;//  1. Removing files that are older than the expiration date.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;//  2. Storing file attributes for the size-based cleanup pass.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;built_in&quot;&gt;NSMutableArray&lt;/span&gt; *urlsToDelete = [[&lt;span class=&quot;built_in&quot;&gt;NSMutableArray&lt;/span&gt; alloc] init];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;built_in&quot;&gt;NSURL&lt;/span&gt; *fileURL &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; fileEnumerator) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;built_in&quot;&gt;NSDictionary&lt;/span&gt; *resourceValues = [fileURL resourceValuesForKeys:resourceKeys error:&lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;comment&quot;&gt;// Skip directories.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([resourceValues[&lt;span class=&quot;built_in&quot;&gt;NSURLIsDirectoryKey&lt;/span&gt;] boolValue]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;keyword&quot;&gt;continue&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;comment&quot;&gt;// Remove files that are older than the expiration date;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;built_in&quot;&gt;NSDate&lt;/span&gt; *modificationDate = resourceValues[&lt;span class=&quot;built_in&quot;&gt;NSURLContentModificationDateKey&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([[modificationDate laterDate:expirationDate] isEqualToDate:expirationDate]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              [urlsToDelete addObject:fileURL];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;keyword&quot;&gt;continue&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;comment&quot;&gt;// Store a reference to this file and account for its total size.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;built_in&quot;&gt;NSNumber&lt;/span&gt; *totalAllocatedSize = resourceValues[&lt;span class=&quot;built_in&quot;&gt;NSURLTotalFileAllocatedSizeKey&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          currentCacheSize += [totalAllocatedSize unsignedIntegerValue];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          [cacheFiles setObject:resourceValues forKey:fileURL];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;built_in&quot;&gt;NSURL&lt;/span&gt; *fileURL &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; urlsToDelete) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          [_fileManager removeItemAtURL:fileURL error:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;// If our remaining disk cache exceeds a configured maximum size, perform a second&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;// size-based cleanup pass.  We delete the oldest files first.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.maxCacheSize &amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; &amp;amp;&amp;amp; currentCacheSize &amp;gt; &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.maxCacheSize) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;comment&quot;&gt;// Target half of our maximum cache size for this cleanup pass.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;NSUInteger&lt;/span&gt; desiredCacheSize = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.maxCacheSize / &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// Sort the remaining cache files by their last modification time (oldest first).&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSArray&lt;/span&gt; *sortedFiles = [cacheFiles keysSortedByValueWithOptions:&lt;span class=&quot;built_in&quot;&gt;NSSortConcurrent&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                        usingComparator:^&lt;span class=&quot;built_in&quot;&gt;NSComparisonResult&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; obj1, &lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; obj2) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; [obj1[&lt;span class=&quot;built_in&quot;&gt;NSURLContentModificationDateKey&lt;/span&gt;] compare:obj2[&lt;span class=&quot;built_in&quot;&gt;NSURLContentModificationDateKey&lt;/span&gt;]];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                        &amp;#125;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// Delete files until we fall below our desired cache size.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;built_in&quot;&gt;NSURL&lt;/span&gt; *fileURL &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; sortedFiles) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([_fileManager removeItemAtURL:fileURL error:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;built_in&quot;&gt;NSDictionary&lt;/span&gt; *resourceValues = cacheFiles[fileURL];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;built_in&quot;&gt;NSNumber&lt;/span&gt; *totalAllocatedSize = resourceValues[&lt;span class=&quot;built_in&quot;&gt;NSURLTotalFileAllocatedSizeKey&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                currentCacheSize -= [totalAllocatedSize unsignedIntegerValue];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (currentCacheSize &amp;lt; desiredCacheSize) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (completionBlock) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;built_in&quot;&gt;dispatch_async&lt;/span&gt;(dispatch_get_main_queue(), ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              completionBlock();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;从上面我们可以看出当收到UIApplicationWillTerminateNotification时，SDImageCache将会使用ioQueue异步地清理磁盘缓存。&lt;/p&gt;
&lt;p&gt;清除过程的逻辑如下：&lt;/p&gt;
&lt;div style=&quot;color:#008B8B&quot;&gt;&lt;p&gt;&lt;br&gt;&lt;ul&gt;&lt;br&gt;&lt;li&gt;先清除已超过最大缓存时间的缓存文件（最大缓存时间默认为一星期）&lt;/li&gt;&lt;br&gt;&lt;li&gt;在第一轮清除的过程中保存文件属性，特别是缓存文件大小&lt;/li&gt;&lt;br&gt;&lt;li&gt;在第一轮清除后，如果设置了最大缓存并且保留下来的磁盘缓存文件仍然超过了配置的最大缓存，那么进行第二轮以大小为基础的清除。&lt;/li&gt;&lt;br&gt;&lt;li&gt;首先删除最老的文件，直到达到期望的总的缓存大小，即最大缓存的一半。&lt;/li&gt;&lt;br&gt;&lt;/ul&gt;&lt;br&gt;&lt;/p&gt;&lt;/div&gt;

&lt;h3 id=&quot;程序进入后台&quot;&gt;&lt;a href=&quot;#程序进入后台&quot; class=&quot;headerlink&quot; title=&quot;程序进入后台&quot;&gt;&lt;/a&gt;程序进入后台&lt;/h3&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)backgroundCleanDisk &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Class &lt;span class=&quot;built_in&quot;&gt;UIApplicationClass&lt;/span&gt; = &lt;span class=&quot;built_in&quot;&gt;NSClassFromString&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;UIApplication&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(!&lt;span class=&quot;built_in&quot;&gt;UIApplicationClass&lt;/span&gt; || ![&lt;span class=&quot;built_in&quot;&gt;UIApplicationClass&lt;/span&gt; respondsToSelector:&lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(sharedApplication)]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;UIApplication&lt;/span&gt; *application = [&lt;span class=&quot;built_in&quot;&gt;UIApplication&lt;/span&gt; performSelector:&lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(sharedApplication)];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    __block &lt;span class=&quot;built_in&quot;&gt;UIBackgroundTaskIdentifier&lt;/span&gt; bgTask = [application beginBackgroundTaskWithExpirationHandler:^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// Clean up any unfinished task business by marking where you&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// stopped or ending the task outright.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [application endBackgroundTask:bgTask];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        bgTask = &lt;span class=&quot;built_in&quot;&gt;UIBackgroundTaskInvalid&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;// Start the long-running task and return immediately.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; cleanDiskWithCompletionBlock:^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       [application endBackgroundTask:bgTask];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       bgTask = &lt;span class=&quot;built_in&quot;&gt;UIBackgroundTaskInvalid&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;当收到UIApplicationDidEnterBackgroundNotification时，在手机系统后台进行如上面描述的异步磁盘缓存清理。这里利用Objective－C的动态语言特性，得到UIApplication的单例sharedApplication，使用sharedApplication开启后台任务cleanDiskWithCompletionBlock:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://boilwater.github.io/2016/05/29/runtime理解/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;runtime的详解&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;查询图片&quot;&gt;&lt;a href=&quot;#查询图片&quot; class=&quot;headerlink&quot; title=&quot;查询图片&quot;&gt;&lt;/a&gt;查询图片&lt;/h3&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;NSOperation&lt;/span&gt; *)queryDiskCacheForKey:(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)key done:(SDWebImageQueryCompletedBlock)doneBlock &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!doneBlock) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!key) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       doneBlock(&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;, SDImageCacheTypeNone);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;// First check the in-memory cache...&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;UIImage&lt;/span&gt; *image = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; imageFromMemoryCacheForKey:key];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (image) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       doneBlock(image, SDImageCacheTypeMemory);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;NSOperation&lt;/span&gt; *operation = [&lt;span class=&quot;built_in&quot;&gt;NSOperation&lt;/span&gt; new];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;dispatch_async&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.ioQueue, ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (operation.isCancelled) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;@autoreleasepool&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           &lt;span class=&quot;built_in&quot;&gt;UIImage&lt;/span&gt; *diskImage = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; diskImageForKey:key];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (diskImage &amp;amp;&amp;amp; &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.shouldCacheImagesInMemory) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;               &lt;span class=&quot;built_in&quot;&gt;NSUInteger&lt;/span&gt; cost = SDCacheCostForImage(diskImage);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;               [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.memCache setObject:diskImage forKey:key cost:cost];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           &lt;span class=&quot;built_in&quot;&gt;dispatch_async&lt;/span&gt;(dispatch_get_main_queue(), ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;               doneBlock(diskImage, SDImageCacheTypeDisk);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; operation;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;查询缓存，默认使用方法queryDiskCacheForKey:done:，如果此方法返回nil，则说明缓存中现在还没有这张照片，因此你需要得到并缓存这张图片。缓存key是缓存图片的程序唯一的标识符，一般使用图片的完整URL。&lt;/p&gt;
&lt;p&gt;如果不想SDImageCache查询磁盘缓存，你可以调用另一个方法：imageFromMemoryCacheForKey:。&lt;/p&gt;
&lt;p&gt;返回值为NSOpration，单独使用SDImageCache没用，但是使用SDWebImageManager就可以对多个任务的优先级、依赖，并且可以取消。&lt;/p&gt;
&lt;p&gt;自定义@autoreleasepool，autoreleasepool代码段里面有大量的内存消耗操作，自定义autoreleasepool可以及时地释放掉内存。&lt;br&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)cachePathForKey:(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)key inPath:(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)path &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *filename = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; cachedFileNameForKey:key];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; [path stringByAppendingPathComponent:filename];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)defaultCachePathForKey:(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)key &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; cachePathForKey:key inPath:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.diskCachePath];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#pragma mark SDImageCache (private)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)cachedFileNameForKey:(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)key &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; *str = [key UTF8String];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (str == &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        str = &lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; r[CC_MD5_DIGEST_LENGTH];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    CC_MD5(str, (CC_LONG)strlen(str), r);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *filename = [&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; stringWithFormat:&lt;span class=&quot;string&quot;&gt;@&quot;%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%@&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                          r[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;], r[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;], r[&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;], r[&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;], r[&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;], r[&lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;], r[&lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;], r[&lt;span class=&quot;number&quot;&gt;7&lt;/span&gt;], r[&lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;], r[&lt;span class=&quot;number&quot;&gt;9&lt;/span&gt;], r[&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                          r[&lt;span class=&quot;number&quot;&gt;11&lt;/span&gt;], r[&lt;span class=&quot;number&quot;&gt;12&lt;/span&gt;], r[&lt;span class=&quot;number&quot;&gt;13&lt;/span&gt;], r[&lt;span class=&quot;number&quot;&gt;14&lt;/span&gt;], r[&lt;span class=&quot;number&quot;&gt;15&lt;/span&gt;], [[key pathExtension] isEqualToString:&lt;span class=&quot;string&quot;&gt;@&quot;&quot;&lt;/span&gt;] ? &lt;span class=&quot;string&quot;&gt;@&quot;&quot;&lt;/span&gt; : [&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; stringWithFormat:&lt;span class=&quot;string&quot;&gt;@&quot;.%@&quot;&lt;/span&gt;, [key pathExtension]]];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; filename;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;NSData&lt;/span&gt; *)diskImageDataBySearchingAllPathsForKey:(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)key &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *defaultPath = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; defaultCachePathForKey:key];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSData&lt;/span&gt; *data = [&lt;span class=&quot;built_in&quot;&gt;NSData&lt;/span&gt; dataWithContentsOfFile:defaultPath];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (data) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; data;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// fallback because of https://github.com/rs/SDWebImage/pull/976 that added the extension to the disk file name&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// checking the key with and without the extension&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    data = [&lt;span class=&quot;built_in&quot;&gt;NSData&lt;/span&gt; dataWithContentsOfFile:[defaultPath stringByDeletingPathExtension]];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (data) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; data;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSArray&lt;/span&gt; *customPaths = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.customPaths &lt;span class=&quot;keyword&quot;&gt;copy&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *path &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; customPaths) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *filePath = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; cachePathForKey:key inPath:path];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSData&lt;/span&gt; *imageData = [&lt;span class=&quot;built_in&quot;&gt;NSData&lt;/span&gt; dataWithContentsOfFile:filePath];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (imageData) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; imageData;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// fallback because of https://github.com/rs/SDWebImage/pull/976 that added the extension to the disk file name&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// checking the key with and without the extension&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        imageData = [&lt;span class=&quot;built_in&quot;&gt;NSData&lt;/span&gt; dataWithContentsOfFile:[filePath stringByDeletingPathExtension]];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (imageData) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; imageData;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;div style=&quot;color:#008B8B&quot;&gt;&lt;p&gt;&lt;br&gt;上面代码段是从磁盘获取图片的代码。得到图片对应的UIData后，还要经过如下步骤，才能返回对应的图片：&lt;br&gt;&lt;ul&gt;&lt;br&gt;&lt;li&gt;根据图片的不同种类，生成对应的UIImage&lt;/li&gt;&lt;br&gt;&lt;li&gt;根据key值，调整image的scale值&lt;/li&gt;&lt;br&gt;&lt;li&gt;如果设置图片需要解压缩，则还需对UIImage进行解码&lt;/li&gt;&lt;br&gt;&lt;/ul&gt;&lt;br&gt;&lt;/p&gt;&lt;/div&gt;

&lt;h3 id=&quot;下面是MD5的加密方式&quot;&gt;&lt;a href=&quot;#下面是MD5的加密方式&quot; class=&quot;headerlink&quot; title=&quot;下面是MD5的加密方式&quot;&gt;&lt;/a&gt;下面是MD5的加密方式&lt;/h3&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)cachedFileNameForKey:(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)key &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; *str = [key UTF8String];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (str == &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        str = &lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; r[CC_MD5_DIGEST_LENGTH];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    CC_MD5(str, (CC_LONG)strlen(str), r);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *filename = [&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; stringWithFormat:&lt;span class=&quot;string&quot;&gt;@&quot;%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%@&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                          r[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;], r[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;], r[&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;], r[&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;], r[&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;], r[&lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;], r[&lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;], r[&lt;span class=&quot;number&quot;&gt;7&lt;/span&gt;], r[&lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;], r[&lt;span class=&quot;number&quot;&gt;9&lt;/span&gt;], r[&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                          r[&lt;span class=&quot;number&quot;&gt;11&lt;/span&gt;], r[&lt;span class=&quot;number&quot;&gt;12&lt;/span&gt;], r[&lt;span class=&quot;number&quot;&gt;13&lt;/span&gt;], r[&lt;span class=&quot;number&quot;&gt;14&lt;/span&gt;], r[&lt;span class=&quot;number&quot;&gt;15&lt;/span&gt;], [[key pathExtension] isEqualToString:&lt;span class=&quot;string&quot;&gt;@&quot;&quot;&lt;/span&gt;] ? &lt;span class=&quot;string&quot;&gt;@&quot;&quot;&lt;/span&gt; : [&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; stringWithFormat:&lt;span class=&quot;string&quot;&gt;@&quot;.%@&quot;&lt;/span&gt;, [key pathExtension]]];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; filename;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;图片的保存&quot;&gt;&lt;a href=&quot;#图片的保存&quot; class=&quot;headerlink&quot; title=&quot;图片的保存&quot;&gt;&lt;/a&gt;图片的保存&lt;/h3&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)storeImage:(&lt;span class=&quot;built_in&quot;&gt;UIImage&lt;/span&gt; *)image recalculateFromImage:(&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)recalculate imageData:(&lt;span class=&quot;built_in&quot;&gt;NSData&lt;/span&gt; *)imageData forKey:(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)key toDisk:(&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)toDisk &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!image || !key) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// if memory cache is enabled&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.shouldCacheImagesInMemory) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSUInteger&lt;/span&gt; cost = SDCacheCostForImage(image);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.memCache setObject:image forKey:key cost:cost];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (toDisk) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;dispatch_async&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.ioQueue, ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;NSData&lt;/span&gt; *data = imageData;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (image &amp;amp;&amp;amp; (recalculate || !data)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#if TARGET_OS_IPHONE&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;// We need to determine if the image is a PNG or a JPEG&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;// PNGs are easier to detect because they have a unique signature (http://www.w3.org/TR/PNG-Structure.html)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;// The first eight bytes of a PNG file always contain the following (decimal) values:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;// 137 80 78 71 13 10 26 10&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;// If the imageData is nil (i.e. if trying to save a UIImage directly or the image was transformed on download)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;// and the image has an alpha channel, we will consider it PNG to avoid losing the transparency&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; alphaInfo = &lt;span class=&quot;built_in&quot;&gt;CGImageGetAlphaInfo&lt;/span&gt;(image.CGImage);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; hasAlpha = !(alphaInfo == kCGImageAlphaNone ||&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                  alphaInfo == kCGImageAlphaNoneSkipFirst ||&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                  alphaInfo == kCGImageAlphaNoneSkipLast);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; imageIsPng = hasAlpha;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;// But if we have an image data, we will look at the preffix&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([imageData length] &amp;gt;= [kPNGSignatureData length]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    imageIsPng = ImageDataHasPNGPreffix(imageData);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (imageIsPng) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    data = &lt;span class=&quot;built_in&quot;&gt;UIImagePNGRepresentation&lt;/span&gt;(image);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    data = &lt;span class=&quot;built_in&quot;&gt;UIImageJPEGRepresentation&lt;/span&gt;(image, (&lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt;)&lt;span class=&quot;number&quot;&gt;1.0&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#else&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                data = [&lt;span class=&quot;built_in&quot;&gt;NSBitmapImageRep&lt;/span&gt; representationOfImageRepsInArray:image.representations usingType: &lt;span class=&quot;built_in&quot;&gt;NSJPEGFileType&lt;/span&gt; properties:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#endif&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (data) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (![_fileManager fileExistsAtPath:_diskCachePath]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    [_fileManager createDirectoryAtPath:_diskCachePath withIntermediateDirectories:&lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt; attributes:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt; error:&lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;// get cache Path for image key&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *cachePathForKey = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; defaultCachePathForKey:key];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;// transform to NSUrl&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;built_in&quot;&gt;NSURL&lt;/span&gt; *fileURL = [&lt;span class=&quot;built_in&quot;&gt;NSURL&lt;/span&gt; fileURLWithPath:cachePathForKey];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                [_fileManager createFileAtPath:cachePathForKey contents:data attributes:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;// disable iCloud backup&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.shouldDisableiCloud) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    [fileURL setResourceValue:[&lt;span class=&quot;built_in&quot;&gt;NSNumber&lt;/span&gt; numberWithBool:&lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;] forKey:&lt;span class=&quot;built_in&quot;&gt;NSURLIsExcludedFromBackupKey&lt;/span&gt; error:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)storeImage:(&lt;span class=&quot;built_in&quot;&gt;UIImage&lt;/span&gt; *)image forKey:(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)key &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; storeImage:image recalculateFromImage:&lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt; imageData:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt; forKey:key toDisk:&lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)storeImage:(&lt;span class=&quot;built_in&quot;&gt;UIImage&lt;/span&gt; *)image forKey:(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)key toDisk:(&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)toDisk &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; storeImage:image recalculateFromImage:&lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt; imageData:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt; forKey:key toDisk:toDisk];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;存储一个图片到缓存中，可以使用方法storeImage:forKey:method:，默认，图片既会存储到内存缓存中，也会异步地保存到磁盘缓存中。如果只想使用内存缓存，可以使用另外一个方法storeImage:forKey:toDisk，第三个参数传入false值就好了。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;这篇文章我将接着节讲述关于SDWebImage图片下载后处理方式，缓存进行讲解。&lt;br&gt;&lt;/br&gt;&lt;br&gt;经过上面我们可以知道SDWebImage是可以从远程的服务器加载图片，然后在UIImageView上进行显示。但是你有想过SDWebImage到底是什么呢？&lt;/p&gt;
&lt;p&gt;在使用时我们知道需要导入包：UIImageView+WebCache.h我们可以根据这看出SDWebImage是一个UIImageView的分类，使用Category进行分装的类。下面列出SDWebImage可以实现的功能：&lt;/p&gt;
    
    </summary>
    
      <category term="第三方框架" scheme="http://yoursite.com/categories/%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="三方框架解析" scheme="http://yoursite.com/tags/%E4%B8%89%E6%96%B9%E6%A1%86%E6%9E%B6%E8%A7%A3%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>SDWebImage之图片下载</title>
    <link href="http://yoursite.com/2016/06/03/SDWebImage/"/>
    <id>http://yoursite.com/2016/06/03/SDWebImage/</id>
    <published>2016-06-03T13:23:21.000Z</published>
    <updated>2017-06-01T07:48:51.000Z</updated>
    
    <content type="html">&lt;p&gt;我们经常使用SDWebImage在加载图片，但对于图片加载过程中怎么样实现不会深究。下面我们就对SDWebImage进行相应的分析：&lt;br&gt;&lt;a href=&quot;https://github.com/rs/SDWebImage&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;源码地址&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;SDWebImage的下载器&quot;&gt;&lt;a href=&quot;#SDWebImage的下载器&quot; class=&quot;headerlink&quot; title=&quot;SDWebImage的下载器&quot;&gt;&lt;/a&gt;SDWebImage的下载器&lt;/h2&gt;&lt;p&gt;SDWebImage的下载器是SDWebImageDownloader利用单例模式sharedDownloader，可以对下载的图片进行相关配置。可以配置的部分如下：&lt;/p&gt;
&lt;ul&gt;&lt;br&gt;&lt;li&gt;下载选项&lt;/li&gt;&lt;br&gt;&lt;li&gt;HTTP的头部&lt;/li&gt;&lt;br&gt;&lt;li&gt;压缩、下载超时、下载顺序、最大并发数等&lt;/li&gt;&lt;br&gt;&lt;/ul&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h3 id=&quot;下载选项&quot;&gt;&lt;a href=&quot;#下载选项&quot; class=&quot;headerlink&quot; title=&quot;下载选项&quot;&gt;&lt;/a&gt;下载选项&lt;/h3&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;typedef&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;NS_OPTIONS&lt;/span&gt;(&lt;span class=&quot;built_in&quot;&gt;NSUInteger&lt;/span&gt;, SDWebImageDownloaderOptions) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;//下载的优先级&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   SDWebImageDownloaderLowPriority = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; &amp;lt;&amp;lt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;//下载进度&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   SDWebImageDownloaderProgressiveDownload = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; &amp;lt;&amp;lt; &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;//下载路径缓存&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   SDWebImageDownloaderUseNSURLCache = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; &amp;lt;&amp;lt; &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;//下载过程的请求缓存&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   SDWebImageDownloaderIgnoreCachedResponse = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; &amp;lt;&amp;lt; &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;//后台进行继续下载&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   SDWebImageDownloaderContinueInBackground = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; &amp;lt;&amp;lt; &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   SDWebImageDownloaderHandleCookies = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; &amp;lt;&amp;lt; &lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   SDWebImageDownloaderAllowInvalidSSLCertificates = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; &amp;lt;&amp;lt; &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   SDWebImageDownloaderHighPriority = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; &amp;lt;&amp;lt; &lt;span class=&quot;number&quot;&gt;7&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;HTTP的头部设置&quot;&gt;&lt;a href=&quot;#HTTP的头部设置&quot; class=&quot;headerlink&quot; title=&quot;HTTP的头部设置&quot;&gt;&lt;/a&gt;HTTP的头部设置&lt;/h3&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#ifdef SD_WEBP&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        _HTTPHeaders = [@&amp;#123;&lt;span class=&quot;string&quot;&gt;@&quot;Accept&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;@&quot;image/webp,image/*;q=0.8&quot;&lt;/span&gt;&amp;#125; mutableCopy];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#else&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        _HTTPHeaders = [@&amp;#123;&lt;span class=&quot;string&quot;&gt;@&quot;Accept&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;@&quot;image/*;q=0.8&quot;&lt;/span&gt;&amp;#125; mutableCopy];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#endif&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-(&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)setValue:(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)value forHTTPHeaderField:(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)field &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (value) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.HTTPHeaders[field] = value;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.HTTPHeaders removeObjectForKey:field];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)valueForHTTPHeaderField:(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)field &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.HTTPHeaders[field];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;我们可以通过上述forHTTPHeaderField的参数进行相应HTTPheader的设置，使用者可以对头部信息进行相关的添加或者是删除HTTP头部信息。&lt;/p&gt;
&lt;h3 id=&quot;线程安全&quot;&gt;&lt;a href=&quot;#线程安全&quot; class=&quot;headerlink&quot; title=&quot;线程安全&quot;&gt;&lt;/a&gt;线程安全&lt;/h3&gt;&lt;p&gt;在图片下载过程中我们要保线程访问的安全性，barrierQueue是实现网络响应的序列化实例。&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;// This queue is used to serialize the handling of the network responses of all&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;the download operation in a single queue&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@property (SDDispatchQueueSetterSementics, nonatomic) dispatch_queue_t barrierQueue;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;在保证线程安全的起见，我们对于URLCallbacks进行增改都需要放在dispatch_barrier_sync的形式放入到barrierQueue。但是如果我们只要进行相关的查询那就使用dispatch_sync放入barrierQueue中即可。&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;__block &lt;span class=&quot;built_in&quot;&gt;NSArray&lt;/span&gt; *callbacksForURL;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;dispatch_sync&lt;/span&gt;(sself.barrierQueue, ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    callbacksForURL = [sself.URLCallbacks[url] &lt;span class=&quot;keyword&quot;&gt;copy&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_barrier_sync(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.barrierQueue, ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; first = &lt;span class=&quot;literal&quot;&gt;NO&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.URLCallbacks[url]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.URLCallbacks[url] = [&lt;span class=&quot;built_in&quot;&gt;NSMutableArray&lt;/span&gt; new];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        first = &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// Handle single download of simultaneous download request for the same URL&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSMutableArray&lt;/span&gt; *callbacksForURL = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.URLCallbacks[url];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSMutableDictionary&lt;/span&gt; *callbacks = [&lt;span class=&quot;built_in&quot;&gt;NSMutableDictionary&lt;/span&gt; new];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (progressBlock) callbacks[kProgressCallbackKey] = [progressBlock &lt;span class=&quot;keyword&quot;&gt;copy&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (completedBlock) callbacks[kCompletedCallbackKey] = [completedBlock &lt;span class=&quot;keyword&quot;&gt;copy&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[callbacksForURL addObject:callbacks];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.URLCallbacks[url] = callbacksForURL;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (first) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      createCallback();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;回调&quot;&gt;&lt;a href=&quot;#回调&quot; class=&quot;headerlink&quot; title=&quot;回调&quot;&gt;&lt;/a&gt;回调&lt;/h3&gt;&lt;p&gt;在我们下载图片的过程中，每一张图片都需要开启一个线程，在每一个线程中都需要对执行一定的回调信息。这些回调的信息会以block的实行出现：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;typedef void(^SDWebImageDownloaderProgressBlock)(NSInteger receivedSize,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSInteger expectedSize);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;typedef void(^SDWebImageDownloaderCompletedBlock)(UIImage *image, NSData *data,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSError *error, BOOL finished);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;typedef NSDictionary *(^SDWebImageDownloaderHeadersFilterBlock)(NSURL *url, &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSDictionary *headers);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;br&gt;图片下载的这些回调信息存储在SDWebImageDownloader类的URLCallbacks属性中，该属性是一个字典，key是图片的URL地址，value则是一个数组，包含每个图片的多组回调信息。&lt;/p&gt;
&lt;h3 id=&quot;下载器&quot;&gt;&lt;a href=&quot;#下载器&quot; class=&quot;headerlink&quot; title=&quot;下载器&quot;&gt;&lt;/a&gt;下载器&lt;/h3&gt;&lt;p&gt;整个下载过程中我们需要执行在本小结讲述的下载器中进行，下载器对于下载的管理都是放在-(id &lt;sdwebimageoperation&gt;)downloadImageWithURL:中的：&lt;/sdwebimageoperation&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (id &amp;lt;SDWebImageOperation&amp;gt;)downloadImageWithURL:(NSURL *)url options:(SDWebImageDownloaderOptions)options progress:(SDWebImageDownloaderProgressBlock)progressBlock completed:(SDWebImageDownloaderCompletedBlock)completedBlock &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;__block SDWebImageDownloaderOperation *operation;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;__weak __typeof(self)wself = self;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[self addProgressCallback:progressBlock completedBlock:completedBlock forURL:url createCallback:^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        NSTimeInterval timeoutInterval = wself.downloadTimeout;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        if (timeoutInterval == 0.0) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            timeoutInterval = 15.0;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// In order to prevent from potential duplicate caching (NSURLCache + SDImageCache) we disable the cache for image requests if told otherwise&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSMutableURLRequest *request = [[NSMutableURLRequest alloc] initWithURL:url&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cachePolicy:(options &amp;amp; SDWebImageDownloaderUseNSURLCache ? &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSURLRequestUseProtocolCachePolicy : NSURLRequestReloadIgnoringLocalCacheData)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;timeoutInterval:timeoutInterval];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;request.HTTPShouldHandleCookies = (options &amp;amp; SDWebImageDownloaderHandleCookies);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;request.HTTPShouldUsePipelining = YES;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      if (wself.headersFilter) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          request.allHTTPHeaderFields = wself.headersFilter(url, [wself.HTTPHeaders copy]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      else &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          request.allHTTPHeaderFields = wself.HTTPHeaders;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      operation = [[wself.operationClass alloc] initWithRequest:request&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                        options:options&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                       progress:^(NSInteger receivedSize, NSInteger expectedSize) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                           SDWebImageDownloader *sself = wself;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                           if (!sself) return;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                           __block NSArray *callbacksForURL;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                           dispatch_sync(sself.barrierQueue, ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                               callbacksForURL = [sself.URLCallbacks[url] copy];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                           &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                           for (NSDictionary *callbacks in callbacksForURL) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                               dispatch_async(dispatch_get_main_queue(), ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                                   SDWebImageDownloaderProgressBlock callback = callbacks[kProgressCallbackKey];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                                   if (callback) callback(receivedSize, expectedSize);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                               &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                           &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                       &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                      completed:^(UIImage *image, NSData *data, NSError *error, BOOL finished) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                          SDWebImageDownloader *sself = wself;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                          if (!sself) return;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                          __block NSArray *callbacksForURL;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                          dispatch_barrier_sync(sself.barrierQueue, ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                              callbacksForURL = [sself.URLCallbacks[url] copy];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                              if (finished) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                                  [sself.URLCallbacks removeObjectForKey:url];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                              &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                          &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                          for (NSDictionary *callbacks in callbacksForURL) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                              SDWebImageDownloaderCompletedBlock callback = callbacks[kCompletedCallbackKey];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                              if (callback) callback(image, data, error, finished);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                          &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                      cancelled:^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                          SDWebImageDownloader *sself = wself;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                          if (!sself) return;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                          dispatch_barrier_async(sself.barrierQueue, ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                              [sself.URLCallbacks removeObjectForKey:url];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                          &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                      &amp;#125;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      operation.shouldDecompressImages = wself.shouldDecompressImages;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      if (wself.urlCredential) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          operation.credential = wself.urlCredential;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125; else if (wself.username &amp;amp;&amp;amp; wself.password) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          operation.credential = [NSURLCredential credentialWithUser:wself.username password:wself.password persistence:NSURLCredentialPersistenceForSession];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      if (options &amp;amp; SDWebImageDownloaderHighPriority) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          operation.queuePriority = NSOperationQueuePriorityHigh;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125; else if (options &amp;amp; SDWebImageDownloaderLowPriority) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          operation.queuePriority = NSOperationQueuePriorityLow;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      [wself.downloadQueue addOperation:operation];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      if (wself.executionOrder == SDWebImageDownloaderLIFOExecutionOrder) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          // Emulate LIFO execution order by systematically adding new operations as last operation&amp;apos;s dependency&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          [wself.lastAddedOperation addDependency:operation];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          wself.lastAddedOperation = operation;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  return operation;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;我们在上面的方法中调用的方法(void)addProgressCallback:completedBlock:forURL:createCallback:将在访问图片请求的信息直接放入下载器。&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)addProgressCallback:(SDWebImageDownloaderProgressBlock)progressBlock completedBlock:(SDWebImageDownloaderCompletedBlock)completedBlock forURL:(&lt;span class=&quot;built_in&quot;&gt;NSURL&lt;/span&gt;*)url createCallback:(SDWebImageNoParamsBlock)createCallback &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// The URL will be used as the key to the callbacks dictionary so it cannot be nil. If it is nil immediately call the completed block with no image or data.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (url == &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (completedBlock != &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            completedBlock(&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;, &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;, &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;, &lt;span class=&quot;literal&quot;&gt;NO&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_barrier_sync(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.barrierQueue, ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; first = &lt;span class=&quot;literal&quot;&gt;NO&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.URLCallbacks[url]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.URLCallbacks[url] = [&lt;span class=&quot;built_in&quot;&gt;NSMutableArray&lt;/span&gt; new];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       first = &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;// Handle single download of simultaneous download request for the same URL&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;NSMutableArray&lt;/span&gt; *callbacksForURL = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.URLCallbacks[url];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;NSMutableDictionary&lt;/span&gt; *callbacks = [&lt;span class=&quot;built_in&quot;&gt;NSMutableDictionary&lt;/span&gt; new];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (progressBlock) callbacks[kProgressCallbackKey] = [progressBlock &lt;span class=&quot;keyword&quot;&gt;copy&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (completedBlock) callbacks[kCompletedCallbackKey] = [completedBlock &lt;span class=&quot;keyword&quot;&gt;copy&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   [callbacksForURL addObject:callbacks];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.URLCallbacks[url] = callbacksForURL;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (first) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       createCallback();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;下载操作&quot;&gt;&lt;a href=&quot;#下载操作&quot; class=&quot;headerlink&quot; title=&quot;下载操作&quot;&gt;&lt;/a&gt;下载操作&lt;/h3&gt;&lt;p&gt;在每张图片下载过程中都要调用一次具体的操作都会调用Operation，下面就分析一下中间的具体过程。&lt;br&gt;我们打开SDWebImage的文件夹可以到其中有一个SDWebImageOperation的类，如下：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;#import &amp;lt;Foundation/Foundation.h&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@protocol SDWebImageOperation &amp;lt;NSObject&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (void)cancel;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@end&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;br&gt;其中我们使用NSOpation的子类来完成具体图片下载的过程，这个类就是SDWebImageDownloaderOperation。在SDWebImageDownloaderOperation类中继承NSOperation的类而且实现SDWebImageOperation的cancel的取消协议。除了继承而来的方法，该类只向外暴露了一个方法，即上面所用到的初始化方法initWithRequest:options:pregress:completed:cancelled:。&lt;/p&gt;
&lt;p&gt;对于图片的下载，SDWebImageDownloaderOperation完全依赖于URL加载系统中的NSURLConnection类（并未使用iOS7以后的NSURLSession类）。我们先来分析一下SDWebImageDownloaderOperation类中对于图片实际数据的下载处理，即NSURLConnection各代理方法的实现。&lt;/p&gt;
&lt;p&gt;首先，SDWebImageDownloaderOperation在Extention中采用了NSURLConnectionDataDelegate协议，并实现了协议的以下几个方法：&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;connection:didReceiveResponse:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;connection:didReceiveData:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;connectionDidFinishLoading:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;connection:didFailWithError:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;connection:willCacheResponse:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;connectionShouldUseCredentialStorage:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;connection:willSendRequestForAuthenticationChallenge:&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这些方法我们就不逐一分析了，就终点分析一下connection:didReceiveResponse:和connection:didReceiveData:两个方法。&lt;/p&gt;
&lt;p&gt;connection:didReceiveResponse方法通过判断NSURLResponse的实际类型和状态码，对除304以外400以内的状态码反应。&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)connection:(&lt;span class=&quot;built_in&quot;&gt;NSURLConnection&lt;/span&gt; *)connection didReceiveResponse:(&lt;span class=&quot;built_in&quot;&gt;NSURLResponse&lt;/span&gt; *)response &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;comment&quot;&gt;//&#39;304 Not Modified&#39; is an exceptional one&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (![response respondsToSelector:&lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(statusCode)] ||([((&lt;span class=&quot;built_in&quot;&gt;NSHTTPURLResponse&lt;/span&gt; *)response) statusCode] &amp;lt; &lt;span class=&quot;number&quot;&gt;400&lt;/span&gt; &amp;amp;&amp;amp; [((&lt;span class=&quot;built_in&quot;&gt;NSHTTPURLResponse&lt;/span&gt;  *)response) statusCode] != &lt;span class=&quot;number&quot;&gt;304&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt; expected = response.expectedContentLength &amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; ? (&lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      response.expectedContentLength : &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.expectedSize = expected;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.progressBlock) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.progressBlock(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, expected);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.imageData = [[&lt;span class=&quot;built_in&quot;&gt;NSMutableData&lt;/span&gt; alloc] initWithCapacity:expected];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.response = response;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;dispatch_async&lt;/span&gt;(dispatch_get_main_queue(), ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      [[&lt;span class=&quot;built_in&quot;&gt;NSNotificationCenter&lt;/span&gt; defaultCenter] postNotificationName:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      SDWebImageDownloadReceiveResponseNotification object:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;NSUInteger&lt;/span&gt; code = [((&lt;span class=&quot;built_in&quot;&gt;NSHTTPURLResponse&lt;/span&gt; *)response) statusCode];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;//This is the case when server returns &#39;304 Not Modified&#39;. It means that &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   remote image is not changed.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;//In case of 304 we need just cancel the operation and return cached image       &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   from the cache.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (code == &lt;span class=&quot;number&quot;&gt;304&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; cancelInternal];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.connection cancel];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;dispatch_async&lt;/span&gt;(dispatch_get_main_queue(), ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       [[&lt;span class=&quot;built_in&quot;&gt;NSNotificationCenter&lt;/span&gt; defaultCenter] postNotificationName:SDWebImageDownloadStopNotification object:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.completedBlock) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.completedBlock(&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;, &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;, [&lt;span class=&quot;built_in&quot;&gt;NSError&lt;/span&gt; errorWithDomain:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;built_in&quot;&gt;NSURLErrorDomain&lt;/span&gt; code:[((&lt;span class=&quot;built_in&quot;&gt;NSHTTPURLResponse&lt;/span&gt; *)response) statusCode] &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       userInfo:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;], &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;CFRunLoopStop&lt;/span&gt;(&lt;span class=&quot;built_in&quot;&gt;CFRunLoopGetCurrent&lt;/span&gt;());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; done];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;connection:didReceiveData:方法的主要任务是接受数据。每次接收到数据时，都会用现有的数据创建一个CGImageSourceRef对象以作处理。在首次获取到数据时（width+height==0）会从这些包含图像信息的数据中取出图像的长、宽、方向等信息以备使用。而后在图片下载完成之前，会使用CGImageSourceRef对象创建一个图像对象，经过缩放、解压缩操作后生成一个UIImage对象供完成回调使用。当然，在这个方法中还需要处理的就是进度信息。如果我们有设置进度回调的话，就调用进度回调以处理当前图片的下载进度。&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)connection:(&lt;span class=&quot;built_in&quot;&gt;NSURLConnection&lt;/span&gt; *)connection didReceiveData:(&lt;span class=&quot;built_in&quot;&gt;NSData&lt;/span&gt; *)data&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.imageData appendData:data];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ((&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.options &amp;amp; SDWebImageDownloaderProgressiveDownload) &amp;amp;&amp;amp; &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.expectedSize &amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; &amp;amp;&amp;amp; &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.completedBlock) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// The following code is from http://www.cocoaintheshell.com/2011/05/&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;progressive-images-download-imageio/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// Thanks to the author @Nyx0uf&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// Get the total bytes downloaded &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt; totalSize = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.imageData.length;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// Update the data source, we must pass ALL the data, not just the new bytes&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;built_in&quot;&gt;CGImageSourceRef&lt;/span&gt; imageSource = &lt;span class=&quot;built_in&quot;&gt;CGImageSourceCreateWithData&lt;/span&gt;((__bridge &lt;span class=&quot;built_in&quot;&gt;CFDataRef&lt;/span&gt;)&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.imageData, &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (width + height == &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;CFDictionaryRef&lt;/span&gt; properties = &lt;span class=&quot;built_in&quot;&gt;CGImageSourceCopyPropertiesAtIndex&lt;/span&gt;(imageSource, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (properties) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt; orientationValue = &lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;built_in&quot;&gt;CFTypeRef&lt;/span&gt; val = &lt;span class=&quot;built_in&quot;&gt;CFDictionaryGetValue&lt;/span&gt;(properties, kCGImagePropertyPixelHeight);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (val) &lt;span class=&quot;built_in&quot;&gt;CFNumberGetValue&lt;/span&gt;(val, kCFNumberLongType, &amp;amp;height);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                val = &lt;span class=&quot;built_in&quot;&gt;CFDictionaryGetValue&lt;/span&gt;(properties, kCGImagePropertyPixelWidth);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (val) &lt;span class=&quot;built_in&quot;&gt;CFNumberGetValue&lt;/span&gt;(val, kCFNumberLongType, &amp;amp;width);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                val = &lt;span class=&quot;built_in&quot;&gt;CFDictionaryGetValue&lt;/span&gt;(properties, kCGImagePropertyOrientation);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (val) &lt;span class=&quot;built_in&quot;&gt;CFNumberGetValue&lt;/span&gt;(val, kCFNumberNSIntegerType, &amp;amp;orientationValue);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;built_in&quot;&gt;CFRelease&lt;/span&gt;(properties);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// When we draw to Core Graphics, we lose orientation information,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// which means the image below born of initWithCGIImage will be&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// oriented incorrectly sometimes. (Unlike the image born of initWithData&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// in connectionDidFinishLoading.) So save it here and pass it on later.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                orientation = [[&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; class] orientationFromPropertyValue:(orientationValue == &lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt; ? &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; : orientationValue)];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (width + height &amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; &amp;amp;&amp;amp; totalSize &amp;lt; &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.expectedSize) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// Create the image&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;CGImageRef&lt;/span&gt; partialImageRef = &lt;span class=&quot;built_in&quot;&gt;CGImageSourceCreateImageAtIndex&lt;/span&gt;(imageSource, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#ifdef TARGET_OS_IPHONE&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// Workaround for iOS anamorphic image&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (partialImageRef) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; size_t partialHeight = &lt;span class=&quot;built_in&quot;&gt;CGImageGetHeight&lt;/span&gt;(partialImageRef);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;built_in&quot;&gt;CGColorSpaceRef&lt;/span&gt; colorSpace = &lt;span class=&quot;built_in&quot;&gt;CGColorSpaceCreateDeviceRGB&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;built_in&quot;&gt;CGContextRef&lt;/span&gt; bmContext = &lt;span class=&quot;built_in&quot;&gt;CGBitmapContextCreate&lt;/span&gt;(&lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;, width, height, &lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;, width * &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;, colorSpace, kCGBitmapByteOrderDefault | kCGImageAlphaPremultipliedFirst);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;built_in&quot;&gt;CGColorSpaceRelease&lt;/span&gt;(colorSpace);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (bmContext) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;built_in&quot;&gt;CGContextDrawImage&lt;/span&gt;(bmContext, (&lt;span class=&quot;built_in&quot;&gt;CGRect&lt;/span&gt;)&amp;#123;.origin.x = &lt;span class=&quot;number&quot;&gt;0.0&lt;/span&gt;f, .origin.y = &lt;span class=&quot;number&quot;&gt;0.0&lt;/span&gt;f, .size.width = width, .size.height = partialHeight&amp;#125;, partialImageRef);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;built_in&quot;&gt;CGImageRelease&lt;/span&gt;(partialImageRef);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    partialImageRef = &lt;span class=&quot;built_in&quot;&gt;CGBitmapContextCreateImage&lt;/span&gt;(bmContext);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;built_in&quot;&gt;CGContextRelease&lt;/span&gt;(bmContext);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;built_in&quot;&gt;CGImageRelease&lt;/span&gt;(partialImageRef);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    partialImageRef = &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#endif&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (partialImageRef) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;built_in&quot;&gt;UIImage&lt;/span&gt; *image = [&lt;span class=&quot;built_in&quot;&gt;UIImage&lt;/span&gt; imageWithCGImage:partialImageRef scale:&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; orientation:orientation];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *key = [[SDWebImageManager sharedManager] cacheKeyForURL:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.request.URL];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;built_in&quot;&gt;UIImage&lt;/span&gt; *scaledImage = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; scaledImageForKey:key image:image];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.shouldDecompressImages) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    image = [&lt;span class=&quot;built_in&quot;&gt;UIImage&lt;/span&gt; decodedImageWithImage:scaledImage];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    image = scaledImage;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;built_in&quot;&gt;CGImageRelease&lt;/span&gt;(partialImageRef);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                dispatch_main_sync_safe(^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.completedBlock) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.completedBlock(image, &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;, &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;, &lt;span class=&quot;literal&quot;&gt;NO&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;CFRelease&lt;/span&gt;(imageSource);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.progressBlock) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.progressBlock(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.imageData.length, &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.expectedSize);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;我们前面说过SDWebImageDownloaderOperation类是继承自NSOperation类。它没有简单的实现main方法，而是采用更加灵活的start方法，以便自己管理下载的状态。&lt;/p&gt;
&lt;p&gt;在start方法中，创建了我们下载所使用的NSURLConnection对象，开启了图片的下载，同时抛出一个下载开始的通知。start方法的具体实现如下：&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)start &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;@synchronized&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.isCancelled) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.finished = &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; reset];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#if TARGET_OS_IPHONE &amp;amp;&amp;amp; __IPHONE_OS_VERSION_MAX_ALLOWED &amp;gt;= __IPHONE_4_0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Class &lt;span class=&quot;built_in&quot;&gt;UIApplicationClass&lt;/span&gt; = &lt;span class=&quot;built_in&quot;&gt;NSClassFromString&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;UIApplication&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; hasApplication = &lt;span class=&quot;built_in&quot;&gt;UIApplicationClass&lt;/span&gt; &amp;amp;&amp;amp; [&lt;span class=&quot;built_in&quot;&gt;UIApplicationClass&lt;/span&gt; respondsToSelector:&lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(sharedApplication)];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (hasApplication &amp;amp;&amp;amp; [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; shouldContinueWhenAppEntersBackground]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            __&lt;span class=&quot;keyword&quot;&gt;weak&lt;/span&gt; __typeof__ (&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;) wself = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;UIApplication&lt;/span&gt; * app = [&lt;span class=&quot;built_in&quot;&gt;UIApplicationClass&lt;/span&gt; performSelector:&lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(sharedApplication)];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.backgroundTaskId = [app beginBackgroundTaskWithExpirationHandler:^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                __&lt;span class=&quot;keyword&quot;&gt;strong&lt;/span&gt; __&lt;span class=&quot;keyword&quot;&gt;typeof&lt;/span&gt; (wself) sself = wself;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (sself) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    [sself cancel];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    [app endBackgroundTask:sself.backgroundTaskId];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    sself.backgroundTaskId = &lt;span class=&quot;built_in&quot;&gt;UIBackgroundTaskInvalid&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#endif&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.executing = &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.connection = [[&lt;span class=&quot;built_in&quot;&gt;NSURLConnection&lt;/span&gt; alloc] initWithRequest:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.request delegate:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; startImmediately:&lt;span class=&quot;literal&quot;&gt;NO&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.thread = [&lt;span class=&quot;built_in&quot;&gt;NSThread&lt;/span&gt; currentThread];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.connection start];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.connection) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.progressBlock) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.progressBlock(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;NSURLResponseUnknownLength&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;dispatch_async&lt;/span&gt;(dispatch_get_main_queue(), ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            [[&lt;span class=&quot;built_in&quot;&gt;NSNotificationCenter&lt;/span&gt; defaultCenter] postNotificationName:SDWebImageDownloadStartNotification object:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (floor(&lt;span class=&quot;built_in&quot;&gt;NSFoundationVersionNumber&lt;/span&gt;) &amp;lt;= &lt;span class=&quot;built_in&quot;&gt;NSFoundationVersionNumber_iOS_5_1&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// Make sure to run the runloop in our background thread so it can process downloaded data&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// Note: we use a timeout to work around an issue with NSURLConnection cancel under iOS 5&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;//       not waking up the runloop, leading to dead threads (see https://github.com/rs/SDWebImage/issues/466)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;CFRunLoopRunInMode&lt;/span&gt;(kCFRunLoopDefaultMode, &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;, &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;CFRunLoopRun&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.isFinished) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.connection cancel];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; connection:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.connection didFailWithError:[&lt;span class=&quot;built_in&quot;&gt;NSError&lt;/span&gt; errorWithDomain:&lt;span class=&quot;built_in&quot;&gt;NSURLErrorDomain&lt;/span&gt; code:&lt;span class=&quot;built_in&quot;&gt;NSURLErrorTimedOut&lt;/span&gt; userInfo:@&amp;#123;&lt;span class=&quot;built_in&quot;&gt;NSURLErrorFailingURLErrorKey&lt;/span&gt; : &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.request.URL&amp;#125;]];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.completedBlock) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.completedBlock(&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;, &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;, [&lt;span class=&quot;built_in&quot;&gt;NSError&lt;/span&gt; errorWithDomain:&lt;span class=&quot;built_in&quot;&gt;NSURLErrorDomain&lt;/span&gt; code:&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; userInfo:@&amp;#123;&lt;span class=&quot;built_in&quot;&gt;NSLocalizedDescriptionKey&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;@&quot;Connection can&#39;t be initialized&quot;&lt;/span&gt;&amp;#125;], &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#if TARGET_OS_IPHONE &amp;amp;&amp;amp; __IPHONE_OS_VERSION_MAX_ALLOWED &amp;gt;= __IPHONE_4_0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Class &lt;span class=&quot;built_in&quot;&gt;UIApplicationClass&lt;/span&gt; = &lt;span class=&quot;built_in&quot;&gt;NSClassFromString&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;UIApplication&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(!&lt;span class=&quot;built_in&quot;&gt;UIApplicationClass&lt;/span&gt; || ![&lt;span class=&quot;built_in&quot;&gt;UIApplicationClass&lt;/span&gt; respondsToSelector:&lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(sharedApplication)]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.backgroundTaskId != &lt;span class=&quot;built_in&quot;&gt;UIBackgroundTaskInvalid&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;UIApplication&lt;/span&gt; * app = [&lt;span class=&quot;built_in&quot;&gt;UIApplication&lt;/span&gt; performSelector:&lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(sharedApplication)];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [app endBackgroundTask:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.backgroundTaskId];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.backgroundTaskId = &lt;span class=&quot;built_in&quot;&gt;UIBackgroundTaskInvalid&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#endif&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;在下载完后或者是下载失败后都会停止当前调用的runloop，清楚链接随后就抛出下载停止的消息。&lt;br&gt;如果下载成功，则会处理完整的图片数据，对其进行适当的缩放与解压缩操作，以提供给完成回调使用。具体可参考-connectionDidFinishLoading:与-connection:didFailWithError:的实现。&lt;/p&gt;
&lt;h3 id=&quot;总结&quot;&gt;&lt;a href=&quot;#总结&quot; class=&quot;headerlink&quot; title=&quot;总结&quot;&gt;&lt;/a&gt;总结&lt;/h3&gt;&lt;p&gt;我们在上面的介绍可以看出在下载图片的过程中，每次下载图片都会调用NSOperation的函数进行处理，每次数据实际实现是使用NSURLConnection。我们把具体实现的线程放置在队列中进行执行操作。如果下载成功，则会处理完整的图片数据，对其进行适当的缩放与解压缩操作，以提供给完成回调使用。具体可参考-connectionDidFinishLoading:与-connection:didFailWithError:的实现。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://boilwater.github.io/2016/06/04/SDWebImage之图片缓存分析/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;下一节我们将讲述如何对下载的图片进行缓存处理&lt;/a&gt;;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;我们经常使用SDWebImage在加载图片，但对于图片加载过程中怎么样实现不会深究。下面我们就对SDWebImage进行相应的分析：&lt;br&gt;&lt;a href=&quot;https://github.com/rs/SDWebImage&quot;&gt;源码地址&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;SDWebImage的下载器&quot;&gt;&lt;a href=&quot;#SDWebImage的下载器&quot; class=&quot;headerlink&quot; title=&quot;SDWebImage的下载器&quot;&gt;&lt;/a&gt;SDWebImage的下载器&lt;/h2&gt;&lt;p&gt;SDWebImage的下载器是SDWebImageDownloader利用单例模式sharedDownloader，可以对下载的图片进行相关配置。可以配置的部分如下：&lt;/p&gt;
&lt;ul&gt;&lt;br&gt;&lt;li&gt;下载选项&lt;/li&gt;&lt;br&gt;&lt;li&gt;HTTP的头部&lt;/li&gt;&lt;br&gt;&lt;li&gt;压缩、下载超时、下载顺序、最大并发数等&lt;/li&gt;&lt;br&gt;&lt;/ul&gt;
    
    </summary>
    
      <category term="第三方框架" scheme="http://yoursite.com/categories/%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="三方框架解析" scheme="http://yoursite.com/tags/%E4%B8%89%E6%96%B9%E6%A1%86%E6%9E%B6%E8%A7%A3%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>IOS面试&amp;自己理解&amp;详细资料库</title>
    <link href="http://yoursite.com/2016/06/02/IOS%E9%9D%A2%E8%AF%95%E6%A2%B3%E7%90%86&%E8%87%AA%E5%B7%B1%E7%90%86%E8%A7%A3&%E8%AF%A6%E7%BB%86%E8%B5%84%E6%96%99%E5%BA%93/"/>
    <id>http://yoursite.com/2016/06/02/IOS面试梳理&自己理解&详细资料库/</id>
    <published>2016-06-02T11:01:41.000Z</published>
    <updated>2017-06-01T07:44:41.000Z</updated>
    
    <content type="html">&lt;p&gt;开启关于IOS面试之路总结，说实话目前IOS开发真是太多很多情况下大家情况良莠不齐很难分辨。目前还是在广州，其实还是很开心的，因为这里有自己😍事物所在。&lt;/p&gt;
&lt;h3 id=&quot;OC的理解和特性&quot;&gt;&lt;a href=&quot;#OC的理解和特性&quot; class=&quot;headerlink&quot; title=&quot;OC的理解和特性&quot;&gt;&lt;/a&gt;OC的理解和特性&lt;/h3&gt;&lt;p&gt;作为开发者我们都知道语言的特性包括：面对对象，面向过程。Objc就是关于面对对象语言，也就包括面向对象的特点：封装、继承、多态。下面是对三者优点列表😉&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;ul&gt;&lt;br&gt;&lt;li&gt;封装：对于要处理的问题进行模块开发，好处有利于我们对于功能的拓展&lt;/li&gt;&lt;br&gt;&lt;li&gt;继承：通过继承实现对父类方法的实现，也可以在子类中重写父类方法&lt;/li&gt;&lt;br&gt;&lt;li&gt;多态：通过同名函数但是输入形式参数的种类，数目，类型不同实现具体函数功能不同（具体实现可以参照C&amp;amp;C++在编译后形式~想了解的可以自己查找）&lt;/li&gt;&lt;br&gt;&lt;/ul&gt;&lt;br&gt;Objc的动态特性：动态类型、动态加载、动态绑定。其实前面我们在runtime的理解过程中有所讲解。&lt;a href=&quot;http://boilwater.github.io/2016/05/29/runtime理解/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;参考地址&lt;/a&gt;&lt;br&gt;&lt;ul&gt;&lt;br&gt;&lt;li&gt;动态类型：在IOS中我们经常见到id类型，id类型指在Objc中动态类型。在实际应用中我们一般使用静态类型，静态类型：固定和可预知性。静态类型是强类型，动态类型是弱类型。例如：我们经常见到的protrcol委托协议就是采取@proerty(nonatomic, weak) id&lt;protrcol&gt; delegate&lt;/protrcol&gt;&lt;/li&gt;&lt;br&gt;&lt;li&gt;动态加载：基于动态类型，在某个实例对象被确定后，其类型便被确定了，该对象对应的属性和响应消息也被完全确定。&lt;/li&gt;&lt;br&gt;&lt;li&gt;动态绑定：是我们在适配机型加载过程中，动态实现图片的实现。例如，在Retina设备上加载@2x的图片。&lt;/li&gt;&lt;br&gt;&lt;/ul&gt;

&lt;h3 id=&quot;内存管理原则&quot;&gt;&lt;a href=&quot;#内存管理原则&quot; class=&quot;headerlink&quot; title=&quot;内存管理原则&quot;&gt;&lt;/a&gt;内存管理原则&lt;/h3&gt;&lt;ul&gt;&lt;br&gt;&lt;li&gt;IOS5.0之前：在IOS 5.0之前Objc内存管理试行谁创建，谁释放的原则。如果要对是初始化的类型进行alloc,retain,copy，就需要手动进行release进行释放。当计数为0时才会释放对应的初始化内存空间和指针，我们称为MRC时代。&lt;/li&gt;&lt;br&gt;&lt;li&gt;IOS 5.0之后：使用戏言IOS开发那就是一个字：爽。在ARC：自动计数模式开发程序，我们不用再手动释放申请的对象，程序开发过程终于见不到release,autorelease,retain语句。不过我们这是就该注意到strong和weak的细微区别。&lt;/li&gt;&lt;br&gt;&lt;/ul&gt;

&lt;hr&gt;
&lt;p&gt;strong &amp;amp; weak区别&lt;/p&gt;
&lt;ul&gt;&lt;br&gt;&lt;li&gt;strong:用来修饰强引用属性&lt;/li&gt;&lt;br&gt;&lt;li&gt;weak:用来修饰弱引用属性&lt;/li&gt;&lt;br&gt;&lt;/ul&gt;&lt;br&gt;strong &amp;amp; weak实现具体情况&lt;br&gt;&lt;ul&gt;&lt;br&gt;&lt;li&gt;我们知道strong的使用时强引用，使用强引用使我们在赋值时会使计数器+1；&lt;br&gt;&lt;br&gt;&lt;br&gt;释放时间：当指针指向新值或者指针不存在，指针不存在一般是在自动计数为0时指针会自动释放。&lt;/li&gt;&lt;br&gt;&lt;li&gt;weak是弱引用，悲剧的是弱引用是不会再计数+1的。不过这也使我们在使用时很方便，因为我们如果要防止block中发生循环引用的时候，可以在block外使用_weak进行修饰。&lt;br&gt;&lt;br&gt;&lt;br&gt;释放时间：对象的拥有者指向新值或者不存在时weak修饰的指针会自动置为nil。&lt;br&gt;&lt;br&gt;&lt;br&gt;weak的实现原理：在每一个类中都有一个弱引用的列表，在释放时都会对列表进行访问。如果找到相应的对象就执行释放。&lt;br&gt;&lt;br&gt;&lt;br&gt;Strong：是通过ARC的自动计数来实现对于对象的释放。&lt;br&gt;&lt;/li&gt;&lt;br&gt;&lt;/ul&gt;

&lt;hr&gt;
&lt;p&gt;&lt;a href=&quot;http://blog.csdn.net/leikezhu1981/article/details/42697977&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;参考资料&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;&lt;br&gt;&lt;li&gt;在想一个对象发送autorelease消息时，其实目标不会立即释放，会有一个具体的时间值。在autorelease调用的时候，会对其中的对象挨个发送release语句对于每个对象进行相应的释放。后面会对于autorelease进行专项讲解，不过这里可以给大牛资料，下文&lt;/li&gt;&lt;br&gt;&lt;li&gt;在ARC中我们不用手动向实例化对象发送release进行释放，但是在MRC中就需要我们对申请的对象进行手动释放对象。那么问题来啦，对象会立即释放吗？&lt;br&gt;&lt;br&gt;&lt;br&gt;记住一点在MRC也是对象有时也不会立即释放，需要当前对象的计数为0时才会使用dealloc进行对象中所有的内容。&lt;br&gt;&lt;/li&gt;&lt;br&gt;&lt;/ul&gt;&lt;br&gt;&lt;a href=&quot;http://www.cocoachina.com/ios/20150610/12093.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;AutoreleasePool大牛的资料&lt;/a&gt;&lt;br&gt;&lt;br&gt;#### 其他注意事项&lt;br&gt;&lt;br&gt;&lt;ul&gt;&lt;br&gt;&lt;li&gt;当一个对象被_strong指向时，该对象是不会被释放的。但是当对象在超出其作用区域时（在C++中局部变量在超出作用区域就会nil），此时指针也会被置为nil于此同时指针所指的内存空间也会被释放。&lt;br&gt;&lt;br&gt;&lt;br&gt;还有就是当试图控制器（ViewController）进行释放，其中的全局变量和局部变量都会被释放。也有意外就是实现循环引用，恭喜你好好修改下吧，因为这是个BUG。&lt;br&gt;&lt;/li&gt;&lt;br&gt;&lt;li&gt;局部变量：上面讲到的局部变量如果超出其范围就会置为nil&lt;/li&gt;&lt;br&gt;&lt;li&gt;在方法中对象创建，为啦使内存能够尽可能的减少可以使用autoreleasepool。使用方法：@autoreleasepool{};&lt;/li&gt;&lt;br&gt;&lt;li&gt;block中为了避免循环引用就会使用_weak进行修饰&lt;/li&gt;&lt;br&gt;&lt;li&gt;ARC不是万能的🔑：ARC是基于在Foundation之上进行的变量的管理，如果是CGtypeRef类型就无法进行管理。例如：CGImageRef的图片的信息&lt;/li&gt;&lt;br&gt;&lt;li&gt;同样我们可以实现ARC和非ARC之间的进行混合编译，具体操作如下：&lt;br&gt;&lt;br&gt;&lt;br&gt;在ARC中进行非ARC程序的混合编译：-fno-fobjc-arc;&lt;br&gt;&lt;br&gt;&lt;br&gt;在非ARC中进行ARC的混合编译：-fobjc-arc;&lt;br&gt;&lt;br&gt;&lt;br&gt;不过目前我们使用ARC较多，所以使用第一种的情形较多。swift毕竟也发布两年之久，很多创业公司已经开始使用swift&lt;br&gt;&lt;/li&gt;&lt;br&gt;&lt;/ul&gt;



&lt;h4 id=&quot;拓展介绍&quot;&gt;&lt;a href=&quot;#拓展介绍&quot; class=&quot;headerlink&quot; title=&quot;拓展介绍&quot;&gt;&lt;/a&gt;拓展介绍&lt;/h4&gt;&lt;hr&gt;
&lt;ul&gt;&lt;br&gt;&lt;li&gt;nonatomic:原子操作，禁止多线程进行操作&lt;/li&gt;&lt;br&gt;&lt;li&gt;atomic:原子操作，多线程安全是property的默认操作基本类型&lt;/li&gt;&lt;br&gt;&lt;li&gt;assign:表示设置器可以直接进行复制，基本用于基本数据类型（NSInteger,CGFloat）和C语言的基本数据类型（int,float,double,char）&lt;/li&gt;&lt;br&gt;&lt;li&gt;readwrite:可以进行读写&lt;/li&gt;&lt;br&gt;&lt;li&gt;readonly:进行只读&lt;/li&gt;&lt;br&gt;&lt;li&gt;copy:在赋值过程中传入一份值得copy，地址和内容都会重新赋值&lt;/li&gt;&lt;br&gt;&lt;li&gt;retain:在赋值过程中会使用retain对象，指向内容的指针会copy&lt;/li&gt;&lt;br&gt;&lt;/ul&gt;

&lt;hr&gt;
&lt;p&gt;&lt;a href=&quot;http://blog.csdn.net/Mars2639/article/details/7352540&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;详细内容参考地址&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;设计模式&quot;&gt;&lt;a href=&quot;#设计模式&quot; class=&quot;headerlink&quot; title=&quot;设计模式&quot;&gt;&lt;/a&gt;设计模式&lt;/h3&gt;&lt;p&gt;开发过程中我们都会使用到设计模式，这里就以两种设计模式进行举例：&lt;/p&gt;
&lt;h4 id=&quot;MVC设计模式&quot;&gt;&lt;a href=&quot;#MVC设计模式&quot; class=&quot;headerlink&quot; title=&quot;MVC设计模式&quot;&gt;&lt;/a&gt;MVC设计模式&lt;/h4&gt;&lt;p&gt;MVC是一种架构模式，M表示MOdel，V表示视图View，C表示控制器Controller：&lt;br&gt;其实重要的还是需要自己动手亲自实现，这样可以锻炼自己的编码能力。&lt;br&gt;&lt;a href=&quot;http://www.cocoachina.com/design/20130917/7009.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;资料点击&lt;/a&gt;。&lt;/p&gt;
&lt;ul&gt;&lt;br&gt;&lt;li&gt;Model负责存储、定义、操作数据；&lt;/li&gt;&lt;br&gt;&lt;li&gt;View用来展示书给用户，和用户进行操作交互；&lt;/li&gt;&lt;br&gt;&lt;li&gt;Controller是Model和View的协调者，Controller把Model中的数据拿过来给View用。Controller可以直接与Model和View进行通信，而View不能和Controller直接通信。View与Controller通信需要利用代理协议的方式，当有数据更新时，MOdel也要与Controller进行通信，这个时候就要用Notification和KVO，这个方式就像一个广播一样，MOdel发信号，Controller设置监听接受信号，当有数据更新时就发信号给Controller，Model和View不能直接进行通信，这样会违背MVC设计模式。&lt;/li&gt;&lt;br&gt;&lt;/ul&gt;

&lt;h4 id=&quot;MVVM设计模式&quot;&gt;&lt;a href=&quot;#MVVM设计模式&quot; class=&quot;headerlink&quot; title=&quot;MVVM设计模式&quot;&gt;&lt;/a&gt;MVVM设计模式&lt;/h4&gt;&lt;p&gt;这里关于MVVM的设计模式就不多说，因为目前还没有使用过。&lt;br&gt;&lt;br&gt;&lt;a href=&quot;http://www.cocoachina.com/ios/20160301/15425.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;MVVM参考资料地址&lt;/a&gt;&lt;br&gt;&lt;br&gt;&lt;a href=&quot;http://www.cocoachina.com/ios/20160517/16309.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;MVVM升级到MVVMM&lt;/a&gt;&lt;br&gt;&lt;br&gt;&lt;a href=&quot;http://www.cocoachina.com/ios/20160330/15823.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;MVVM With ReactiveCocoa&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;Objc中的协议&quot;&gt;&lt;a href=&quot;#Objc中的协议&quot; class=&quot;headerlink&quot; title=&quot;Objc中的协议&quot;&gt;&lt;/a&gt;Objc中的协议&lt;/h3&gt;&lt;p&gt;我们在IOS开发过程中我们经常会使用协议和代理模式来进行消息传递，协议一般是伴随着代理产生而产生。我们在实现协议的同时一般都会有代理形式进行完成。&lt;br&gt;协议中有两个属性：&lt;/p&gt;
&lt;ul&gt;&lt;br&gt;&lt;li&gt;@required:是表明此中的方法一定要实现，在我们使用UITableViewDataSourceDelete就有两个必须实现的方法&lt;/li&gt;&lt;br&gt;&lt;li&gt;@optional:方法可以根据自己选着实现方法&lt;/li&gt;&lt;br&gt;&lt;/ul&gt;&lt;br&gt;在博客中有关于protrcol的相关使用&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;a href=&quot;http://boilwater.github.io/2016/05/29/block，注册监听，委托协议和KVO/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;参考地址&lt;/a&gt;&lt;br&gt;&lt;br&gt;### Category的优缺点&lt;br&gt;我们使用Category一般是在一个现有类中定向添加方法，其实我们使用常见的SDWebImage本质就是一个类的类目：UIImageView&lt;br&gt;优点：&lt;br&gt;&lt;ul&gt;&lt;br&gt;&lt;li&gt;我们在一个现有类中可以增加方法，于此同时我们又不需要改变原来对象的属性。增加方法和原来方法使用是一样的&lt;/li&gt;&lt;br&gt;&lt;li&gt;在多方法的使用过程中我们可以通过使用Category实现对类进行区分，达到方便管理类种方法的原则&lt;/li&gt;&lt;br&gt;&lt;/ul&gt;

&lt;p&gt;缺点：&lt;/p&gt;
&lt;ul&gt;&lt;br&gt;&lt;li&gt;Category允许我们对类进行添加特定方法，但是我们不能向类中添加成员变量。但是我们可以继承类在子类中进行相关成员属性添加&lt;/li&gt;&lt;br&gt;&lt;li&gt;在增加方法的过程中，我们增加方法的优先级别比较高因此会覆盖父类中的方法。例如：在界面我们相应手指触摸时有响应链，如果在子类中调用touch方法没有调用父类就会使响应者连中断&lt;/li&gt;&lt;br&gt;&lt;/ul&gt;

&lt;p&gt;&lt;a href=&quot;http://www.cocoachina.com/ios/20120614/4361.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Objective-C Category初体验&lt;/a&gt;&lt;br&gt; &lt;br&gt;&lt;br&gt;&lt;a href=&quot;http://www.cocoachina.com/ios/20140212/7808.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Objective-C相关Category的收集&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;键路径-keyPath-、键值编码（KVC）和键值观察（KVO）&quot;&gt;&lt;a href=&quot;#键路径-keyPath-、键值编码（KVC）和键值观察（KVO）&quot; class=&quot;headerlink&quot; title=&quot;键路径(keyPath)、键值编码（KVC）和键值观察（KVO）&quot;&gt;&lt;/a&gt;键路径(keyPath)、键值编码（KVC）和键值观察（KVO）&lt;/h3&gt;&lt;p&gt;在我的博客中有所讲述，在这里就不赘述啦。不过这里给大家留一个问题？为什么使用KVC（Key-value-coding）在效率不是很高？&lt;br&gt;&lt;br&gt;&lt;a href=&quot;http://boilwater.github.io/2016/05/29/block%EF%BC%8C%E6%B3%A8%E5%86%8C%E7%9B%91%E5%90%AC%EF%BC%8C%E5%A7%94%E6%89%98%E5%8D%8F%E8%AE%AE%E5%92%8CKVO/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;参考路径&lt;/a&gt;&lt;br&gt;其他参考资料：&lt;br&gt;&lt;br&gt;&lt;a href=&quot;http://www.cocoachina.com/ios/20160408/15868.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;谈KVC、KVO（重点观察者模式）机制编程&lt;/a&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;a href=&quot;http://www.cocoachina.com/ios/20140224/7866.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;iOS KVC &amp;amp; KVO&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;NSNotification、Block、Delegate和KVO的区别&quot;&gt;&lt;a href=&quot;#NSNotification、Block、Delegate和KVO的区别&quot; class=&quot;headerlink&quot; title=&quot;NSNotification、Block、Delegate和KVO的区别&quot;&gt;&lt;/a&gt;NSNotification、Block、Delegate和KVO的区别&lt;/h3&gt;&lt;p&gt;博客中有详细介绍&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;a href=&quot;http://boilwater.github.io/2016/05/29/block%EF%BC%8C%E6%B3%A8%E5%86%8C%E7%9B%91%E5%90%AC%EF%BC%8C%E5%A7%94%E6%89%98%E5%8D%8F%E8%AE%AE%E5%92%8CKVO/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;详细参看&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;Objective-C中可修改和不可以修改类型&quot;&gt;&lt;a href=&quot;#Objective-C中可修改和不可以修改类型&quot; class=&quot;headerlink&quot; title=&quot;Objective-C中可修改和不可以修改类型&quot;&gt;&lt;/a&gt;Objective-C中可修改和不可以修改类型&lt;/h3&gt;&lt;p&gt;可修改和不可修改的集合类，我们在IOS开发过程中经常会遇到NSArray和NSMutableArray两种，两者的区别：&lt;/p&gt;
&lt;ul&gt;&lt;br&gt;&lt;li&gt;一个是可以动态添加，一个不可以动态添加&lt;/li&gt;&lt;br&gt;&lt;li&gt;前者初始化后内存是固定不边的，后者经过初始化内存是可以发生改变的&lt;/li&gt;&lt;br&gt;&lt;/ul&gt;

&lt;hr&gt;
&lt;p&gt;这里我就引出一个概念：非容器对象和容器对象。&lt;/p&gt;
&lt;ul&gt;&lt;br&gt;&lt;li&gt;非容器对象：NSNumber，NSSting等只能放单个字符或者数字&lt;/li&gt;&lt;br&gt;&lt;li&gt;容器对象：NSArray，NSDictionary等可以放置多个数据类型&lt;/li&gt;&lt;br&gt;&lt;/ul&gt;&lt;br&gt;但是在我们熟悉的copy过程中会发生哪些情况呢？&lt;br&gt;&lt;br&gt;这里又提出另外的cop的新概念：copy, mutableCopy&lt;br&gt;&lt;ul&gt;&lt;br&gt;&lt;li&gt;copy：复制了一个imutable的对象+ copyWithZone:&lt;/li&gt;&lt;br&gt;&lt;li&gt;mutableCopy：复制的是一个mutable的对象，使用的方法+ mutableCopyWithZone:&lt;/li&gt;&lt;br&gt;&lt;/ul&gt;&lt;br&gt;下面我们给出在非容器对象复制后的具体情况&lt;br&gt;&lt;br&gt;非容器对象     | 不变类（NSString） |  可变类（NSMustbleString）&lt;br&gt;———— | ——————| ————&lt;br&gt;copy         | 浅Copy            | 深Copy~返回的对象是不可变的对象&lt;br&gt;mutableCopy  | 深Copy            | 深Copy&lt;br&gt;&lt;br&gt;下面我们给出容器对象中复制的具体情况&lt;br&gt;&lt;br&gt;容器类型      | 不变类型（NSArray） | 可变类型（NSMutableArray）&lt;br&gt;———— | —————- | ————&lt;br&gt;copy         | 浅copy            | 深copy&lt;br&gt;mutableCopy  | 深copy            | 深copy&lt;br&gt;&lt;br&gt;&lt;div style=&quot;color:#008B8B&quot;&gt;&lt;br&gt;&lt;p&gt;但是在容器对象复制过程中我们需要记住一点，我们对于NSArray和NSMutable的copy是对于整体指针和内存来说。但是在容器内部每一个元素我们进行的都是指针copy,也就是我们所说的浅copy。&lt;/p&gt;&lt;br&gt;&lt;/div&gt;&lt;br&gt;从上面列举的例子我们可以得出一个结论：&lt;br&gt;&lt;ul&gt;&lt;br&gt;&lt;li&gt;无论是非容器类型还是容器类型只有在不可变时（NSArray，NSString）使用copy才是浅复制，也就是说只是复制指针而不复制内存。&lt;/li&gt;&lt;br&gt;&lt;li&gt;在可变的类型（NSMutableString, NSMutableArray）在使用copy时会生成不可变类型。&lt;/li&gt;&lt;br&gt;&lt;/ul&gt;&lt;br&gt;具体为什么实现这种原理可以看下在NSArray和NSMutable实现接口，以及参照C++的原理进行解释。&lt;br&gt;&lt;br&gt;—&lt;br&gt;&lt;br&gt;下面是参考资料：&lt;br&gt;&lt;br&gt;&lt;a href=&quot;http://www.fanliugen.com/?p=278&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;copy与mutableCopy&lt;/a&gt;&lt;br&gt;&lt;br&gt;&lt;a href=&quot;http://www.cnblogs.com/-Eric-Liu/p/5564030.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;NSArray与NSMutableArray的区别&lt;/a&gt;&lt;br&gt;&lt;br&gt;### 当我们调用一个静态方法时,需要对对象进行 release 吗?&lt;br&gt;&lt;br&gt;不要对静态方法进行释放，因为静态方法会放到自动释放池中，后面会自动释放。&lt;br&gt;&lt;br&gt;我在博客中写过关于Runtime的解析，在那里我们可以看出一个类在解析过程中其中类中调用方法是Method形式，放在Struct的Class中的。执行过程AutoReleasePool会进行管理。&lt;br&gt;&lt;br&gt;&lt;a href=&quot;http://www.cocoachina.com/ios/20150601/11970.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;深入理解RunLoop&lt;/a&gt;大神文章写得很详细&lt;br&gt;&lt;br&gt;### 当我们释放我们的对象时,为什么需要调用[super dealloc]方法,它的位置又是如何的呢?&lt;br&gt;&lt;br&gt;因为子类的某些实例是继承自父类的,因此需要调用[super dealloc]方法, 来释放父类拥有的实例,其实也就是子类本身的。一般来说我们优先释放子类拥 有的实例,最后释放父类所拥有的实例。&lt;br&gt;&lt;br&gt;### static、self、super关键字的作用&lt;br&gt;&lt;br&gt;static 是在C和C++中经常使用的，在Objc中我们也是常常使用static来定义cell的identifer目前就想到这些。下面给出static的具体作用：&lt;br&gt;&lt;ul&gt;&lt;br&gt;&lt;li&gt;static修饰的变量只是在第一次调用过程进行初始化，所以在第二次调用时会维持上一次的值&lt;/li&gt;&lt;br&gt;&lt;li&gt;在模块内我们使用的static变量可以在模块中所有函数使用，但是在模块外就不可以进行访问&lt;/li&gt;&lt;br&gt;&lt;li&gt;在模块内的static的函数只能被模块内的函数进行调用，不能被模块外的其他函数声明&lt;/li&gt;&lt;br&gt;&lt;li&gt;在类中的satic的全局变量，在整个类中有且仅仅只有一份的copy&lt;/li&gt;&lt;br&gt;&lt;/ul&gt;&lt;br&gt;self: 是我们在当前类消息的接受者&lt;br&gt;&lt;br&gt;super: 是我们调用父类的方法，消息链过程中我们在touch调用super就是调用父类方法，防止消息链中断。&lt;br&gt;&lt;br&gt;### #include与#import的区别，#import 与@class 的区别&lt;br&gt;&lt;br&gt;&lt;ul&gt;&lt;br&gt;&lt;li&gt;#include是我们在C/C++经常使用到的引入到文件的方式&lt;/li&gt;&lt;br&gt;&lt;li&gt;#import是我们在Objc中使用引入头文件的方式，可以防止头文件被多次引用（如果头文件被多次应用，程序在编译过程中会把库函数编译到类中这样就占用较多内存）&lt;/li&gt;&lt;br&gt;&lt;br&gt;#import和@class两者之间的区别&lt;br&gt;&lt;li&gt;@class是只是定义类名，对其中的行为并不知道，我们经常可以再很多类的.h文件可以看到&lt;/li&gt;&lt;br&gt;&lt;li&gt;@class由于仅仅是定义类的名字，所以在编译过程要比import的效率高&lt;/li&gt;&lt;br&gt;&lt;li&gt;此外@class 和#import 的主要区别在于解决引用死锁的问题&lt;/li&gt;&lt;br&gt;&lt;/ul&gt;&lt;br&gt;&lt;a href=&quot;http://www.cnblogs.com/stevenschen/p/3825044.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;参考资料点击&lt;/a&gt;&lt;br&gt;&lt;br&gt;### @public、@protected、@private 它们的含义与作用&lt;br&gt;&lt;br&gt;&lt;ul&gt;&lt;br&gt;&lt;li&gt;@public:对象的实例变量的作用域在任意地方都可以被访问&lt;/li&gt;&lt;br&gt;&lt;li&gt;@protected:对象的实例变量作用域在本类和子类都可以被访问&lt;/li&gt;&lt;br&gt;&lt;li&gt;@private:实例变量的作用域只能在本类(自身)中访问 &lt;/li&gt;&lt;br&gt;&lt;/ul&gt;

&lt;h3 id=&quot;解释-id-类型&quot;&gt;&lt;a href=&quot;#解释-id-类型&quot; class=&quot;headerlink&quot; title=&quot;解释 id 类型&quot;&gt;&lt;/a&gt;解释 id 类型&lt;/h3&gt;&lt;p&gt;任意类型对象，程序运行时才决定对象的类型。 这也是我们在上面解释的动态类型。&lt;/p&gt;
&lt;h3 id=&quot;switch-语句-if-语句区别与联系&quot;&gt;&lt;a href=&quot;#switch-语句-if-语句区别与联系&quot; class=&quot;headerlink&quot; title=&quot;switch 语句 if 语句区别与联系&quot;&gt;&lt;/a&gt;switch 语句 if 语句区别与联系&lt;/h3&gt;&lt;p&gt;两者均是判断语句。但是switch只可以判断整形，字符型，枚举类型；但是if并没有类型限制。&lt;/p&gt;
&lt;h3 id=&quot;isMemberOfClass-和-isKindOfClass-联系与区别&quot;&gt;&lt;a href=&quot;#isMemberOfClass-和-isKindOfClass-联系与区别&quot; class=&quot;headerlink&quot; title=&quot;isMemberOfClass 和 isKindOfClass 联系与区别&quot;&gt;&lt;/a&gt;isMemberOfClass 和 isKindOfClass 联系与区别&lt;/h3&gt;&lt;ul&gt;&lt;br&gt;&lt;li&gt;两者都可以判断一个对象是否是某个类的成员&lt;/li&gt;&lt;br&gt;&lt;li&gt;isKindOfClesss不紧可以判断对象是否是一个类的成员，也可以判断一个对象是否派生于类的类成员&lt;/li&gt;&lt;br&gt;&lt;li&gt;举例：如 ClassA派 生 自NSObject 类 , ClassA *a = [ClassA alloc] init];,[a isKindOfClass:[NSObject class]] 可以检查出 a 是否是 NSObject派生类 的成员,但 isMemberOfClass 做不到&lt;/li&gt;&lt;br&gt;&lt;/ul&gt;

&lt;h3 id=&quot;iOS-开发中数据持久性有哪几种&quot;&gt;&lt;a href=&quot;#iOS-开发中数据持久性有哪几种&quot; class=&quot;headerlink&quot; title=&quot;iOS 开发中数据持久性有哪几种?&quot;&gt;&lt;/a&gt;iOS 开发中数据持久性有哪几种?&lt;/h3&gt;&lt;p&gt;&lt;a href=&quot;http://boilwater.github.io/2016/05/29/IOS%E7%9A%84%E6%B0%B8%E4%B9%85%E8%AF%9D%E5%82%A8%E5%AD%98/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;参考资料~IOS的永久话储存&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;自动释放池工作原理&quot;&gt;&lt;a href=&quot;#自动释放池工作原理&quot; class=&quot;headerlink&quot; title=&quot;自动释放池工作原理&quot;&gt;&lt;/a&gt;自动释放池工作原理&lt;/h3&gt;&lt;p&gt;&lt;a href=&quot;http://www.cocoachina.com/ios/20160602/16569.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;自动释放池的前世今生&lt;/a&gt;&lt;br&gt;&lt;br&gt;&lt;a href=&quot;http://www.cocoachina.com/ios/20150610/12093.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Objective-C Autorelease Pool 的实现原理&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;开启关于IOS面试之路总结，说实话目前IOS开发真是太多很多情况下大家情况良莠不齐很难分辨。目前还是在广州，其实还是很开心的，因为这里有自己😍事物所在。&lt;/p&gt;
&lt;h3 id=&quot;OC的理解和特性&quot;&gt;&lt;a href=&quot;#OC的理解和特性&quot; class=&quot;headerlink&quot; title=&quot;OC的理解和特性&quot;&gt;&lt;/a&gt;OC的理解和特性&lt;/h3&gt;&lt;p&gt;作为开发者我们都知道语言的特性包括：面对对象，面向过程。Objc就是关于面对对象语言，也就包括面向对象的特点：封装、继承、多态。下面是对三者优点列表😉&lt;/p&gt;
    
    </summary>
    
      <category term="IOS" scheme="http://yoursite.com/categories/IOS/"/>
    
    
      <category term="IOS基础知识" scheme="http://yoursite.com/tags/IOS%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
    
  </entry>
  
  <entry>
    <title>runtime理解</title>
    <link href="http://yoursite.com/2016/05/29/runtime%E7%90%86%E8%A7%A3/"/>
    <id>http://yoursite.com/2016/05/29/runtime理解/</id>
    <published>2016-05-29T04:15:38.000Z</published>
    <updated>2017-06-01T07:48:51.000Z</updated>
    
    <content type="html">&lt;p&gt;网上其实有很多关于讲述runtime的学习资料，也是站在巨人肩上看的更远。写这篇文章也是对于其他人借鉴和翻阅源码，向源码寻求解释吧。&lt;br&gt;&lt;br&gt;无意间看到一份关于runtime的博客，感觉写的挺不错的就耐心的看下。看后发现自己对runtime的理解还是比较浅，就决定对自己博客进行重新修改。&lt;/p&gt;
&lt;div style=&quot;color:#008B8B&quot;&gt;&lt;br&gt;&lt;p&gt;随便在这里抛出一个问题：假如我们程序员自己是系统我们怎么执行程序呢？当然换个高级点的说法，如果我们是系统设计者我们想要runtime怎么运行？&lt;/p&gt;&lt;br&gt;&lt;/div&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;在介绍runtime之前我现在这里给大家梳理一下我们在Objc类中可能见到的内容：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;-成员变量、成员属性：&amp;lt;br&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-数据成员：&amp;lt;/br&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-协议实现：&amp;lt;/br&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;runtime简介&quot;&gt;&lt;a href=&quot;#runtime简介&quot; class=&quot;headerlink&quot; title=&quot;runtime简介&quot;&gt;&lt;/a&gt;runtime简介&lt;/h3&gt;&lt;p&gt;Objc被我们成为动态语言，换句话说就是把我们平时看到一些关键方法由编译连接推迟到运行时执行。Objc底层是基于C/C++的编译语言，在C/C++项目运行过程中链接、编译生成可执行文件。而Objc语言是在执行过程中进行编译源码，生成我们熟悉的C/C++后面最终生成机器可以识别的汇编语言。Objc中有三大自己特色：动态类型，动态绑定和动态加载。&lt;br&gt;&lt;br&gt;获runtime的源码点击&lt;a href=&quot;https://developer.apple.com/library/ios/documentation/Cocoa/Reference/ObjCRuntimeRef/index.html#//apple_ref/doc/uid/TP40001418&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;这里&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;这里我们主要探究runtime.h和message.h两个文件夹中一些使用方法。&lt;br&gt;下面列出runtime.h文件中代码：&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;typedef&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; objc_method *Method;  &lt;span class=&quot;comment&quot;&gt;//代表类定义当中的使用方法&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;typedef&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; objc_ivar *Ivar;  &lt;span class=&quot;comment&quot;&gt;//代表类定义中实例变量和属性&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;typedef&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; objc_category *Category; &lt;span class=&quot;comment&quot;&gt;//代表添加成员函数&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;typedef&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; objc_property *objc_property_t; &lt;span class=&quot;comment&quot;&gt;//声明的属性&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; objc_class &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Class isa;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;#if !__OBJC2__&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Class super_class                                        OBJC2_UNAVAILABLE;&lt;span class=&quot;comment&quot;&gt;//父类&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; *name                                         OBJC2_UNAVAILABLE;&lt;span class=&quot;comment&quot;&gt;//类名&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; version                                             OBJC2_UNAVAILABLE;&lt;span class=&quot;comment&quot;&gt;//类的版本信心，默认的情况下是0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; info                                                OBJC2_UNAVAILABLE;&lt;span class=&quot;comment&quot;&gt;//类信息&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; instance_size                                       OBJC2_UNAVAILABLE;&lt;span class=&quot;comment&quot;&gt;//类的实例变量的大小&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; objc_ivar_list *ivars                             OBJC2_UNAVAILABLE;&lt;span class=&quot;comment&quot;&gt;//类成员变量的列表&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; objc_method_list **methodLists                    OBJC2_UNAVAILABLE;&lt;span class=&quot;comment&quot;&gt;//类的方法列表&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; objc_cache *cache                                 OBJC2_UNAVAILABLE;&lt;span class=&quot;comment&quot;&gt;//方法缓存&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; objc_protocol_list *protocols                     OBJC2_UNAVAILABLE;&lt;span class=&quot;comment&quot;&gt;//类的协议列表&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;meta&quot;&gt;#endif&amp;#125; &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    OBJC2_UNAVAILABLE;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;看其中一种实现方式&quot;&gt;&lt;a href=&quot;#看其中一种实现方式&quot; class=&quot;headerlink&quot; title=&quot;看其中一种实现方式&quot;&gt;&lt;/a&gt;看其中一种实现方式&lt;/h3&gt;&lt;p&gt;其中我们就以类中struct objc_ivar_list *ivars ,为例来看是怎样实现&lt;br&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; objc_ivar_list &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; ivar_count                                           OBJC2_UNAVAILABLE;&lt;span class=&quot;comment&quot;&gt;//成员列表的数量&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#ifdef __LP64__&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; space                                                OBJC2_UNAVAILABLE;&lt;span class=&quot;comment&quot;&gt;//成员列表的空间&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#endif&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/* variable length structure */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; objc_ivar ivar_list[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]                            OBJC2_UNAVAILABLE;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;                                                            OBJC2_UNAVAILABLE;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;可以看出实例变量和属性是存放时一个struct的list的数组中，其中包括list的数目、所占空间和基本储存objc_ivar。&lt;br&gt;&lt;/p&gt;
&lt;p&gt;上面objc_ivar在runtime.h中形式：&lt;br&gt;typedef struct objc_ivar Ivar;&lt;br&gt;objc_ivar中实例变量储存方式：&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; objc_ivar &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; *ivar_name                       OBJC2_UNAVAILABLE;&lt;span class=&quot;comment&quot;&gt;//成员的名字&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; *ivar_type                       OBJC2_UNAVAILABLE;&lt;span class=&quot;comment&quot;&gt;//成员数据的类型&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; ivar_offset                      OBJC2_UNAVAILABLE;&lt;span class=&quot;comment&quot;&gt;//成员的偏移量&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;#indef _LP64_&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; space                             OBJC2_UNAVAILABLE;&lt;span class=&quot;comment&quot;&gt;//成员变量所占空间&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;#endif&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;从上面可以看出类的实例变量和属性经过runtime编译后是以struct的储存形式存在，并且单个实例变量保存其名字、类型、偏移量和储存空间。类中所有实例变量是以list类型进行储存。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;通过对runtime.h文件源码分析我们可以看出，在IOS程序运行过程中把我们类编译为C/C++形式。且编译过程是一个动态过程，所以我们可以通过此方式对我们程序进行动态操作&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;runtime动态操作&quot;&gt;&lt;a href=&quot;#runtime动态操作&quot; class=&quot;headerlink&quot; title=&quot;runtime动态操作&quot;&gt;&lt;/a&gt;runtime动态操作&lt;/h3&gt;&lt;ul&gt;在动态编译过程中无论是属性、实例变量、成员函数、类方法的均可以操作，一下就以比较简单的进行讲解&lt;br&gt;&lt;li&gt;获取类的对象名&lt;/li&gt;&lt;br&gt;&lt;li&gt;获取类中成实例变量和属性&lt;/li&gt;&lt;br&gt;&lt;li&gt;动态添加方法&lt;/li&gt;&lt;br&gt;&lt;/ul&gt;

&lt;h3 id=&quot;获取类的对象名&quot;&gt;&lt;a href=&quot;#获取类的对象名&quot; class=&quot;headerlink&quot; title=&quot;获取类的对象名&quot;&gt;&lt;/a&gt;获取类的对象名&lt;/h3&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; count = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Class *classes = objc_copyClassList(&amp;amp;count);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; count; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; *name = class_getName(classes[i]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;%s&quot;&lt;/span&gt;, name);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;打印出的内容可能出乎你的意料！&lt;/p&gt;
&lt;h3 id=&quot;获取类的实例变量和属性&quot;&gt;&lt;a href=&quot;#获取类的实例变量和属性&quot; class=&quot;headerlink&quot; title=&quot;获取类的实例变量和属性&quot;&gt;&lt;/a&gt;获取类的实例变量和属性&lt;/h3&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Class clazz = &lt;span class=&quot;built_in&quot;&gt;NSClassFromString&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;Graduater&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; count = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Ivar *var = class_copyIvarList(clazz, &amp;amp;count);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; count; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; *name = ivar_getName(var[i]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;%s&quot;&lt;/span&gt;, name);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;我定义一个毕业生类，然后就可以打印出其中的函数实例变量和属性（不多记得要引入&lt;objc runtime.h=&quot;&quot;&gt;的头文件）；&lt;/objc&gt;&lt;/p&gt;
&lt;h3 id=&quot;动态的添加方法&quot;&gt;&lt;a href=&quot;#动态的添加方法&quot; class=&quot;headerlink&quot; title=&quot;动态的添加方法&quot;&gt;&lt;/a&gt;动态的添加方法&lt;/h3&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#import &lt;span class=&quot;meta-string&quot;&gt;&amp;lt;objc/runtime.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; abc(&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;, SEL _cmd)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;%@hello&quot;&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@implementation&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Graduater&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+(&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)resolveInstanceMethod:(SEL)sel&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([&lt;span class=&quot;built_in&quot;&gt;NSStringFromSelector&lt;/span&gt;(sel) isEqualToString:&lt;span class=&quot;string&quot;&gt;@&quot;sihai&quot;&lt;/span&gt;]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        class_addMethod(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;, sel, abc, &lt;span class=&quot;string&quot;&gt;&quot;v@:&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然后在函数调用时执行下列：&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Graduater *graduate = [[Graduater alloc] init];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[graduate performSelector:&lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(sihai) withObject:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;执行的结果可以条用我们添加的@select(abc)的方法。&lt;/p&gt;
&lt;h3 id=&quot;runtime使用API的介绍：&quot;&gt;&lt;a href=&quot;#runtime使用API的介绍：&quot; class=&quot;headerlink&quot; title=&quot;runtime使用API的介绍：&quot;&gt;&lt;/a&gt;runtime使用API的介绍：&lt;/h3&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; * class_getName(Class cls) &lt;span class=&quot;comment&quot;&gt;//获取class的名字&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; class_addIvar(Class cls, &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; *name, size_t size, uint8_t alignment, &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; *types)  &lt;span class=&quot;comment&quot;&gt;//增添实例变量&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;objc_property_t  class_getProperty(Class cls, &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; *name) &lt;span class=&quot;comment&quot;&gt;//获取属性&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;objc_property_t * class_copyPropertyList(Class cls, &lt;span class=&quot;keyword&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; *outCount) &lt;span class=&quot;comment&quot;&gt;//获取属性列表&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Method class_getInstanceMethod(Class aClass, SEL aSelector) &lt;span class=&quot;comment&quot;&gt;//获取方法&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;objc_allocateClassPair(Class superclass, &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; *name, size_t extraBytes) &lt;span class=&quot;comment&quot;&gt;//添加动态类&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;除去上面我们列举其中极少数的调用实例，如果想了解更多点击&lt;a href=&quot;https://developer.apple.com/library/ios/documentation/Cocoa/Reference/ObjCRuntimeRef/index.html#//apple_ref/doc/uid/TP40001418-CH1g-211911&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;这里&lt;/a&gt;。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;在使用runtime过程，对于操作对象实行方法改善&lt;br&gt;对于对象进行相关操作一般以objc&lt;em&gt;开头&lt;br&gt;对于类的对象进行操作一般以class&lt;/em&gt;开头&lt;br&gt;对于使用方法对象操作一般以method&lt;em&gt;开头&lt;br&gt;对于使用申明属性（property）一般是以property&lt;/em&gt;开头&lt;br&gt;对于使用类成员变量一般使用ivar_开头&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;消息传送机制&quot;&gt;&lt;a href=&quot;#消息传送机制&quot; class=&quot;headerlink&quot; title=&quot;消息传送机制&quot;&gt;&lt;/a&gt;消息传送机制&lt;/h3&gt;&lt;p&gt;在IOS的一个类中我们调用方法使用也是比较多，如&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; method];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;但是在runtime编译过程中具体实现的方式是什么呢？&lt;br&gt;首先我们看先message.h中的源码&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/* Basic Messaging Primitives&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * On some architectures, use objc_msgSend_stret for some struct return types.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * On some architectures, use objc_msgSend_fpret for some float return types.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * These functions must be cast to an appropriate function pointer type &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * before being called. */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;OBJC_EXPORT &lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; objc_msgSend(&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;, SEL op, ...);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;OBJC_EXPORT &lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; objc_msgSendSuper(&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; objc_super *&lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;, SEL op, ...);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;从上面的解释我们可以的出如果返回类型为float调用objc_msgSend_fpret，如果是数据结构返回使用objc_msgSend_stret。而我们讲解时使用 objc_msgSend(id self, SEL op, …)，就像我们上面的例子就会转化为objc_msgSend(self @select(method))，但是找到我们所使用的方法具体是怎么实现的？&lt;/p&gt;
&lt;div style=&quot;color:#008B8B&quot;&gt;&lt;br&gt;&lt;p&gt;在此地方我就将添加上面看到的关于objc_msgSend,objc_msgSendSuper,SEL&lt;/p&gt;&lt;br&gt;&lt;/div&gt;

&lt;hr&gt;
&lt;p&gt;数据类型：&lt;br&gt;（1）SEL:&lt;br&gt;     SEL又叫做选择器，表示一个@selector的指针，映射方法的名字。在Objc编译的过程中通过每个方法的名字和参数是生成的唯一的标示（此标示是int的类型），我们把这个标示称作为SEL。&lt;br&gt;&lt;br&gt;     SEl的作用是作为IMP（关于IMP的具体说明会在下面展示）的key存在，存储在NSSet的中，这样可以方便我们使用hash的快速查找。SEL使我们查找IMP（指向实现函数的指针）key，如果SEL可以相同的话我们调用函数就会发生错误。所以SEL是不可以重复的，方法也是不可以重复的。这也就是我们在Objc开发过程中在同一个类中不可以使用同名的函数~~~此处和C++支持重载有很大区别。&lt;br&gt;&lt;br&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;typedef&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; objc_selector *SEL;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;br&gt;虽说在runtime.h中没有显示objc_selector结构体类型，但是作为程序员的我们可以找到方法进行验证，使用log打印SEL试下？&lt;br&gt;&lt;br&gt;（2）IMP:&lt;br&gt;      IMP上面讲到IMP把SEL作为key值，IMP说白啦就是指向我们方法的指针，也就是我们条用具体函数方法的入口。&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;figcaption&gt;&lt;span&gt;lang: objc&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;typedefine id (*IMP)(id, SEL, ...)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;（3）Method&lt;br&gt;       Method:上面我们在类的Struct的结构中可以看出Method是放置我们使用的方法，也是我们使用SEL和IMP的一个具体的绑定。通过使用SEL来找到对应的IMP进而实现我们方法的具体调用。下面看代码：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;figcaption&gt;&lt;span&gt;lang: objc&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;typedef struct objc_method *Method;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;struct objc_method &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    SEL method_name                 OBJC2_UNAVAILABLE;  // 方法名&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    char *method_types                  OBJC2_UNAVAILABLE; // 参数类型&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    IMP method_imp                      OBJC2_UNAVAILABLE;  // 方法实现&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;下面我们看下在类中方法具体实现的形式：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;figcaption&gt;&lt;span&gt;lang: objc&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;struct objc_method_list &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    struct objc_method_list *obsolete                        OBJC2_UNAVAILABLE;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    int method_count                                                 OBJC2_UNAVAILABLE;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#ifdef __LP64__&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    int space                                                              OBJC2_UNAVAILABLE;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#endif&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    /* variable length structure */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    struct objc_method method_list[1]                        OBJC2_UNAVAILABLE;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;（4）方法缓存&lt;br&gt;我们在调用方法的过程其实是Lazy调用的过程，方法在第一次调用加载后会放到缓存池中。objc程序启动后，需要进行类的初始化、调用方法时的cache初始化，再发送消息的时候就直接走缓存。&lt;br&gt;&lt;br&gt;下面我会对方法缓存做详细的解释。&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; objc_cache &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// 缓存bucket的总数&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; mask &lt;span class=&quot;comment&quot;&gt;/* total = mask + 1 */&lt;/span&gt;                 OBJC2_UNAVAILABLE;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// 实际缓存bucket的总数&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; occupied                                    OBJC2_UNAVAILABLE;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// 指向Method数据结构指针的数组&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Method buckets[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]                                        OBJC2_UNAVAILABLE;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;hr&gt;
&lt;h3 id=&quot;消息转发机制具体实现&quot;&gt;&lt;a href=&quot;#消息转发机制具体实现&quot; class=&quot;headerlink&quot; title=&quot;消息转发机制具体实现&quot;&gt;&lt;/a&gt;消息转发机制具体实现&lt;/h3&gt;&lt;p&gt;在动态添加方法过程中，我们使用如下方式：&lt;/p&gt;
&lt;h3 id=&quot;1动态解析方法&quot;&gt;&lt;a href=&quot;#1动态解析方法&quot; class=&quot;headerlink&quot; title=&quot;1动态解析方法&quot;&gt;&lt;/a&gt;1动态解析方法&lt;/h3&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;+(&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)resolveInstanceMethod:(SEL)sel;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;具体实例如下：&lt;br&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;+(&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)resolveInstanceMethod:(SEL)sel&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([&lt;span class=&quot;built_in&quot;&gt;NSStringFromSelector&lt;/span&gt;(sel) isEqualToString:&lt;span class=&quot;string&quot;&gt;@&quot;sihai&quot;&lt;/span&gt;])&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   class_addMethod(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;, sel, abc, &lt;span class=&quot;string&quot;&gt;&quot;v@:&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;NO&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;从这里我们就可以看出在函数调用过程中runtime会根据SEl识别子进行寻找，在例子中我们有相应的识别可以查询，如果没有相应的识别子呢？&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;在系统中如果在查找过程中没有找到相应的选择子，就会调用上面的函数&lt;br&gt;+(BOOL)resolveInstanceMethod:(SEL)sel；生成实例方法，如上面例子（添加相应的实例方法可以实现，就跳转方法实现）。把添加方法放入到缓存中，可以供我们进行下次的调用&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;如果上面我们找到相应的识别子，就会进行第二次对选择子进行相关的处理。&lt;/p&gt;
&lt;h3 id=&quot;2备援接收到&quot;&gt;&lt;a href=&quot;#2备援接收到&quot; class=&quot;headerlink&quot; title=&quot;2备援接收到&quot;&gt;&lt;/a&gt;2备援接收到&lt;/h3&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;-(&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;)forwardingTargetForSelector:(SEL)aSelector;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;具体实例如下：&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-(&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;)forwardingTargetForSelector:(SEL)aSelector&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([&lt;span class=&quot;built_in&quot;&gt;NSStringFromSelector&lt;/span&gt;(aSelector) isEqualToString:&lt;span class=&quot;string&quot;&gt;@&quot;sihai&quot;&lt;/span&gt;]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; [&lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; forwardingTargetForSelector:aSelector];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;系统会把选择子作为参数，返回给我们一个选择子对象。运行的系统就会对相关方法实例进行查找，如果找到相关方法就实行，找不到就结束转发。&lt;/p&gt;
&lt;h3 id=&quot;3完整的消息传递&quot;&gt;&lt;a href=&quot;#3完整的消息传递&quot; class=&quot;headerlink&quot; title=&quot;3完整的消息传递&quot;&gt;&lt;/a&gt;3完整的消息传递&lt;/h3&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;-(&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)forwardInvocation:(&lt;span class=&quot;built_in&quot;&gt;NSInvocation&lt;/span&gt; *)anInvocation;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;实现的具体方法如下：&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-(&lt;span class=&quot;built_in&quot;&gt;NSMethodSignature&lt;/span&gt;*)methodSignatureForSelector:(SEL)aSelector&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([&lt;span class=&quot;built_in&quot;&gt;NSStringFromSelector&lt;/span&gt;(aSelector) isEqualToString:&lt;span class=&quot;string&quot;&gt;@&quot;sihai&quot;&lt;/span&gt;]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; [&lt;span class=&quot;built_in&quot;&gt;NSMethodSignature&lt;/span&gt; signatureWithObjCTypes:&lt;span class=&quot;string&quot;&gt;&quot;v@:&quot;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; [&lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; methodSignatureForSelector:aSelector];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-(&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)forwardInvocation:(&lt;span class=&quot;built_in&quot;&gt;NSInvocation&lt;/span&gt; *)anInvocation&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        anInvocation.selector = &lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(fly);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [anInvocation invokeWithTarget:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;如果上面2步骤中返回依然是nil，也会执行完整的消息传输消息机制。在该方法中我们可以改变其目标，然后运行系统就会根据改变的目标，在其目标中查询实现方法别调用。当然也可以进行修改选择子。&lt;/p&gt;
&lt;h3 id=&quot;如果方法调用失败&quot;&gt;&lt;a href=&quot;#如果方法调用失败&quot; class=&quot;headerlink&quot; title=&quot;如果方法调用失败&quot;&gt;&lt;/a&gt;如果方法调用失败&lt;/h3&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;-(&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)doesNotRecognizeSelector:(SEL)aSelector;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;通过对于[self method];方法的实现过程的进行探究我们我们可以了解到在消息传递过程是如何实现的，而且我们可以更具我们需求对其中的方法进行相应的而修改。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;runtime是Objc语言特性，本人通过对于的研究理解是：通过runtime我们可以等到我们类中所有元素的资料信息，可以使用期同工的API对类进行我们想到达到的目的；在我们调试过程中也可以通过打印来简化我们调试信息；最棒的就是我们可以了解程序运行过程可以在开发中使我们更加得心应手。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;h3 id=&quot;参考来之：&quot;&gt;&lt;a href=&quot;#参考来之：&quot; class=&quot;headerlink&quot; title=&quot;参考来之：&quot;&gt;&lt;/a&gt;参考来之：&lt;/h3&gt;&lt;p&gt;&lt;a href=&quot;http://www.cocoachina.com/ios/20151015/13769.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Runtime初涉之消息转发&lt;/a&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;a href=&quot;http://www.cocoachina.com/ios/20150901/13173.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;学习runtime的理解和心得&lt;/a&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;a href=&quot;https://developer.apple.com/library/ios/documentation/Cocoa/Reference/ObjCRuntimeRef/index.html#//apple_ref/doc/uid/TP40001418-CH1g-88778&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;runtime 源码&lt;/a&gt;&lt;br&gt;&lt;br&gt;&lt;a href=&quot;http://www.jianshu.com/p/f900de4a1495#&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;OC刨根问底-Runtime简单粗暴理解&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;网上其实有很多关于讲述runtime的学习资料，也是站在巨人肩上看的更远。写这篇文章也是对于其他人借鉴和翻阅源码，向源码寻求解释吧。&lt;/br&gt;&lt;br&gt;无意间看到一份关于runtime的博客，感觉写的挺不错的就耐心的看下。看后发现自己对runtime的理解还是比较浅，就决定对自己博客进行重新修改。&lt;/p&gt;
&lt;div style=&quot;color:#008B8B&quot; &gt;&lt;br&gt;&lt;p&gt;随便在这里抛出一个问题：假如我们程序员自己是系统我们怎么执行程序呢？当然换个高级点的说法，如果我们是系统设计者我们想要runtime怎么运行？&lt;/p&gt;&lt;br&gt;&lt;/div&gt;
    
    </summary>
    
      <category term="IOS" scheme="http://yoursite.com/categories/IOS/"/>
    
    
      <category term="IOS" scheme="http://yoursite.com/tags/IOS/"/>
    
  </entry>
  
  <entry>
    <title>Fastlane 讲解</title>
    <link href="http://yoursite.com/2016/05/29/Fastlane%E8%AE%B2%E8%A7%A3/"/>
    <id>http://yoursite.com/2016/05/29/Fastlane讲解/</id>
    <published>2016-05-29T04:13:46.000Z</published>
    <updated>2017-08-25T17:18:07.000Z</updated>
    
    <content type="html">&lt;p&gt;大概在一个月左右写过关于cocoaPods安装和使用方法，如果说cocoaPods是我们盾牌（可以让我们在开发过程中专注实现代码部分），那么fastlane就会是我们开发过程中的长矛（帮助我们在开发过程中提交测试、快速发布）。&lt;br&gt;想知道fastlane了解点击&lt;a href=&quot;https://fastlane.tools&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;这里&lt;br&gt;&lt;/a&gt;获取fastlan的github下载点击&lt;a href=&quot;https://github.com/fastlane/fastlane&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;这里&lt;/a&gt;&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h3 id=&quot;fastlane安装&quot;&gt;&lt;a href=&quot;#fastlane安装&quot; class=&quot;headerlink&quot; title=&quot;fastlane安装&quot;&gt;&lt;/a&gt;fastlane安装&lt;/h3&gt;&lt;p&gt;fastlane是基于Ruby的开发脚本集合有助于我们在IOS开发过程中达到简便的开发。如果你在自己MAC上已经安装Ruby及其环境，只需要执行下列安装就可以实现&lt;br&gt;    sudo gem install fastlane –verbose&lt;br&gt;确定自己安装的是最新版本的Xcode:&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Xcode-select --install&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;如果在启动fastlane比较慢的情况可以执行:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;gem cleanup&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;fastlane使用具体方法和具体功能&quot;&gt;&lt;a href=&quot;#fastlane使用具体方法和具体功能&quot; class=&quot;headerlink&quot; title=&quot;fastlane使用具体方法和具体功能&quot;&gt;&lt;/a&gt;fastlane使用具体方法和具体功能&lt;/h3&gt;&lt;p&gt;了解具体使用点击&lt;a href=&quot;https://github.com/fastlane/fastlane/tree/master/deliver&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;这里&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;&lt;br&gt;&lt;li&gt;deliver：上传屏幕截图、二进制程序数据和应用程序到AppStore&lt;/li&gt;&lt;br&gt;&lt;li&gt;snapshot：自动截取你的程序在每个设备上的图片&lt;/li&gt;&lt;br&gt;&lt;li&gt;frameit：应用截屏外添加设备框架&lt;/li&gt;&lt;br&gt;&lt;li&gt;pem：可以自动化地生成和更新应用推送通知描述文件&lt;/li&gt;&lt;br&gt;&lt;li&gt;sigh：生成下载开发商店的配置文件&lt;/li&gt;&lt;br&gt;&lt;li&gt;pilot：最好的在终端管理测试和建立的文件&lt;/li&gt;&lt;br&gt;&lt;li&gt;boarding：很容易的方式邀请你测试beta测试&lt;/li&gt;&lt;br&gt;&lt;li&gt;gyp：建立新的发布的版本&lt;/li&gt;&lt;br&gt;&lt;li&gt;match：使用git同步你成员间的开发者证书和文件配置&lt;/li&gt;&lt;br&gt;&lt;/ul&gt;

&lt;h3 id=&quot;fastlane举例：&quot;&gt;&lt;a href=&quot;#fastlane举例：&quot; class=&quot;headerlink&quot; title=&quot;fastlane举例：&quot;&gt;&lt;/a&gt;fastlane举例：&lt;/h3&gt;&lt;p&gt;使用deliver自动打包我们App提交到AppStore，官方使用点击&lt;a href=&quot;https://github.com/fastlane/fastlane/tree/master/deliver&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;这里&lt;/a&gt;&lt;br&gt;打开终端进行我们项目所在的floder，我的项目是在桌面上名称是hello&lt;br&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;cd ~/desktop/hello&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;然后输入：&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;deliver init&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;然后输入我们的Apple ID Username:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;再输入我们的Password &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&quot;fastlane使用场景&quot;&gt;&lt;a href=&quot;#fastlane使用场景&quot; class=&quot;headerlink&quot; title=&quot;fastlane使用场景&quot;&gt;&lt;/a&gt;fastlane使用场景&lt;/h3&gt;&lt;ul&gt;&lt;br&gt;&lt;li&gt;在我们开发后每次提交时执行的测试（有team的单元测试和团队开发的集成测试）(pilot)&lt;/li&gt;&lt;br&gt;&lt;li&gt;构建我们使用的Bate版本时（boarding）&lt;/li&gt;&lt;br&gt;&lt;li&gt;开发好项目需要提给界面截图时(snapshot)&lt;/li&gt;&lt;br&gt;&lt;li&gt;构建并分发至应用商店（这包括更新配置文件，创建新的屏幕截图，上传应用至应用商店并提交应用）(deliver)&lt;/li&gt;&lt;br&gt;&lt;/ul&gt;

&lt;h3 id=&quot;fastlane典型的开发流程&quot;&gt;&lt;a href=&quot;#fastlane典型的开发流程&quot; class=&quot;headerlink&quot; title=&quot;fastlane典型的开发流程&quot;&gt;&lt;/a&gt;fastlane典型的开发流程&lt;/h3&gt;&lt;p&gt;此开发流程也是我们团队开发过程中基本开发顺序&lt;br&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;lane :appstore &lt;span class=&quot;keyword&quot;&gt;do&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  increment_build_number&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  cocoapods&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  xctool&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  snapshot&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  sigh&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  deliver&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  frameit&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  sh &lt;span class=&quot;string&quot;&gt;&quot;./customScript.sh&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  slack&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;end&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;cocoaPods帮助我们管理三方开源库，fastlane可以在我们开发过程中简化我们开发过程以及简化我们发布流程。如果要提高自己IOS方面能力需要我们进一步深入研究。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;大概在一个月左右写过关于cocoaPods安装和使用方法，如果说cocoaPods是我们盾牌（可以让我们在开发过程中专注实现代码部分），那么fastlane就会是我们开发过程中的长矛（帮助我们在开发过程中提交测试、快速发布）。&lt;br&gt;想知道fastlane了解点击&lt;a href=&quot;https://fastlane.tools&quot;&gt;这里&lt;br&gt;&lt;/a&gt;获取fastlan的github下载点击&lt;a href =&quot;https://github.com/fastlane/fastlane&quot;&gt;这里&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://yoursite.com/categories/iOS/"/>
    
    
      <category term="iOS" scheme="http://yoursite.com/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>从叮叮CTO采访演讲随笔</title>
    <link href="http://yoursite.com/2016/05/29/%E4%BB%8E%E5%8F%AE%E5%8F%AECTO%E9%87%87%E8%AE%BF%E6%BC%94%E8%AE%B2%E9%9A%8F%E7%AC%94/"/>
    <id>http://yoursite.com/2016/05/29/从叮叮CTO采访演讲随笔/</id>
    <published>2016-05-29T04:09:11.000Z</published>
    <updated>2017-06-01T07:43:44.000Z</updated>
    
    <content type="html">&lt;p&gt;今天在看One’s Cat大神的博客时讲到如何创建我们个人的开源框架，就涉及到fastlane就找来看下，无意中看到叮叮的CTO朱鸿大神（又一尊大神）讲述自己的产品。短短22：05的视频让自己感触很大，写这篇文章也就是无聊说下自己所学知识吧。&lt;/p&gt;
&lt;h3 id=&quot;总的来说以技术来简化我们生活，目前比想象中要难。&quot;&gt;&lt;a href=&quot;#总的来说以技术来简化我们生活，目前比想象中要难。&quot; class=&quot;headerlink&quot; title=&quot;总的来说以技术来简化我们生活，目前比想象中要难。&quot;&gt;&lt;/a&gt;总的来说以技术来简化我们生活，目前比想象中要难。&lt;/h3&gt;&lt;h3 id=&quot;人员配置方面&quot;&gt;&lt;a href=&quot;#人员配置方面&quot; class=&quot;headerlink&quot; title=&quot;人员配置方面&quot;&gt;&lt;/a&gt;人员配置方面&lt;/h3&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;首先朱大神讲述团队人数有120人，而在客户端和后端比例2：1估计这样的标配也只有像阿里这样想要在移动端尤其社交这块站住一定地位强悍标配。&lt;/p&gt;
&lt;h3 id=&quot;踩过的大坑&quot;&gt;&lt;a href=&quot;#踩过的大坑&quot; class=&quot;headerlink&quot; title=&quot;踩过的大坑&quot;&gt;&lt;/a&gt;踩过的大坑&lt;/h3&gt;&lt;p&gt;朱大神讲述在数据解析方便曾经踩过一个大坑，所谓大坑就是在IOS&amp;amp;Android两个客户端对于数据解析有所不同。就是在于基本数据类型方面对于数据解析产生不同的结果，估计是使用加密方式在服务器得到数据解析有一定乱码想象只是不知道是Json还是Xml得解析（小编自己猜测）。&lt;/p&gt;
&lt;h3 id=&quot;企业电话方面&quot;&gt;&lt;a href=&quot;#企业电话方面&quot; class=&quot;headerlink&quot; title=&quot;企业电话方面&quot;&gt;&lt;/a&gt;企业电话方面&lt;/h3&gt;&lt;p&gt;大神说出目前我们移动的端所在2G用户比重挺大，采用融合通信方向期间还是用阿里的线路。关于在WiFi情况下测试使用OA通信方式，随便讲述在手机网络提供商不同的情况下具体情况（联通网络通信一旦打开网络就会占用一条信道进行通信，所以在数据较大时带宽就是占用较大问题~小心脏作为客户端开发的小编之前竟没有听说过）。&lt;/p&gt;
&lt;h3 id=&quot;发布机制和团队意思&quot;&gt;&lt;a href=&quot;#发布机制和团队意思&quot; class=&quot;headerlink&quot; title=&quot;发布机制和团队意思&quot;&gt;&lt;/a&gt;发布机制和团队意思&lt;/h3&gt;&lt;p&gt;由于叮叮是基于企业通信服务的行业应用性能方便真是个大问题。&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt; 嗨，记得去年的暑假在参加深圳一个活动时，黄老大奔去深圳创业~那时我们住在旅社&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;他说要做企业OA，我随口说现在创业那么火要不做一个给创业者做个服务型的应用提高效率。看到这个感觉&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;事情真的不想我们想象的那么简单！&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;作为开发人员我们都知道如何做到流畅滚动界面和通信方面及时，这个是很大的挑战。这个后面有所涉及大家还是耐心看下去。&lt;br&gt;其实真正触动💘项目组技术、产品和运营拆分为7个team，实行竞争估计机制。产品经理对于自己team负责的功能进行跟进，技术和运营负责相关技术开发。这样完成每天都可以进行一个bate的提交，三周进行产品的一次迭代。项目开发之快。&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt; 最让小编疑惑的是产品之间功能可以进行模块开发~基于面向对象有点（针对功能实现&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;可以进行模块划分），但是运营是怎么在一个大的team然后7个小团队之间实现😂&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;记得不久前有个标题党：BAT未来还会存在吗？中间就是利用“二八法则”来讲述大企业面对科技什么鬼突变时难以进行改革，小企业更有活力。来辩证讲述自己的观点，看小编微微一笑就喝下水平静平静。&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt; 不过目前看来这个定理估计是有自己价值，以后如果是自己出来尝试就可以试验下，此&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;处可以hulue&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&quot;灰度用户&quot;&gt;&lt;a href=&quot;#灰度用户&quot; class=&quot;headerlink&quot; title=&quot;灰度用户&quot;&gt;&lt;/a&gt;灰度用户&lt;/h3&gt;&lt;p&gt;听到的第一感觉就是“恩？”请问和37度灰有关系不。我可是窦文涛的粉丝啊，难道是自己见识太少。认认真&lt;br&gt;真百度一下关于灰度的问题，所说没有找到灰度用户说法但是却看到关于QQ传授灰度法则：需求度、速度、灵活度、冗余度、开放协作度、创新度和进化度。&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;小编下面就为大家讲述下：&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;需求度：用户需求就是使用者最想要。例如：只从去年国家放开二胎政策，我们就会看到今年母婴行业天天&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;火爆的行业，毕竟70，80后大叔和阿姨估计从那天就开始人类伟大的传承奋斗啦😛&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;速度：这个估计大家都知道，刘翔110跨栏成为亚洲飞人的称号。对于互联网而言速度就更难能可贵的，估&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;计这也是面对微信的叮叮三周一个版本更新具体体现吧。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;灵活度：面对当前局势有所判断和对未知的预见，就像神雕侠侣里的段誉，面对强大恶老三（一直都自称老&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;二来着）虽说武术哥不行。但是好在凌波微步，照样在打赌中成为你小子的师傅不是。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;冗余度：看到这心里凉把把的，QQ老大你也是程序员开始的，冗余度是在程序开发过程中我们想法设法解&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;决。后来定睛一看，哦，原来是是试错啊，好吧奉上我的膝盖👍🏻。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;开放协作度：在互联网中把自家的资源拿来共享合作，大家都知道蜜蜂一般蜂巢中只有一个蜂后无数工蜂，&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;蜂后向工蜂提供生命工蜂负责具体事务。之后大家在一个集体里把自己越做越大，蜂后后期几乎可以独资。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;创新度：只记得去年克强大大所得万众创新，大众创业。后面身边很多人就去啦，一路好走🌵&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;进化度：QQ大佬说6个如果做到的话，这个会自动完成。有点生物进化的味道，但是缺少物竞天择。&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;问题调试&quot;&gt;&lt;a href=&quot;#问题调试&quot; class=&quot;headerlink&quot; title=&quot;问题调试&quot;&gt;&lt;/a&gt;问题调试&lt;/h3&gt;&lt;blockquote&gt;&lt;p&gt;这里之所使用代码格式是真的有重要，仅对于码农来说，比方说本人。&lt;br&gt;还像是Android段可以进行fix后台自动修复功能，IOS客户端是在IOS端直接进行修改。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;性能优化要求&quot;&gt;&lt;a href=&quot;#性能优化要求&quot; class=&quot;headerlink&quot; title=&quot;性能优化要求&quot;&gt;&lt;/a&gt;性能优化要求&lt;/h3&gt;&lt;p&gt;省电和顺滑，具体怎么完成和实现，朱大神微微😃。当讲到在图片下载处理时主要将海外，朱大神说我们在海外有简历服务器然后跟具体的路由优化选择可以对图片下载加快速度。&lt;/p&gt;
&lt;h3 id=&quot;企业群聊处理&quot;&gt;&lt;a href=&quot;#企业群聊处理&quot; class=&quot;headerlink&quot; title=&quot;企业群聊处理&quot;&gt;&lt;/a&gt;企业群聊处理&lt;/h3&gt;&lt;p&gt;假设一种情况：当很多在一个群组中一起聊天，一秒可以让数据达到几千条。请问你怎么解决？&lt;br&gt;朱大神解决方式：一起把数据下载下来，保存不至于丢失。但是最后显示的数据大多是最后十几二十几条。这样可以减少屏幕的刷屏率，优化性能。至少在GPU渲染显示方面肯定有所优化🙅🏻&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;之所以写这些随笔，是想让自己记住自己看过知识。毕竟好记性是在不如一个烂笔头，写的过程也是在记忆&lt;br&gt;中重新思考的过程。&lt;/p&gt;
&lt;/blockquote&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;今天在看One’s Cat大神的博客时讲到如何创建我们个人的开源框架，就涉及到fastlane就找来看下，无意中看到叮叮的CTO朱鸿大神（又一尊大神）讲述自己的产品。短短22：05的视频让自己感触很大，写这篇文章也就是无聊说下自己所学知识吧。&lt;/p&gt;
&lt;h3 id=&quot;总的来说以技术来简化我们生活，目前比想象中要难。&quot;&gt;&lt;a href=&quot;#总的来说以技术来简化我们生活，目前比想象中要难。&quot; class=&quot;headerlink&quot; title=&quot;总的来说以技术来简化我们生活，目前比想象中要难。&quot;&gt;&lt;/a&gt;总的来说以技术来简化我们生活，目前比想象中要难。&lt;/h3&gt;&lt;h3 id=&quot;人员配置方面&quot;&gt;&lt;a href=&quot;#人员配置方面&quot; class=&quot;headerlink&quot; title=&quot;人员配置方面&quot;&gt;&lt;/a&gt;人员配置方面&lt;/h3&gt;
    
    </summary>
    
      <category term="随笔" scheme="http://yoursite.com/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
      <category term="视频心得" scheme="http://yoursite.com/tags/%E8%A7%86%E9%A2%91%E5%BF%83%E5%BE%97/"/>
    
  </entry>
  
  <entry>
    <title>博客搬家感觉</title>
    <link href="http://yoursite.com/2016/05/28/%E5%8D%9A%E5%AE%A2%E5%BC%80%E5%90%AF/"/>
    <id>http://yoursite.com/2016/05/28/博客开启/</id>
    <published>2016-05-28T13:44:27.000Z</published>
    <updated>2017-06-01T07:48:51.000Z</updated>
    
    <content type="html">&lt;p&gt; &lt;br&gt;&lt;br&gt; &lt;br&gt; &lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;博客地址有经常使p用的博客园搬至简书，从简书搬到Hexo建立的Github上面。从此开启自己在跟人博客学&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;习和分享征程，要是说写这些对我最大驱动力是一条自己一直对技术喜爱和完成自己蜕变之路。 &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;hr&gt;
&lt;p&gt;昨天把博客搬至自己的博客，虽说花费的时间有点多，但是看着自己花费的时间有所收获还是很开心&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;的。而且自己也将要离开生活四年头大开始新的征程，有的同学说自己上大学优劣，不过我是真心感&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;谢头大。在四年间自己做过很多事情，也收获很多。其实最大的收获是有一件事值得自己一直去等待&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;这也需是自己在大学最大的收获，也是在大学最开心大三下半学期╮(╯▽╰)╭。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/p&gt;
&lt;p style=&quot;text-align:right;&quot;&gt;&lt;br&gt;    – &lt;a href=&quot;https://github.com/boilWater/boilWater.github.io&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt; 后面会附上自己简历独自介绍😘&lt;/a&gt;&lt;br&gt;&lt;/p&gt;


</content>
    
    <summary type="html">
    
      &lt;p&gt; &lt;/br&gt;&lt;br&gt; &lt;/br&gt; &lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;博客地址有经常使p用的博客园搬至简书，从简书搬到Hexo建立的Github上面。从此开启自己在跟人博客学&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;习和分享征程，要是说写这些对我最大驱动力是一条自己一直对技术喜爱和完成自己蜕变之路。 &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="随笔" scheme="http://yoursite.com/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
      <category term="博客之初" scheme="http://yoursite.com/tags/%E5%8D%9A%E5%AE%A2%E4%B9%8B%E5%88%9D/"/>
    
  </entry>
  
</feed>
